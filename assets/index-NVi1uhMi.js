var iA=Object.defineProperty;var aA=(e,t,n)=>t in e?iA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var z0=(e,t,n)=>aA(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var hp={exports:{}},_l={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L0;function rA(){if(L0)return _l;L0=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(a,s,o){var u=null;if(o!==void 0&&(u=""+o),s.key!==void 0&&(u=""+s.key),"key"in s){o={};for(var d in s)d!=="key"&&(o[d]=s[d])}else o=s;return s=o.ref,{$$typeof:e,type:a,key:u,ref:s!==void 0?s:null,props:o}}return _l.Fragment=t,_l.jsx=n,_l.jsxs=n,_l}var U0;function oA(){return U0||(U0=1,hp.exports=rA()),hp.exports}var L=oA(),mp={exports:{}},Qe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P0;function sA(){if(P0)return Qe;P0=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),b=Symbol.iterator;function E(z){return z===null||typeof z!="object"?null:(z=b&&z[b]||z["@@iterator"],typeof z=="function"?z:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,N={};function R(z,q,te){this.props=z,this.context=q,this.refs=N,this.updater=te||x}R.prototype.isReactComponent={},R.prototype.setState=function(z,q){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,q,"setState")},R.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function $(){}$.prototype=R.prototype;function O(z,q,te){this.props=z,this.context=q,this.refs=N,this.updater=te||x}var k=O.prototype=new $;k.constructor=O,I(k,R.prototype),k.isPureReactComponent=!0;var P=Array.isArray;function G(){}var B={H:null,A:null,T:null,S:null},K=Object.prototype.hasOwnProperty;function Y(z,q,te){var de=te.ref;return{$$typeof:e,type:z,key:q,ref:de!==void 0?de:null,props:te}}function se(z,q){return Y(z.type,q,z.props)}function ve(z){return typeof z=="object"&&z!==null&&z.$$typeof===e}function _e(z){var q={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(te){return q[te]})}var ge=/\/+/g;function $e(z,q){return typeof z=="object"&&z!==null&&z.key!=null?_e(""+z.key):q.toString(36)}function Ae(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(G,G):(z.status="pending",z.then(function(q){z.status==="pending"&&(z.status="fulfilled",z.value=q)},function(q){z.status==="pending"&&(z.status="rejected",z.reason=q)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function H(z,q,te,de,Me){var Fe=typeof z;(Fe==="undefined"||Fe==="boolean")&&(z=null);var oe=!1;if(z===null)oe=!0;else switch(Fe){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(z.$$typeof){case e:case t:oe=!0;break;case m:return oe=z._init,H(oe(z._payload),q,te,de,Me)}}if(oe)return Me=Me(z),oe=de===""?"."+$e(z,0):de,P(Me)?(te="",oe!=null&&(te=oe.replace(ge,"$&/")+"/"),H(Me,q,te,"",function(Pt){return Pt})):Me!=null&&(ve(Me)&&(Me=se(Me,te+(Me.key==null||z&&z.key===Me.key?"":(""+Me.key).replace(ge,"$&/")+"/")+oe)),q.push(Me)),1;oe=0;var Be=de===""?".":de+":";if(P(z))for(var je=0;je<z.length;je++)de=z[je],Fe=Be+$e(de,je),oe+=H(de,q,te,Fe,Me);else if(je=E(z),typeof je=="function")for(z=je.call(z),je=0;!(de=z.next()).done;)de=de.value,Fe=Be+$e(de,je++),oe+=H(de,q,te,Fe,Me);else if(Fe==="object"){if(typeof z.then=="function")return H(Ae(z),q,te,de,Me);throw q=String(z),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return oe}function j(z,q,te){if(z==null)return z;var de=[],Me=0;return H(z,de,"","",function(Fe){return q.call(te,Fe,Me++)}),de}function fe(z){if(z._status===-1){var q=z._result;q=q(),q.then(function(te){(z._status===0||z._status===-1)&&(z._status=1,z._result=te)},function(te){(z._status===0||z._status===-1)&&(z._status=2,z._result=te)}),z._status===-1&&(z._status=0,z._result=q)}if(z._status===1)return z._result.default;throw z._result}var Ee=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},Ie={map:j,forEach:function(z,q,te){j(z,function(){q.apply(this,arguments)},te)},count:function(z){var q=0;return j(z,function(){q++}),q},toArray:function(z){return j(z,function(q){return q})||[]},only:function(z){if(!ve(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return Qe.Activity=_,Qe.Children=Ie,Qe.Component=R,Qe.Fragment=n,Qe.Profiler=s,Qe.PureComponent=O,Qe.StrictMode=a,Qe.Suspense=p,Qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,Qe.__COMPILER_RUNTIME={__proto__:null,c:function(z){return B.H.useMemoCache(z)}},Qe.cache=function(z){return function(){return z.apply(null,arguments)}},Qe.cacheSignal=function(){return null},Qe.cloneElement=function(z,q,te){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var de=I({},z.props),Me=z.key;if(q!=null)for(Fe in q.key!==void 0&&(Me=""+q.key),q)!K.call(q,Fe)||Fe==="key"||Fe==="__self"||Fe==="__source"||Fe==="ref"&&q.ref===void 0||(de[Fe]=q[Fe]);var Fe=arguments.length-2;if(Fe===1)de.children=te;else if(1<Fe){for(var oe=Array(Fe),Be=0;Be<Fe;Be++)oe[Be]=arguments[Be+2];de.children=oe}return Y(z.type,Me,de)},Qe.createContext=function(z){return z={$$typeof:u,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:o,_context:z},z},Qe.createElement=function(z,q,te){var de,Me={},Fe=null;if(q!=null)for(de in q.key!==void 0&&(Fe=""+q.key),q)K.call(q,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(Me[de]=q[de]);var oe=arguments.length-2;if(oe===1)Me.children=te;else if(1<oe){for(var Be=Array(oe),je=0;je<oe;je++)Be[je]=arguments[je+2];Me.children=Be}if(z&&z.defaultProps)for(de in oe=z.defaultProps,oe)Me[de]===void 0&&(Me[de]=oe[de]);return Y(z,Fe,Me)},Qe.createRef=function(){return{current:null}},Qe.forwardRef=function(z){return{$$typeof:d,render:z}},Qe.isValidElement=ve,Qe.lazy=function(z){return{$$typeof:m,_payload:{_status:-1,_result:z},_init:fe}},Qe.memo=function(z,q){return{$$typeof:f,type:z,compare:q===void 0?null:q}},Qe.startTransition=function(z){var q=B.T,te={};B.T=te;try{var de=z(),Me=B.S;Me!==null&&Me(te,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(G,Ee)}catch(Fe){Ee(Fe)}finally{q!==null&&te.types!==null&&(q.types=te.types),B.T=q}},Qe.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},Qe.use=function(z){return B.H.use(z)},Qe.useActionState=function(z,q,te){return B.H.useActionState(z,q,te)},Qe.useCallback=function(z,q){return B.H.useCallback(z,q)},Qe.useContext=function(z){return B.H.useContext(z)},Qe.useDebugValue=function(){},Qe.useDeferredValue=function(z,q){return B.H.useDeferredValue(z,q)},Qe.useEffect=function(z,q){return B.H.useEffect(z,q)},Qe.useEffectEvent=function(z){return B.H.useEffectEvent(z)},Qe.useId=function(){return B.H.useId()},Qe.useImperativeHandle=function(z,q,te){return B.H.useImperativeHandle(z,q,te)},Qe.useInsertionEffect=function(z,q){return B.H.useInsertionEffect(z,q)},Qe.useLayoutEffect=function(z,q){return B.H.useLayoutEffect(z,q)},Qe.useMemo=function(z,q){return B.H.useMemo(z,q)},Qe.useOptimistic=function(z,q){return B.H.useOptimistic(z,q)},Qe.useReducer=function(z,q,te){return B.H.useReducer(z,q,te)},Qe.useRef=function(z){return B.H.useRef(z)},Qe.useState=function(z){return B.H.useState(z)},Qe.useSyncExternalStore=function(z,q,te){return B.H.useSyncExternalStore(z,q,te)},Qe.useTransition=function(){return B.H.useTransition()},Qe.version="19.2.3",Qe}var B0;function Xh(){return B0||(B0=1,mp.exports=sA()),mp.exports}var We=Xh(),gp={exports:{}},bl={},yp={exports:{}},vp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0;function lA(){return G0||(G0=1,(function(e){function t(H,j){var fe=H.length;H.push(j);e:for(;0<fe;){var Ee=fe-1>>>1,Ie=H[Ee];if(0<s(Ie,j))H[Ee]=j,H[fe]=Ie,fe=Ee;else break e}}function n(H){return H.length===0?null:H[0]}function a(H){if(H.length===0)return null;var j=H[0],fe=H.pop();if(fe!==j){H[0]=fe;e:for(var Ee=0,Ie=H.length,z=Ie>>>1;Ee<z;){var q=2*(Ee+1)-1,te=H[q],de=q+1,Me=H[de];if(0>s(te,fe))de<Ie&&0>s(Me,te)?(H[Ee]=Me,H[de]=fe,Ee=de):(H[Ee]=te,H[q]=fe,Ee=q);else if(de<Ie&&0>s(Me,fe))H[Ee]=Me,H[de]=fe,Ee=de;else break e}}return j}function s(H,j){var fe=H.sortIndex-j.sortIndex;return fe!==0?fe:H.id-j.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var u=Date,d=u.now();e.unstable_now=function(){return u.now()-d}}var p=[],f=[],m=1,_=null,b=3,E=!1,x=!1,I=!1,N=!1,R=typeof setTimeout=="function"?setTimeout:null,$=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function k(H){for(var j=n(f);j!==null;){if(j.callback===null)a(f);else if(j.startTime<=H)a(f),j.sortIndex=j.expirationTime,t(p,j);else break;j=n(f)}}function P(H){if(I=!1,k(H),!x)if(n(p)!==null)x=!0,G||(G=!0,_e());else{var j=n(f);j!==null&&Ae(P,j.startTime-H)}}var G=!1,B=-1,K=5,Y=-1;function se(){return N?!0:!(e.unstable_now()-Y<K)}function ve(){if(N=!1,G){var H=e.unstable_now();Y=H;var j=!0;try{e:{x=!1,I&&(I=!1,$(B),B=-1),E=!0;var fe=b;try{t:{for(k(H),_=n(p);_!==null&&!(_.expirationTime>H&&se());){var Ee=_.callback;if(typeof Ee=="function"){_.callback=null,b=_.priorityLevel;var Ie=Ee(_.expirationTime<=H);if(H=e.unstable_now(),typeof Ie=="function"){_.callback=Ie,k(H),j=!0;break t}_===n(p)&&a(p),k(H)}else a(p);_=n(p)}if(_!==null)j=!0;else{var z=n(f);z!==null&&Ae(P,z.startTime-H),j=!1}}break e}finally{_=null,b=fe,E=!1}j=void 0}}finally{j?_e():G=!1}}}var _e;if(typeof O=="function")_e=function(){O(ve)};else if(typeof MessageChannel<"u"){var ge=new MessageChannel,$e=ge.port2;ge.port1.onmessage=ve,_e=function(){$e.postMessage(null)}}else _e=function(){R(ve,0)};function Ae(H,j){B=R(function(){H(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_next=function(H){switch(b){case 1:case 2:case 3:var j=3;break;default:j=b}var fe=b;b=j;try{return H()}finally{b=fe}},e.unstable_requestPaint=function(){N=!0},e.unstable_runWithPriority=function(H,j){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var fe=b;b=H;try{return j()}finally{b=fe}},e.unstable_scheduleCallback=function(H,j,fe){var Ee=e.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?Ee+fe:Ee):fe=Ee,H){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=fe+Ie,H={id:m++,callback:j,priorityLevel:H,startTime:fe,expirationTime:Ie,sortIndex:-1},fe>Ee?(H.sortIndex=fe,t(f,H),n(p)===null&&H===n(f)&&(I?($(B),B=-1):I=!0,Ae(P,fe-Ee))):(H.sortIndex=Ie,t(p,H),x||E||(x=!0,G||(G=!0,_e()))),H},e.unstable_shouldYield=se,e.unstable_wrapCallback=function(H){var j=b;return function(){var fe=b;b=j;try{return H.apply(this,arguments)}finally{b=fe}}}})(vp)),vp}var V0;function uA(){return V0||(V0=1,yp.exports=lA()),yp.exports}var _p={exports:{}},kn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q0;function cA(){if(q0)return kn;q0=1;var e=Xh();function t(p){var f="https://react.dev/errors/"+p;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+p+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var a={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(p,f,m){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:p,containerInfo:f,implementation:m}}var u=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(p,f){if(p==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return kn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,kn.createPortal=function(p,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(p,f,null,m)},kn.flushSync=function(p){var f=u.T,m=a.p;try{if(u.T=null,a.p=2,p)return p()}finally{u.T=f,a.p=m,a.d.f()}},kn.preconnect=function(p,f){typeof p=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,a.d.C(p,f))},kn.prefetchDNS=function(p){typeof p=="string"&&a.d.D(p)},kn.preinit=function(p,f){if(typeof p=="string"&&f&&typeof f.as=="string"){var m=f.as,_=d(m,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,E=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?a.d.S(p,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:b,fetchPriority:E}):m==="script"&&a.d.X(p,{crossOrigin:_,integrity:b,fetchPriority:E,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},kn.preinitModule=function(p,f){if(typeof p=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=d(f.as,f.crossOrigin);a.d.M(p,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&a.d.M(p)},kn.preload=function(p,f){if(typeof p=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,_=d(m,f.crossOrigin);a.d.L(p,m,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},kn.preloadModule=function(p,f){if(typeof p=="string")if(f){var m=d(f.as,f.crossOrigin);a.d.m(p,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else a.d.m(p)},kn.requestFormReset=function(p){a.d.r(p)},kn.unstable_batchedUpdates=function(p,f){return p(f)},kn.useFormState=function(p,f,m){return u.H.useFormState(p,f,m)},kn.useFormStatus=function(){return u.H.useHostTransitionStatus()},kn.version="19.2.3",kn}var H0;function dA(){if(H0)return _p.exports;H0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),_p.exports=cA(),_p.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F0;function fA(){if(F0)return bl;F0=1;var e=uA(),t=Xh(),n=dA();function a(i){var r="https://react.dev/errors/"+i;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function o(i){var r=i,l=i;if(i.alternate)for(;r.return;)r=r.return;else{i=r;do r=i,(r.flags&4098)!==0&&(l=r.return),i=r.return;while(i)}return r.tag===3?l:null}function u(i){if(i.tag===13){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function d(i){if(i.tag===31){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function p(i){if(o(i)!==i)throw Error(a(188))}function f(i){var r=i.alternate;if(!r){if(r=o(i),r===null)throw Error(a(188));return r!==i?null:i}for(var l=i,c=r;;){var y=l.return;if(y===null)break;var T=y.alternate;if(T===null){if(c=y.return,c!==null){l=c;continue}break}if(y.child===T.child){for(T=y.child;T;){if(T===l)return p(y),i;if(T===c)return p(y),r;T=T.sibling}throw Error(a(188))}if(l.return!==c.return)l=y,c=T;else{for(var C=!1,D=y.child;D;){if(D===l){C=!0,l=y,c=T;break}if(D===c){C=!0,c=y,l=T;break}D=D.sibling}if(!C){for(D=T.child;D;){if(D===l){C=!0,l=T,c=y;break}if(D===c){C=!0,c=T,l=y;break}D=D.sibling}if(!C)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?i:r}function m(i){var r=i.tag;if(r===5||r===26||r===27||r===6)return i;for(i=i.child;i!==null;){if(r=m(i),r!==null)return r;i=i.sibling}return null}var _=Object.assign,b=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),$=Symbol.for("react.consumer"),O=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),se=Symbol.for("react.memo_cache_sentinel"),ve=Symbol.iterator;function _e(i){return i===null||typeof i!="object"?null:(i=ve&&i[ve]||i["@@iterator"],typeof i=="function"?i:null)}var ge=Symbol.for("react.client.reference");function $e(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ge?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case I:return"Fragment";case R:return"Profiler";case N:return"StrictMode";case P:return"Suspense";case G:return"SuspenseList";case Y:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case x:return"Portal";case O:return i.displayName||"Context";case $:return(i._context.displayName||"Context")+".Consumer";case k:var r=i.render;return i=i.displayName,i||(i=r.displayName||r.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case B:return r=i.displayName||null,r!==null?r:$e(i.type)||"Memo";case K:r=i._payload,i=i._init;try{return $e(i(r))}catch{}}return null}var Ae=Array.isArray,H=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},Ee=[],Ie=-1;function z(i){return{current:i}}function q(i){0>Ie||(i.current=Ee[Ie],Ee[Ie]=null,Ie--)}function te(i,r){Ie++,Ee[Ie]=i.current,i.current=r}var de=z(null),Me=z(null),Fe=z(null),oe=z(null);function Be(i,r){switch(te(Fe,r),te(Me,i),te(de,null),r.nodeType){case 9:case 11:i=(i=r.documentElement)&&(i=i.namespaceURI)?r0(i):0;break;default:if(i=r.tagName,r=r.namespaceURI)r=r0(r),i=o0(r,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}q(de),te(de,i)}function je(){q(de),q(Me),q(Fe)}function Pt(i){i.memoizedState!==null&&te(oe,i);var r=de.current,l=o0(r,i.type);r!==l&&(te(Me,i),te(de,l))}function cn(i){Me.current===i&&(q(de),q(Me)),oe.current===i&&(q(oe),ml._currentValue=fe)}var nt,yt;function Bt(i){if(nt===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);nt=r&&r[1]||"",yt=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nt+i+yt}var ei=!1;function Ot(i,r){if(!i||ei)return"";ei=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(re){var ee=re}Reflect.construct(i,[],me)}else{try{me.call()}catch(re){ee=re}i.call(me.prototype)}}else{try{throw Error()}catch(re){ee=re}(me=i())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(re){if(re&&ee&&typeof re.stack=="string")return[re.stack,ee.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=c.DetermineComponentFrameRoot(),C=T[0],D=T[1];if(C&&D){var V=C.split(`
`),Q=D.split(`
`);for(y=c=0;c<V.length&&!V[c].includes("DetermineComponentFrameRoot");)c++;for(;y<Q.length&&!Q[y].includes("DetermineComponentFrameRoot");)y++;if(c===V.length||y===Q.length)for(c=V.length-1,y=Q.length-1;1<=c&&0<=y&&V[c]!==Q[y];)y--;for(;1<=c&&0<=y;c--,y--)if(V[c]!==Q[y]){if(c!==1||y!==1)do if(c--,y--,0>y||V[c]!==Q[y]){var ce=`
`+V[c].replace(" at new "," at ");return i.displayName&&ce.includes("<anonymous>")&&(ce=ce.replace("<anonymous>",i.displayName)),ce}while(1<=c&&0<=y);break}}}finally{ei=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?Bt(l):""}function pi(i,r){switch(i.tag){case 26:case 27:case 5:return Bt(i.type);case 16:return Bt("Lazy");case 13:return i.child!==r&&r!==null?Bt("Suspense Fallback"):Bt("Suspense");case 19:return Bt("SuspenseList");case 0:case 15:return Ot(i.type,!1);case 11:return Ot(i.type.render,!1);case 1:return Ot(i.type,!0);case 31:return Bt("Activity");default:return""}}function Dt(i){try{var r="",l=null;do r+=pi(i,l),l=i,i=i.return;while(i);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Nn=Object.prototype.hasOwnProperty,tn=e.unstable_scheduleCallback,Ii=e.unstable_cancelCallback,ka=e.unstable_shouldYield,za=e.unstable_requestPaint,Gt=e.unstable_now,vt=e.unstable_getCurrentPriorityLevel,La=e.unstable_ImmediatePriority,Sr=e.unstable_UserBlockingPriority,Ri=e.unstable_NormalPriority,ti=e.unstable_LowPriority,Xi=e.unstable_IdlePriority,xr=e.log,hi=e.unstable_setDisableYieldValue,Ni=null,dn=null;function Hn(i){if(typeof xr=="function"&&hi(i),dn&&typeof dn.setStrictMode=="function")try{dn.setStrictMode(Ni,i)}catch{}}var fn=Math.clz32?Math.clz32:J,ie=Math.log,we=Math.LN2;function J(i){return i>>>=0,i===0?32:31-(ie(i)/we|0)|0}var Ye=256,kt=262144,Ft=4194304;function Et(i){var r=i&42;if(r!==0)return r;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function De(i,r,l){var c=i.pendingLanes;if(c===0)return 0;var y=0,T=i.suspendedLanes,C=i.pingedLanes;i=i.warmLanes;var D=c&134217727;return D!==0?(c=D&~T,c!==0?y=Et(c):(C&=D,C!==0?y=Et(C):l||(l=D&~i,l!==0&&(y=Et(l))))):(D=c&~T,D!==0?y=Et(D):C!==0?y=Et(C):l||(l=c&~i,l!==0&&(y=Et(l)))),y===0?0:r!==0&&r!==y&&(r&T)===0&&(T=y&-y,l=r&-r,T>=l||T===32&&(l&4194048)!==0)?r:y}function Le(i,r){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&r)===0}function Yt(i,r){switch(i){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Rt(){var i=Ft;return Ft<<=1,(Ft&62914560)===0&&(Ft=4194304),i}function Wt(i){for(var r=[],l=0;31>l;l++)r.push(i);return r}function gn(i,r){i.pendingLanes|=r,r!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function la(i,r,l,c,y,T){var C=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var D=i.entanglements,V=i.expirationTimes,Q=i.hiddenUpdates;for(l=C&~l;0<l;){var ce=31-fn(l),me=1<<ce;D[ce]=0,V[ce]=-1;var ee=Q[ce];if(ee!==null)for(Q[ce]=null,ce=0;ce<ee.length;ce++){var re=ee[ce];re!==null&&(re.lane&=-536870913)}l&=~me}c!==0&&mi(i,c,0),T!==0&&y===0&&i.tag!==0&&(i.suspendedLanes|=T&~(C&~r))}function mi(i,r,l){i.pendingLanes|=r,i.suspendedLanes&=~r;var c=31-fn(r);i.entangledLanes|=r,i.entanglements[c]=i.entanglements[c]|1073741824|l&261930}function Ua(i,r){var l=i.entangledLanes|=r;for(i=i.entanglements;l;){var c=31-fn(l),y=1<<c;y&r|i[c]&r&&(i[c]|=r),l&=~y}}function ye(i,r){var l=r&-r;return l=(l&42)!==0?1:zt(l),(l&(i.suspendedLanes|r))!==0?0:l}function zt(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function at(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Ue(){var i=j.p;return i!==0?i:(i=window.event,i===void 0?32:R0(i.type))}function $n(i,r){var l=j.p;try{return j.p=i,r()}finally{j.p=l}}var Nt=Math.random().toString(36).slice(2),qe="__reactFiber$"+Nt,Ke="__reactProps$"+Nt,et="__reactContainer$"+Nt,Xt="__reactEvents$"+Nt,Mn="__reactListeners$"+Nt,On="__reactHandles$"+Nt,pn="__reactResources$"+Nt,Zi="__reactMarker$"+Nt;function Pa(i){delete i[qe],delete i[Ke],delete i[Xt],delete i[Mn],delete i[On]}function St(i){var r=i[qe];if(r)return r;for(var l=i.parentNode;l;){if(r=l[et]||l[qe]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(i=p0(i);i!==null;){if(l=i[qe])return l;i=p0(i)}return r}i=l,l=i.parentNode}return null}function Zt(i){if(i=i[qe]||i[et]){var r=i.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return i}return null}function yn(i){var r=i.tag;if(r===5||r===26||r===27||r===6)return i.stateNode;throw Error(a(33))}function En(i){var r=i[pn];return r||(r=i[pn]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Kt(i){i[Zi]=!0}var rn=new Set,Un={};function $i(i,r){Ba(i,r),Ba(i+"Capture",r)}function Ba(i,r){for(Un[i]=r,i=0;i<r.length;i++)rn.add(r[i])}var ad=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vl={},ql={};function rd(i){return Nn.call(ql,i)?!0:Nn.call(Vl,i)?!1:ad.test(i)?ql[i]=!0:(Vl[i]=!0,!1)}function po(i,r,l){if(rd(r))if(l===null)i.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){i.removeAttribute(r);return}}i.setAttribute(r,""+l)}}function gi(i,r,l){if(l===null)i.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(r);return}i.setAttribute(r,""+l)}}function ni(i,r,l,c){if(c===null)i.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(r,l,""+c)}}function Fn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ps(i){var r=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function od(i,r,l){var c=Object.getOwnPropertyDescriptor(i.constructor.prototype,r);if(!i.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var y=c.get,T=c.set;return Object.defineProperty(i,r,{configurable:!0,get:function(){return y.call(this)},set:function(C){l=""+C,T.call(this,C)}}),Object.defineProperty(i,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(C){l=""+C},stopTracking:function(){i._valueTracker=null,delete i[r]}}}}function hs(i){if(!i._valueTracker){var r=ps(i)?"checked":"value";i._valueTracker=od(i,r,""+i[r])}}function Hl(i){if(!i)return!1;var r=i._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return i&&(c=ps(i)?i.checked?"true":"false":i.value),i=c,i!==l?(r.setValue(i),!0):!1}function ho(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var sd=/[\n"\\]/g;function Yn(i){return i.replace(sd,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function ms(i,r,l,c,y,T,C,D){i.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?i.type=C:i.removeAttribute("type"),r!=null?C==="number"?(r===0&&i.value===""||i.value!=r)&&(i.value=""+Fn(r)):i.value!==""+Fn(r)&&(i.value=""+Fn(r)):C!=="submit"&&C!=="reset"||i.removeAttribute("value"),r!=null?gs(i,C,Fn(r)):l!=null?gs(i,C,Fn(l)):c!=null&&i.removeAttribute("value"),y==null&&T!=null&&(i.defaultChecked=!!T),y!=null&&(i.checked=y&&typeof y!="function"&&typeof y!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+Fn(D):i.removeAttribute("name")}function Fl(i,r,l,c,y,T,C,D){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.type=T),r!=null||l!=null){if(!(T!=="submit"&&T!=="reset"||r!=null)){hs(i);return}l=l!=null?""+Fn(l):"",r=r!=null?""+Fn(r):l,D||r===i.value||(i.value=r),i.defaultValue=r}c=c??y,c=typeof c!="function"&&typeof c!="symbol"&&!!c,i.checked=D?i.checked:!!c,i.defaultChecked=!!c,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(i.name=C),hs(i)}function gs(i,r,l){r==="number"&&ho(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function Qi(i,r,l,c){if(i=i.options,r){r={};for(var y=0;y<l.length;y++)r["$"+l[y]]=!0;for(l=0;l<i.length;l++)y=r.hasOwnProperty("$"+i[l].value),i[l].selected!==y&&(i[l].selected=y),y&&c&&(i[l].defaultSelected=!0)}else{for(l=""+Fn(l),r=null,y=0;y<i.length;y++){if(i[y].value===l){i[y].selected=!0,c&&(i[y].defaultSelected=!0);return}r!==null||i[y].disabled||(r=i[y])}r!==null&&(r.selected=!0)}}function mo(i,r,l){if(r!=null&&(r=""+Fn(r),r!==i.value&&(i.value=r),l==null)){i.defaultValue!==r&&(i.defaultValue=r);return}i.defaultValue=l!=null?""+Fn(l):""}function Cr(i,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(a(92));if(Ae(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=Fn(r),i.defaultValue=l,c=i.textContent,c===l&&c!==""&&c!==null&&(i.value=c),hs(i)}function Ga(i,r){if(r){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=r;return}}i.textContent=r}var ys=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Yl(i,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?i.setProperty(r,""):r==="float"?i.cssFloat="":i[r]="":c?i.setProperty(r,l):typeof l!="number"||l===0||ys.has(r)?r==="float"?i.cssFloat=l:i[r]=(""+l).trim():i[r]=l+"px"}function Wl(i,r,l){if(r!=null&&typeof r!="object")throw Error(a(62));if(i=i.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?i.setProperty(c,""):c==="float"?i.cssFloat="":i[c]="");for(var y in r)c=r[y],r.hasOwnProperty(y)&&l[y]!==c&&Yl(i,y,c)}else for(var T in r)r.hasOwnProperty(T)&&Yl(i,T,r[T])}function vs(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ld=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),go=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ar(i){return go.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Mi(){}var _s=null;function Va(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Pn=null,Sn=null;function bs(i){var r=Zt(i);if(r&&(i=r.stateNode)){var l=i[Ke]||null;e:switch(i=r.stateNode,r.type){case"input":if(ms(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Yn(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==i&&c.form===i.form){var y=c[Ke]||null;if(!y)throw Error(a(90));ms(c,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===i.form&&Hl(c)}break e;case"textarea":mo(i,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&Qi(i,!!l.multiple,r,!1)}}}var qa=!1;function Ts(i,r,l){if(qa)return i(r,l);qa=!0;try{var c=i(r);return c}finally{if(qa=!1,(Pn!==null||Sn!==null)&&(qu(),Pn&&(r=Pn,i=Sn,Sn=Pn=null,bs(r),i)))for(r=0;r<i.length;r++)bs(i[r])}}function Ha(i,r){var l=i.stateNode;if(l===null)return null;var c=l[Ke]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(a(231,r,typeof l));return l}var Oi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ir=!1;if(Oi)try{var Rr={};Object.defineProperty(Rr,"passive",{get:function(){Ir=!0}}),window.addEventListener("test",Rr,Rr),window.removeEventListener("test",Rr,Rr)}catch{Ir=!1}var Di=null,ws=null,ua=null;function Kl(){if(ua)return ua;var i,r=ws,l=r.length,c,y="value"in Di?Di.value:Di.textContent,T=y.length;for(i=0;i<l&&r[i]===y[i];i++);var C=l-i;for(c=1;c<=C&&r[l-c]===y[T-c];c++);return ua=y.slice(i,1<c?1-c:void 0)}function yo(i){var r=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&r===13&&(i=13)):i=r,i===10&&(i=13),32<=i||i===13?i:0}function ca(){return!0}function Jl(){return!1}function Dn(i){function r(l,c,y,T,C){this._reactName=l,this._targetInst=y,this.type=c,this.nativeEvent=T,this.target=C,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(l=i[D],this[D]=l?l(T):T[D]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ca:Jl,this.isPropagationStopped=Jl,this}return _(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ca)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ca)},persist:function(){},isPersistent:ca}),r}var ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vo=Dn(ji),Nr=_({},ji,{view:0,detail:0}),ud=Dn(Nr),Es,Ss,$r,_o=_({},Nr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:da,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==$r&&($r&&i.type==="mousemove"?(Es=i.screenX-$r.screenX,Ss=i.screenY-$r.screenY):Ss=Es=0,$r=i),Es)},movementY:function(i){return"movementY"in i?i.movementY:Ss}}),Xl=Dn(_o),cd=_({},_o,{dataTransfer:0}),dd=Dn(cd),fd=_({},Nr,{relatedTarget:0}),xs=Dn(fd),pd=_({},ji,{animationName:0,elapsedTime:0,pseudoElement:0}),hd=Dn(pd),md=_({},ji,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Zl=Dn(md),Ql=_({},ji,{data:0}),Cs=Dn(Ql),gd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eu(i){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(i):(i=jl[i])?!!r[i]:!1}function da(){return eu}var vd=_({},Nr,{key:function(i){if(i.key){var r=gd[i.key]||i.key;if(r!=="Unidentified")return r}return i.type==="keypress"?(i=yo(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?yd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:da,charCode:function(i){return i.type==="keypress"?yo(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?yo(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),tu=Dn(vd),_d=_({},_o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nu=Dn(_d),bd=_({},Nr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:da}),As=Dn(bd),iu=_({},ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),Td=Dn(iu),wd=_({},_o,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Ed=Dn(wd),Sd=_({},ji,{newState:0,oldState:0}),xd=Dn(Sd),Cd=[9,13,27,32],Is=Oi&&"CompositionEvent"in window,Mr=null;Oi&&"documentMode"in document&&(Mr=document.documentMode);var Ad=Oi&&"TextEvent"in window&&!Mr,Or=Oi&&(!Is||Mr&&8<Mr&&11>=Mr),Fa=" ",Rs=!1;function au(i,r){switch(i){case"keyup":return Cd.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ru(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ea=!1;function Ns(i,r){switch(i){case"compositionend":return ru(r);case"keypress":return r.which!==32?null:(Rs=!0,Fa);case"textInput":return i=r.data,i===Fa&&Rs?null:i;default:return null}}function ou(i,r){if(ea)return i==="compositionend"||!Is&&au(i,r)?(i=Kl(),ua=ws=Di=null,ea=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Or&&r.locale!=="ko"?null:r.data;default:return null}}var su={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $s(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!su[i.type]:r==="textarea"}function Ms(i,r,l,c){Pn?Sn?Sn.push(c):Sn=[c]:Pn=c,r=Xu(r,"onChange"),0<r.length&&(l=new vo("onChange","change",null,l,c),i.push({event:l,listeners:r}))}var Ya=null,Wa=null;function Id(i){jy(i,0)}function Dr(i){var r=yn(i);if(Hl(r))return i}function Os(i,r){if(i==="change")return r}var kr=!1;if(Oi){var Ds;if(Oi){var zr="oninput"in document;if(!zr){var lu=document.createElement("div");lu.setAttribute("oninput","return;"),zr=typeof lu.oninput=="function"}Ds=zr}else Ds=!1;kr=Ds&&(!document.documentMode||9<document.documentMode)}function uu(){Ya&&(Ya.detachEvent("onpropertychange",le),Wa=Ya=null)}function le(i){if(i.propertyName==="value"&&Dr(Wa)){var r=[];Ms(r,Wa,i,Va(i)),Ts(Id,r)}}function cu(i,r,l){i==="focusin"?(uu(),Ya=r,Wa=l,Ya.attachEvent("onpropertychange",le)):i==="focusout"&&uu()}function du(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Dr(Wa)}function ks(i,r){if(i==="click")return Dr(r)}function ki(i,r){if(i==="input"||i==="change")return Dr(r)}function bo(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var xn=typeof Object.is=="function"?Object.is:bo;function Ka(i,r){if(xn(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var l=Object.keys(i),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var y=l[c];if(!Nn.call(r,y)||!xn(i[y],r[y]))return!1}return!0}function zs(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Ls(i,r){var l=zs(i);i=0;for(var c;l;){if(l.nodeType===3){if(c=i+l.textContent.length,i<=r&&c>=r)return{node:l,offset:r-i};i=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=zs(l)}}function To(i,r){return i&&r?i===r?!0:i&&i.nodeType===3?!1:r&&r.nodeType===3?To(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1:!1}function Us(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var r=ho(i.document);r instanceof i.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)i=r.contentWindow;else break;r=ho(i.document)}return r}function wo(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}var fu=Oi&&"documentMode"in document&&11>=document.documentMode,zi=null,Lr=null,fa=null,Eo=!1;function Ps(i,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Eo||zi==null||zi!==ho(c)||(c=zi,"selectionStart"in c&&wo(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),fa&&Ka(fa,c)||(fa=c,c=Xu(Lr,"onSelect"),0<c.length&&(r=new vo("onSelect","select",null,r,l),i.push({event:r,listeners:c}),r.target=zi)))}function ta(i,r){var l={};return l[i.toLowerCase()]=r.toLowerCase(),l["Webkit"+i]="webkit"+r,l["Moz"+i]="moz"+r,l}var pa={animationend:ta("Animation","AnimationEnd"),animationiteration:ta("Animation","AnimationIteration"),animationstart:ta("Animation","AnimationStart"),transitionrun:ta("Transition","TransitionRun"),transitionstart:ta("Transition","TransitionStart"),transitioncancel:ta("Transition","TransitionCancel"),transitionend:ta("Transition","TransitionEnd")},So={},Bs={};Oi&&(Bs=document.createElement("div").style,"AnimationEvent"in window||(delete pa.animationend.animation,delete pa.animationiteration.animation,delete pa.animationstart.animation),"TransitionEvent"in window||delete pa.transitionend.transition);function v(i){if(So[i])return So[i];if(!pa[i])return i;var r=pa[i],l;for(l in r)if(r.hasOwnProperty(l)&&l in Bs)return So[i]=r[l];return i}var w=v("animationend"),S=v("animationiteration"),A=v("animationstart"),M=v("transitionrun"),U=v("transitionstart"),W=v("transitioncancel"),ne=v("transitionend"),he=new Map,Te="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Te.push("scrollEnd");function Se(i,r){he.set(i,r),$i(r,[i])}var ze=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Pe=[],rt=0,Vt=0;function vn(){for(var i=rt,r=Vt=rt=0;r<i;){var l=Pe[r];Pe[r++]=null;var c=Pe[r];Pe[r++]=null;var y=Pe[r];Pe[r++]=null;var T=Pe[r];if(Pe[r++]=null,c!==null&&y!==null){var C=c.pending;C===null?y.next=y:(y.next=C.next,C.next=y),c.pending=y}T!==0&&xo(l,y,T)}}function Wn(i,r,l,c){Pe[rt++]=i,Pe[rt++]=r,Pe[rt++]=l,Pe[rt++]=c,Vt|=c,i.lanes|=c,i=i.alternate,i!==null&&(i.lanes|=c)}function Li(i,r,l,c){return Wn(i,r,l,c),Co(i)}function ii(i,r){return Wn(i,null,null,r),Co(i)}function xo(i,r,l){i.lanes|=l;var c=i.alternate;c!==null&&(c.lanes|=l);for(var y=!1,T=i.return;T!==null;)T.childLanes|=l,c=T.alternate,c!==null&&(c.childLanes|=l),T.tag===22&&(i=T.stateNode,i===null||i._visibility&1||(y=!0)),i=T,T=T.return;return i.tag===3?(T=i.stateNode,y&&r!==null&&(y=31-fn(l),i=T.hiddenUpdates,c=i[y],c===null?i[y]=[r]:c.push(r),r.lane=l|536870912),T):null}function Co(i){if(50<ll)throw ll=0,Uf=null,Error(a(185));for(var r=i.return;r!==null;)i=r,r=i.return;return i.tag===3?i.stateNode:null}var Ao={};function B2(i,r,l,c){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(i,r,l,c){return new B2(i,r,l,c)}function Rd(i){return i=i.prototype,!(!i||!i.isReactComponent)}function ha(i,r){var l=i.alternate;return l===null?(l=ai(i.tag,r,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=r,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,r=i.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function km(i,r){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,r=l.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),i}function pu(i,r,l,c,y,T){var C=0;if(c=i,typeof i=="function")Rd(i)&&(C=1);else if(typeof i=="string")C=FC(i,l,de.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Y:return i=ai(31,l,r,y),i.elementType=Y,i.lanes=T,i;case I:return Ur(l.children,y,T,r);case N:C=8,y|=24;break;case R:return i=ai(12,l,r,y|2),i.elementType=R,i.lanes=T,i;case P:return i=ai(13,l,r,y),i.elementType=P,i.lanes=T,i;case G:return i=ai(19,l,r,y),i.elementType=G,i.lanes=T,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case O:C=10;break e;case $:C=9;break e;case k:C=11;break e;case B:C=14;break e;case K:C=16,c=null;break e}C=29,l=Error(a(130,i===null?"null":typeof i,"")),c=null}return r=ai(C,l,r,y),r.elementType=i,r.type=c,r.lanes=T,r}function Ur(i,r,l,c){return i=ai(7,i,c,r),i.lanes=l,i}function Nd(i,r,l){return i=ai(6,i,null,r),i.lanes=l,i}function zm(i){var r=ai(18,null,null,0);return r.stateNode=i,r}function $d(i,r,l){return r=ai(4,i.children!==null?i.children:[],i.key,r),r.lanes=l,r.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},r}var Lm=new WeakMap;function yi(i,r){if(typeof i=="object"&&i!==null){var l=Lm.get(i);return l!==void 0?l:(r={value:i,source:r,stack:Dt(r)},Lm.set(i,r),r)}return{value:i,source:r,stack:Dt(r)}}var Io=[],Ro=0,hu=null,Gs=0,vi=[],_i=0,Ja=null,na=1,ia="";function ma(i,r){Io[Ro++]=Gs,Io[Ro++]=hu,hu=i,Gs=r}function Um(i,r,l){vi[_i++]=na,vi[_i++]=ia,vi[_i++]=Ja,Ja=i;var c=na;i=ia;var y=32-fn(c)-1;c&=~(1<<y),l+=1;var T=32-fn(r)+y;if(30<T){var C=y-y%5;T=(c&(1<<C)-1).toString(32),c>>=C,y-=C,na=1<<32-fn(r)+y|l<<y|c,ia=T+i}else na=1<<T|l<<y|c,ia=i}function Md(i){i.return!==null&&(ma(i,1),Um(i,1,0))}function Od(i){for(;i===hu;)hu=Io[--Ro],Io[Ro]=null,Gs=Io[--Ro],Io[Ro]=null;for(;i===Ja;)Ja=vi[--_i],vi[_i]=null,ia=vi[--_i],vi[_i]=null,na=vi[--_i],vi[_i]=null}function Pm(i,r){vi[_i++]=na,vi[_i++]=ia,vi[_i++]=Ja,na=r.id,ia=r.overflow,Ja=i}var Cn=null,Lt=null,dt=!1,Xa=null,bi=!1,Dd=Error(a(519));function Za(i){var r=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Vs(yi(r,i)),Dd}function Bm(i){var r=i.stateNode,l=i.type,c=i.memoizedProps;switch(r[qe]=i,r[Ke]=c,l){case"dialog":st("cancel",r),st("close",r);break;case"iframe":case"object":case"embed":st("load",r);break;case"video":case"audio":for(l=0;l<cl.length;l++)st(cl[l],r);break;case"source":st("error",r);break;case"img":case"image":case"link":st("error",r),st("load",r);break;case"details":st("toggle",r);break;case"input":st("invalid",r),Fl(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":st("invalid",r);break;case"textarea":st("invalid",r),Cr(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||i0(r.textContent,l)?(c.popover!=null&&(st("beforetoggle",r),st("toggle",r)),c.onScroll!=null&&st("scroll",r),c.onScrollEnd!=null&&st("scrollend",r),c.onClick!=null&&(r.onclick=Mi),r=!0):r=!1,r||Za(i,!0)}function Gm(i){for(Cn=i.return;Cn;)switch(Cn.tag){case 5:case 31:case 13:bi=!1;return;case 27:case 3:bi=!0;return;default:Cn=Cn.return}}function No(i){if(i!==Cn)return!1;if(!dt)return Gm(i),dt=!0,!1;var r=i.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||jf(i.type,i.memoizedProps)),l=!l),l&&Lt&&Za(i),Gm(i),r===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(a(317));Lt=f0(i)}else if(r===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(a(317));Lt=f0(i)}else r===27?(r=Lt,dr(i.type)?(i=ap,ap=null,Lt=i):Lt=r):Lt=Cn?wi(i.stateNode.nextSibling):null;return!0}function Pr(){Lt=Cn=null,dt=!1}function kd(){var i=Xa;return i!==null&&(Zn===null?Zn=i:Zn.push.apply(Zn,i),Xa=null),i}function Vs(i){Xa===null?Xa=[i]:Xa.push(i)}var zd=z(null),Br=null,ga=null;function Qa(i,r,l){te(zd,r._currentValue),r._currentValue=l}function ya(i){i._currentValue=zd.current,q(zd)}function Ld(i,r,l){for(;i!==null;){var c=i.alternate;if((i.childLanes&r)!==r?(i.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),i===l)break;i=i.return}}function Ud(i,r,l,c){var y=i.child;for(y!==null&&(y.return=i);y!==null;){var T=y.dependencies;if(T!==null){var C=y.child;T=T.firstContext;e:for(;T!==null;){var D=T;T=y;for(var V=0;V<r.length;V++)if(D.context===r[V]){T.lanes|=l,D=T.alternate,D!==null&&(D.lanes|=l),Ld(T.return,l,i),c||(C=null);break e}T=D.next}}else if(y.tag===18){if(C=y.return,C===null)throw Error(a(341));C.lanes|=l,T=C.alternate,T!==null&&(T.lanes|=l),Ld(C,l,i),C=null}else C=y.child;if(C!==null)C.return=y;else for(C=y;C!==null;){if(C===i){C=null;break}if(y=C.sibling,y!==null){y.return=C.return,C=y;break}C=C.return}y=C}}function $o(i,r,l,c){i=null;for(var y=r,T=!1;y!==null;){if(!T){if((y.flags&524288)!==0)T=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var C=y.alternate;if(C===null)throw Error(a(387));if(C=C.memoizedProps,C!==null){var D=y.type;xn(y.pendingProps.value,C.value)||(i!==null?i.push(D):i=[D])}}else if(y===oe.current){if(C=y.alternate,C===null)throw Error(a(387));C.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(i!==null?i.push(ml):i=[ml])}y=y.return}i!==null&&Ud(r,i,l,c),r.flags|=262144}function mu(i){for(i=i.firstContext;i!==null;){if(!xn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Gr(i){Br=i,ga=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function An(i){return Vm(Br,i)}function gu(i,r){return Br===null&&Gr(i),Vm(i,r)}function Vm(i,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},ga===null){if(i===null)throw Error(a(308));ga=r,i.dependencies={lanes:0,firstContext:r},i.flags|=524288}else ga=ga.next=r;return l}var G2=typeof AbortController<"u"?AbortController:function(){var i=[],r=this.signal={aborted:!1,addEventListener:function(l,c){i.push(c)}};this.abort=function(){r.aborted=!0,i.forEach(function(l){return l()})}},V2=e.unstable_scheduleCallback,q2=e.unstable_NormalPriority,on={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pd(){return{controller:new G2,data:new Map,refCount:0}}function qs(i){i.refCount--,i.refCount===0&&V2(q2,function(){i.controller.abort()})}var Hs=null,Bd=0,Mo=0,Oo=null;function H2(i,r){if(Hs===null){var l=Hs=[];Bd=0,Mo=Hf(),Oo={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Bd++,r.then(qm,qm),r}function qm(){if(--Bd===0&&Hs!==null){Oo!==null&&(Oo.status="fulfilled");var i=Hs;Hs=null,Mo=0,Oo=null;for(var r=0;r<i.length;r++)(0,i[r])()}}function F2(i,r){var l=[],c={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return i.then(function(){c.status="fulfilled",c.value=r;for(var y=0;y<l.length;y++)(0,l[y])(r)},function(y){for(c.status="rejected",c.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),c}var Hm=H.S;H.S=function(i,r){Ay=Gt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&H2(i,r),Hm!==null&&Hm(i,r)};var Vr=z(null);function Gd(){var i=Vr.current;return i!==null?i:$t.pooledCache}function yu(i,r){r===null?te(Vr,Vr.current):te(Vr,r.pool)}function Fm(){var i=Gd();return i===null?null:{parent:on._currentValue,pool:i}}var Do=Error(a(460)),Vd=Error(a(474)),vu=Error(a(542)),_u={then:function(){}};function Ym(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Wm(i,r,l){switch(l=i[l],l===void 0?i.push(r):l!==r&&(r.then(Mi,Mi),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw i=r.reason,Jm(i),i;default:if(typeof r.status=="string")r.then(Mi,Mi);else{if(i=$t,i!==null&&100<i.shellSuspendCounter)throw Error(a(482));i=r,i.status="pending",i.then(function(c){if(r.status==="pending"){var y=r;y.status="fulfilled",y.value=c}},function(c){if(r.status==="pending"){var y=r;y.status="rejected",y.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw i=r.reason,Jm(i),i}throw Hr=r,Do}}function qr(i){try{var r=i._init;return r(i._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Hr=l,Do):l}}var Hr=null;function Km(){if(Hr===null)throw Error(a(459));var i=Hr;return Hr=null,i}function Jm(i){if(i===Do||i===vu)throw Error(a(483))}var ko=null,Fs=0;function bu(i){var r=Fs;return Fs+=1,ko===null&&(ko=[]),Wm(ko,i,r)}function Ys(i,r){r=r.props.ref,i.ref=r!==void 0?r:null}function Tu(i,r){throw r.$$typeof===b?Error(a(525)):(i=Object.prototype.toString.call(r),Error(a(31,i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i)))}function Xm(i){function r(X,F){if(i){var Z=X.deletions;Z===null?(X.deletions=[F],X.flags|=16):Z.push(F)}}function l(X,F){if(!i)return null;for(;F!==null;)r(X,F),F=F.sibling;return null}function c(X){for(var F=new Map;X!==null;)X.key!==null?F.set(X.key,X):F.set(X.index,X),X=X.sibling;return F}function y(X,F){return X=ha(X,F),X.index=0,X.sibling=null,X}function T(X,F,Z){return X.index=Z,i?(Z=X.alternate,Z!==null?(Z=Z.index,Z<F?(X.flags|=67108866,F):Z):(X.flags|=67108866,F)):(X.flags|=1048576,F)}function C(X){return i&&X.alternate===null&&(X.flags|=67108866),X}function D(X,F,Z,pe){return F===null||F.tag!==6?(F=Nd(Z,X.mode,pe),F.return=X,F):(F=y(F,Z),F.return=X,F)}function V(X,F,Z,pe){var Ge=Z.type;return Ge===I?ce(X,F,Z.props.children,pe,Z.key):F!==null&&(F.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===K&&qr(Ge)===F.type)?(F=y(F,Z.props),Ys(F,Z),F.return=X,F):(F=pu(Z.type,Z.key,Z.props,null,X.mode,pe),Ys(F,Z),F.return=X,F)}function Q(X,F,Z,pe){return F===null||F.tag!==4||F.stateNode.containerInfo!==Z.containerInfo||F.stateNode.implementation!==Z.implementation?(F=$d(Z,X.mode,pe),F.return=X,F):(F=y(F,Z.children||[]),F.return=X,F)}function ce(X,F,Z,pe,Ge){return F===null||F.tag!==7?(F=Ur(Z,X.mode,pe,Ge),F.return=X,F):(F=y(F,Z),F.return=X,F)}function me(X,F,Z){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Nd(""+F,X.mode,Z),F.return=X,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case E:return Z=pu(F.type,F.key,F.props,null,X.mode,Z),Ys(Z,F),Z.return=X,Z;case x:return F=$d(F,X.mode,Z),F.return=X,F;case K:return F=qr(F),me(X,F,Z)}if(Ae(F)||_e(F))return F=Ur(F,X.mode,Z,null),F.return=X,F;if(typeof F.then=="function")return me(X,bu(F),Z);if(F.$$typeof===O)return me(X,gu(X,F),Z);Tu(X,F)}return null}function ee(X,F,Z,pe){var Ge=F!==null?F.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Ge!==null?null:D(X,F,""+Z,pe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case E:return Z.key===Ge?V(X,F,Z,pe):null;case x:return Z.key===Ge?Q(X,F,Z,pe):null;case K:return Z=qr(Z),ee(X,F,Z,pe)}if(Ae(Z)||_e(Z))return Ge!==null?null:ce(X,F,Z,pe,null);if(typeof Z.then=="function")return ee(X,F,bu(Z),pe);if(Z.$$typeof===O)return ee(X,F,gu(X,Z),pe);Tu(X,Z)}return null}function re(X,F,Z,pe,Ge){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return X=X.get(Z)||null,D(F,X,""+pe,Ge);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case E:return X=X.get(pe.key===null?Z:pe.key)||null,V(F,X,pe,Ge);case x:return X=X.get(pe.key===null?Z:pe.key)||null,Q(F,X,pe,Ge);case K:return pe=qr(pe),re(X,F,Z,pe,Ge)}if(Ae(pe)||_e(pe))return X=X.get(Z)||null,ce(F,X,pe,Ge,null);if(typeof pe.then=="function")return re(X,F,Z,bu(pe),Ge);if(pe.$$typeof===O)return re(X,F,Z,gu(F,pe),Ge);Tu(F,pe)}return null}function Re(X,F,Z,pe){for(var Ge=null,ht=null,ke=F,it=F=0,ct=null;ke!==null&&it<Z.length;it++){ke.index>it?(ct=ke,ke=null):ct=ke.sibling;var mt=ee(X,ke,Z[it],pe);if(mt===null){ke===null&&(ke=ct);break}i&&ke&&mt.alternate===null&&r(X,ke),F=T(mt,F,it),ht===null?Ge=mt:ht.sibling=mt,ht=mt,ke=ct}if(it===Z.length)return l(X,ke),dt&&ma(X,it),Ge;if(ke===null){for(;it<Z.length;it++)ke=me(X,Z[it],pe),ke!==null&&(F=T(ke,F,it),ht===null?Ge=ke:ht.sibling=ke,ht=ke);return dt&&ma(X,it),Ge}for(ke=c(ke);it<Z.length;it++)ct=re(ke,X,it,Z[it],pe),ct!==null&&(i&&ct.alternate!==null&&ke.delete(ct.key===null?it:ct.key),F=T(ct,F,it),ht===null?Ge=ct:ht.sibling=ct,ht=ct);return i&&ke.forEach(function(gr){return r(X,gr)}),dt&&ma(X,it),Ge}function He(X,F,Z,pe){if(Z==null)throw Error(a(151));for(var Ge=null,ht=null,ke=F,it=F=0,ct=null,mt=Z.next();ke!==null&&!mt.done;it++,mt=Z.next()){ke.index>it?(ct=ke,ke=null):ct=ke.sibling;var gr=ee(X,ke,mt.value,pe);if(gr===null){ke===null&&(ke=ct);break}i&&ke&&gr.alternate===null&&r(X,ke),F=T(gr,F,it),ht===null?Ge=gr:ht.sibling=gr,ht=gr,ke=ct}if(mt.done)return l(X,ke),dt&&ma(X,it),Ge;if(ke===null){for(;!mt.done;it++,mt=Z.next())mt=me(X,mt.value,pe),mt!==null&&(F=T(mt,F,it),ht===null?Ge=mt:ht.sibling=mt,ht=mt);return dt&&ma(X,it),Ge}for(ke=c(ke);!mt.done;it++,mt=Z.next())mt=re(ke,X,it,mt.value,pe),mt!==null&&(i&&mt.alternate!==null&&ke.delete(mt.key===null?it:mt.key),F=T(mt,F,it),ht===null?Ge=mt:ht.sibling=mt,ht=mt);return i&&ke.forEach(function(nA){return r(X,nA)}),dt&&ma(X,it),Ge}function At(X,F,Z,pe){if(typeof Z=="object"&&Z!==null&&Z.type===I&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case E:e:{for(var Ge=Z.key;F!==null;){if(F.key===Ge){if(Ge=Z.type,Ge===I){if(F.tag===7){l(X,F.sibling),pe=y(F,Z.props.children),pe.return=X,X=pe;break e}}else if(F.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===K&&qr(Ge)===F.type){l(X,F.sibling),pe=y(F,Z.props),Ys(pe,Z),pe.return=X,X=pe;break e}l(X,F);break}else r(X,F);F=F.sibling}Z.type===I?(pe=Ur(Z.props.children,X.mode,pe,Z.key),pe.return=X,X=pe):(pe=pu(Z.type,Z.key,Z.props,null,X.mode,pe),Ys(pe,Z),pe.return=X,X=pe)}return C(X);case x:e:{for(Ge=Z.key;F!==null;){if(F.key===Ge)if(F.tag===4&&F.stateNode.containerInfo===Z.containerInfo&&F.stateNode.implementation===Z.implementation){l(X,F.sibling),pe=y(F,Z.children||[]),pe.return=X,X=pe;break e}else{l(X,F);break}else r(X,F);F=F.sibling}pe=$d(Z,X.mode,pe),pe.return=X,X=pe}return C(X);case K:return Z=qr(Z),At(X,F,Z,pe)}if(Ae(Z))return Re(X,F,Z,pe);if(_e(Z)){if(Ge=_e(Z),typeof Ge!="function")throw Error(a(150));return Z=Ge.call(Z),He(X,F,Z,pe)}if(typeof Z.then=="function")return At(X,F,bu(Z),pe);if(Z.$$typeof===O)return At(X,F,gu(X,Z),pe);Tu(X,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,F!==null&&F.tag===6?(l(X,F.sibling),pe=y(F,Z),pe.return=X,X=pe):(l(X,F),pe=Nd(Z,X.mode,pe),pe.return=X,X=pe),C(X)):l(X,F)}return function(X,F,Z,pe){try{Fs=0;var Ge=At(X,F,Z,pe);return ko=null,Ge}catch(ke){if(ke===Do||ke===vu)throw ke;var ht=ai(29,ke,null,X.mode);return ht.lanes=pe,ht.return=X,ht}finally{}}}var Fr=Xm(!0),Zm=Xm(!1),ja=!1;function qd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hd(i,r){i=i.updateQueue,r.updateQueue===i&&(r.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function er(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function tr(i,r,l){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,(_t&2)!==0){var y=c.pending;return y===null?r.next=r:(r.next=y.next,y.next=r),c.pending=r,r=Co(i),xo(i,null,l),r}return Wn(i,c,r,l),Co(i)}function Ws(i,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=i.pendingLanes,l|=c,r.lanes=l,Ua(i,l)}}function Fd(i,r){var l=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var y=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var C={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};T===null?y=T=C:T=T.next=C,l=l.next}while(l!==null);T===null?y=T=r:T=T.next=r}else y=T=r;l={baseState:c.baseState,firstBaseUpdate:y,lastBaseUpdate:T,shared:c.shared,callbacks:c.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=r:i.next=r,l.lastBaseUpdate=r}var Yd=!1;function Ks(){if(Yd){var i=Oo;if(i!==null)throw i}}function Js(i,r,l,c){Yd=!1;var y=i.updateQueue;ja=!1;var T=y.firstBaseUpdate,C=y.lastBaseUpdate,D=y.shared.pending;if(D!==null){y.shared.pending=null;var V=D,Q=V.next;V.next=null,C===null?T=Q:C.next=Q,C=V;var ce=i.alternate;ce!==null&&(ce=ce.updateQueue,D=ce.lastBaseUpdate,D!==C&&(D===null?ce.firstBaseUpdate=Q:D.next=Q,ce.lastBaseUpdate=V))}if(T!==null){var me=y.baseState;C=0,ce=Q=V=null,D=T;do{var ee=D.lane&-536870913,re=ee!==D.lane;if(re?(ut&ee)===ee:(c&ee)===ee){ee!==0&&ee===Mo&&(Yd=!0),ce!==null&&(ce=ce.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var Re=i,He=D;ee=r;var At=l;switch(He.tag){case 1:if(Re=He.payload,typeof Re=="function"){me=Re.call(At,me,ee);break e}me=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=He.payload,ee=typeof Re=="function"?Re.call(At,me,ee):Re,ee==null)break e;me=_({},me,ee);break e;case 2:ja=!0}}ee=D.callback,ee!==null&&(i.flags|=64,re&&(i.flags|=8192),re=y.callbacks,re===null?y.callbacks=[ee]:re.push(ee))}else re={lane:ee,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ce===null?(Q=ce=re,V=me):ce=ce.next=re,C|=ee;if(D=D.next,D===null){if(D=y.shared.pending,D===null)break;re=D,D=re.next,re.next=null,y.lastBaseUpdate=re,y.shared.pending=null}}while(!0);ce===null&&(V=me),y.baseState=V,y.firstBaseUpdate=Q,y.lastBaseUpdate=ce,T===null&&(y.shared.lanes=0),or|=C,i.lanes=C,i.memoizedState=me}}function Qm(i,r){if(typeof i!="function")throw Error(a(191,i));i.call(r)}function jm(i,r){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)Qm(l[i],r)}var zo=z(null),wu=z(0);function eg(i,r){i=Ca,te(wu,i),te(zo,r),Ca=i|r.baseLanes}function Wd(){te(wu,Ca),te(zo,zo.current)}function Kd(){Ca=wu.current,q(zo),q(wu)}var ri=z(null),Ti=null;function nr(i){var r=i.alternate;te(nn,nn.current&1),te(ri,i),Ti===null&&(r===null||zo.current!==null||r.memoizedState!==null)&&(Ti=i)}function Jd(i){te(nn,nn.current),te(ri,i),Ti===null&&(Ti=i)}function tg(i){i.tag===22?(te(nn,nn.current),te(ri,i),Ti===null&&(Ti=i)):ir()}function ir(){te(nn,nn.current),te(ri,ri.current)}function oi(i){q(ri),Ti===i&&(Ti=null),q(nn)}var nn=z(0);function Eu(i){for(var r=i;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||np(l)||ip(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var va=0,tt=null,xt=null,sn=null,Su=!1,Lo=!1,Yr=!1,xu=0,Xs=0,Uo=null,Y2=0;function Qt(){throw Error(a(321))}function Xd(i,r){if(r===null)return!1;for(var l=0;l<r.length&&l<i.length;l++)if(!xn(i[l],r[l]))return!1;return!0}function Zd(i,r,l,c,y,T){return va=T,tt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,H.H=i===null||i.memoizedState===null?Ug:pf,Yr=!1,T=l(c,y),Yr=!1,Lo&&(T=ig(r,l,c,y)),ng(i),T}function ng(i){H.H=js;var r=xt!==null&&xt.next!==null;if(va=0,sn=xt=tt=null,Su=!1,Xs=0,Uo=null,r)throw Error(a(300));i===null||ln||(i=i.dependencies,i!==null&&mu(i)&&(ln=!0))}function ig(i,r,l,c){tt=i;var y=0;do{if(Lo&&(Uo=null),Xs=0,Lo=!1,25<=y)throw Error(a(301));if(y+=1,sn=xt=null,i.updateQueue!=null){var T=i.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}H.H=Pg,T=r(l,c)}while(Lo);return T}function W2(){var i=H.H,r=i.useState()[0];return r=typeof r.then=="function"?Zs(r):r,i=i.useState()[0],(xt!==null?xt.memoizedState:null)!==i&&(tt.flags|=1024),r}function Qd(){var i=xu!==0;return xu=0,i}function jd(i,r,l){r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~l}function ef(i){if(Su){for(i=i.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Su=!1}va=0,sn=xt=tt=null,Lo=!1,Xs=xu=0,Uo=null}function Bn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?tt.memoizedState=sn=i:sn=sn.next=i,sn}function an(){if(xt===null){var i=tt.alternate;i=i!==null?i.memoizedState:null}else i=xt.next;var r=sn===null?tt.memoizedState:sn.next;if(r!==null)sn=r,xt=i;else{if(i===null)throw tt.alternate===null?Error(a(467)):Error(a(310));xt=i,i={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},sn===null?tt.memoizedState=sn=i:sn=sn.next=i}return sn}function Cu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zs(i){var r=Xs;return Xs+=1,Uo===null&&(Uo=[]),i=Wm(Uo,i,r),r=tt,(sn===null?r.memoizedState:sn.next)===null&&(r=r.alternate,H.H=r===null||r.memoizedState===null?Ug:pf),i}function Au(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Zs(i);if(i.$$typeof===O)return An(i)}throw Error(a(438,String(i)))}function tf(i){var r=null,l=tt.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=tt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(y){return y.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=Cu(),tt.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(i),c=0;c<i;c++)l[c]=se;return r.index++,l}function _a(i,r){return typeof r=="function"?r(i):r}function Iu(i){var r=an();return nf(r,xt,i)}function nf(i,r,l){var c=i.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var y=i.baseQueue,T=c.pending;if(T!==null){if(y!==null){var C=y.next;y.next=T.next,T.next=C}r.baseQueue=y=T,c.pending=null}if(T=i.baseState,y===null)i.memoizedState=T;else{r=y.next;var D=C=null,V=null,Q=r,ce=!1;do{var me=Q.lane&-536870913;if(me!==Q.lane?(ut&me)===me:(va&me)===me){var ee=Q.revertLane;if(ee===0)V!==null&&(V=V.next={lane:0,revertLane:0,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),me===Mo&&(ce=!0);else if((va&ee)===ee){Q=Q.next,ee===Mo&&(ce=!0);continue}else me={lane:0,revertLane:Q.revertLane,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},V===null?(D=V=me,C=T):V=V.next=me,tt.lanes|=ee,or|=ee;me=Q.action,Yr&&l(T,me),T=Q.hasEagerState?Q.eagerState:l(T,me)}else ee={lane:me,revertLane:Q.revertLane,gesture:Q.gesture,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},V===null?(D=V=ee,C=T):V=V.next=ee,tt.lanes|=me,or|=me;Q=Q.next}while(Q!==null&&Q!==r);if(V===null?C=T:V.next=D,!xn(T,i.memoizedState)&&(ln=!0,ce&&(l=Oo,l!==null)))throw l;i.memoizedState=T,i.baseState=C,i.baseQueue=V,c.lastRenderedState=T}return y===null&&(c.lanes=0),[i.memoizedState,c.dispatch]}function af(i){var r=an(),l=r.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=i;var c=l.dispatch,y=l.pending,T=r.memoizedState;if(y!==null){l.pending=null;var C=y=y.next;do T=i(T,C.action),C=C.next;while(C!==y);xn(T,r.memoizedState)||(ln=!0),r.memoizedState=T,r.baseQueue===null&&(r.baseState=T),l.lastRenderedState=T}return[T,c]}function ag(i,r,l){var c=tt,y=an(),T=dt;if(T){if(l===void 0)throw Error(a(407));l=l()}else l=r();var C=!xn((xt||y).memoizedState,l);if(C&&(y.memoizedState=l,ln=!0),y=y.queue,sf(sg.bind(null,c,y,i),[i]),y.getSnapshot!==r||C||sn!==null&&sn.memoizedState.tag&1){if(c.flags|=2048,Po(9,{destroy:void 0},og.bind(null,c,y,l,r),null),$t===null)throw Error(a(349));T||(va&127)!==0||rg(c,r,l)}return l}function rg(i,r,l){i.flags|=16384,i={getSnapshot:r,value:l},r=tt.updateQueue,r===null?(r=Cu(),tt.updateQueue=r,r.stores=[i]):(l=r.stores,l===null?r.stores=[i]:l.push(i))}function og(i,r,l,c){r.value=l,r.getSnapshot=c,lg(r)&&ug(i)}function sg(i,r,l){return l(function(){lg(r)&&ug(i)})}function lg(i){var r=i.getSnapshot;i=i.value;try{var l=r();return!xn(i,l)}catch{return!0}}function ug(i){var r=ii(i,2);r!==null&&Qn(r,i,2)}function rf(i){var r=Bn();if(typeof i=="function"){var l=i;if(i=l(),Yr){Hn(!0);try{l()}finally{Hn(!1)}}}return r.memoizedState=r.baseState=i,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:i},r}function cg(i,r,l,c){return i.baseState=l,nf(i,xt,typeof c=="function"?c:_a)}function K2(i,r,l,c,y){if($u(i))throw Error(a(485));if(i=r.action,i!==null){var T={payload:y,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){T.listeners.push(C)}};H.T!==null?l(!0):T.isTransition=!1,c(T),l=r.pending,l===null?(T.next=r.pending=T,dg(r,T)):(T.next=l.next,r.pending=l.next=T)}}function dg(i,r){var l=r.action,c=r.payload,y=i.state;if(r.isTransition){var T=H.T,C={};H.T=C;try{var D=l(y,c),V=H.S;V!==null&&V(C,D),fg(i,r,D)}catch(Q){of(i,r,Q)}finally{T!==null&&C.types!==null&&(T.types=C.types),H.T=T}}else try{T=l(y,c),fg(i,r,T)}catch(Q){of(i,r,Q)}}function fg(i,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){pg(i,r,c)},function(c){return of(i,r,c)}):pg(i,r,l)}function pg(i,r,l){r.status="fulfilled",r.value=l,hg(r),i.state=l,r=i.pending,r!==null&&(l=r.next,l===r?i.pending=null:(l=l.next,r.next=l,dg(i,l)))}function of(i,r,l){var c=i.pending;if(i.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,hg(r),r=r.next;while(r!==c)}i.action=null}function hg(i){i=i.listeners;for(var r=0;r<i.length;r++)(0,i[r])()}function mg(i,r){return r}function gg(i,r){if(dt){var l=$t.formState;if(l!==null){e:{var c=tt;if(dt){if(Lt){t:{for(var y=Lt,T=bi;y.nodeType!==8;){if(!T){y=null;break t}if(y=wi(y.nextSibling),y===null){y=null;break t}}T=y.data,y=T==="F!"||T==="F"?y:null}if(y){Lt=wi(y.nextSibling),c=y.data==="F!";break e}}Za(c)}c=!1}c&&(r=l[0])}}return l=Bn(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mg,lastRenderedState:r},l.queue=c,l=kg.bind(null,tt,c),c.dispatch=l,c=rf(!1),T=ff.bind(null,tt,!1,c.queue),c=Bn(),y={state:r,dispatch:null,action:i,pending:null},c.queue=y,l=K2.bind(null,tt,y,T,l),y.dispatch=l,c.memoizedState=i,[r,l,!1]}function yg(i){var r=an();return vg(r,xt,i)}function vg(i,r,l){if(r=nf(i,r,mg)[0],i=Iu(_a)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Zs(r)}catch(C){throw C===Do?vu:C}else c=r;r=an();var y=r.queue,T=y.dispatch;return l!==r.memoizedState&&(tt.flags|=2048,Po(9,{destroy:void 0},J2.bind(null,y,l),null)),[c,T,i]}function J2(i,r){i.action=r}function _g(i){var r=an(),l=xt;if(l!==null)return vg(r,l,i);an(),r=r.memoizedState,l=an();var c=l.queue.dispatch;return l.memoizedState=i,[r,c,!1]}function Po(i,r,l,c){return i={tag:i,create:l,deps:c,inst:r,next:null},r=tt.updateQueue,r===null&&(r=Cu(),tt.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=i.next=i:(c=l.next,l.next=i,i.next=c,r.lastEffect=i),i}function bg(){return an().memoizedState}function Ru(i,r,l,c){var y=Bn();tt.flags|=i,y.memoizedState=Po(1|r,{destroy:void 0},l,c===void 0?null:c)}function Nu(i,r,l,c){var y=an();c=c===void 0?null:c;var T=y.memoizedState.inst;xt!==null&&c!==null&&Xd(c,xt.memoizedState.deps)?y.memoizedState=Po(r,T,l,c):(tt.flags|=i,y.memoizedState=Po(1|r,T,l,c))}function Tg(i,r){Ru(8390656,8,i,r)}function sf(i,r){Nu(2048,8,i,r)}function X2(i){tt.flags|=4;var r=tt.updateQueue;if(r===null)r=Cu(),tt.updateQueue=r,r.events=[i];else{var l=r.events;l===null?r.events=[i]:l.push(i)}}function wg(i){var r=an().memoizedState;return X2({ref:r,nextImpl:i}),function(){if((_t&2)!==0)throw Error(a(440));return r.impl.apply(void 0,arguments)}}function Eg(i,r){return Nu(4,2,i,r)}function Sg(i,r){return Nu(4,4,i,r)}function xg(i,r){if(typeof r=="function"){i=i();var l=r(i);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return i=i(),r.current=i,function(){r.current=null}}function Cg(i,r,l){l=l!=null?l.concat([i]):null,Nu(4,4,xg.bind(null,r,i),l)}function lf(){}function Ag(i,r){var l=an();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&Xd(r,c[1])?c[0]:(l.memoizedState=[i,r],i)}function Ig(i,r){var l=an();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&Xd(r,c[1]))return c[0];if(c=i(),Yr){Hn(!0);try{i()}finally{Hn(!1)}}return l.memoizedState=[c,r],c}function uf(i,r,l){return l===void 0||(va&1073741824)!==0&&(ut&261930)===0?i.memoizedState=r:(i.memoizedState=l,i=Ry(),tt.lanes|=i,or|=i,l)}function Rg(i,r,l,c){return xn(l,r)?l:zo.current!==null?(i=uf(i,l,c),xn(i,r)||(ln=!0),i):(va&42)===0||(va&1073741824)!==0&&(ut&261930)===0?(ln=!0,i.memoizedState=l):(i=Ry(),tt.lanes|=i,or|=i,r)}function Ng(i,r,l,c,y){var T=j.p;j.p=T!==0&&8>T?T:8;var C=H.T,D={};H.T=D,ff(i,!1,r,l);try{var V=y(),Q=H.S;if(Q!==null&&Q(D,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var ce=F2(V,c);Qs(i,r,ce,ui(i))}else Qs(i,r,c,ui(i))}catch(me){Qs(i,r,{then:function(){},status:"rejected",reason:me},ui())}finally{j.p=T,C!==null&&D.types!==null&&(C.types=D.types),H.T=C}}function Z2(){}function cf(i,r,l,c){if(i.tag!==5)throw Error(a(476));var y=$g(i).queue;Ng(i,y,r,fe,l===null?Z2:function(){return Mg(i),l(c)})}function $g(i){var r=i.memoizedState;if(r!==null)return r;r={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:fe},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:l},next:null},i.memoizedState=r,i=i.alternate,i!==null&&(i.memoizedState=r),r}function Mg(i){var r=$g(i);r.next===null&&(r=i.alternate.memoizedState),Qs(i,r.next.queue,{},ui())}function df(){return An(ml)}function Og(){return an().memoizedState}function Dg(){return an().memoizedState}function Q2(i){for(var r=i.return;r!==null;){switch(r.tag){case 24:case 3:var l=ui();i=er(l);var c=tr(r,i,l);c!==null&&(Qn(c,r,l),Ws(c,r,l)),r={cache:Pd()},i.payload=r;return}r=r.return}}function j2(i,r,l){var c=ui();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},$u(i)?zg(r,l):(l=Li(i,r,l,c),l!==null&&(Qn(l,i,c),Lg(l,r,c)))}function kg(i,r,l){var c=ui();Qs(i,r,l,c)}function Qs(i,r,l,c){var y={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if($u(i))zg(r,y);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=r.lastRenderedReducer,T!==null))try{var C=r.lastRenderedState,D=T(C,l);if(y.hasEagerState=!0,y.eagerState=D,xn(D,C))return Wn(i,r,y,0),$t===null&&vn(),!1}catch{}finally{}if(l=Li(i,r,y,c),l!==null)return Qn(l,i,c),Lg(l,r,c),!0}return!1}function ff(i,r,l,c){if(c={lane:2,revertLane:Hf(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},$u(i)){if(r)throw Error(a(479))}else r=Li(i,l,c,2),r!==null&&Qn(r,i,2)}function $u(i){var r=i.alternate;return i===tt||r!==null&&r===tt}function zg(i,r){Lo=Su=!0;var l=i.pending;l===null?r.next=r:(r.next=l.next,l.next=r),i.pending=r}function Lg(i,r,l){if((l&4194048)!==0){var c=r.lanes;c&=i.pendingLanes,l|=c,r.lanes=l,Ua(i,l)}}var js={readContext:An,use:Au,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};js.useEffectEvent=Qt;var Ug={readContext:An,use:Au,useCallback:function(i,r){return Bn().memoizedState=[i,r===void 0?null:r],i},useContext:An,useEffect:Tg,useImperativeHandle:function(i,r,l){l=l!=null?l.concat([i]):null,Ru(4194308,4,xg.bind(null,r,i),l)},useLayoutEffect:function(i,r){return Ru(4194308,4,i,r)},useInsertionEffect:function(i,r){Ru(4,2,i,r)},useMemo:function(i,r){var l=Bn();r=r===void 0?null:r;var c=i();if(Yr){Hn(!0);try{i()}finally{Hn(!1)}}return l.memoizedState=[c,r],c},useReducer:function(i,r,l){var c=Bn();if(l!==void 0){var y=l(r);if(Yr){Hn(!0);try{l(r)}finally{Hn(!1)}}}else y=r;return c.memoizedState=c.baseState=y,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:y},c.queue=i,i=i.dispatch=j2.bind(null,tt,i),[c.memoizedState,i]},useRef:function(i){var r=Bn();return i={current:i},r.memoizedState=i},useState:function(i){i=rf(i);var r=i.queue,l=kg.bind(null,tt,r);return r.dispatch=l,[i.memoizedState,l]},useDebugValue:lf,useDeferredValue:function(i,r){var l=Bn();return uf(l,i,r)},useTransition:function(){var i=rf(!1);return i=Ng.bind(null,tt,i.queue,!0,!1),Bn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,r,l){var c=tt,y=Bn();if(dt){if(l===void 0)throw Error(a(407));l=l()}else{if(l=r(),$t===null)throw Error(a(349));(ut&127)!==0||rg(c,r,l)}y.memoizedState=l;var T={value:l,getSnapshot:r};return y.queue=T,Tg(sg.bind(null,c,T,i),[i]),c.flags|=2048,Po(9,{destroy:void 0},og.bind(null,c,T,l,r),null),l},useId:function(){var i=Bn(),r=$t.identifierPrefix;if(dt){var l=ia,c=na;l=(c&~(1<<32-fn(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=xu++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=Y2++,r="_"+r+"r_"+l.toString(32)+"_";return i.memoizedState=r},useHostTransitionStatus:df,useFormState:gg,useActionState:gg,useOptimistic:function(i){var r=Bn();r.memoizedState=r.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=ff.bind(null,tt,!0,l),l.dispatch=r,[i,r]},useMemoCache:tf,useCacheRefresh:function(){return Bn().memoizedState=Q2.bind(null,tt)},useEffectEvent:function(i){var r=Bn(),l={impl:i};return r.memoizedState=l,function(){if((_t&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},pf={readContext:An,use:Au,useCallback:Ag,useContext:An,useEffect:sf,useImperativeHandle:Cg,useInsertionEffect:Eg,useLayoutEffect:Sg,useMemo:Ig,useReducer:Iu,useRef:bg,useState:function(){return Iu(_a)},useDebugValue:lf,useDeferredValue:function(i,r){var l=an();return Rg(l,xt.memoizedState,i,r)},useTransition:function(){var i=Iu(_a)[0],r=an().memoizedState;return[typeof i=="boolean"?i:Zs(i),r]},useSyncExternalStore:ag,useId:Og,useHostTransitionStatus:df,useFormState:yg,useActionState:yg,useOptimistic:function(i,r){var l=an();return cg(l,xt,i,r)},useMemoCache:tf,useCacheRefresh:Dg};pf.useEffectEvent=wg;var Pg={readContext:An,use:Au,useCallback:Ag,useContext:An,useEffect:sf,useImperativeHandle:Cg,useInsertionEffect:Eg,useLayoutEffect:Sg,useMemo:Ig,useReducer:af,useRef:bg,useState:function(){return af(_a)},useDebugValue:lf,useDeferredValue:function(i,r){var l=an();return xt===null?uf(l,i,r):Rg(l,xt.memoizedState,i,r)},useTransition:function(){var i=af(_a)[0],r=an().memoizedState;return[typeof i=="boolean"?i:Zs(i),r]},useSyncExternalStore:ag,useId:Og,useHostTransitionStatus:df,useFormState:_g,useActionState:_g,useOptimistic:function(i,r){var l=an();return xt!==null?cg(l,xt,i,r):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:tf,useCacheRefresh:Dg};Pg.useEffectEvent=wg;function hf(i,r,l,c){r=i.memoizedState,l=l(c,r),l=l==null?r:_({},r,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var mf={enqueueSetState:function(i,r,l){i=i._reactInternals;var c=ui(),y=er(c);y.payload=r,l!=null&&(y.callback=l),r=tr(i,y,c),r!==null&&(Qn(r,i,c),Ws(r,i,c))},enqueueReplaceState:function(i,r,l){i=i._reactInternals;var c=ui(),y=er(c);y.tag=1,y.payload=r,l!=null&&(y.callback=l),r=tr(i,y,c),r!==null&&(Qn(r,i,c),Ws(r,i,c))},enqueueForceUpdate:function(i,r){i=i._reactInternals;var l=ui(),c=er(l);c.tag=2,r!=null&&(c.callback=r),r=tr(i,c,l),r!==null&&(Qn(r,i,l),Ws(r,i,l))}};function Bg(i,r,l,c,y,T,C){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,T,C):r.prototype&&r.prototype.isPureReactComponent?!Ka(l,c)||!Ka(y,T):!0}function Gg(i,r,l,c){i=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==i&&mf.enqueueReplaceState(r,r.state,null)}function Wr(i,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(i=i.defaultProps){l===r&&(l=_({},l));for(var y in i)l[y]===void 0&&(l[y]=i[y])}return l}function Vg(i){ze(i)}function qg(i){console.error(i)}function Hg(i){ze(i)}function Mu(i,r){try{var l=i.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function Fg(i,r,l){try{var c=i.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function gf(i,r,l){return l=er(l),l.tag=3,l.payload={element:null},l.callback=function(){Mu(i,r)},l}function Yg(i){return i=er(i),i.tag=3,i}function Wg(i,r,l,c){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var T=c.value;i.payload=function(){return y(T)},i.callback=function(){Fg(r,l,c)}}var C=l.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(i.callback=function(){Fg(r,l,c),typeof y!="function"&&(sr===null?sr=new Set([this]):sr.add(this));var D=c.stack;this.componentDidCatch(c.value,{componentStack:D!==null?D:""})})}function eC(i,r,l,c,y){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&$o(r,l,y,!0),l=ri.current,l!==null){switch(l.tag){case 31:case 13:return Ti===null?Hu():l.alternate===null&&jt===0&&(jt=3),l.flags&=-257,l.flags|=65536,l.lanes=y,c===_u?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),Gf(i,c,y)),!1;case 22:return l.flags|=65536,c===_u?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),Gf(i,c,y)),!1}throw Error(a(435,l.tag))}return Gf(i,c,y),Hu(),!1}if(dt)return r=ri.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=y,c!==Dd&&(i=Error(a(422),{cause:c}),Vs(yi(i,l)))):(c!==Dd&&(r=Error(a(423),{cause:c}),Vs(yi(r,l))),i=i.current.alternate,i.flags|=65536,y&=-y,i.lanes|=y,c=yi(c,l),y=gf(i.stateNode,c,y),Fd(i,y),jt!==4&&(jt=2)),!1;var T=Error(a(520),{cause:c});if(T=yi(T,l),sl===null?sl=[T]:sl.push(T),jt!==4&&(jt=2),r===null)return!0;c=yi(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,i=y&-y,l.lanes|=i,i=gf(l.stateNode,c,i),Fd(l,i),!1;case 1:if(r=l.type,T=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(sr===null||!sr.has(T))))return l.flags|=65536,y&=-y,l.lanes|=y,y=Yg(y),Wg(y,i,l,c),Fd(l,y),!1}l=l.return}while(l!==null);return!1}var yf=Error(a(461)),ln=!1;function In(i,r,l,c){r.child=i===null?Zm(r,null,l,c):Fr(r,i.child,l,c)}function Kg(i,r,l,c,y){l=l.render;var T=r.ref;if("ref"in c){var C={};for(var D in c)D!=="ref"&&(C[D]=c[D])}else C=c;return Gr(r),c=Zd(i,r,l,C,T,y),D=Qd(),i!==null&&!ln?(jd(i,r,y),ba(i,r,y)):(dt&&D&&Md(r),r.flags|=1,In(i,r,c,y),r.child)}function Jg(i,r,l,c,y){if(i===null){var T=l.type;return typeof T=="function"&&!Rd(T)&&T.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=T,Xg(i,r,T,c,y)):(i=pu(l.type,null,c,r,r.mode,y),i.ref=r.ref,i.return=r,r.child=i)}if(T=i.child,!xf(i,y)){var C=T.memoizedProps;if(l=l.compare,l=l!==null?l:Ka,l(C,c)&&i.ref===r.ref)return ba(i,r,y)}return r.flags|=1,i=ha(T,c),i.ref=r.ref,i.return=r,r.child=i}function Xg(i,r,l,c,y){if(i!==null){var T=i.memoizedProps;if(Ka(T,c)&&i.ref===r.ref)if(ln=!1,r.pendingProps=c=T,xf(i,y))(i.flags&131072)!==0&&(ln=!0);else return r.lanes=i.lanes,ba(i,r,y)}return vf(i,r,l,c,y)}function Zg(i,r,l,c){var y=c.children,T=i!==null?i.memoizedState:null;if(i===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(T=T!==null?T.baseLanes|l:l,i!==null){for(c=r.child=i.child,y=0;c!==null;)y=y|c.lanes|c.childLanes,c=c.sibling;c=y&~T}else c=0,r.child=null;return Qg(i,r,T,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},i!==null&&yu(r,T!==null?T.cachePool:null),T!==null?eg(r,T):Wd(),tg(r);else return c=r.lanes=536870912,Qg(i,r,T!==null?T.baseLanes|l:l,l,c)}else T!==null?(yu(r,T.cachePool),eg(r,T),ir(),r.memoizedState=null):(i!==null&&yu(r,null),Wd(),ir());return In(i,r,y,l),r.child}function el(i,r){return i!==null&&i.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Qg(i,r,l,c,y){var T=Gd();return T=T===null?null:{parent:on._currentValue,pool:T},r.memoizedState={baseLanes:l,cachePool:T},i!==null&&yu(r,null),Wd(),tg(r),i!==null&&$o(i,r,c,!0),r.childLanes=y,null}function Ou(i,r){return r=ku({mode:r.mode,children:r.children},i.mode),r.ref=i.ref,i.child=r,r.return=i,r}function jg(i,r,l){return Fr(r,i.child,null,l),i=Ou(r,r.pendingProps),i.flags|=2,oi(r),r.memoizedState=null,i}function tC(i,r,l){var c=r.pendingProps,y=(r.flags&128)!==0;if(r.flags&=-129,i===null){if(dt){if(c.mode==="hidden")return i=Ou(r,c),r.lanes=536870912,el(null,i);if(Jd(r),(i=Lt)?(i=d0(i,bi),i=i!==null&&i.data==="&"?i:null,i!==null&&(r.memoizedState={dehydrated:i,treeContext:Ja!==null?{id:na,overflow:ia}:null,retryLane:536870912,hydrationErrors:null},l=zm(i),l.return=r,r.child=l,Cn=r,Lt=null)):i=null,i===null)throw Za(r);return r.lanes=536870912,null}return Ou(r,c)}var T=i.memoizedState;if(T!==null){var C=T.dehydrated;if(Jd(r),y)if(r.flags&256)r.flags&=-257,r=jg(i,r,l);else if(r.memoizedState!==null)r.child=i.child,r.flags|=128,r=null;else throw Error(a(558));else if(ln||$o(i,r,l,!1),y=(l&i.childLanes)!==0,ln||y){if(c=$t,c!==null&&(C=ye(c,l),C!==0&&C!==T.retryLane))throw T.retryLane=C,ii(i,C),Qn(c,i,C),yf;Hu(),r=jg(i,r,l)}else i=T.treeContext,Lt=wi(C.nextSibling),Cn=r,dt=!0,Xa=null,bi=!1,i!==null&&Pm(r,i),r=Ou(r,c),r.flags|=4096;return r}return i=ha(i.child,{mode:c.mode,children:c.children}),i.ref=r.ref,r.child=i,i.return=r,i}function Du(i,r){var l=r.ref;if(l===null)i!==null&&i.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(i===null||i.ref!==l)&&(r.flags|=4194816)}}function vf(i,r,l,c,y){return Gr(r),l=Zd(i,r,l,c,void 0,y),c=Qd(),i!==null&&!ln?(jd(i,r,y),ba(i,r,y)):(dt&&c&&Md(r),r.flags|=1,In(i,r,l,y),r.child)}function ey(i,r,l,c,y,T){return Gr(r),r.updateQueue=null,l=ig(r,c,l,y),ng(i),c=Qd(),i!==null&&!ln?(jd(i,r,T),ba(i,r,T)):(dt&&c&&Md(r),r.flags|=1,In(i,r,l,T),r.child)}function ty(i,r,l,c,y){if(Gr(r),r.stateNode===null){var T=Ao,C=l.contextType;typeof C=="object"&&C!==null&&(T=An(C)),T=new l(c,T),r.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=mf,r.stateNode=T,T._reactInternals=r,T=r.stateNode,T.props=c,T.state=r.memoizedState,T.refs={},qd(r),C=l.contextType,T.context=typeof C=="object"&&C!==null?An(C):Ao,T.state=r.memoizedState,C=l.getDerivedStateFromProps,typeof C=="function"&&(hf(r,l,C,c),T.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(C=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),C!==T.state&&mf.enqueueReplaceState(T,T.state,null),Js(r,c,T,y),Ks(),T.state=r.memoizedState),typeof T.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(i===null){T=r.stateNode;var D=r.memoizedProps,V=Wr(l,D);T.props=V;var Q=T.context,ce=l.contextType;C=Ao,typeof ce=="object"&&ce!==null&&(C=An(ce));var me=l.getDerivedStateFromProps;ce=typeof me=="function"||typeof T.getSnapshotBeforeUpdate=="function",D=r.pendingProps!==D,ce||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(D||Q!==C)&&Gg(r,T,c,C),ja=!1;var ee=r.memoizedState;T.state=ee,Js(r,c,T,y),Ks(),Q=r.memoizedState,D||ee!==Q||ja?(typeof me=="function"&&(hf(r,l,me,c),Q=r.memoizedState),(V=ja||Bg(r,l,V,c,ee,Q,C))?(ce||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(r.flags|=4194308)):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=Q),T.props=c,T.state=Q,T.context=C,c=V):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{T=r.stateNode,Hd(i,r),C=r.memoizedProps,ce=Wr(l,C),T.props=ce,me=r.pendingProps,ee=T.context,Q=l.contextType,V=Ao,typeof Q=="object"&&Q!==null&&(V=An(Q)),D=l.getDerivedStateFromProps,(Q=typeof D=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(C!==me||ee!==V)&&Gg(r,T,c,V),ja=!1,ee=r.memoizedState,T.state=ee,Js(r,c,T,y),Ks();var re=r.memoizedState;C!==me||ee!==re||ja||i!==null&&i.dependencies!==null&&mu(i.dependencies)?(typeof D=="function"&&(hf(r,l,D,c),re=r.memoizedState),(ce=ja||Bg(r,l,ce,c,ee,re,V)||i!==null&&i.dependencies!==null&&mu(i.dependencies))?(Q||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(c,re,V),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(c,re,V)),typeof T.componentDidUpdate=="function"&&(r.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof T.componentDidUpdate!="function"||C===i.memoizedProps&&ee===i.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&ee===i.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=re),T.props=c,T.state=re,T.context=V,c=ce):(typeof T.componentDidUpdate!="function"||C===i.memoizedProps&&ee===i.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&ee===i.memoizedState||(r.flags|=1024),c=!1)}return T=c,Du(i,r),c=(r.flags&128)!==0,T||c?(T=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:T.render(),r.flags|=1,i!==null&&c?(r.child=Fr(r,i.child,null,y),r.child=Fr(r,null,l,y)):In(i,r,l,y),r.memoizedState=T.state,i=r.child):i=ba(i,r,y),i}function ny(i,r,l,c){return Pr(),r.flags|=256,In(i,r,l,c),r.child}var _f={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function bf(i){return{baseLanes:i,cachePool:Fm()}}function Tf(i,r,l){return i=i!==null?i.childLanes&~l:0,r&&(i|=li),i}function iy(i,r,l){var c=r.pendingProps,y=!1,T=(r.flags&128)!==0,C;if((C=T)||(C=i!==null&&i.memoizedState===null?!1:(nn.current&2)!==0),C&&(y=!0,r.flags&=-129),C=(r.flags&32)!==0,r.flags&=-33,i===null){if(dt){if(y?nr(r):ir(),(i=Lt)?(i=d0(i,bi),i=i!==null&&i.data!=="&"?i:null,i!==null&&(r.memoizedState={dehydrated:i,treeContext:Ja!==null?{id:na,overflow:ia}:null,retryLane:536870912,hydrationErrors:null},l=zm(i),l.return=r,r.child=l,Cn=r,Lt=null)):i=null,i===null)throw Za(r);return ip(i)?r.lanes=32:r.lanes=536870912,null}var D=c.children;return c=c.fallback,y?(ir(),y=r.mode,D=ku({mode:"hidden",children:D},y),c=Ur(c,y,l,null),D.return=r,c.return=r,D.sibling=c,r.child=D,c=r.child,c.memoizedState=bf(l),c.childLanes=Tf(i,C,l),r.memoizedState=_f,el(null,c)):(nr(r),wf(r,D))}var V=i.memoizedState;if(V!==null&&(D=V.dehydrated,D!==null)){if(T)r.flags&256?(nr(r),r.flags&=-257,r=Ef(i,r,l)):r.memoizedState!==null?(ir(),r.child=i.child,r.flags|=128,r=null):(ir(),D=c.fallback,y=r.mode,c=ku({mode:"visible",children:c.children},y),D=Ur(D,y,l,null),D.flags|=2,c.return=r,D.return=r,c.sibling=D,r.child=c,Fr(r,i.child,null,l),c=r.child,c.memoizedState=bf(l),c.childLanes=Tf(i,C,l),r.memoizedState=_f,r=el(null,c));else if(nr(r),ip(D)){if(C=D.nextSibling&&D.nextSibling.dataset,C)var Q=C.dgst;C=Q,c=Error(a(419)),c.stack="",c.digest=C,Vs({value:c,source:null,stack:null}),r=Ef(i,r,l)}else if(ln||$o(i,r,l,!1),C=(l&i.childLanes)!==0,ln||C){if(C=$t,C!==null&&(c=ye(C,l),c!==0&&c!==V.retryLane))throw V.retryLane=c,ii(i,c),Qn(C,i,c),yf;np(D)||Hu(),r=Ef(i,r,l)}else np(D)?(r.flags|=192,r.child=i.child,r=null):(i=V.treeContext,Lt=wi(D.nextSibling),Cn=r,dt=!0,Xa=null,bi=!1,i!==null&&Pm(r,i),r=wf(r,c.children),r.flags|=4096);return r}return y?(ir(),D=c.fallback,y=r.mode,V=i.child,Q=V.sibling,c=ha(V,{mode:"hidden",children:c.children}),c.subtreeFlags=V.subtreeFlags&65011712,Q!==null?D=ha(Q,D):(D=Ur(D,y,l,null),D.flags|=2),D.return=r,c.return=r,c.sibling=D,r.child=c,el(null,c),c=r.child,D=i.child.memoizedState,D===null?D=bf(l):(y=D.cachePool,y!==null?(V=on._currentValue,y=y.parent!==V?{parent:V,pool:V}:y):y=Fm(),D={baseLanes:D.baseLanes|l,cachePool:y}),c.memoizedState=D,c.childLanes=Tf(i,C,l),r.memoizedState=_f,el(i.child,c)):(nr(r),l=i.child,i=l.sibling,l=ha(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,i!==null&&(C=r.deletions,C===null?(r.deletions=[i],r.flags|=16):C.push(i)),r.child=l,r.memoizedState=null,l)}function wf(i,r){return r=ku({mode:"visible",children:r},i.mode),r.return=i,i.child=r}function ku(i,r){return i=ai(22,i,null,r),i.lanes=0,i}function Ef(i,r,l){return Fr(r,i.child,null,l),i=wf(r,r.pendingProps.children),i.flags|=2,r.memoizedState=null,i}function ay(i,r,l){i.lanes|=r;var c=i.alternate;c!==null&&(c.lanes|=r),Ld(i.return,r,l)}function Sf(i,r,l,c,y,T){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:y,treeForkCount:T}:(C.isBackwards=r,C.rendering=null,C.renderingStartTime=0,C.last=c,C.tail=l,C.tailMode=y,C.treeForkCount=T)}function ry(i,r,l){var c=r.pendingProps,y=c.revealOrder,T=c.tail;c=c.children;var C=nn.current,D=(C&2)!==0;if(D?(C=C&1|2,r.flags|=128):C&=1,te(nn,C),In(i,r,c,l),c=dt?Gs:0,!D&&i!==null&&(i.flags&128)!==0)e:for(i=r.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&ay(i,l,r);else if(i.tag===19)ay(i,l,r);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(y){case"forwards":for(l=r.child,y=null;l!==null;)i=l.alternate,i!==null&&Eu(i)===null&&(y=l),l=l.sibling;l=y,l===null?(y=r.child,r.child=null):(y=l.sibling,l.sibling=null),Sf(r,!1,y,l,T,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=r.child,r.child=null;y!==null;){if(i=y.alternate,i!==null&&Eu(i)===null){r.child=y;break}i=y.sibling,y.sibling=l,l=y,y=i}Sf(r,!0,l,null,T,c);break;case"together":Sf(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function ba(i,r,l){if(i!==null&&(r.dependencies=i.dependencies),or|=r.lanes,(l&r.childLanes)===0)if(i!==null){if($o(i,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(i!==null&&r.child!==i.child)throw Error(a(153));if(r.child!==null){for(i=r.child,l=ha(i,i.pendingProps),r.child=l,l.return=r;i.sibling!==null;)i=i.sibling,l=l.sibling=ha(i,i.pendingProps),l.return=r;l.sibling=null}return r.child}function xf(i,r){return(i.lanes&r)!==0?!0:(i=i.dependencies,!!(i!==null&&mu(i)))}function nC(i,r,l){switch(r.tag){case 3:Be(r,r.stateNode.containerInfo),Qa(r,on,i.memoizedState.cache),Pr();break;case 27:case 5:Pt(r);break;case 4:Be(r,r.stateNode.containerInfo);break;case 10:Qa(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Jd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(nr(r),r.flags|=128,null):(l&r.child.childLanes)!==0?iy(i,r,l):(nr(r),i=ba(i,r,l),i!==null?i.sibling:null);nr(r);break;case 19:var y=(i.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||($o(i,r,l,!1),c=(l&r.childLanes)!==0),y){if(c)return ry(i,r,l);r.flags|=128}if(y=r.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),te(nn,nn.current),c)break;return null;case 22:return r.lanes=0,Zg(i,r,l,r.pendingProps);case 24:Qa(r,on,i.memoizedState.cache)}return ba(i,r,l)}function oy(i,r,l){if(i!==null)if(i.memoizedProps!==r.pendingProps)ln=!0;else{if(!xf(i,l)&&(r.flags&128)===0)return ln=!1,nC(i,r,l);ln=(i.flags&131072)!==0}else ln=!1,dt&&(r.flags&1048576)!==0&&Um(r,Gs,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(i=qr(r.elementType),r.type=i,typeof i=="function")Rd(i)?(c=Wr(i,c),r.tag=1,r=ty(null,r,i,c,l)):(r.tag=0,r=vf(null,r,i,c,l));else{if(i!=null){var y=i.$$typeof;if(y===k){r.tag=11,r=Kg(null,r,i,c,l);break e}else if(y===B){r.tag=14,r=Jg(null,r,i,c,l);break e}}throw r=$e(i)||i,Error(a(306,r,""))}}return r;case 0:return vf(i,r,r.type,r.pendingProps,l);case 1:return c=r.type,y=Wr(c,r.pendingProps),ty(i,r,c,y,l);case 3:e:{if(Be(r,r.stateNode.containerInfo),i===null)throw Error(a(387));c=r.pendingProps;var T=r.memoizedState;y=T.element,Hd(i,r),Js(r,c,null,l);var C=r.memoizedState;if(c=C.cache,Qa(r,on,c),c!==T.cache&&Ud(r,[on],l,!0),Ks(),c=C.element,T.isDehydrated)if(T={element:c,isDehydrated:!1,cache:C.cache},r.updateQueue.baseState=T,r.memoizedState=T,r.flags&256){r=ny(i,r,c,l);break e}else if(c!==y){y=yi(Error(a(424)),r),Vs(y),r=ny(i,r,c,l);break e}else{switch(i=r.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Lt=wi(i.firstChild),Cn=r,dt=!0,Xa=null,bi=!0,l=Zm(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Pr(),c===y){r=ba(i,r,l);break e}In(i,r,c,l)}r=r.child}return r;case 26:return Du(i,r),i===null?(l=y0(r.type,null,r.pendingProps,null))?r.memoizedState=l:dt||(l=r.type,i=r.pendingProps,c=Zu(Fe.current).createElement(l),c[qe]=r,c[Ke]=i,Rn(c,l,i),Kt(c),r.stateNode=c):r.memoizedState=y0(r.type,i.memoizedProps,r.pendingProps,i.memoizedState),null;case 27:return Pt(r),i===null&&dt&&(c=r.stateNode=h0(r.type,r.pendingProps,Fe.current),Cn=r,bi=!0,y=Lt,dr(r.type)?(ap=y,Lt=wi(c.firstChild)):Lt=y),In(i,r,r.pendingProps.children,l),Du(i,r),i===null&&(r.flags|=4194304),r.child;case 5:return i===null&&dt&&((y=c=Lt)&&(c=MC(c,r.type,r.pendingProps,bi),c!==null?(r.stateNode=c,Cn=r,Lt=wi(c.firstChild),bi=!1,y=!0):y=!1),y||Za(r)),Pt(r),y=r.type,T=r.pendingProps,C=i!==null?i.memoizedProps:null,c=T.children,jf(y,T)?c=null:C!==null&&jf(y,C)&&(r.flags|=32),r.memoizedState!==null&&(y=Zd(i,r,W2,null,null,l),ml._currentValue=y),Du(i,r),In(i,r,c,l),r.child;case 6:return i===null&&dt&&((i=l=Lt)&&(l=OC(l,r.pendingProps,bi),l!==null?(r.stateNode=l,Cn=r,Lt=null,i=!0):i=!1),i||Za(r)),null;case 13:return iy(i,r,l);case 4:return Be(r,r.stateNode.containerInfo),c=r.pendingProps,i===null?r.child=Fr(r,null,c,l):In(i,r,c,l),r.child;case 11:return Kg(i,r,r.type,r.pendingProps,l);case 7:return In(i,r,r.pendingProps,l),r.child;case 8:return In(i,r,r.pendingProps.children,l),r.child;case 12:return In(i,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,Qa(r,r.type,c.value),In(i,r,c.children,l),r.child;case 9:return y=r.type._context,c=r.pendingProps.children,Gr(r),y=An(y),c=c(y),r.flags|=1,In(i,r,c,l),r.child;case 14:return Jg(i,r,r.type,r.pendingProps,l);case 15:return Xg(i,r,r.type,r.pendingProps,l);case 19:return ry(i,r,l);case 31:return tC(i,r,l);case 22:return Zg(i,r,l,r.pendingProps);case 24:return Gr(r),c=An(on),i===null?(y=Gd(),y===null&&(y=$t,T=Pd(),y.pooledCache=T,T.refCount++,T!==null&&(y.pooledCacheLanes|=l),y=T),r.memoizedState={parent:c,cache:y},qd(r),Qa(r,on,y)):((i.lanes&l)!==0&&(Hd(i,r),Js(r,null,null,l),Ks()),y=i.memoizedState,T=r.memoizedState,y.parent!==c?(y={parent:c,cache:c},r.memoizedState=y,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=y),Qa(r,on,c)):(c=T.cache,Qa(r,on,c),c!==y.cache&&Ud(r,[on],l,!0))),In(i,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(a(156,r.tag))}function Ta(i){i.flags|=4}function Cf(i,r,l,c,y){if((r=(i.mode&32)!==0)&&(r=!1),r){if(i.flags|=16777216,(y&335544128)===y)if(i.stateNode.complete)i.flags|=8192;else if(Oy())i.flags|=8192;else throw Hr=_u,Vd}else i.flags&=-16777217}function sy(i,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!w0(r))if(Oy())i.flags|=8192;else throw Hr=_u,Vd}function zu(i,r){r!==null&&(i.flags|=4),i.flags&16384&&(r=i.tag!==22?Rt():536870912,i.lanes|=r,qo|=r)}function tl(i,r){if(!dt)switch(i.tailMode){case"hidden":r=i.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function Ut(i){var r=i.alternate!==null&&i.alternate.child===i.child,l=0,c=0;if(r)for(var y=i.child;y!==null;)l|=y.lanes|y.childLanes,c|=y.subtreeFlags&65011712,c|=y.flags&65011712,y.return=i,y=y.sibling;else for(y=i.child;y!==null;)l|=y.lanes|y.childLanes,c|=y.subtreeFlags,c|=y.flags,y.return=i,y=y.sibling;return i.subtreeFlags|=c,i.childLanes=l,r}function iC(i,r,l){var c=r.pendingProps;switch(Od(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(r),null;case 1:return Ut(r),null;case 3:return l=r.stateNode,c=null,i!==null&&(c=i.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),ya(on),je(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(No(r)?Ta(r):i===null||i.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,kd())),Ut(r),null;case 26:var y=r.type,T=r.memoizedState;return i===null?(Ta(r),T!==null?(Ut(r),sy(r,T)):(Ut(r),Cf(r,y,null,c,l))):T?T!==i.memoizedState?(Ta(r),Ut(r),sy(r,T)):(Ut(r),r.flags&=-16777217):(i=i.memoizedProps,i!==c&&Ta(r),Ut(r),Cf(r,y,i,c,l)),null;case 27:if(cn(r),l=Fe.current,y=r.type,i!==null&&r.stateNode!=null)i.memoizedProps!==c&&Ta(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return Ut(r),null}i=de.current,No(r)?Bm(r):(i=h0(y,c,l),r.stateNode=i,Ta(r))}return Ut(r),null;case 5:if(cn(r),y=r.type,i!==null&&r.stateNode!=null)i.memoizedProps!==c&&Ta(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return Ut(r),null}if(T=de.current,No(r))Bm(r);else{var C=Zu(Fe.current);switch(T){case 1:T=C.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:T=C.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":T=C.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":T=C.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":T=C.createElement("div"),T.innerHTML="<script><\/script>",T=T.removeChild(T.firstChild);break;case"select":T=typeof c.is=="string"?C.createElement("select",{is:c.is}):C.createElement("select"),c.multiple?T.multiple=!0:c.size&&(T.size=c.size);break;default:T=typeof c.is=="string"?C.createElement(y,{is:c.is}):C.createElement(y)}}T[qe]=r,T[Ke]=c;e:for(C=r.child;C!==null;){if(C.tag===5||C.tag===6)T.appendChild(C.stateNode);else if(C.tag!==4&&C.tag!==27&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===r)break e;for(;C.sibling===null;){if(C.return===null||C.return===r)break e;C=C.return}C.sibling.return=C.return,C=C.sibling}r.stateNode=T;e:switch(Rn(T,y,c),y){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Ta(r)}}return Ut(r),Cf(r,r.type,i===null?null:i.memoizedProps,r.pendingProps,l),null;case 6:if(i&&r.stateNode!=null)i.memoizedProps!==c&&Ta(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(a(166));if(i=Fe.current,No(r)){if(i=r.stateNode,l=r.memoizedProps,c=null,y=Cn,y!==null)switch(y.tag){case 27:case 5:c=y.memoizedProps}i[qe]=r,i=!!(i.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||i0(i.nodeValue,l)),i||Za(r,!0)}else i=Zu(i).createTextNode(c),i[qe]=r,r.stateNode=i}return Ut(r),null;case 31:if(l=r.memoizedState,i===null||i.memoizedState!==null){if(c=No(r),l!==null){if(i===null){if(!c)throw Error(a(318));if(i=r.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(a(557));i[qe]=r}else Pr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Ut(r),i=!1}else l=kd(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=l),i=!0;if(!i)return r.flags&256?(oi(r),r):(oi(r),null);if((r.flags&128)!==0)throw Error(a(558))}return Ut(r),null;case 13:if(c=r.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(y=No(r),c!==null&&c.dehydrated!==null){if(i===null){if(!y)throw Error(a(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(a(317));y[qe]=r}else Pr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Ut(r),y=!1}else y=kd(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=y),y=!0;if(!y)return r.flags&256?(oi(r),r):(oi(r),null)}return oi(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,i=i!==null&&i.memoizedState!==null,l&&(c=r.child,y=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(y=c.alternate.memoizedState.cachePool.pool),T=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(T=c.memoizedState.cachePool.pool),T!==y&&(c.flags|=2048)),l!==i&&l&&(r.child.flags|=8192),zu(r,r.updateQueue),Ut(r),null);case 4:return je(),i===null&&Kf(r.stateNode.containerInfo),Ut(r),null;case 10:return ya(r.type),Ut(r),null;case 19:if(q(nn),c=r.memoizedState,c===null)return Ut(r),null;if(y=(r.flags&128)!==0,T=c.rendering,T===null)if(y)tl(c,!1);else{if(jt!==0||i!==null&&(i.flags&128)!==0)for(i=r.child;i!==null;){if(T=Eu(i),T!==null){for(r.flags|=128,tl(c,!1),i=T.updateQueue,r.updateQueue=i,zu(r,i),r.subtreeFlags=0,i=l,l=r.child;l!==null;)km(l,i),l=l.sibling;return te(nn,nn.current&1|2),dt&&ma(r,c.treeForkCount),r.child}i=i.sibling}c.tail!==null&&Gt()>Gu&&(r.flags|=128,y=!0,tl(c,!1),r.lanes=4194304)}else{if(!y)if(i=Eu(T),i!==null){if(r.flags|=128,y=!0,i=i.updateQueue,r.updateQueue=i,zu(r,i),tl(c,!0),c.tail===null&&c.tailMode==="hidden"&&!T.alternate&&!dt)return Ut(r),null}else 2*Gt()-c.renderingStartTime>Gu&&l!==536870912&&(r.flags|=128,y=!0,tl(c,!1),r.lanes=4194304);c.isBackwards?(T.sibling=r.child,r.child=T):(i=c.last,i!==null?i.sibling=T:r.child=T,c.last=T)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=Gt(),i.sibling=null,l=nn.current,te(nn,y?l&1|2:l&1),dt&&ma(r,c.treeForkCount),i):(Ut(r),null);case 22:case 23:return oi(r),Kd(),c=r.memoizedState!==null,i!==null?i.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(Ut(r),r.subtreeFlags&6&&(r.flags|=8192)):Ut(r),l=r.updateQueue,l!==null&&zu(r,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),i!==null&&q(Vr),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),ya(on),Ut(r),null;case 25:return null;case 30:return null}throw Error(a(156,r.tag))}function aC(i,r){switch(Od(r),r.tag){case 1:return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 3:return ya(on),je(),i=r.flags,(i&65536)!==0&&(i&128)===0?(r.flags=i&-65537|128,r):null;case 26:case 27:case 5:return cn(r),null;case 31:if(r.memoizedState!==null){if(oi(r),r.alternate===null)throw Error(a(340));Pr()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 13:if(oi(r),i=r.memoizedState,i!==null&&i.dehydrated!==null){if(r.alternate===null)throw Error(a(340));Pr()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 19:return q(nn),null;case 4:return je(),null;case 10:return ya(r.type),null;case 22:case 23:return oi(r),Kd(),i!==null&&q(Vr),i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 24:return ya(on),null;case 25:return null;default:return null}}function ly(i,r){switch(Od(r),r.tag){case 3:ya(on),je();break;case 26:case 27:case 5:cn(r);break;case 4:je();break;case 31:r.memoizedState!==null&&oi(r);break;case 13:oi(r);break;case 19:q(nn);break;case 10:ya(r.type);break;case 22:case 23:oi(r),Kd(),i!==null&&q(Vr);break;case 24:ya(on)}}function nl(i,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var y=c.next;l=y;do{if((l.tag&i)===i){c=void 0;var T=l.create,C=l.inst;c=T(),C.destroy=c}l=l.next}while(l!==y)}}catch(D){wt(r,r.return,D)}}function ar(i,r,l){try{var c=r.updateQueue,y=c!==null?c.lastEffect:null;if(y!==null){var T=y.next;c=T;do{if((c.tag&i)===i){var C=c.inst,D=C.destroy;if(D!==void 0){C.destroy=void 0,y=r;var V=l,Q=D;try{Q()}catch(ce){wt(y,V,ce)}}}c=c.next}while(c!==T)}}catch(ce){wt(r,r.return,ce)}}function uy(i){var r=i.updateQueue;if(r!==null){var l=i.stateNode;try{jm(r,l)}catch(c){wt(i,i.return,c)}}}function cy(i,r,l){l.props=Wr(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(c){wt(i,r,c)}}function il(i,r){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var c=i.stateNode;break;case 30:c=i.stateNode;break;default:c=i.stateNode}typeof l=="function"?i.refCleanup=l(c):l.current=c}}catch(y){wt(i,r,y)}}function aa(i,r){var l=i.ref,c=i.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(y){wt(i,r,y)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){wt(i,r,y)}else l.current=null}function dy(i){var r=i.type,l=i.memoizedProps,c=i.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(y){wt(i,i.return,y)}}function Af(i,r,l){try{var c=i.stateNode;CC(c,i.type,l,r),c[Ke]=r}catch(y){wt(i,i.return,y)}}function fy(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&dr(i.type)||i.tag===4}function If(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||fy(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&dr(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Rf(i,r,l){var c=i.tag;if(c===5||c===6)i=i.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(i),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Mi));else if(c!==4&&(c===27&&dr(i.type)&&(l=i.stateNode,r=null),i=i.child,i!==null))for(Rf(i,r,l),i=i.sibling;i!==null;)Rf(i,r,l),i=i.sibling}function Lu(i,r,l){var c=i.tag;if(c===5||c===6)i=i.stateNode,r?l.insertBefore(i,r):l.appendChild(i);else if(c!==4&&(c===27&&dr(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(Lu(i,r,l),i=i.sibling;i!==null;)Lu(i,r,l),i=i.sibling}function py(i){var r=i.stateNode,l=i.memoizedProps;try{for(var c=i.type,y=r.attributes;y.length;)r.removeAttributeNode(y[0]);Rn(r,c,l),r[qe]=i,r[Ke]=l}catch(T){wt(i,i.return,T)}}var wa=!1,un=!1,Nf=!1,hy=typeof WeakSet=="function"?WeakSet:Set,_n=null;function rC(i,r){if(i=i.containerInfo,Zf=ac,i=Us(i),wo(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var y=c.anchorOffset,T=c.focusNode;c=c.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var C=0,D=-1,V=-1,Q=0,ce=0,me=i,ee=null;t:for(;;){for(var re;me!==l||y!==0&&me.nodeType!==3||(D=C+y),me!==T||c!==0&&me.nodeType!==3||(V=C+c),me.nodeType===3&&(C+=me.nodeValue.length),(re=me.firstChild)!==null;)ee=me,me=re;for(;;){if(me===i)break t;if(ee===l&&++Q===y&&(D=C),ee===T&&++ce===c&&(V=C),(re=me.nextSibling)!==null)break;me=ee,ee=me.parentNode}me=re}l=D===-1||V===-1?null:{start:D,end:V}}else l=null}l=l||{start:0,end:0}}else l=null;for(Qf={focusedElem:i,selectionRange:l},ac=!1,_n=r;_n!==null;)if(r=_n,i=r.child,(r.subtreeFlags&1028)!==0&&i!==null)i.return=r,_n=i;else for(;_n!==null;){switch(r=_n,T=r.alternate,i=r.flags,r.tag){case 0:if((i&4)!==0&&(i=r.updateQueue,i=i!==null?i.events:null,i!==null))for(l=0;l<i.length;l++)y=i[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&T!==null){i=void 0,l=r,y=T.memoizedProps,T=T.memoizedState,c=l.stateNode;try{var Re=Wr(l.type,y);i=c.getSnapshotBeforeUpdate(Re,T),c.__reactInternalSnapshotBeforeUpdate=i}catch(He){wt(l,l.return,He)}}break;case 3:if((i&1024)!==0){if(i=r.stateNode.containerInfo,l=i.nodeType,l===9)tp(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":tp(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(a(163))}if(i=r.sibling,i!==null){i.return=r.return,_n=i;break}_n=r.return}}function my(i,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Sa(i,l),c&4&&nl(5,l);break;case 1:if(Sa(i,l),c&4)if(i=l.stateNode,r===null)try{i.componentDidMount()}catch(C){wt(l,l.return,C)}else{var y=Wr(l.type,r.memoizedProps);r=r.memoizedState;try{i.componentDidUpdate(y,r,i.__reactInternalSnapshotBeforeUpdate)}catch(C){wt(l,l.return,C)}}c&64&&uy(l),c&512&&il(l,l.return);break;case 3:if(Sa(i,l),c&64&&(i=l.updateQueue,i!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{jm(i,r)}catch(C){wt(l,l.return,C)}}break;case 27:r===null&&c&4&&py(l);case 26:case 5:Sa(i,l),r===null&&c&4&&dy(l),c&512&&il(l,l.return);break;case 12:Sa(i,l);break;case 31:Sa(i,l),c&4&&vy(i,l);break;case 13:Sa(i,l),c&4&&_y(i,l),c&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=hC.bind(null,l),DC(i,l))));break;case 22:if(c=l.memoizedState!==null||wa,!c){r=r!==null&&r.memoizedState!==null||un,y=wa;var T=un;wa=c,(un=r)&&!T?xa(i,l,(l.subtreeFlags&8772)!==0):Sa(i,l),wa=y,un=T}break;case 30:break;default:Sa(i,l)}}function gy(i){var r=i.alternate;r!==null&&(i.alternate=null,gy(r)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(r=i.stateNode,r!==null&&Pa(r)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var qt=null,Kn=!1;function Ea(i,r,l){for(l=l.child;l!==null;)yy(i,r,l),l=l.sibling}function yy(i,r,l){if(dn&&typeof dn.onCommitFiberUnmount=="function")try{dn.onCommitFiberUnmount(Ni,l)}catch{}switch(l.tag){case 26:un||aa(l,r),Ea(i,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:un||aa(l,r);var c=qt,y=Kn;dr(l.type)&&(qt=l.stateNode,Kn=!1),Ea(i,r,l),fl(l.stateNode),qt=c,Kn=y;break;case 5:un||aa(l,r);case 6:if(c=qt,y=Kn,qt=null,Ea(i,r,l),qt=c,Kn=y,qt!==null)if(Kn)try{(qt.nodeType===9?qt.body:qt.nodeName==="HTML"?qt.ownerDocument.body:qt).removeChild(l.stateNode)}catch(T){wt(l,r,T)}else try{qt.removeChild(l.stateNode)}catch(T){wt(l,r,T)}break;case 18:qt!==null&&(Kn?(i=qt,u0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),Zo(i)):u0(qt,l.stateNode));break;case 4:c=qt,y=Kn,qt=l.stateNode.containerInfo,Kn=!0,Ea(i,r,l),qt=c,Kn=y;break;case 0:case 11:case 14:case 15:ar(2,l,r),un||ar(4,l,r),Ea(i,r,l);break;case 1:un||(aa(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&cy(l,r,c)),Ea(i,r,l);break;case 21:Ea(i,r,l);break;case 22:un=(c=un)||l.memoizedState!==null,Ea(i,r,l),un=c;break;default:Ea(i,r,l)}}function vy(i,r){if(r.memoizedState===null&&(i=r.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Zo(i)}catch(l){wt(r,r.return,l)}}}function _y(i,r){if(r.memoizedState===null&&(i=r.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Zo(i)}catch(l){wt(r,r.return,l)}}function oC(i){switch(i.tag){case 31:case 13:case 19:var r=i.stateNode;return r===null&&(r=i.stateNode=new hy),r;case 22:return i=i.stateNode,r=i._retryCache,r===null&&(r=i._retryCache=new hy),r;default:throw Error(a(435,i.tag))}}function Uu(i,r){var l=oC(i);r.forEach(function(c){if(!l.has(c)){l.add(c);var y=mC.bind(null,i,c);c.then(y,y)}})}function Jn(i,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var y=l[c],T=i,C=r,D=C;e:for(;D!==null;){switch(D.tag){case 27:if(dr(D.type)){qt=D.stateNode,Kn=!1;break e}break;case 5:qt=D.stateNode,Kn=!1;break e;case 3:case 4:qt=D.stateNode.containerInfo,Kn=!0;break e}D=D.return}if(qt===null)throw Error(a(160));yy(T,C,y),qt=null,Kn=!1,T=y.alternate,T!==null&&(T.return=null),y.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)by(r,i),r=r.sibling}var Ui=null;function by(i,r){var l=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Jn(r,i),Xn(i),c&4&&(ar(3,i,i.return),nl(3,i),ar(5,i,i.return));break;case 1:Jn(r,i),Xn(i),c&512&&(un||l===null||aa(l,l.return)),c&64&&wa&&(i=i.updateQueue,i!==null&&(c=i.callbacks,c!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var y=Ui;if(Jn(r,i),Xn(i),c&512&&(un||l===null||aa(l,l.return)),c&4){var T=l!==null?l.memoizedState:null;if(c=i.memoizedState,l===null)if(c===null)if(i.stateNode===null){e:{c=i.type,l=i.memoizedProps,y=y.ownerDocument||y;t:switch(c){case"title":T=y.getElementsByTagName("title")[0],(!T||T[Zi]||T[qe]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=y.createElement(c),y.head.insertBefore(T,y.querySelector("head > title"))),Rn(T,c,l),T[qe]=i,Kt(T),c=T;break e;case"link":var C=b0("link","href",y).get(c+(l.href||""));if(C){for(var D=0;D<C.length;D++)if(T=C[D],T.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&T.getAttribute("rel")===(l.rel==null?null:l.rel)&&T.getAttribute("title")===(l.title==null?null:l.title)&&T.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){C.splice(D,1);break t}}T=y.createElement(c),Rn(T,c,l),y.head.appendChild(T);break;case"meta":if(C=b0("meta","content",y).get(c+(l.content||""))){for(D=0;D<C.length;D++)if(T=C[D],T.getAttribute("content")===(l.content==null?null:""+l.content)&&T.getAttribute("name")===(l.name==null?null:l.name)&&T.getAttribute("property")===(l.property==null?null:l.property)&&T.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&T.getAttribute("charset")===(l.charSet==null?null:l.charSet)){C.splice(D,1);break t}}T=y.createElement(c),Rn(T,c,l),y.head.appendChild(T);break;default:throw Error(a(468,c))}T[qe]=i,Kt(T),c=T}i.stateNode=c}else T0(y,i.type,i.stateNode);else i.stateNode=_0(y,c,i.memoizedProps);else T!==c?(T===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):T.count--,c===null?T0(y,i.type,i.stateNode):_0(y,c,i.memoizedProps)):c===null&&i.stateNode!==null&&Af(i,i.memoizedProps,l.memoizedProps)}break;case 27:Jn(r,i),Xn(i),c&512&&(un||l===null||aa(l,l.return)),l!==null&&c&4&&Af(i,i.memoizedProps,l.memoizedProps);break;case 5:if(Jn(r,i),Xn(i),c&512&&(un||l===null||aa(l,l.return)),i.flags&32){y=i.stateNode;try{Ga(y,"")}catch(Re){wt(i,i.return,Re)}}c&4&&i.stateNode!=null&&(y=i.memoizedProps,Af(i,y,l!==null?l.memoizedProps:y)),c&1024&&(Nf=!0);break;case 6:if(Jn(r,i),Xn(i),c&4){if(i.stateNode===null)throw Error(a(162));c=i.memoizedProps,l=i.stateNode;try{l.nodeValue=c}catch(Re){wt(i,i.return,Re)}}break;case 3:if(ec=null,y=Ui,Ui=Qu(r.containerInfo),Jn(r,i),Ui=y,Xn(i),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Zo(r.containerInfo)}catch(Re){wt(i,i.return,Re)}Nf&&(Nf=!1,Ty(i));break;case 4:c=Ui,Ui=Qu(i.stateNode.containerInfo),Jn(r,i),Xn(i),Ui=c;break;case 12:Jn(r,i),Xn(i);break;case 31:Jn(r,i),Xn(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Uu(i,c)));break;case 13:Jn(r,i),Xn(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Bu=Gt()),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Uu(i,c)));break;case 22:y=i.memoizedState!==null;var V=l!==null&&l.memoizedState!==null,Q=wa,ce=un;if(wa=Q||y,un=ce||V,Jn(r,i),un=ce,wa=Q,Xn(i),c&8192)e:for(r=i.stateNode,r._visibility=y?r._visibility&-2:r._visibility|1,y&&(l===null||V||wa||un||Kr(i)),l=null,r=i;;){if(r.tag===5||r.tag===26){if(l===null){V=l=r;try{if(T=V.stateNode,y)C=T.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{D=V.stateNode;var me=V.memoizedProps.style,ee=me!=null&&me.hasOwnProperty("display")?me.display:null;D.style.display=ee==null||typeof ee=="boolean"?"":(""+ee).trim()}}catch(Re){wt(V,V.return,Re)}}}else if(r.tag===6){if(l===null){V=r;try{V.stateNode.nodeValue=y?"":V.memoizedProps}catch(Re){wt(V,V.return,Re)}}}else if(r.tag===18){if(l===null){V=r;try{var re=V.stateNode;y?c0(re,!0):c0(V.stateNode,!1)}catch(Re){wt(V,V.return,Re)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===i)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break e;for(;r.sibling===null;){if(r.return===null||r.return===i)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=i.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Uu(i,l))));break;case 19:Jn(r,i),Xn(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,Uu(i,c)));break;case 30:break;case 21:break;default:Jn(r,i),Xn(i)}}function Xn(i){var r=i.flags;if(r&2){try{for(var l,c=i.return;c!==null;){if(fy(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var y=l.stateNode,T=If(i);Lu(i,T,y);break;case 5:var C=l.stateNode;l.flags&32&&(Ga(C,""),l.flags&=-33);var D=If(i);Lu(i,D,C);break;case 3:case 4:var V=l.stateNode.containerInfo,Q=If(i);Rf(i,Q,V);break;default:throw Error(a(161))}}catch(ce){wt(i,i.return,ce)}i.flags&=-3}r&4096&&(i.flags&=-4097)}function Ty(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var r=i;Ty(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),i=i.sibling}}function Sa(i,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)my(i,r.alternate,r),r=r.sibling}function Kr(i){for(i=i.child;i!==null;){var r=i;switch(r.tag){case 0:case 11:case 14:case 15:ar(4,r,r.return),Kr(r);break;case 1:aa(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&cy(r,r.return,l),Kr(r);break;case 27:fl(r.stateNode);case 26:case 5:aa(r,r.return),Kr(r);break;case 22:r.memoizedState===null&&Kr(r);break;case 30:Kr(r);break;default:Kr(r)}i=i.sibling}}function xa(i,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,y=i,T=r,C=T.flags;switch(T.tag){case 0:case 11:case 15:xa(y,T,l),nl(4,T);break;case 1:if(xa(y,T,l),c=T,y=c.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(Q){wt(c,c.return,Q)}if(c=T,y=c.updateQueue,y!==null){var D=c.stateNode;try{var V=y.shared.hiddenCallbacks;if(V!==null)for(y.shared.hiddenCallbacks=null,y=0;y<V.length;y++)Qm(V[y],D)}catch(Q){wt(c,c.return,Q)}}l&&C&64&&uy(T),il(T,T.return);break;case 27:py(T);case 26:case 5:xa(y,T,l),l&&c===null&&C&4&&dy(T),il(T,T.return);break;case 12:xa(y,T,l);break;case 31:xa(y,T,l),l&&C&4&&vy(y,T);break;case 13:xa(y,T,l),l&&C&4&&_y(y,T);break;case 22:T.memoizedState===null&&xa(y,T,l),il(T,T.return);break;case 30:break;default:xa(y,T,l)}r=r.sibling}}function $f(i,r){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(i=r.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&qs(l))}function Mf(i,r){i=null,r.alternate!==null&&(i=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==i&&(r.refCount++,i!=null&&qs(i))}function Pi(i,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)wy(i,r,l,c),r=r.sibling}function wy(i,r,l,c){var y=r.flags;switch(r.tag){case 0:case 11:case 15:Pi(i,r,l,c),y&2048&&nl(9,r);break;case 1:Pi(i,r,l,c);break;case 3:Pi(i,r,l,c),y&2048&&(i=null,r.alternate!==null&&(i=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==i&&(r.refCount++,i!=null&&qs(i)));break;case 12:if(y&2048){Pi(i,r,l,c),i=r.stateNode;try{var T=r.memoizedProps,C=T.id,D=T.onPostCommit;typeof D=="function"&&D(C,r.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(V){wt(r,r.return,V)}}else Pi(i,r,l,c);break;case 31:Pi(i,r,l,c);break;case 13:Pi(i,r,l,c);break;case 23:break;case 22:T=r.stateNode,C=r.alternate,r.memoizedState!==null?T._visibility&2?Pi(i,r,l,c):al(i,r):T._visibility&2?Pi(i,r,l,c):(T._visibility|=2,Bo(i,r,l,c,(r.subtreeFlags&10256)!==0||!1)),y&2048&&$f(C,r);break;case 24:Pi(i,r,l,c),y&2048&&Mf(r.alternate,r);break;default:Pi(i,r,l,c)}}function Bo(i,r,l,c,y){for(y=y&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var T=i,C=r,D=l,V=c,Q=C.flags;switch(C.tag){case 0:case 11:case 15:Bo(T,C,D,V,y),nl(8,C);break;case 23:break;case 22:var ce=C.stateNode;C.memoizedState!==null?ce._visibility&2?Bo(T,C,D,V,y):al(T,C):(ce._visibility|=2,Bo(T,C,D,V,y)),y&&Q&2048&&$f(C.alternate,C);break;case 24:Bo(T,C,D,V,y),y&&Q&2048&&Mf(C.alternate,C);break;default:Bo(T,C,D,V,y)}r=r.sibling}}function al(i,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=i,c=r,y=c.flags;switch(c.tag){case 22:al(l,c),y&2048&&$f(c.alternate,c);break;case 24:al(l,c),y&2048&&Mf(c.alternate,c);break;default:al(l,c)}r=r.sibling}}var rl=8192;function Go(i,r,l){if(i.subtreeFlags&rl)for(i=i.child;i!==null;)Ey(i,r,l),i=i.sibling}function Ey(i,r,l){switch(i.tag){case 26:Go(i,r,l),i.flags&rl&&i.memoizedState!==null&&YC(l,Ui,i.memoizedState,i.memoizedProps);break;case 5:Go(i,r,l);break;case 3:case 4:var c=Ui;Ui=Qu(i.stateNode.containerInfo),Go(i,r,l),Ui=c;break;case 22:i.memoizedState===null&&(c=i.alternate,c!==null&&c.memoizedState!==null?(c=rl,rl=16777216,Go(i,r,l),rl=c):Go(i,r,l));break;default:Go(i,r,l)}}function Sy(i){var r=i.alternate;if(r!==null&&(i=r.child,i!==null)){r.child=null;do r=i.sibling,i.sibling=null,i=r;while(i!==null)}}function ol(i){var r=i.deletions;if((i.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];_n=c,Cy(c,i)}Sy(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)xy(i),i=i.sibling}function xy(i){switch(i.tag){case 0:case 11:case 15:ol(i),i.flags&2048&&ar(9,i,i.return);break;case 3:ol(i);break;case 12:ol(i);break;case 22:var r=i.stateNode;i.memoizedState!==null&&r._visibility&2&&(i.return===null||i.return.tag!==13)?(r._visibility&=-3,Pu(i)):ol(i);break;default:ol(i)}}function Pu(i){var r=i.deletions;if((i.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];_n=c,Cy(c,i)}Sy(i)}for(i=i.child;i!==null;){switch(r=i,r.tag){case 0:case 11:case 15:ar(8,r,r.return),Pu(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Pu(r));break;default:Pu(r)}i=i.sibling}}function Cy(i,r){for(;_n!==null;){var l=_n;switch(l.tag){case 0:case 11:case 15:ar(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:qs(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,_n=c;else e:for(l=i;_n!==null;){c=_n;var y=c.sibling,T=c.return;if(gy(c),c===l){_n=null;break e}if(y!==null){y.return=T,_n=y;break e}_n=T}}}var sC={getCacheForType:function(i){var r=An(on),l=r.data.get(i);return l===void 0&&(l=i(),r.data.set(i,l)),l},cacheSignal:function(){return An(on).controller.signal}},lC=typeof WeakMap=="function"?WeakMap:Map,_t=0,$t=null,ot=null,ut=0,Tt=0,si=null,rr=!1,Vo=!1,Of=!1,Ca=0,jt=0,or=0,Jr=0,Df=0,li=0,qo=0,sl=null,Zn=null,kf=!1,Bu=0,Ay=0,Gu=1/0,Vu=null,sr=null,hn=0,lr=null,Ho=null,Aa=0,zf=0,Lf=null,Iy=null,ll=0,Uf=null;function ui(){return(_t&2)!==0&&ut!==0?ut&-ut:H.T!==null?Hf():Ue()}function Ry(){if(li===0)if((ut&536870912)===0||dt){var i=kt;kt<<=1,(kt&3932160)===0&&(kt=262144),li=i}else li=536870912;return i=ri.current,i!==null&&(i.flags|=32),li}function Qn(i,r,l){(i===$t&&(Tt===2||Tt===9)||i.cancelPendingCommit!==null)&&(Fo(i,0),ur(i,ut,li,!1)),gn(i,l),((_t&2)===0||i!==$t)&&(i===$t&&((_t&2)===0&&(Jr|=l),jt===4&&ur(i,ut,li,!1)),ra(i))}function Ny(i,r,l){if((_t&6)!==0)throw Error(a(327));var c=!l&&(r&127)===0&&(r&i.expiredLanes)===0||Le(i,r),y=c?dC(i,r):Bf(i,r,!0),T=c;do{if(y===0){Vo&&!c&&ur(i,r,0,!1);break}else{if(l=i.current.alternate,T&&!uC(l)){y=Bf(i,r,!1),T=!1;continue}if(y===2){if(T=r,i.errorRecoveryDisabledLanes&T)var C=0;else C=i.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){r=C;e:{var D=i;y=sl;var V=D.current.memoizedState.isDehydrated;if(V&&(Fo(D,C).flags|=256),C=Bf(D,C,!1),C!==2){if(Of&&!V){D.errorRecoveryDisabledLanes|=T,Jr|=T,y=4;break e}T=Zn,Zn=y,T!==null&&(Zn===null?Zn=T:Zn.push.apply(Zn,T))}y=C}if(T=!1,y!==2)continue}}if(y===1){Fo(i,0),ur(i,r,0,!0);break}e:{switch(c=i,T=y,T){case 0:case 1:throw Error(a(345));case 4:if((r&4194048)!==r)break;case 6:ur(c,r,li,!rr);break e;case 2:Zn=null;break;case 3:case 5:break;default:throw Error(a(329))}if((r&62914560)===r&&(y=Bu+300-Gt(),10<y)){if(ur(c,r,li,!rr),De(c,0,!0)!==0)break e;Aa=r,c.timeoutHandle=s0($y.bind(null,c,l,Zn,Vu,kf,r,li,Jr,qo,rr,T,"Throttled",-0,0),y);break e}$y(c,l,Zn,Vu,kf,r,li,Jr,qo,rr,T,null,-0,0)}}break}while(!0);ra(i)}function $y(i,r,l,c,y,T,C,D,V,Q,ce,me,ee,re){if(i.timeoutHandle=-1,me=r.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Mi},Ey(r,T,me);var Re=(T&62914560)===T?Bu-Gt():(T&4194048)===T?Ay-Gt():0;if(Re=WC(me,Re),Re!==null){Aa=T,i.cancelPendingCommit=Re(Py.bind(null,i,r,T,l,c,y,C,D,V,ce,me,null,ee,re)),ur(i,T,C,!Q);return}}Py(i,r,T,l,c,y,C,D,V)}function uC(i){for(var r=i;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var y=l[c],T=y.getSnapshot;y=y.value;try{if(!xn(T(),y))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ur(i,r,l,c){r&=~Df,r&=~Jr,i.suspendedLanes|=r,i.pingedLanes&=~r,c&&(i.warmLanes|=r),c=i.expirationTimes;for(var y=r;0<y;){var T=31-fn(y),C=1<<T;c[T]=-1,y&=~C}l!==0&&mi(i,l,r)}function qu(){return(_t&6)===0?(ul(0),!1):!0}function Pf(){if(ot!==null){if(Tt===0)var i=ot.return;else i=ot,ga=Br=null,ef(i),ko=null,Fs=0,i=ot;for(;i!==null;)ly(i.alternate,i),i=i.return;ot=null}}function Fo(i,r){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,RC(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),Aa=0,Pf(),$t=i,ot=l=ha(i.current,null),ut=r,Tt=0,si=null,rr=!1,Vo=Le(i,r),Of=!1,qo=li=Df=Jr=or=jt=0,Zn=sl=null,kf=!1,(r&8)!==0&&(r|=r&32);var c=i.entangledLanes;if(c!==0)for(i=i.entanglements,c&=r;0<c;){var y=31-fn(c),T=1<<y;r|=i[y],c&=~T}return Ca=r,vn(),l}function My(i,r){tt=null,H.H=js,r===Do||r===vu?(r=Km(),Tt=3):r===Vd?(r=Km(),Tt=4):Tt=r===yf?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,si=r,ot===null&&(jt=1,Mu(i,yi(r,i.current)))}function Oy(){var i=ri.current;return i===null?!0:(ut&4194048)===ut?Ti===null:(ut&62914560)===ut||(ut&536870912)!==0?i===Ti:!1}function Dy(){var i=H.H;return H.H=js,i===null?js:i}function ky(){var i=H.A;return H.A=sC,i}function Hu(){jt=4,rr||(ut&4194048)!==ut&&ri.current!==null||(Vo=!0),(or&134217727)===0&&(Jr&134217727)===0||$t===null||ur($t,ut,li,!1)}function Bf(i,r,l){var c=_t;_t|=2;var y=Dy(),T=ky();($t!==i||ut!==r)&&(Vu=null,Fo(i,r)),r=!1;var C=jt;e:do try{if(Tt!==0&&ot!==null){var D=ot,V=si;switch(Tt){case 8:Pf(),C=6;break e;case 3:case 2:case 9:case 6:ri.current===null&&(r=!0);var Q=Tt;if(Tt=0,si=null,Yo(i,D,V,Q),l&&Vo){C=0;break e}break;default:Q=Tt,Tt=0,si=null,Yo(i,D,V,Q)}}cC(),C=jt;break}catch(ce){My(i,ce)}while(!0);return r&&i.shellSuspendCounter++,ga=Br=null,_t=c,H.H=y,H.A=T,ot===null&&($t=null,ut=0,vn()),C}function cC(){for(;ot!==null;)zy(ot)}function dC(i,r){var l=_t;_t|=2;var c=Dy(),y=ky();$t!==i||ut!==r?(Vu=null,Gu=Gt()+500,Fo(i,r)):Vo=Le(i,r);e:do try{if(Tt!==0&&ot!==null){r=ot;var T=si;t:switch(Tt){case 1:Tt=0,si=null,Yo(i,r,T,1);break;case 2:case 9:if(Ym(T)){Tt=0,si=null,Ly(r);break}r=function(){Tt!==2&&Tt!==9||$t!==i||(Tt=7),ra(i)},T.then(r,r);break e;case 3:Tt=7;break e;case 4:Tt=5;break e;case 7:Ym(T)?(Tt=0,si=null,Ly(r)):(Tt=0,si=null,Yo(i,r,T,7));break;case 5:var C=null;switch(ot.tag){case 26:C=ot.memoizedState;case 5:case 27:var D=ot;if(C?w0(C):D.stateNode.complete){Tt=0,si=null;var V=D.sibling;if(V!==null)ot=V;else{var Q=D.return;Q!==null?(ot=Q,Fu(Q)):ot=null}break t}}Tt=0,si=null,Yo(i,r,T,5);break;case 6:Tt=0,si=null,Yo(i,r,T,6);break;case 8:Pf(),jt=6;break e;default:throw Error(a(462))}}fC();break}catch(ce){My(i,ce)}while(!0);return ga=Br=null,H.H=c,H.A=y,_t=l,ot!==null?0:($t=null,ut=0,vn(),jt)}function fC(){for(;ot!==null&&!ka();)zy(ot)}function zy(i){var r=oy(i.alternate,i,Ca);i.memoizedProps=i.pendingProps,r===null?Fu(i):ot=r}function Ly(i){var r=i,l=r.alternate;switch(r.tag){case 15:case 0:r=ey(l,r,r.pendingProps,r.type,void 0,ut);break;case 11:r=ey(l,r,r.pendingProps,r.type.render,r.ref,ut);break;case 5:ef(r);default:ly(l,r),r=ot=km(r,Ca),r=oy(l,r,Ca)}i.memoizedProps=i.pendingProps,r===null?Fu(i):ot=r}function Yo(i,r,l,c){ga=Br=null,ef(r),ko=null,Fs=0;var y=r.return;try{if(eC(i,y,r,l,ut)){jt=1,Mu(i,yi(l,i.current)),ot=null;return}}catch(T){if(y!==null)throw ot=y,T;jt=1,Mu(i,yi(l,i.current)),ot=null;return}r.flags&32768?(dt||c===1?i=!0:Vo||(ut&536870912)!==0?i=!1:(rr=i=!0,(c===2||c===9||c===3||c===6)&&(c=ri.current,c!==null&&c.tag===13&&(c.flags|=16384))),Uy(r,i)):Fu(r)}function Fu(i){var r=i;do{if((r.flags&32768)!==0){Uy(r,rr);return}i=r.return;var l=iC(r.alternate,r,Ca);if(l!==null){ot=l;return}if(r=r.sibling,r!==null){ot=r;return}ot=r=i}while(r!==null);jt===0&&(jt=5)}function Uy(i,r){do{var l=aC(i.alternate,i);if(l!==null){l.flags&=32767,ot=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(i=i.sibling,i!==null)){ot=i;return}ot=i=l}while(i!==null);jt=6,ot=null}function Py(i,r,l,c,y,T,C,D,V){i.cancelPendingCommit=null;do Yu();while(hn!==0);if((_t&6)!==0)throw Error(a(327));if(r!==null){if(r===i.current)throw Error(a(177));if(T=r.lanes|r.childLanes,T|=Vt,la(i,l,T,C,D,V),i===$t&&(ot=$t=null,ut=0),Ho=r,lr=i,Aa=l,zf=T,Lf=y,Iy=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,gC(Ri,function(){return Hy(),null})):(i.callbackNode=null,i.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=H.T,H.T=null,y=j.p,j.p=2,C=_t,_t|=4;try{rC(i,r,l)}finally{_t=C,j.p=y,H.T=c}}hn=1,By(),Gy(),Vy()}}function By(){if(hn===1){hn=0;var i=lr,r=Ho,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=H.T,H.T=null;var c=j.p;j.p=2;var y=_t;_t|=4;try{by(r,i);var T=Qf,C=Us(i.containerInfo),D=T.focusedElem,V=T.selectionRange;if(C!==D&&D&&D.ownerDocument&&To(D.ownerDocument.documentElement,D)){if(V!==null&&wo(D)){var Q=V.start,ce=V.end;if(ce===void 0&&(ce=Q),"selectionStart"in D)D.selectionStart=Q,D.selectionEnd=Math.min(ce,D.value.length);else{var me=D.ownerDocument||document,ee=me&&me.defaultView||window;if(ee.getSelection){var re=ee.getSelection(),Re=D.textContent.length,He=Math.min(V.start,Re),At=V.end===void 0?He:Math.min(V.end,Re);!re.extend&&He>At&&(C=At,At=He,He=C);var X=Ls(D,He),F=Ls(D,At);if(X&&F&&(re.rangeCount!==1||re.anchorNode!==X.node||re.anchorOffset!==X.offset||re.focusNode!==F.node||re.focusOffset!==F.offset)){var Z=me.createRange();Z.setStart(X.node,X.offset),re.removeAllRanges(),He>At?(re.addRange(Z),re.extend(F.node,F.offset)):(Z.setEnd(F.node,F.offset),re.addRange(Z))}}}}for(me=[],re=D;re=re.parentNode;)re.nodeType===1&&me.push({element:re,left:re.scrollLeft,top:re.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<me.length;D++){var pe=me[D];pe.element.scrollLeft=pe.left,pe.element.scrollTop=pe.top}}ac=!!Zf,Qf=Zf=null}finally{_t=y,j.p=c,H.T=l}}i.current=r,hn=2}}function Gy(){if(hn===2){hn=0;var i=lr,r=Ho,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=H.T,H.T=null;var c=j.p;j.p=2;var y=_t;_t|=4;try{my(i,r.alternate,r)}finally{_t=y,j.p=c,H.T=l}}hn=3}}function Vy(){if(hn===4||hn===3){hn=0,za();var i=lr,r=Ho,l=Aa,c=Iy;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?hn=5:(hn=0,Ho=lr=null,qy(i,i.pendingLanes));var y=i.pendingLanes;if(y===0&&(sr=null),at(l),r=r.stateNode,dn&&typeof dn.onCommitFiberRoot=="function")try{dn.onCommitFiberRoot(Ni,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=H.T,y=j.p,j.p=2,H.T=null;try{for(var T=i.onRecoverableError,C=0;C<c.length;C++){var D=c[C];T(D.value,{componentStack:D.stack})}}finally{H.T=r,j.p=y}}(Aa&3)!==0&&Yu(),ra(i),y=i.pendingLanes,(l&261930)!==0&&(y&42)!==0?i===Uf?ll++:(ll=0,Uf=i):ll=0,ul(0)}}function qy(i,r){(i.pooledCacheLanes&=r)===0&&(r=i.pooledCache,r!=null&&(i.pooledCache=null,qs(r)))}function Yu(){return By(),Gy(),Vy(),Hy()}function Hy(){if(hn!==5)return!1;var i=lr,r=zf;zf=0;var l=at(Aa),c=H.T,y=j.p;try{j.p=32>l?32:l,H.T=null,l=Lf,Lf=null;var T=lr,C=Aa;if(hn=0,Ho=lr=null,Aa=0,(_t&6)!==0)throw Error(a(331));var D=_t;if(_t|=4,xy(T.current),wy(T,T.current,C,l),_t=D,ul(0,!1),dn&&typeof dn.onPostCommitFiberRoot=="function")try{dn.onPostCommitFiberRoot(Ni,T)}catch{}return!0}finally{j.p=y,H.T=c,qy(i,r)}}function Fy(i,r,l){r=yi(l,r),r=gf(i.stateNode,r,2),i=tr(i,r,2),i!==null&&(gn(i,2),ra(i))}function wt(i,r,l){if(i.tag===3)Fy(i,i,l);else for(;r!==null;){if(r.tag===3){Fy(r,i,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(sr===null||!sr.has(c))){i=yi(l,i),l=Yg(2),c=tr(r,l,2),c!==null&&(Wg(l,c,r,i),gn(c,2),ra(c));break}}r=r.return}}function Gf(i,r,l){var c=i.pingCache;if(c===null){c=i.pingCache=new lC;var y=new Set;c.set(r,y)}else y=c.get(r),y===void 0&&(y=new Set,c.set(r,y));y.has(l)||(Of=!0,y.add(l),i=pC.bind(null,i,r,l),r.then(i,i))}function pC(i,r,l){var c=i.pingCache;c!==null&&c.delete(r),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,$t===i&&(ut&l)===l&&(jt===4||jt===3&&(ut&62914560)===ut&&300>Gt()-Bu?(_t&2)===0&&Fo(i,0):Df|=l,qo===ut&&(qo=0)),ra(i)}function Yy(i,r){r===0&&(r=Rt()),i=ii(i,r),i!==null&&(gn(i,r),ra(i))}function hC(i){var r=i.memoizedState,l=0;r!==null&&(l=r.retryLane),Yy(i,l)}function mC(i,r){var l=0;switch(i.tag){case 31:case 13:var c=i.stateNode,y=i.memoizedState;y!==null&&(l=y.retryLane);break;case 19:c=i.stateNode;break;case 22:c=i.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(r),Yy(i,l)}function gC(i,r){return tn(i,r)}var Wu=null,Wo=null,Vf=!1,Ku=!1,qf=!1,cr=0;function ra(i){i!==Wo&&i.next===null&&(Wo===null?Wu=Wo=i:Wo=Wo.next=i),Ku=!0,Vf||(Vf=!0,vC())}function ul(i,r){if(!qf&&Ku){qf=!0;do for(var l=!1,c=Wu;c!==null;){if(i!==0){var y=c.pendingLanes;if(y===0)var T=0;else{var C=c.suspendedLanes,D=c.pingedLanes;T=(1<<31-fn(42|i)+1)-1,T&=y&~(C&~D),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(l=!0,Xy(c,T))}else T=ut,T=De(c,c===$t?T:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(T&3)===0||Le(c,T)||(l=!0,Xy(c,T));c=c.next}while(l);qf=!1}}function yC(){Wy()}function Wy(){Ku=Vf=!1;var i=0;cr!==0&&IC()&&(i=cr);for(var r=Gt(),l=null,c=Wu;c!==null;){var y=c.next,T=Ky(c,r);T===0?(c.next=null,l===null?Wu=y:l.next=y,y===null&&(Wo=l)):(l=c,(i!==0||(T&3)!==0)&&(Ku=!0)),c=y}hn!==0&&hn!==5||ul(i),cr!==0&&(cr=0)}function Ky(i,r){for(var l=i.suspendedLanes,c=i.pingedLanes,y=i.expirationTimes,T=i.pendingLanes&-62914561;0<T;){var C=31-fn(T),D=1<<C,V=y[C];V===-1?((D&l)===0||(D&c)!==0)&&(y[C]=Yt(D,r)):V<=r&&(i.expiredLanes|=D),T&=~D}if(r=$t,l=ut,l=De(i,i===r?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c=i.callbackNode,l===0||i===r&&(Tt===2||Tt===9)||i.cancelPendingCommit!==null)return c!==null&&c!==null&&Ii(c),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||Le(i,l)){if(r=l&-l,r===i.callbackPriority)return r;switch(c!==null&&Ii(c),at(l)){case 2:case 8:l=Sr;break;case 32:l=Ri;break;case 268435456:l=Xi;break;default:l=Ri}return c=Jy.bind(null,i),l=tn(l,c),i.callbackPriority=r,i.callbackNode=l,r}return c!==null&&c!==null&&Ii(c),i.callbackPriority=2,i.callbackNode=null,2}function Jy(i,r){if(hn!==0&&hn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if(Yu()&&i.callbackNode!==l)return null;var c=ut;return c=De(i,i===$t?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c===0?null:(Ny(i,c,r),Ky(i,Gt()),i.callbackNode!=null&&i.callbackNode===l?Jy.bind(null,i):null)}function Xy(i,r){if(Yu())return null;Ny(i,r,!0)}function vC(){NC(function(){(_t&6)!==0?tn(La,yC):Wy()})}function Hf(){if(cr===0){var i=Mo;i===0&&(i=Ye,Ye<<=1,(Ye&261888)===0&&(Ye=256)),cr=i}return cr}function Zy(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ar(""+i)}function Qy(i,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,i.id&&l.setAttribute("form",i.id),r.parentNode.insertBefore(l,r),i=new FormData(i),l.parentNode.removeChild(l),i}function _C(i,r,l,c,y){if(r==="submit"&&l&&l.stateNode===y){var T=Zy((y[Ke]||null).action),C=c.submitter;C&&(r=(r=C[Ke]||null)?Zy(r.formAction):C.getAttribute("formAction"),r!==null&&(T=r,C=null));var D=new vo("action","action",null,c,y);i.push({event:D,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(cr!==0){var V=C?Qy(y,C):new FormData(y);cf(l,{pending:!0,data:V,method:y.method,action:T},null,V)}}else typeof T=="function"&&(D.preventDefault(),V=C?Qy(y,C):new FormData(y),cf(l,{pending:!0,data:V,method:y.method,action:T},T,V))},currentTarget:y}]})}}for(var Ff=0;Ff<Te.length;Ff++){var Yf=Te[Ff],bC=Yf.toLowerCase(),TC=Yf[0].toUpperCase()+Yf.slice(1);Se(bC,"on"+TC)}Se(w,"onAnimationEnd"),Se(S,"onAnimationIteration"),Se(A,"onAnimationStart"),Se("dblclick","onDoubleClick"),Se("focusin","onFocus"),Se("focusout","onBlur"),Se(M,"onTransitionRun"),Se(U,"onTransitionStart"),Se(W,"onTransitionCancel"),Se(ne,"onTransitionEnd"),Ba("onMouseEnter",["mouseout","mouseover"]),Ba("onMouseLeave",["mouseout","mouseover"]),Ba("onPointerEnter",["pointerout","pointerover"]),Ba("onPointerLeave",["pointerout","pointerover"]),$i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$i("onBeforeInput",["compositionend","keypress","textInput","paste"]),$i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wC=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cl));function jy(i,r){r=(r&4)!==0;for(var l=0;l<i.length;l++){var c=i[l],y=c.event;c=c.listeners;e:{var T=void 0;if(r)for(var C=c.length-1;0<=C;C--){var D=c[C],V=D.instance,Q=D.currentTarget;if(D=D.listener,V!==T&&y.isPropagationStopped())break e;T=D,y.currentTarget=Q;try{T(y)}catch(ce){ze(ce)}y.currentTarget=null,T=V}else for(C=0;C<c.length;C++){if(D=c[C],V=D.instance,Q=D.currentTarget,D=D.listener,V!==T&&y.isPropagationStopped())break e;T=D,y.currentTarget=Q;try{T(y)}catch(ce){ze(ce)}y.currentTarget=null,T=V}}}}function st(i,r){var l=r[Xt];l===void 0&&(l=r[Xt]=new Set);var c=i+"__bubble";l.has(c)||(e0(r,i,2,!1),l.add(c))}function Wf(i,r,l){var c=0;r&&(c|=4),e0(l,i,c,r)}var Ju="_reactListening"+Math.random().toString(36).slice(2);function Kf(i){if(!i[Ju]){i[Ju]=!0,rn.forEach(function(l){l!=="selectionchange"&&(wC.has(l)||Wf(l,!1,i),Wf(l,!0,i))});var r=i.nodeType===9?i:i.ownerDocument;r===null||r[Ju]||(r[Ju]=!0,Wf("selectionchange",!1,r))}}function e0(i,r,l,c){switch(R0(r)){case 2:var y=XC;break;case 8:y=ZC;break;default:y=up}l=y.bind(null,r,l,i),y=void 0,!Ir||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(y=!0),c?y!==void 0?i.addEventListener(r,l,{capture:!0,passive:y}):i.addEventListener(r,l,!0):y!==void 0?i.addEventListener(r,l,{passive:y}):i.addEventListener(r,l,!1)}function Jf(i,r,l,c,y){var T=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var C=c.tag;if(C===3||C===4){var D=c.stateNode.containerInfo;if(D===y)break;if(C===4)for(C=c.return;C!==null;){var V=C.tag;if((V===3||V===4)&&C.stateNode.containerInfo===y)return;C=C.return}for(;D!==null;){if(C=St(D),C===null)return;if(V=C.tag,V===5||V===6||V===26||V===27){c=T=C;continue e}D=D.parentNode}}c=c.return}Ts(function(){var Q=T,ce=Va(l),me=[];e:{var ee=he.get(i);if(ee!==void 0){var re=vo,Re=i;switch(i){case"keypress":if(yo(l)===0)break e;case"keydown":case"keyup":re=tu;break;case"focusin":Re="focus",re=xs;break;case"focusout":Re="blur",re=xs;break;case"beforeblur":case"afterblur":re=xs;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=Xl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=As;break;case w:case S:case A:re=hd;break;case ne:re=Td;break;case"scroll":case"scrollend":re=ud;break;case"wheel":re=Ed;break;case"copy":case"cut":case"paste":re=Zl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=nu;break;case"toggle":case"beforetoggle":re=xd}var He=(r&4)!==0,At=!He&&(i==="scroll"||i==="scrollend"),X=He?ee!==null?ee+"Capture":null:ee;He=[];for(var F=Q,Z;F!==null;){var pe=F;if(Z=pe.stateNode,pe=pe.tag,pe!==5&&pe!==26&&pe!==27||Z===null||X===null||(pe=Ha(F,X),pe!=null&&He.push(dl(F,pe,Z))),At)break;F=F.return}0<He.length&&(ee=new re(ee,Re,null,l,ce),me.push({event:ee,listeners:He}))}}if((r&7)===0){e:{if(ee=i==="mouseover"||i==="pointerover",re=i==="mouseout"||i==="pointerout",ee&&l!==_s&&(Re=l.relatedTarget||l.fromElement)&&(St(Re)||Re[et]))break e;if((re||ee)&&(ee=ce.window===ce?ce:(ee=ce.ownerDocument)?ee.defaultView||ee.parentWindow:window,re?(Re=l.relatedTarget||l.toElement,re=Q,Re=Re?St(Re):null,Re!==null&&(At=o(Re),He=Re.tag,Re!==At||He!==5&&He!==27&&He!==6)&&(Re=null)):(re=null,Re=Q),re!==Re)){if(He=Xl,pe="onMouseLeave",X="onMouseEnter",F="mouse",(i==="pointerout"||i==="pointerover")&&(He=nu,pe="onPointerLeave",X="onPointerEnter",F="pointer"),At=re==null?ee:yn(re),Z=Re==null?ee:yn(Re),ee=new He(pe,F+"leave",re,l,ce),ee.target=At,ee.relatedTarget=Z,pe=null,St(ce)===Q&&(He=new He(X,F+"enter",Re,l,ce),He.target=Z,He.relatedTarget=At,pe=He),At=pe,re&&Re)t:{for(He=EC,X=re,F=Re,Z=0,pe=X;pe;pe=He(pe))Z++;pe=0;for(var Ge=F;Ge;Ge=He(Ge))pe++;for(;0<Z-pe;)X=He(X),Z--;for(;0<pe-Z;)F=He(F),pe--;for(;Z--;){if(X===F||F!==null&&X===F.alternate){He=X;break t}X=He(X),F=He(F)}He=null}else He=null;re!==null&&t0(me,ee,re,He,!1),Re!==null&&At!==null&&t0(me,At,Re,He,!0)}}e:{if(ee=Q?yn(Q):window,re=ee.nodeName&&ee.nodeName.toLowerCase(),re==="select"||re==="input"&&ee.type==="file")var ht=Os;else if($s(ee))if(kr)ht=ki;else{ht=du;var ke=cu}else re=ee.nodeName,!re||re.toLowerCase()!=="input"||ee.type!=="checkbox"&&ee.type!=="radio"?Q&&vs(Q.elementType)&&(ht=Os):ht=ks;if(ht&&(ht=ht(i,Q))){Ms(me,ht,l,ce);break e}ke&&ke(i,ee,Q),i==="focusout"&&Q&&ee.type==="number"&&Q.memoizedProps.value!=null&&gs(ee,"number",ee.value)}switch(ke=Q?yn(Q):window,i){case"focusin":($s(ke)||ke.contentEditable==="true")&&(zi=ke,Lr=Q,fa=null);break;case"focusout":fa=Lr=zi=null;break;case"mousedown":Eo=!0;break;case"contextmenu":case"mouseup":case"dragend":Eo=!1,Ps(me,l,ce);break;case"selectionchange":if(fu)break;case"keydown":case"keyup":Ps(me,l,ce)}var it;if(Is)e:{switch(i){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else ea?au(i,l)&&(ct="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(ct="onCompositionStart");ct&&(Or&&l.locale!=="ko"&&(ea||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&ea&&(it=Kl()):(Di=ce,ws="value"in Di?Di.value:Di.textContent,ea=!0)),ke=Xu(Q,ct),0<ke.length&&(ct=new Cs(ct,i,null,l,ce),me.push({event:ct,listeners:ke}),it?ct.data=it:(it=ru(l),it!==null&&(ct.data=it)))),(it=Ad?Ns(i,l):ou(i,l))&&(ct=Xu(Q,"onBeforeInput"),0<ct.length&&(ke=new Cs("onBeforeInput","beforeinput",null,l,ce),me.push({event:ke,listeners:ct}),ke.data=it)),_C(me,i,Q,l,ce)}jy(me,r)})}function dl(i,r,l){return{instance:i,listener:r,currentTarget:l}}function Xu(i,r){for(var l=r+"Capture",c=[];i!==null;){var y=i,T=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||T===null||(y=Ha(i,l),y!=null&&c.unshift(dl(i,y,T)),y=Ha(i,r),y!=null&&c.push(dl(i,y,T))),i.tag===3)return c;i=i.return}return[]}function EC(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function t0(i,r,l,c,y){for(var T=r._reactName,C=[];l!==null&&l!==c;){var D=l,V=D.alternate,Q=D.stateNode;if(D=D.tag,V!==null&&V===c)break;D!==5&&D!==26&&D!==27||Q===null||(V=Q,y?(Q=Ha(l,T),Q!=null&&C.unshift(dl(l,Q,V))):y||(Q=Ha(l,T),Q!=null&&C.push(dl(l,Q,V)))),l=l.return}C.length!==0&&i.push({event:r,listeners:C})}var SC=/\r\n?/g,xC=/\u0000|\uFFFD/g;function n0(i){return(typeof i=="string"?i:""+i).replace(SC,`
`).replace(xC,"")}function i0(i,r){return r=n0(r),n0(i)===r}function Ct(i,r,l,c,y,T){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||Ga(i,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&Ga(i,""+c);break;case"className":gi(i,"class",c);break;case"tabIndex":gi(i,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":gi(i,l,c);break;case"style":Wl(i,c,T);break;case"data":if(r!=="object"){gi(i,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){i.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(l);break}c=Ar(""+c),i.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(l==="formAction"?(r!=="input"&&Ct(i,r,"name",y.name,y,null),Ct(i,r,"formEncType",y.formEncType,y,null),Ct(i,r,"formMethod",y.formMethod,y,null),Ct(i,r,"formTarget",y.formTarget,y,null)):(Ct(i,r,"encType",y.encType,y,null),Ct(i,r,"method",y.method,y,null),Ct(i,r,"target",y.target,y,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(l);break}c=Ar(""+c),i.setAttribute(l,c);break;case"onClick":c!=null&&(i.onclick=Mi);break;case"onScroll":c!=null&&st("scroll",i);break;case"onScrollEnd":c!=null&&st("scrollend",i);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(y.children!=null)throw Error(a(60));i.innerHTML=l}}break;case"multiple":i.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":i.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){i.removeAttribute("xlink:href");break}l=Ar(""+c),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,""+c):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":c===!0?i.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,c):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?i.setAttribute(l,c):i.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?i.removeAttribute(l):i.setAttribute(l,c);break;case"popover":st("beforetoggle",i),st("toggle",i),po(i,"popover",c);break;case"xlinkActuate":ni(i,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":ni(i,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":ni(i,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":ni(i,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":ni(i,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":ni(i,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":ni(i,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":ni(i,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":ni(i,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":po(i,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=ld.get(l)||l,po(i,l,c))}}function Xf(i,r,l,c,y,T){switch(l){case"style":Wl(i,c,T);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(y.children!=null)throw Error(a(60));i.innerHTML=l}}break;case"children":typeof c=="string"?Ga(i,c):(typeof c=="number"||typeof c=="bigint")&&Ga(i,""+c);break;case"onScroll":c!=null&&st("scroll",i);break;case"onScrollEnd":c!=null&&st("scrollend",i);break;case"onClick":c!=null&&(i.onclick=Mi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Un.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),r=l.slice(2,y?l.length-7:void 0),T=i[Ke]||null,T=T!=null?T[l]:null,typeof T=="function"&&i.removeEventListener(r,T,y),typeof c=="function")){typeof T!="function"&&T!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(r,c,y);break e}l in i?i[l]=c:c===!0?i.setAttribute(l,""):po(i,l,c)}}}function Rn(i,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",i),st("load",i);var c=!1,y=!1,T;for(T in l)if(l.hasOwnProperty(T)){var C=l[T];if(C!=null)switch(T){case"src":c=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:Ct(i,r,T,C,l,null)}}y&&Ct(i,r,"srcSet",l.srcSet,l,null),c&&Ct(i,r,"src",l.src,l,null);return;case"input":st("invalid",i);var D=T=C=y=null,V=null,Q=null;for(c in l)if(l.hasOwnProperty(c)){var ce=l[c];if(ce!=null)switch(c){case"name":y=ce;break;case"type":C=ce;break;case"checked":V=ce;break;case"defaultChecked":Q=ce;break;case"value":T=ce;break;case"defaultValue":D=ce;break;case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(a(137,r));break;default:Ct(i,r,c,ce,l,null)}}Fl(i,T,D,V,Q,C,y,!1);return;case"select":st("invalid",i),c=C=T=null;for(y in l)if(l.hasOwnProperty(y)&&(D=l[y],D!=null))switch(y){case"value":T=D;break;case"defaultValue":C=D;break;case"multiple":c=D;default:Ct(i,r,y,D,l,null)}r=T,l=C,i.multiple=!!c,r!=null?Qi(i,!!c,r,!1):l!=null&&Qi(i,!!c,l,!0);return;case"textarea":st("invalid",i),T=y=c=null;for(C in l)if(l.hasOwnProperty(C)&&(D=l[C],D!=null))switch(C){case"value":c=D;break;case"defaultValue":y=D;break;case"children":T=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(a(91));break;default:Ct(i,r,C,D,l,null)}Cr(i,c,y,T);return;case"option":for(V in l)if(l.hasOwnProperty(V)&&(c=l[V],c!=null))switch(V){case"selected":i.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:Ct(i,r,V,c,l,null)}return;case"dialog":st("beforetoggle",i),st("toggle",i),st("cancel",i),st("close",i);break;case"iframe":case"object":st("load",i);break;case"video":case"audio":for(c=0;c<cl.length;c++)st(cl[c],i);break;case"image":st("error",i),st("load",i);break;case"details":st("toggle",i);break;case"embed":case"source":case"link":st("error",i),st("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in l)if(l.hasOwnProperty(Q)&&(c=l[Q],c!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:Ct(i,r,Q,c,l,null)}return;default:if(vs(r)){for(ce in l)l.hasOwnProperty(ce)&&(c=l[ce],c!==void 0&&Xf(i,r,ce,c,l,void 0));return}}for(D in l)l.hasOwnProperty(D)&&(c=l[D],c!=null&&Ct(i,r,D,c,l,null))}function CC(i,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,T=null,C=null,D=null,V=null,Q=null,ce=null;for(re in l){var me=l[re];if(l.hasOwnProperty(re)&&me!=null)switch(re){case"checked":break;case"value":break;case"defaultValue":V=me;default:c.hasOwnProperty(re)||Ct(i,r,re,null,c,me)}}for(var ee in c){var re=c[ee];if(me=l[ee],c.hasOwnProperty(ee)&&(re!=null||me!=null))switch(ee){case"type":T=re;break;case"name":y=re;break;case"checked":Q=re;break;case"defaultChecked":ce=re;break;case"value":C=re;break;case"defaultValue":D=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(a(137,r));break;default:re!==me&&Ct(i,r,ee,re,c,me)}}ms(i,C,D,V,Q,ce,T,y);return;case"select":re=C=D=ee=null;for(T in l)if(V=l[T],l.hasOwnProperty(T)&&V!=null)switch(T){case"value":break;case"multiple":re=V;default:c.hasOwnProperty(T)||Ct(i,r,T,null,c,V)}for(y in c)if(T=c[y],V=l[y],c.hasOwnProperty(y)&&(T!=null||V!=null))switch(y){case"value":ee=T;break;case"defaultValue":D=T;break;case"multiple":C=T;default:T!==V&&Ct(i,r,y,T,c,V)}r=D,l=C,c=re,ee!=null?Qi(i,!!l,ee,!1):!!c!=!!l&&(r!=null?Qi(i,!!l,r,!0):Qi(i,!!l,l?[]:"",!1));return;case"textarea":re=ee=null;for(D in l)if(y=l[D],l.hasOwnProperty(D)&&y!=null&&!c.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:Ct(i,r,D,null,c,y)}for(C in c)if(y=c[C],T=l[C],c.hasOwnProperty(C)&&(y!=null||T!=null))switch(C){case"value":ee=y;break;case"defaultValue":re=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(a(91));break;default:y!==T&&Ct(i,r,C,y,c,T)}mo(i,ee,re);return;case"option":for(var Re in l)if(ee=l[Re],l.hasOwnProperty(Re)&&ee!=null&&!c.hasOwnProperty(Re))switch(Re){case"selected":i.selected=!1;break;default:Ct(i,r,Re,null,c,ee)}for(V in c)if(ee=c[V],re=l[V],c.hasOwnProperty(V)&&ee!==re&&(ee!=null||re!=null))switch(V){case"selected":i.selected=ee&&typeof ee!="function"&&typeof ee!="symbol";break;default:Ct(i,r,V,ee,c,re)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var He in l)ee=l[He],l.hasOwnProperty(He)&&ee!=null&&!c.hasOwnProperty(He)&&Ct(i,r,He,null,c,ee);for(Q in c)if(ee=c[Q],re=l[Q],c.hasOwnProperty(Q)&&ee!==re&&(ee!=null||re!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(a(137,r));break;default:Ct(i,r,Q,ee,c,re)}return;default:if(vs(r)){for(var At in l)ee=l[At],l.hasOwnProperty(At)&&ee!==void 0&&!c.hasOwnProperty(At)&&Xf(i,r,At,void 0,c,ee);for(ce in c)ee=c[ce],re=l[ce],!c.hasOwnProperty(ce)||ee===re||ee===void 0&&re===void 0||Xf(i,r,ce,ee,c,re);return}}for(var X in l)ee=l[X],l.hasOwnProperty(X)&&ee!=null&&!c.hasOwnProperty(X)&&Ct(i,r,X,null,c,ee);for(me in c)ee=c[me],re=l[me],!c.hasOwnProperty(me)||ee===re||ee==null&&re==null||Ct(i,r,me,ee,c,re)}function a0(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function AC(){if(typeof performance.getEntriesByType=="function"){for(var i=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var y=l[c],T=y.transferSize,C=y.initiatorType,D=y.duration;if(T&&D&&a0(C)){for(C=0,D=y.responseEnd,c+=1;c<l.length;c++){var V=l[c],Q=V.startTime;if(Q>D)break;var ce=V.transferSize,me=V.initiatorType;ce&&a0(me)&&(V=V.responseEnd,C+=ce*(V<D?1:(D-Q)/(V-Q)))}if(--c,r+=8*(T+C)/(y.duration/1e3),i++,10<i)break}}if(0<i)return r/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Zf=null,Qf=null;function Zu(i){return i.nodeType===9?i:i.ownerDocument}function r0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function o0(i,r){if(i===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&r==="foreignObject"?0:i}function jf(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var ep=null;function IC(){var i=window.event;return i&&i.type==="popstate"?i===ep?!1:(ep=i,!0):(ep=null,!1)}var s0=typeof setTimeout=="function"?setTimeout:void 0,RC=typeof clearTimeout=="function"?clearTimeout:void 0,l0=typeof Promise=="function"?Promise:void 0,NC=typeof queueMicrotask=="function"?queueMicrotask:typeof l0<"u"?function(i){return l0.resolve(null).then(i).catch($C)}:s0;function $C(i){setTimeout(function(){throw i})}function dr(i){return i==="head"}function u0(i,r){var l=r,c=0;do{var y=l.nextSibling;if(i.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(c===0){i.removeChild(y),Zo(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")fl(i.ownerDocument.documentElement);else if(l==="head"){l=i.ownerDocument.head,fl(l);for(var T=l.firstChild;T;){var C=T.nextSibling,D=T.nodeName;T[Zi]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&T.rel.toLowerCase()==="stylesheet"||l.removeChild(T),T=C}}else l==="body"&&fl(i.ownerDocument.body);l=y}while(l);Zo(r)}function c0(i,r){var l=i;i=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(i===0)break;i--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||i++;l=c}while(l)}function tp(i){var r=i.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":tp(l),Pa(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function MC(i,r,l,c){for(;i.nodeType===1;){var y=l;if(i.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(c){if(!i[Zi])switch(r){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(T=i.getAttribute("rel"),T==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(T!==y.rel||i.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||i.getAttribute("title")!==(y.title==null?null:y.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(T=i.getAttribute("src"),(T!==(y.src==null?null:y.src)||i.getAttribute("type")!==(y.type==null?null:y.type)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&T&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(r==="input"&&i.type==="hidden"){var T=y.name==null?null:""+y.name;if(y.type==="hidden"&&i.getAttribute("name")===T)return i}else return i;if(i=wi(i.nextSibling),i===null)break}return null}function OC(i,r,l){if(r==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=wi(i.nextSibling),i===null))return null;return i}function d0(i,r){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!r||(i=wi(i.nextSibling),i===null))return null;return i}function np(i){return i.data==="$?"||i.data==="$~"}function ip(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function DC(i,r){var l=i.ownerDocument;if(i.data==="$~")i._reactRetry=r;else if(i.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),i._reactRetry=c}}function wi(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===1||r===3)break;if(r===8){if(r=i.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return i}var ap=null;function f0(i){i=i.nextSibling;for(var r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"||l==="/&"){if(r===0)return wi(i.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}i=i.nextSibling}return null}function p0(i){i=i.previousSibling;for(var r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return i;r--}else l!=="/$"&&l!=="/&"||r++}i=i.previousSibling}return null}function h0(i,r,l){switch(r=Zu(l),i){case"html":if(i=r.documentElement,!i)throw Error(a(452));return i;case"head":if(i=r.head,!i)throw Error(a(453));return i;case"body":if(i=r.body,!i)throw Error(a(454));return i;default:throw Error(a(451))}}function fl(i){for(var r=i.attributes;r.length;)i.removeAttributeNode(r[0]);Pa(i)}var Ei=new Map,m0=new Set;function Qu(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Ia=j.d;j.d={f:kC,r:zC,D:LC,C:UC,L:PC,m:BC,X:VC,S:GC,M:qC};function kC(){var i=Ia.f(),r=qu();return i||r}function zC(i){var r=Zt(i);r!==null&&r.tag===5&&r.type==="form"?Mg(r):Ia.r(i)}var Ko=typeof document>"u"?null:document;function g0(i,r,l){var c=Ko;if(c&&typeof r=="string"&&r){var y=Yn(r);y='link[rel="'+i+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),m0.has(y)||(m0.add(y),i={rel:i,crossOrigin:l,href:r},c.querySelector(y)===null&&(r=c.createElement("link"),Rn(r,"link",i),Kt(r),c.head.appendChild(r)))}}function LC(i){Ia.D(i),g0("dns-prefetch",i,null)}function UC(i,r){Ia.C(i,r),g0("preconnect",i,r)}function PC(i,r,l){Ia.L(i,r,l);var c=Ko;if(c&&i&&r){var y='link[rel="preload"][as="'+Yn(r)+'"]';r==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+Yn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+Yn(l.imageSizes)+'"]')):y+='[href="'+Yn(i)+'"]';var T=y;switch(r){case"style":T=Jo(i);break;case"script":T=Xo(i)}Ei.has(T)||(i=_({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:i,as:r},l),Ei.set(T,i),c.querySelector(y)!==null||r==="style"&&c.querySelector(pl(T))||r==="script"&&c.querySelector(hl(T))||(r=c.createElement("link"),Rn(r,"link",i),Kt(r),c.head.appendChild(r)))}}function BC(i,r){Ia.m(i,r);var l=Ko;if(l&&i){var c=r&&typeof r.as=="string"?r.as:"script",y='link[rel="modulepreload"][as="'+Yn(c)+'"][href="'+Yn(i)+'"]',T=y;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=Xo(i)}if(!Ei.has(T)&&(i=_({rel:"modulepreload",href:i},r),Ei.set(T,i),l.querySelector(y)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(hl(T)))return}c=l.createElement("link"),Rn(c,"link",i),Kt(c),l.head.appendChild(c)}}}function GC(i,r,l){Ia.S(i,r,l);var c=Ko;if(c&&i){var y=En(c).hoistableStyles,T=Jo(i);r=r||"default";var C=y.get(T);if(!C){var D={loading:0,preload:null};if(C=c.querySelector(pl(T)))D.loading=5;else{i=_({rel:"stylesheet",href:i,"data-precedence":r},l),(l=Ei.get(T))&&rp(i,l);var V=C=c.createElement("link");Kt(V),Rn(V,"link",i),V._p=new Promise(function(Q,ce){V.onload=Q,V.onerror=ce}),V.addEventListener("load",function(){D.loading|=1}),V.addEventListener("error",function(){D.loading|=2}),D.loading|=4,ju(C,r,c)}C={type:"stylesheet",instance:C,count:1,state:D},y.set(T,C)}}}function VC(i,r){Ia.X(i,r);var l=Ko;if(l&&i){var c=En(l).hoistableScripts,y=Xo(i),T=c.get(y);T||(T=l.querySelector(hl(y)),T||(i=_({src:i,async:!0},r),(r=Ei.get(y))&&op(i,r),T=l.createElement("script"),Kt(T),Rn(T,"link",i),l.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},c.set(y,T))}}function qC(i,r){Ia.M(i,r);var l=Ko;if(l&&i){var c=En(l).hoistableScripts,y=Xo(i),T=c.get(y);T||(T=l.querySelector(hl(y)),T||(i=_({src:i,async:!0,type:"module"},r),(r=Ei.get(y))&&op(i,r),T=l.createElement("script"),Kt(T),Rn(T,"link",i),l.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},c.set(y,T))}}function y0(i,r,l,c){var y=(y=Fe.current)?Qu(y):null;if(!y)throw Error(a(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Jo(l.href),l=En(y).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=Jo(l.href);var T=En(y).hoistableStyles,C=T.get(i);if(C||(y=y.ownerDocument||y,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(i,C),(T=y.querySelector(pl(i)))&&!T._p&&(C.instance=T,C.state.loading=5),Ei.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Ei.set(i,l),T||HC(y,i,l,C.state))),r&&c===null)throw Error(a(528,""));return C}if(r&&c!==null)throw Error(a(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Xo(l),l=En(y).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,i))}}function Jo(i){return'href="'+Yn(i)+'"'}function pl(i){return'link[rel="stylesheet"]['+i+"]"}function v0(i){return _({},i,{"data-precedence":i.precedence,precedence:null})}function HC(i,r,l,c){i.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=i.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Rn(r,"link",l),Kt(r),i.head.appendChild(r))}function Xo(i){return'[src="'+Yn(i)+'"]'}function hl(i){return"script[async]"+i}function _0(i,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=i.querySelector('style[data-href~="'+Yn(l.href)+'"]');if(c)return r.instance=c,Kt(c),c;var y=_({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(i.ownerDocument||i).createElement("style"),Kt(c),Rn(c,"style",y),ju(c,l.precedence,i),r.instance=c;case"stylesheet":y=Jo(l.href);var T=i.querySelector(pl(y));if(T)return r.state.loading|=4,r.instance=T,Kt(T),T;c=v0(l),(y=Ei.get(y))&&rp(c,y),T=(i.ownerDocument||i).createElement("link"),Kt(T);var C=T;return C._p=new Promise(function(D,V){C.onload=D,C.onerror=V}),Rn(T,"link",c),r.state.loading|=4,ju(T,l.precedence,i),r.instance=T;case"script":return T=Xo(l.src),(y=i.querySelector(hl(T)))?(r.instance=y,Kt(y),y):(c=l,(y=Ei.get(T))&&(c=_({},l),op(c,y)),i=i.ownerDocument||i,y=i.createElement("script"),Kt(y),Rn(y,"link",c),i.head.appendChild(y),r.instance=y);case"void":return null;default:throw Error(a(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,ju(c,l.precedence,i));return r.instance}function ju(i,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=c.length?c[c.length-1]:null,T=y,C=0;C<c.length;C++){var D=c[C];if(D.dataset.precedence===r)T=D;else if(T!==y)break}T?T.parentNode.insertBefore(i,T.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(i,r.firstChild))}function rp(i,r){i.crossOrigin==null&&(i.crossOrigin=r.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=r.referrerPolicy),i.title==null&&(i.title=r.title)}function op(i,r){i.crossOrigin==null&&(i.crossOrigin=r.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=r.referrerPolicy),i.integrity==null&&(i.integrity=r.integrity)}var ec=null;function b0(i,r,l){if(ec===null){var c=new Map,y=ec=new Map;y.set(l,c)}else y=ec,c=y.get(l),c||(c=new Map,y.set(l,c));if(c.has(i))return c;for(c.set(i,null),l=l.getElementsByTagName(i),y=0;y<l.length;y++){var T=l[y];if(!(T[Zi]||T[qe]||i==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var C=T.getAttribute(r)||"";C=i+C;var D=c.get(C);D?D.push(T):c.set(C,[T])}}return c}function T0(i,r,l){i=i.ownerDocument||i,i.head.insertBefore(l,r==="title"?i.querySelector("head > title"):null)}function FC(i,r,l){if(l===1||r.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return i=r.disabled,typeof r.precedence=="string"&&i==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function w0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function YC(i,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=Jo(c.href),T=r.querySelector(pl(y));if(T){r=T._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(i.count++,i=tc.bind(i),r.then(i,i)),l.state.loading|=4,l.instance=T,Kt(T);return}T=r.ownerDocument||r,c=v0(c),(y=Ei.get(y))&&rp(c,y),T=T.createElement("link"),Kt(T);var C=T;C._p=new Promise(function(D,V){C.onload=D,C.onerror=V}),Rn(T,"link",c),l.instance=T}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(i.count++,l=tc.bind(i),r.addEventListener("load",l),r.addEventListener("error",l))}}var sp=0;function WC(i,r){return i.stylesheets&&i.count===0&&ic(i,i.stylesheets),0<i.count||0<i.imgCount?function(l){var c=setTimeout(function(){if(i.stylesheets&&ic(i,i.stylesheets),i.unsuspend){var T=i.unsuspend;i.unsuspend=null,T()}},6e4+r);0<i.imgBytes&&sp===0&&(sp=62500*AC());var y=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&ic(i,i.stylesheets),i.unsuspend)){var T=i.unsuspend;i.unsuspend=null,T()}},(i.imgBytes>sp?50:800)+r);return i.unsuspend=l,function(){i.unsuspend=null,clearTimeout(c),clearTimeout(y)}}:null}function tc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ic(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var nc=null;function ic(i,r){i.stylesheets=null,i.unsuspend!==null&&(i.count++,nc=new Map,r.forEach(KC,i),nc=null,tc.call(i))}function KC(i,r){if(!(r.state.loading&4)){var l=nc.get(i);if(l)var c=l.get(null);else{l=new Map,nc.set(i,l);for(var y=i.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<y.length;T++){var C=y[T];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(l.set(C.dataset.precedence,C),c=C)}c&&l.set(null,c)}y=r.instance,C=y.getAttribute("data-precedence"),T=l.get(C)||c,T===c&&l.set(null,y),l.set(C,y),this.count++,c=tc.bind(this),y.addEventListener("load",c),y.addEventListener("error",c),T?T.parentNode.insertBefore(y,T.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(y,i.firstChild)),r.state.loading|=4}}var ml={$$typeof:O,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function JC(i,r,l,c,y,T,C,D,V){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Wt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wt(0),this.hiddenUpdates=Wt(null),this.identifierPrefix=c,this.onUncaughtError=y,this.onCaughtError=T,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function E0(i,r,l,c,y,T,C,D,V,Q,ce,me){return i=new JC(i,r,l,C,V,Q,ce,me,D),r=1,T===!0&&(r|=24),T=ai(3,null,null,r),i.current=T,T.stateNode=i,r=Pd(),r.refCount++,i.pooledCache=r,r.refCount++,T.memoizedState={element:c,isDehydrated:l,cache:r},qd(T),i}function S0(i){return i?(i=Ao,i):Ao}function x0(i,r,l,c,y,T){y=S0(y),c.context===null?c.context=y:c.pendingContext=y,c=er(r),c.payload={element:l},T=T===void 0?null:T,T!==null&&(c.callback=T),l=tr(i,c,r),l!==null&&(Qn(l,i,r),Ws(l,i,r))}function C0(i,r){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<r?l:r}}function lp(i,r){C0(i,r),(i=i.alternate)&&C0(i,r)}function A0(i){if(i.tag===13||i.tag===31){var r=ii(i,67108864);r!==null&&Qn(r,i,67108864),lp(i,67108864)}}function I0(i){if(i.tag===13||i.tag===31){var r=ui();r=zt(r);var l=ii(i,r);l!==null&&Qn(l,i,r),lp(i,r)}}var ac=!0;function XC(i,r,l,c){var y=H.T;H.T=null;var T=j.p;try{j.p=2,up(i,r,l,c)}finally{j.p=T,H.T=y}}function ZC(i,r,l,c){var y=H.T;H.T=null;var T=j.p;try{j.p=8,up(i,r,l,c)}finally{j.p=T,H.T=y}}function up(i,r,l,c){if(ac){var y=cp(c);if(y===null)Jf(i,r,c,rc,l),N0(i,c);else if(jC(y,i,r,l,c))c.stopPropagation();else if(N0(i,c),r&4&&-1<QC.indexOf(i)){for(;y!==null;){var T=Zt(y);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var C=Et(T.pendingLanes);if(C!==0){var D=T;for(D.pendingLanes|=2,D.entangledLanes|=2;C;){var V=1<<31-fn(C);D.entanglements[1]|=V,C&=~V}ra(T),(_t&6)===0&&(Gu=Gt()+500,ul(0))}}break;case 31:case 13:D=ii(T,2),D!==null&&Qn(D,T,2),qu(),lp(T,2)}if(T=cp(c),T===null&&Jf(i,r,c,rc,l),T===y)break;y=T}y!==null&&c.stopPropagation()}else Jf(i,r,c,null,l)}}function cp(i){return i=Va(i),dp(i)}var rc=null;function dp(i){if(rc=null,i=St(i),i!==null){var r=o(i);if(r===null)i=null;else{var l=r.tag;if(l===13){if(i=u(r),i!==null)return i;i=null}else if(l===31){if(i=d(r),i!==null)return i;i=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;i=null}else r!==i&&(i=null)}}return rc=i,null}function R0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vt()){case La:return 2;case Sr:return 8;case Ri:case ti:return 32;case Xi:return 268435456;default:return 32}default:return 32}}var fp=!1,fr=null,pr=null,hr=null,gl=new Map,yl=new Map,mr=[],QC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function N0(i,r){switch(i){case"focusin":case"focusout":fr=null;break;case"dragenter":case"dragleave":pr=null;break;case"mouseover":case"mouseout":hr=null;break;case"pointerover":case"pointerout":gl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":yl.delete(r.pointerId)}}function vl(i,r,l,c,y,T){return i===null||i.nativeEvent!==T?(i={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:T,targetContainers:[y]},r!==null&&(r=Zt(r),r!==null&&A0(r)),i):(i.eventSystemFlags|=c,r=i.targetContainers,y!==null&&r.indexOf(y)===-1&&r.push(y),i)}function jC(i,r,l,c,y){switch(r){case"focusin":return fr=vl(fr,i,r,l,c,y),!0;case"dragenter":return pr=vl(pr,i,r,l,c,y),!0;case"mouseover":return hr=vl(hr,i,r,l,c,y),!0;case"pointerover":var T=y.pointerId;return gl.set(T,vl(gl.get(T)||null,i,r,l,c,y)),!0;case"gotpointercapture":return T=y.pointerId,yl.set(T,vl(yl.get(T)||null,i,r,l,c,y)),!0}return!1}function $0(i){var r=St(i.target);if(r!==null){var l=o(r);if(l!==null){if(r=l.tag,r===13){if(r=u(l),r!==null){i.blockedOn=r,$n(i.priority,function(){I0(l)});return}}else if(r===31){if(r=d(l),r!==null){i.blockedOn=r,$n(i.priority,function(){I0(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function oc(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;0<r.length;){var l=cp(i.nativeEvent);if(l===null){l=i.nativeEvent;var c=new l.constructor(l.type,l);_s=c,l.target.dispatchEvent(c),_s=null}else return r=Zt(l),r!==null&&A0(r),i.blockedOn=l,!1;r.shift()}return!0}function M0(i,r,l){oc(i)&&l.delete(r)}function eA(){fp=!1,fr!==null&&oc(fr)&&(fr=null),pr!==null&&oc(pr)&&(pr=null),hr!==null&&oc(hr)&&(hr=null),gl.forEach(M0),yl.forEach(M0)}function sc(i,r){i.blockedOn===r&&(i.blockedOn=null,fp||(fp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,eA)))}var lc=null;function O0(i){lc!==i&&(lc=i,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){lc===i&&(lc=null);for(var r=0;r<i.length;r+=3){var l=i[r],c=i[r+1],y=i[r+2];if(typeof c!="function"){if(dp(c||l)===null)continue;break}var T=Zt(l);T!==null&&(i.splice(r,3),r-=3,cf(T,{pending:!0,data:y,method:l.method,action:c},c,y))}}))}function Zo(i){function r(V){return sc(V,i)}fr!==null&&sc(fr,i),pr!==null&&sc(pr,i),hr!==null&&sc(hr,i),gl.forEach(r),yl.forEach(r);for(var l=0;l<mr.length;l++){var c=mr[l];c.blockedOn===i&&(c.blockedOn=null)}for(;0<mr.length&&(l=mr[0],l.blockedOn===null);)$0(l),l.blockedOn===null&&mr.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var y=l[c],T=l[c+1],C=y[Ke]||null;if(typeof T=="function")C||O0(l);else if(C){var D=null;if(T&&T.hasAttribute("formAction")){if(y=T,C=T[Ke]||null)D=C.formAction;else if(dp(y)!==null)continue}else D=C.action;typeof D=="function"?l[c+1]=D:(l.splice(c,3),c-=3),O0(l)}}}function D0(){function i(T){T.canIntercept&&T.info==="react-transition"&&T.intercept({handler:function(){return new Promise(function(C){return y=C})},focusReset:"manual",scroll:"manual"})}function r(){y!==null&&(y(),y=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var T=navigation.currentEntry;T&&T.url!=null&&navigation.navigate(T.url,{state:T.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,y=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),y!==null&&(y(),y=null)}}}function pp(i){this._internalRoot=i}uc.prototype.render=pp.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw Error(a(409));var l=r.current,c=ui();x0(l,c,i,r,null,null)},uc.prototype.unmount=pp.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;x0(i.current,2,null,i,null,null),qu(),r[et]=null}};function uc(i){this._internalRoot=i}uc.prototype.unstable_scheduleHydration=function(i){if(i){var r=Ue();i={blockedOn:null,target:i,priority:r};for(var l=0;l<mr.length&&r!==0&&r<mr[l].priority;l++);mr.splice(l,0,i),l===0&&$0(i)}};var k0=t.version;if(k0!=="19.2.3")throw Error(a(527,k0,"19.2.3"));j.findDOMNode=function(i){var r=i._reactInternals;if(r===void 0)throw typeof i.render=="function"?Error(a(188)):(i=Object.keys(i).join(","),Error(a(268,i)));return i=f(r),i=i!==null?m(i):null,i=i===null?null:i.stateNode,i};var tA={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{Ni=cc.inject(tA),dn=cc}catch{}}return bl.createRoot=function(i,r){if(!s(i))throw Error(a(299));var l=!1,c="",y=Vg,T=qg,C=Hg;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(y=r.onUncaughtError),r.onCaughtError!==void 0&&(T=r.onCaughtError),r.onRecoverableError!==void 0&&(C=r.onRecoverableError)),r=E0(i,1,!1,null,null,l,c,null,y,T,C,D0),i[et]=r.current,Kf(i),new pp(r)},bl.hydrateRoot=function(i,r,l){if(!s(i))throw Error(a(299));var c=!1,y="",T=Vg,C=qg,D=Hg,V=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(T=l.onUncaughtError),l.onCaughtError!==void 0&&(C=l.onCaughtError),l.onRecoverableError!==void 0&&(D=l.onRecoverableError),l.formState!==void 0&&(V=l.formState)),r=E0(i,1,!0,r,l??null,c,y,V,T,C,D,D0),r.context=S0(null),l=r.current,c=ui(),c=zt(c),y=er(c),y.callback=null,tr(l,y,c),l=c,r.current.lanes=l,gn(r,l),ra(r),i[et]=r.current,Kf(i),new uc(r)},bl.version="19.2.3",bl}var Y0;function pA(){if(Y0)return gp.exports;Y0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),gp.exports=fA(),gp.exports}var hA=pA(),mA={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let gA,yA;function vA(){return{geminiUrl:gA,vertexUrl:yA}}function _A(e,t,n,a){var s,o;if(!(e!=null&&e.baseUrl)){const u=vA();return t?(s=u.vertexUrl)!==null&&s!==void 0?s:n:(o=u.geminiUrl)!==null&&o!==void 0?o:a}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ma{}function xe(e,t){const n=/\{([^}]+)\}/g;return e.replace(n,(a,s)=>{if(Object.prototype.hasOwnProperty.call(t,s)){const o=t[s];return o!=null?String(o):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function g(e,t,n){for(let o=0;o<t.length-1;o++){const u=t[o];if(u.endsWith("[]")){const d=u.slice(0,-2);if(!(d in e))if(Array.isArray(n))e[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(e[d])){const p=e[d];if(Array.isArray(n))for(let f=0;f<p.length;f++){const m=p[f];g(m,t.slice(o+1),n[f])}else for(const f of p)g(f,t.slice(o+1),n)}return}else if(u.endsWith("[0]")){const d=u.slice(0,-3);d in e||(e[d]=[{}]);const p=e[d];g(p[0],t.slice(o+1),n);return}(!e[u]||typeof e[u]!="object")&&(e[u]={}),e=e[u]}const a=t[t.length-1],s=e[a];if(s!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===s)return;if(typeof s=="object"&&typeof n=="object"&&s!==null&&n!==null)Object.assign(s,n);else throw new Error(`Cannot set value for an existing key. Key: ${a}`)}else a==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(e,n):e[a]=n}function h(e,t,n=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let a=0;a<t.length;a++){if(typeof e!="object"||e===null)return n;const s=t[a];if(s.endsWith("[]")){const o=s.slice(0,-2);if(o in e){const u=e[o];return Array.isArray(u)?u.map(d=>h(d,t.slice(a+1),n)):n}else return n}else e=e[s]}return e}catch(a){if(a instanceof TypeError)return n;throw a}}function bA(e,t){for(const[n,a]of Object.entries(t)){const s=n.split("."),o=a.split("."),u=new Set;let d=-1;for(let p=0;p<s.length;p++)if(s[p]==="*"){d=p;break}if(d!==-1&&o.length>d)for(let p=d;p<o.length;p++){const f=o[p];f!=="*"&&!f.endsWith("[]")&&!f.endsWith("[0]")&&u.add(f)}bh(e,s,o,0,u)}}function bh(e,t,n,a,s){if(a>=t.length||typeof e!="object"||e===null)return;const o=t[a];if(o.endsWith("[]")){const u=o.slice(0,-2),d=e;if(u in d&&Array.isArray(d[u]))for(const p of d[u])bh(p,t,n,a+1,s)}else if(o==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const u=e,d=Object.keys(u).filter(f=>!f.startsWith("_")&&!s.has(f)),p={};for(const f of d)p[f]=u[f];for(const[f,m]of Object.entries(p)){const _=[];for(const b of n.slice(a))b==="*"?_.push(f):_.push(b);g(u,_,m)}for(const f of d)delete u[f]}}else{const u=e;o in u&&bh(u[o],t,n,a+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zh(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TA(e){const t={},n=h(e,["operationName"]);n!=null&&g(t,["operationName"],n);const a=h(e,["resourceName"]);return a!=null&&g(t,["_url","resourceName"],a),t}function wA(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response","generateVideoResponse"]);return u!=null&&g(t,["response"],SA(u)),t}function EA(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response"]);return u!=null&&g(t,["response"],xA(u)),t}function SA(e){const t={},n=h(e,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>CA(u))),g(t,["generatedVideos"],o)}const a=h(e,["raiMediaFilteredCount"]);a!=null&&g(t,["raiMediaFilteredCount"],a);const s=h(e,["raiMediaFilteredReasons"]);return s!=null&&g(t,["raiMediaFilteredReasons"],s),t}function xA(e){const t={},n=h(e,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>AA(u))),g(t,["generatedVideos"],o)}const a=h(e,["raiMediaFilteredCount"]);a!=null&&g(t,["raiMediaFilteredCount"],a);const s=h(e,["raiMediaFilteredReasons"]);return s!=null&&g(t,["raiMediaFilteredReasons"],s),t}function CA(e){const t={},n=h(e,["video"]);return n!=null&&g(t,["video"],OA(n)),t}function AA(e){const t={},n=h(e,["_self"]);return n!=null&&g(t,["video"],DA(n)),t}function IA(e){const t={},n=h(e,["operationName"]);return n!=null&&g(t,["_url","operationName"],n),t}function RA(e){const t={},n=h(e,["operationName"]);return n!=null&&g(t,["_url","operationName"],n),t}function NA(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response"]);return u!=null&&g(t,["response"],$A(u)),t}function $A(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["parent"]);a!=null&&g(t,["parent"],a);const s=h(e,["documentName"]);return s!=null&&g(t,["documentName"],s),t}function dw(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response"]);return u!=null&&g(t,["response"],MA(u)),t}function MA(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["parent"]);a!=null&&g(t,["parent"],a);const s=h(e,["documentName"]);return s!=null&&g(t,["documentName"],s),t}function OA(e){const t={},n=h(e,["uri"]);n!=null&&g(t,["uri"],n);const a=h(e,["encodedVideo"]);a!=null&&g(t,["videoBytes"],Zh(a));const s=h(e,["encoding"]);return s!=null&&g(t,["mimeType"],s),t}function DA(e){const t={},n=h(e,["gcsUri"]);n!=null&&g(t,["uri"],n);const a=h(e,["bytesBase64Encoded"]);a!=null&&g(t,["videoBytes"],Zh(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["mimeType"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var W0;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(W0||(W0={}));var K0;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(K0||(K0={}));var J0;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(J0||(J0={}));var br;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(br||(br={}));var X0;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(X0||(X0={}));var Z0;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(Z0||(Z0={}));var Q0;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Q0||(Q0={}));var j0;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(j0||(j0={}));var ev;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(ev||(ev={}));var tv;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(tv||(tv={}));var nv;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(nv||(nv={}));var iv;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(iv||(iv={}));var av;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(av||(av={}));var rv;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(rv||(rv={}));var ov;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(ov||(ov={}));var sv;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})(sv||(sv={}));var lv;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(lv||(lv={}));var uv;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(uv||(uv={}));var cv;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(cv||(cv={}));var dv;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(dv||(dv={}));var fv;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(fv||(fv={}));var Oc;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(Oc||(Oc={}));var pv;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(pv||(pv={}));var hv;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(hv||(hv={}));var mv;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(mv||(mv={}));var Th;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Th||(Th={}));var gv;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(gv||(gv={}));var yv;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(yv||(yv={}));var vv;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(vv||(vv={}));var _v;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(_v||(_v={}));var bv;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(bv||(bv={}));var Tv;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(Tv||(Tv={}));var wv;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(wv||(wv={}));var Ev;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ev||(Ev={}));var Sv;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Sv||(Sv={}));var xv;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(xv||(xv={}));var Cv;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Cv||(Cv={}));var Av;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(Av||(Av={}));var Iv;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(Iv||(Iv={}));var Rv;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(Rv||(Rv={}));var Nv;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(Nv||(Nv={}));var $v;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})($v||($v={}));var Mv;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(Mv||(Mv={}));var Ov;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(Ov||(Ov={}));var Dv;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"})(Dv||(Dv={}));var kv;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(kv||(kv={}));var zv;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(zv||(zv={}));var Lv;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Lv||(Lv={}));var Uv;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Uv||(Uv={}));var Pv;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Pv||(Pv={}));var Bv;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(Bv||(Bv={}));var Gv;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Gv||(Gv={}));var Vv;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Vv||(Vv={}));var qv;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(qv||(qv={}));var es;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(es||(es={}));class wh{constructor(t){const n={};for(const a of t.headers.entries())n[a[0]]=a[1];this.headers=n,this.responseInternal=t}json(){return this.responseInternal.json()}}class Tl{get text(){var t,n,a,s,o,u,d,p;if(((s=(a=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let f="",m=!1;const _=[];for(const b of(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[E,x]of Object.entries(b))E!=="text"&&E!=="thought"&&E!=="thoughtSignature"&&(x!==null||x!==void 0)&&_.push(E);if(typeof b.text=="string"){if(typeof b.thought=="boolean"&&b.thought)continue;m=!0,f+=b.text}}return _.length>0&&console.warn(`there are non-text parts ${_} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?f:void 0}get data(){var t,n,a,s,o,u,d,p;if(((s=(a=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let f="";const m=[];for(const _ of(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)!==null&&p!==void 0?p:[]){for(const[b,E]of Object.entries(_))b!=="inlineData"&&(E!==null||E!==void 0)&&m.push(b);_.inlineData&&typeof _.inlineData.data=="string"&&(f+=atob(_.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),f.length>0?btoa(f):void 0}get functionCalls(){var t,n,a,s,o,u,d,p;if(((s=(a=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const f=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((f==null?void 0:f.length)!==0)return f}get executableCode(){var t,n,a,s,o,u,d,p,f;if(((s=(a=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(_=>_.executableCode).map(_=>_.executableCode).filter(_=>_!==void 0);if((m==null?void 0:m.length)!==0)return(f=m==null?void 0:m[0])===null||f===void 0?void 0:f.code}get codeExecutionResult(){var t,n,a,s,o,u,d,p,f;if(((s=(a=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||a===void 0?void 0:a.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(p=(d=(u=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content)===null||d===void 0?void 0:d.parts)===null||p===void 0?void 0:p.filter(_=>_.codeExecutionResult).map(_=>_.codeExecutionResult).filter(_=>_!==void 0);if((m==null?void 0:m.length)!==0)return(f=m==null?void 0:m[0])===null||f===void 0?void 0:f.output}}class Hv{}class Fv{}class kA{}class zA{}class LA{}class UA{}class Yv{}class Wv{}class Kv{}class PA{}class Dc{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const a=new Dc;let s;const o=t;return n?s=EA(o):s=wA(o),Object.assign(a,s),a}}class Jv{}class Xv{}class Zv{}class Qv{}class BA{}class GA{}class VA{}class Qh{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const a=new Qh,o=NA(t);return Object.assign(a,o),a}}class qA{}class HA{}class FA{}class jv{}class YA{get text(){var t,n,a;let s="",o=!1;const u=[];for(const d of(a=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&a!==void 0?a:[]){for(const[p,f]of Object.entries(d))p!=="text"&&p!=="thought"&&f!==null&&u.push(p);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,s+=d.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?s:void 0}get data(){var t,n,a;let s="";const o=[];for(const u of(a=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&a!==void 0?a:[]){for(const[d,p]of Object.entries(u))d!=="inlineData"&&p!==null&&o.push(d);u.inlineData&&typeof u.inlineData.data=="string"&&(s+=atob(u.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class WA{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class jh{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const a=new jh,o=dw(t);return Object.assign(a,o),a}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gt(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const n=t.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function fw(e,t){const n=gt(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function pw(e){return Array.isArray(e)?e.map(t=>kc(t)):[kc(e)]}function kc(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function hw(e){const t=kc(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function mw(e){const t=kc(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function e_(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function gw(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>e_(t)):[e_(e)]}function Eh(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function t_(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function n_(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Ln(e){if(e==null)throw new Error("ContentUnion is required");return Eh(e)?e:{role:"user",parts:gw(e)}}function em(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(n=>{const a=Ln(n);return a.parts&&a.parts.length>0&&a.parts[0].text!==void 0?[a.parts[0].text]:[]});if(e.isVertexAI()){const n=Ln(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(t)?t.map(n=>Ln(n)):[Ln(t)]}function xi(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(t_(e)||n_(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ln(e)]}const t=[],n=[],a=Eh(e[0]);for(const s of e){const o=Eh(s);if(o!=a)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)t.push(s);else{if(t_(s)||n_(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(s)}}return a||t.push({role:"user",parts:gw(n)}),t}function KA(e,t){e.includes("null")&&(t.nullable=!0);const n=e.filter(a=>a!=="null");if(n.length===1)t.type=Object.values(br).includes(n[0].toUpperCase())?n[0].toUpperCase():br.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const a of n)t.anyOf.push({type:Object.values(br).includes(a.toUpperCase())?a.toUpperCase():br.TYPE_UNSPECIFIED})}}function rs(e){const t={},n=["items"],a=["anyOf"],s=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=e.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(t.nullable=!0,e=o[1]):o[1].type==="null"&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&KA(e.type,t);for(const[u,d]of Object.entries(e))if(d!=null)if(u=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;t.type=Object.values(br).includes(d.toUpperCase())?d.toUpperCase():br.TYPE_UNSPECIFIED}else if(n.includes(u))t[u]=rs(d);else if(a.includes(u)){const p=[];for(const f of d){if(f.type=="null"){t.nullable=!0;continue}p.push(rs(f))}t[u]=p}else if(s.includes(u)){const p={};for(const[f,m]of Object.entries(d))p[f]=rs(m);t[u]=p}else{if(u==="additionalProperties")continue;t[u]=d}return t}function tm(e){return rs(e)}function nm(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function im(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function us(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=rs(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=rs(t.response));return e}function cs(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function JA(e,t,n,a=1){const s=!t.startsWith(`${n}/`)&&t.split("/").length===a;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:s?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:s?`${n}/${t}`:t}function Oa(e,t){if(typeof t!="string")throw new Error("name must be a string");return JA(e,t,"cachedContents")}function yw(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function wr(e){return Zh(e)}function XA(e){return e!=null&&typeof e=="object"&&"name"in e}function ZA(e){return e!=null&&typeof e=="object"&&"video"in e}function QA(e){return e!=null&&typeof e=="object"&&"uri"in e}function vw(e){var t;let n;if(XA(e)&&(n=e.name),!(QA(e)&&(n=e.uri,n===void 0))&&!(ZA(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const s=n.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${n}`);n=s[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function _w(e,t){let n;return e.isVertexAI()?n=t?"publishers/google/models":"models":n=t?"models":"tunedModels",n}function bw(e){for(const t of["models","tunedModels","publisherModels"])if(jA(e,t))return e[t];return[]}function jA(e,t){return e!==null&&typeof e=="object"&&t in e}function eI(e,t={}){const n=e,a={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(a.responseJsonSchema=n.outputSchema),t.behavior&&(a.behavior=t.behavior),{functionDeclarations:[a]}}function tI(e,t={}){const n=[],a=new Set;for(const s of e){const o=s.name;if(a.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);a.add(o);const u=eI(s,t);u.functionDeclarations&&n.push(...u.functionDeclarations)}return{functionDeclarations:n}}function Tw(e,t){let n;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;const a=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,s=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(s>0||a!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(a>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function nI(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function ww(e){if(typeof e!="object"||e===null)return{};const t=e,n=t.inlinedResponses;if(typeof n!="object"||n===null)return e;const s=n.inlinedResponses;if(!Array.isArray(s)||s.length===0)return e;let o=!1;for(const u of s){if(typeof u!="object"||u===null)continue;const p=u.response;if(typeof p!="object"||p===null)continue;if(p.embedding!==void 0){o=!0;break}}return o&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function ds(e,t){const n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Ew(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iI(e){const t={},n=h(e,["responsesFile"]);n!=null&&g(t,["fileName"],n);const a=h(e,["inlinedResponses","inlinedResponses"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>LI(u))),g(t,["inlinedResponses"],o)}const s=h(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["inlinedEmbedContentResponses"],o)}return t}function aI(e){const t={},n=h(e,["predictionsFormat"]);n!=null&&g(t,["format"],n);const a=h(e,["gcsDestination","outputUriPrefix"]);a!=null&&g(t,["gcsUri"],a);const s=h(e,["bigqueryDestination","outputUri"]);return s!=null&&g(t,["bigqueryUri"],s),t}function rI(e){const t={},n=h(e,["format"]);n!=null&&g(t,["predictionsFormat"],n);const a=h(e,["gcsUri"]);a!=null&&g(t,["gcsDestination","outputUriPrefix"],a);const s=h(e,["bigqueryUri"]);if(s!=null&&g(t,["bigqueryDestination","outputUri"],s),h(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(h(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Rc(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata","displayName"]);a!=null&&g(t,["displayName"],a);const s=h(e,["metadata","state"]);s!=null&&g(t,["state"],Ew(s));const o=h(e,["metadata","createTime"]);o!=null&&g(t,["createTime"],o);const u=h(e,["metadata","endTime"]);u!=null&&g(t,["endTime"],u);const d=h(e,["metadata","updateTime"]);d!=null&&g(t,["updateTime"],d);const p=h(e,["metadata","model"]);p!=null&&g(t,["model"],p);const f=h(e,["metadata","output"]);return f!=null&&g(t,["dest"],iI(ww(f))),t}function Sh(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["displayName"]);a!=null&&g(t,["displayName"],a);const s=h(e,["state"]);s!=null&&g(t,["state"],Ew(s));const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["createTime"]);u!=null&&g(t,["createTime"],u);const d=h(e,["startTime"]);d!=null&&g(t,["startTime"],d);const p=h(e,["endTime"]);p!=null&&g(t,["endTime"],p);const f=h(e,["updateTime"]);f!=null&&g(t,["updateTime"],f);const m=h(e,["model"]);m!=null&&g(t,["model"],m);const _=h(e,["inputConfig"]);_!=null&&g(t,["src"],oI(_));const b=h(e,["outputConfig"]);b!=null&&g(t,["dest"],aI(ww(b)));const E=h(e,["completionStats"]);return E!=null&&g(t,["completionStats"],E),t}function oI(e){const t={},n=h(e,["instancesFormat"]);n!=null&&g(t,["format"],n);const a=h(e,["gcsSource","uris"]);a!=null&&g(t,["gcsUri"],a);const s=h(e,["bigquerySource","inputUri"]);return s!=null&&g(t,["bigqueryUri"],s),t}function sI(e,t){const n={};if(h(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(h(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const a=h(t,["fileName"]);a!=null&&g(n,["fileName"],a);const s=h(t,["inlinedRequests"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>zI(e,u))),g(n,["requests","requests"],o)}return n}function lI(e){const t={},n=h(e,["format"]);n!=null&&g(t,["instancesFormat"],n);const a=h(e,["gcsUri"]);a!=null&&g(t,["gcsSource","uris"],a);const s=h(e,["bigqueryUri"]);if(s!=null&&g(t,["bigquerySource","inputUri"],s),h(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(h(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function uI(e){const t={},n=h(e,["data"]);if(n!=null&&g(t,["data"],n),h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function cI(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function dI(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function fI(e){const t={},n=h(e,["content"]);n!=null&&g(t,["content"],n);const a=h(e,["citationMetadata"]);a!=null&&g(t,["citationMetadata"],pI(a));const s=h(e,["tokenCount"]);s!=null&&g(t,["tokenCount"],s);const o=h(e,["finishReason"]);o!=null&&g(t,["finishReason"],o);const u=h(e,["avgLogprobs"]);u!=null&&g(t,["avgLogprobs"],u);const d=h(e,["groundingMetadata"]);d!=null&&g(t,["groundingMetadata"],d);const p=h(e,["index"]);p!=null&&g(t,["index"],p);const f=h(e,["logprobsResult"]);f!=null&&g(t,["logprobsResult"],f);const m=h(e,["safetyRatings"]);if(m!=null){let b=m;Array.isArray(b)&&(b=b.map(E=>E)),g(t,["safetyRatings"],b)}const _=h(e,["urlContextMetadata"]);return _!=null&&g(t,["urlContextMetadata"],_),t}function pI(e){const t={},n=h(e,["citationSources"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(s=>s)),g(t,["citations"],a)}return t}function Sw(e){const t={},n=h(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>HI(o))),g(t,["parts"],s)}const a=h(e,["role"]);return a!=null&&g(t,["role"],a),t}function hI(e,t){const n={},a=h(e,["displayName"]);if(t!==void 0&&a!=null&&g(t,["batch","displayName"],a),h(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function mI(e,t){const n={},a=h(e,["displayName"]);t!==void 0&&a!=null&&g(t,["displayName"],a);const s=h(e,["dest"]);return t!==void 0&&s!=null&&g(t,["outputConfig"],rI(nI(s))),n}function i_(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["src"]);s!=null&&g(n,["batch","inputConfig"],sI(e,Tw(e,s)));const o=h(t,["config"]);return o!=null&&hI(o,n),n}function gI(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["model"],gt(e,a));const s=h(t,["src"]);s!=null&&g(n,["inputConfig"],lI(Tw(e,s)));const o=h(t,["config"]);return o!=null&&mI(o,n),n}function yI(e,t){const n={},a=h(e,["displayName"]);return t!==void 0&&a!=null&&g(t,["batch","displayName"],a),n}function vI(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["src"]);s!=null&&g(n,["batch","inputConfig"],xI(e,s));const o=h(t,["config"]);return o!=null&&yI(o,n),n}function _I(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function bI(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function TI(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["name"]);a!=null&&g(t,["name"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);return o!=null&&g(t,["error"],o),t}function wI(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["name"]);a!=null&&g(t,["name"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);return o!=null&&g(t,["error"],o),t}function EI(e,t){const n={},a=h(t,["contents"]);if(a!=null){let o=em(e,a);Array.isArray(o)&&(o=o.map(u=>u)),g(n,["requests[]","request","content"],o)}const s=h(t,["config"]);return s!=null&&(g(n,["_self"],SI(s,n)),bA(n,{"requests[].*":"requests[].request.*"})),n}function SI(e,t){const n={},a=h(e,["taskType"]);t!==void 0&&a!=null&&g(t,["requests[]","taskType"],a);const s=h(e,["title"]);t!==void 0&&s!=null&&g(t,["requests[]","title"],s);const o=h(e,["outputDimensionality"]);if(t!==void 0&&o!=null&&g(t,["requests[]","outputDimensionality"],o),h(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function xI(e,t){const n={},a=h(t,["fileName"]);a!=null&&g(n,["file_name"],a);const s=h(t,["inlinedRequests"]);return s!=null&&g(n,["requests"],EI(e,s)),n}function CI(e){const t={};if(h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=h(e,["fileUri"]);n!=null&&g(t,["fileUri"],n);const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function AI(e){const t={},n=h(e,["id"]);n!=null&&g(t,["id"],n);const a=h(e,["args"]);a!=null&&g(t,["args"],a);const s=h(e,["name"]);if(s!=null&&g(t,["name"],s),h(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function II(e){const t={},n=h(e,["allowedFunctionNames"]);n!=null&&g(t,["allowedFunctionNames"],n);const a=h(e,["mode"]);if(a!=null&&g(t,["mode"],a),h(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function RI(e,t,n){const a={},s=h(t,["systemInstruction"]);n!==void 0&&s!=null&&g(n,["systemInstruction"],Sw(Ln(s)));const o=h(t,["temperature"]);o!=null&&g(a,["temperature"],o);const u=h(t,["topP"]);u!=null&&g(a,["topP"],u);const d=h(t,["topK"]);d!=null&&g(a,["topK"],d);const p=h(t,["candidateCount"]);p!=null&&g(a,["candidateCount"],p);const f=h(t,["maxOutputTokens"]);f!=null&&g(a,["maxOutputTokens"],f);const m=h(t,["stopSequences"]);m!=null&&g(a,["stopSequences"],m);const _=h(t,["responseLogprobs"]);_!=null&&g(a,["responseLogprobs"],_);const b=h(t,["logprobs"]);b!=null&&g(a,["logprobs"],b);const E=h(t,["presencePenalty"]);E!=null&&g(a,["presencePenalty"],E);const x=h(t,["frequencyPenalty"]);x!=null&&g(a,["frequencyPenalty"],x);const I=h(t,["seed"]);I!=null&&g(a,["seed"],I);const N=h(t,["responseMimeType"]);N!=null&&g(a,["responseMimeType"],N);const R=h(t,["responseSchema"]);R!=null&&g(a,["responseSchema"],tm(R));const $=h(t,["responseJsonSchema"]);if($!=null&&g(a,["responseJsonSchema"],$),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const O=h(t,["safetySettings"]);if(n!==void 0&&O!=null){let ge=O;Array.isArray(ge)&&(ge=ge.map($e=>FI($e))),g(n,["safetySettings"],ge)}const k=h(t,["tools"]);if(n!==void 0&&k!=null){let ge=cs(k);Array.isArray(ge)&&(ge=ge.map($e=>WI(us($e)))),g(n,["tools"],ge)}const P=h(t,["toolConfig"]);if(n!==void 0&&P!=null&&g(n,["toolConfig"],YI(P)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=h(t,["cachedContent"]);n!==void 0&&G!=null&&g(n,["cachedContent"],Oa(e,G));const B=h(t,["responseModalities"]);B!=null&&g(a,["responseModalities"],B);const K=h(t,["mediaResolution"]);K!=null&&g(a,["mediaResolution"],K);const Y=h(t,["speechConfig"]);if(Y!=null&&g(a,["speechConfig"],nm(Y)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const se=h(t,["thinkingConfig"]);se!=null&&g(a,["thinkingConfig"],se);const ve=h(t,["imageConfig"]);ve!=null&&g(a,["imageConfig"],kI(ve));const _e=h(t,["enableEnhancedCivicAnswers"]);return _e!=null&&g(a,["enableEnhancedCivicAnswers"],_e),a}function NI(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["candidates"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(f=>fI(f))),g(t,["candidates"],p)}const s=h(e,["modelVersion"]);s!=null&&g(t,["modelVersion"],s);const o=h(e,["promptFeedback"]);o!=null&&g(t,["promptFeedback"],o);const u=h(e,["responseId"]);u!=null&&g(t,["responseId"],u);const d=h(e,["usageMetadata"]);return d!=null&&g(t,["usageMetadata"],d),t}function $I(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function MI(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],ds(e,a)),n}function OI(e){const t={};if(h(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=h(e,["enableWidget"]);return n!=null&&g(t,["enableWidget"],n),t}function DI(e){const t={};if(h(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=h(e,["timeRangeFilter"]);return n!=null&&g(t,["timeRangeFilter"],n),t}function kI(e){const t={},n=h(e,["aspectRatio"]);n!=null&&g(t,["aspectRatio"],n);const a=h(e,["imageSize"]);if(a!=null&&g(t,["imageSize"],a),h(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(h(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function zI(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["request","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let d=xi(s);Array.isArray(d)&&(d=d.map(p=>Sw(p))),g(n,["request","contents"],d)}const o=h(t,["metadata"]);o!=null&&g(n,["metadata"],o);const u=h(t,["config"]);return u!=null&&g(n,["request","generationConfig"],RI(e,u,h(n,["request"],{}))),n}function LI(e){const t={},n=h(e,["response"]);n!=null&&g(t,["response"],NI(n));const a=h(e,["error"]);return a!=null&&g(t,["error"],a),t}function UI(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);if(t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),h(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function PI(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);t!==void 0&&s!=null&&g(t,["_query","pageToken"],s);const o=h(e,["filter"]);return t!==void 0&&o!=null&&g(t,["_query","filter"],o),n}function BI(e){const t={},n=h(e,["config"]);return n!=null&&UI(n,t),t}function GI(e){const t={},n=h(e,["config"]);return n!=null&&PI(n,t),t}function VI(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["operations"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>Rc(u))),g(t,["batchJobs"],o)}return t}function qI(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["batchPredictionJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>Sh(u))),g(t,["batchJobs"],o)}return t}function HI(e){const t={},n=h(e,["mediaResolution"]);n!=null&&g(t,["mediaResolution"],n);const a=h(e,["codeExecutionResult"]);a!=null&&g(t,["codeExecutionResult"],a);const s=h(e,["executableCode"]);s!=null&&g(t,["executableCode"],s);const o=h(e,["fileData"]);o!=null&&g(t,["fileData"],CI(o));const u=h(e,["functionCall"]);u!=null&&g(t,["functionCall"],AI(u));const d=h(e,["functionResponse"]);d!=null&&g(t,["functionResponse"],d);const p=h(e,["inlineData"]);p!=null&&g(t,["inlineData"],uI(p));const f=h(e,["text"]);f!=null&&g(t,["text"],f);const m=h(e,["thought"]);m!=null&&g(t,["thought"],m);const _=h(e,["thoughtSignature"]);_!=null&&g(t,["thoughtSignature"],_);const b=h(e,["videoMetadata"]);return b!=null&&g(t,["videoMetadata"],b),t}function FI(e){const t={},n=h(e,["category"]);if(n!=null&&g(t,["category"],n),h(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const a=h(e,["threshold"]);return a!=null&&g(t,["threshold"],a),t}function YI(e){const t={},n=h(e,["retrievalConfig"]);n!=null&&g(t,["retrievalConfig"],n);const a=h(e,["functionCallingConfig"]);return a!=null&&g(t,["functionCallingConfig"],II(a)),t}function WI(e){const t={};if(h(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=h(e,["computerUse"]);n!=null&&g(t,["computerUse"],n);const a=h(e,["fileSearch"]);a!=null&&g(t,["fileSearch"],a);const s=h(e,["codeExecution"]);if(s!=null&&g(t,["codeExecution"],s),h(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=h(e,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(_=>_)),g(t,["functionDeclarations"],m)}const u=h(e,["googleMaps"]);u!=null&&g(t,["googleMaps"],OI(u));const d=h(e,["googleSearch"]);d!=null&&g(t,["googleSearch"],DI(d));const p=h(e,["googleSearchRetrieval"]);p!=null&&g(t,["googleSearchRetrieval"],p);const f=h(e,["urlContext"]);return f!=null&&g(t,["urlContext"],f),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var $a;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})($a||($a={}));class uo{constructor(t,n,a,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(t,a,s)}init(t,n,a){var s,o;this.nameInternal=t,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let u={config:{}};!a||Object.keys(a).length===0?u={config:{}}:typeof a=="object"?u=Object.assign({},a):u=a,u.config&&(u.config.pageToken=n.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(o=(s=u.config)===null||s===void 0?void 0:s.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KI extends Ma{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new uo($a.PAGED_ITEM_BATCH_JOBS,a=>this.listInternal(a),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(t){const n=i_(this.apiClient,t),a=n._url,s=xe("{model}:batchGenerateContent",a),d=n.batch.inputConfig.requests,p=d.requests,f=[];for(const m of p){const _=Object.assign({},m);if(_.systemInstruction){const b=_.systemInstruction;delete _.systemInstruction;const E=_.request;E.systemInstruction=b,_.request=E}f.push(_)}return d.requests=f,delete n.config,delete n._url,delete n._query,{path:s,body:n}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,n){const a=n?Object.assign({},n):{},s=Date.now().toString();if(a.displayName||(a.displayName=`genaiBatchJob_${s}`),a.dest===void 0){const o=this.getGcsUri(t),u=this.getBigqueryUri(t);if(o)o.endsWith(".jsonl")?a.dest=`${o.slice(0,-6)}/dest`:a.dest=`${o}_dest_${s}`;else if(u)a.dest=`${u}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return a}async createInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=gI(this.apiClient,t);return d=xe("batchPredictionJobs",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>Sh(m))}else{const f=i_(this.apiClient,t);return d=xe("{model}:batchGenerateContent",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>Rc(m))}}async createEmbeddingsInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=vI(this.apiClient,t);return o=xe("{model}:asyncBatchEmbedContent",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>Rc(p))}}async get(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=MI(this.apiClient,t);return d=xe("batchPredictionJobs/{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>Sh(m))}else{const f=$I(this.apiClient,t);return d=xe("batches/{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>Rc(m))}}async cancel(t){var n,a,s,o;let u="",d={};if(this.apiClient.isVertexAI()){const p=dI(this.apiClient,t);u=xe("batchPredictionJobs/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}else{const p=cI(this.apiClient,t);u=xe("batches/{name}:cancel",p._url),d=p._query,delete p._url,delete p._query,await this.apiClient.request({path:u,queryParams:d,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=GI(t);return d=xe("batchPredictionJobs",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=qI(m),b=new jv;return Object.assign(b,_),b})}else{const f=BI(t);return d=xe("batches",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=VI(m),b=new jv;return Object.assign(b,_),b})}}async delete(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=bI(this.apiClient,t);return d=xe("batchPredictionJobs/{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>wI(m))}else{const f=_I(this.apiClient,t);return d=xe("batches/{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>TI(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function JI(e){const t={},n=h(e,["data"]);if(n!=null&&g(t,["data"],n),h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function a_(e){const t={},n=h(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>vR(o))),g(t,["parts"],s)}const a=h(e,["role"]);return a!=null&&g(t,["role"],a),t}function XI(e,t){const n={},a=h(e,["ttl"]);t!==void 0&&a!=null&&g(t,["ttl"],a);const s=h(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);const o=h(e,["displayName"]);t!==void 0&&o!=null&&g(t,["displayName"],o);const u=h(e,["contents"]);if(t!==void 0&&u!=null){let m=xi(u);Array.isArray(m)&&(m=m.map(_=>a_(_))),g(t,["contents"],m)}const d=h(e,["systemInstruction"]);t!==void 0&&d!=null&&g(t,["systemInstruction"],a_(Ln(d)));const p=h(e,["tools"]);if(t!==void 0&&p!=null){let m=p;Array.isArray(m)&&(m=m.map(_=>bR(_))),g(t,["tools"],m)}const f=h(e,["toolConfig"]);if(t!==void 0&&f!=null&&g(t,["toolConfig"],_R(f)),h(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function ZI(e,t){const n={},a=h(e,["ttl"]);t!==void 0&&a!=null&&g(t,["ttl"],a);const s=h(e,["expireTime"]);t!==void 0&&s!=null&&g(t,["expireTime"],s);const o=h(e,["displayName"]);t!==void 0&&o!=null&&g(t,["displayName"],o);const u=h(e,["contents"]);if(t!==void 0&&u!=null){let _=xi(u);Array.isArray(_)&&(_=_.map(b=>b)),g(t,["contents"],_)}const d=h(e,["systemInstruction"]);t!==void 0&&d!=null&&g(t,["systemInstruction"],Ln(d));const p=h(e,["tools"]);if(t!==void 0&&p!=null){let _=p;Array.isArray(_)&&(_=_.map(b=>TR(b))),g(t,["tools"],_)}const f=h(e,["toolConfig"]);t!==void 0&&f!=null&&g(t,["toolConfig"],f);const m=h(e,["kmsKeyName"]);return t!==void 0&&m!=null&&g(t,["encryption_spec","kmsKeyName"],m),n}function QI(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["model"],fw(e,a));const s=h(t,["config"]);return s!=null&&XI(s,n),n}function jI(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["model"],fw(e,a));const s=h(t,["config"]);return s!=null&&ZI(s,n),n}function eR(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],Oa(e,a)),n}function tR(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],Oa(e,a)),n}function nR(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function iR(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function aR(e){const t={};if(h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=h(e,["fileUri"]);n!=null&&g(t,["fileUri"],n);const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function rR(e){const t={},n=h(e,["id"]);n!=null&&g(t,["id"],n);const a=h(e,["args"]);a!=null&&g(t,["args"],a);const s=h(e,["name"]);if(s!=null&&g(t,["name"],s),h(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function oR(e){const t={},n=h(e,["allowedFunctionNames"]);n!=null&&g(t,["allowedFunctionNames"],n);const a=h(e,["mode"]);if(a!=null&&g(t,["mode"],a),h(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function sR(e){const t={},n=h(e,["description"]);n!=null&&g(t,["description"],n);const a=h(e,["name"]);a!=null&&g(t,["name"],a);const s=h(e,["parameters"]);s!=null&&g(t,["parameters"],s);const o=h(e,["parametersJsonSchema"]);o!=null&&g(t,["parametersJsonSchema"],o);const u=h(e,["response"]);u!=null&&g(t,["response"],u);const d=h(e,["responseJsonSchema"]);if(d!=null&&g(t,["responseJsonSchema"],d),h(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function lR(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],Oa(e,a)),n}function uR(e,t){const n={},a=h(t,["name"]);return a!=null&&g(n,["_url","name"],Oa(e,a)),n}function cR(e){const t={};if(h(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=h(e,["enableWidget"]);return n!=null&&g(t,["enableWidget"],n),t}function dR(e){const t={};if(h(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=h(e,["timeRangeFilter"]);return n!=null&&g(t,["timeRangeFilter"],n),t}function fR(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);return t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),n}function pR(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);return t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),n}function hR(e){const t={},n=h(e,["config"]);return n!=null&&fR(n,t),t}function mR(e){const t={},n=h(e,["config"]);return n!=null&&pR(n,t),t}function gR(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["cachedContents"],o)}return t}function yR(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["cachedContents"],o)}return t}function vR(e){const t={},n=h(e,["mediaResolution"]);n!=null&&g(t,["mediaResolution"],n);const a=h(e,["codeExecutionResult"]);a!=null&&g(t,["codeExecutionResult"],a);const s=h(e,["executableCode"]);s!=null&&g(t,["executableCode"],s);const o=h(e,["fileData"]);o!=null&&g(t,["fileData"],aR(o));const u=h(e,["functionCall"]);u!=null&&g(t,["functionCall"],rR(u));const d=h(e,["functionResponse"]);d!=null&&g(t,["functionResponse"],d);const p=h(e,["inlineData"]);p!=null&&g(t,["inlineData"],JI(p));const f=h(e,["text"]);f!=null&&g(t,["text"],f);const m=h(e,["thought"]);m!=null&&g(t,["thought"],m);const _=h(e,["thoughtSignature"]);_!=null&&g(t,["thoughtSignature"],_);const b=h(e,["videoMetadata"]);return b!=null&&g(t,["videoMetadata"],b),t}function _R(e){const t={},n=h(e,["retrievalConfig"]);n!=null&&g(t,["retrievalConfig"],n);const a=h(e,["functionCallingConfig"]);return a!=null&&g(t,["functionCallingConfig"],oR(a)),t}function bR(e){const t={};if(h(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=h(e,["computerUse"]);n!=null&&g(t,["computerUse"],n);const a=h(e,["fileSearch"]);a!=null&&g(t,["fileSearch"],a);const s=h(e,["codeExecution"]);if(s!=null&&g(t,["codeExecution"],s),h(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=h(e,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(_=>_)),g(t,["functionDeclarations"],m)}const u=h(e,["googleMaps"]);u!=null&&g(t,["googleMaps"],cR(u));const d=h(e,["googleSearch"]);d!=null&&g(t,["googleSearch"],dR(d));const p=h(e,["googleSearchRetrieval"]);p!=null&&g(t,["googleSearchRetrieval"],p);const f=h(e,["urlContext"]);return f!=null&&g(t,["urlContext"],f),t}function TR(e){const t={},n=h(e,["retrieval"]);n!=null&&g(t,["retrieval"],n);const a=h(e,["computerUse"]);if(a!=null&&g(t,["computerUse"],a),h(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=h(e,["codeExecution"]);s!=null&&g(t,["codeExecution"],s);const o=h(e,["enterpriseWebSearch"]);o!=null&&g(t,["enterpriseWebSearch"],o);const u=h(e,["functionDeclarations"]);if(u!=null){let _=u;Array.isArray(_)&&(_=_.map(b=>sR(b))),g(t,["functionDeclarations"],_)}const d=h(e,["googleMaps"]);d!=null&&g(t,["googleMaps"],d);const p=h(e,["googleSearch"]);p!=null&&g(t,["googleSearch"],p);const f=h(e,["googleSearchRetrieval"]);f!=null&&g(t,["googleSearchRetrieval"],f);const m=h(e,["urlContext"]);return m!=null&&g(t,["urlContext"],m),t}function wR(e,t){const n={},a=h(e,["ttl"]);t!==void 0&&a!=null&&g(t,["ttl"],a);const s=h(e,["expireTime"]);return t!==void 0&&s!=null&&g(t,["expireTime"],s),n}function ER(e,t){const n={},a=h(e,["ttl"]);t!==void 0&&a!=null&&g(t,["ttl"],a);const s=h(e,["expireTime"]);return t!==void 0&&s!=null&&g(t,["expireTime"],s),n}function SR(e,t){const n={},a=h(t,["name"]);a!=null&&g(n,["_url","name"],Oa(e,a));const s=h(t,["config"]);return s!=null&&wR(s,n),n}function xR(e,t){const n={},a=h(t,["name"]);a!=null&&g(n,["_url","name"],Oa(e,a));const s=h(t,["config"]);return s!=null&&ER(s,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CR extends Ma{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new uo($a.PAGED_ITEM_CACHED_CONTENTS,a=>this.listInternal(a),await this.listInternal(n),n)}async create(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=jI(this.apiClient,t);return d=xe("cachedContents",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>m)}else{const f=QI(this.apiClient,t);return d=xe("cachedContents",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>m)}}async get(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=uR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>m)}else{const f=lR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>m)}}async delete(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=tR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=iR(m),b=new Zv;return Object.assign(b,_),b})}else{const f=eR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=nR(m),b=new Zv;return Object.assign(b,_),b})}}async update(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=xR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>m)}else{const f=SR(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>m)}}async listInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=mR(t);return d=xe("cachedContents",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=yR(m),b=new Qv;return Object.assign(b,_),b})}else{const f=hR(t);return d=xe("cachedContents",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=gR(m),b=new Qv;return Object.assign(b,_),b})}}}function zc(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]]);return n}function r_(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ze(e){return this instanceof Ze?(this.v=e,this):new Ze(e)}function Yi(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=n.apply(e,t||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",u),s[Symbol.asyncIterator]=function(){return this},s;function u(E){return function(x){return Promise.resolve(x).then(E,_)}}function d(E,x){a[E]&&(s[E]=function(I){return new Promise(function(N,R){o.push([E,I,N,R])>1||p(E,I)})},x&&(s[E]=x(s[E])))}function p(E,x){try{f(a[E](x))}catch(I){b(o[0][3],I)}}function f(E){E.value instanceof Ze?Promise.resolve(E.value.v).then(m,_):b(o[0][2],E)}function m(E){p("next",E)}function _(E){p("throw",E)}function b(E,x){E(x),o.shift(),o.length&&p(o[0][0],o[0][1])}}function Wi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof r_=="function"?r_(e):e[Symbol.iterator](),n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n);function a(o){n[o]=e[o]&&function(u){return new Promise(function(d,p){u=e[o](u),s(d,p,u.done,u.value)})}}function s(o,u,d,p){Promise.resolve(p).then(function(f){o({value:f,done:d})},u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AR(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return n===void 0?!1:xw(n)}function xw(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function IR(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function o_(e){if(e===void 0||e.length===0)return[];const t=[],n=e.length;let a=0;for(;a<n;)if(e[a].role==="user")t.push(e[a]),a++;else{const s=[];let o=!0;for(;a<n&&e[a].role==="model";)s.push(e[a]),o&&!xw(e[a])&&(o=!1),a++;o?t.push(...s):t.pop()}return t}class RR{constructor(t,n){this.modelsModule=t,this.apiClient=n}create(t){return new NR(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class NR{constructor(t,n,a,s={},o=[]){this.apiClient=t,this.modelsModule=n,this.model=a,this.config=s,this.history=o,this.sendPromise=Promise.resolve(),IR(o)}async sendMessage(t){var n;await this.sendPromise;const a=Ln(t.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(a),config:(n=t.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,u,d;const p=await s,f=(u=(o=p.candidates)===null||o===void 0?void 0:o[0])===null||u===void 0?void 0:u.content,m=p.automaticFunctionCallingHistory,_=this.getHistory(!0).length;let b=[];m!=null&&(b=(d=m.slice(_))!==null&&d!==void 0?d:[]);const E=f?[f]:[];this.recordHistory(a,E,b)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(t){var n;await this.sendPromise;const a=Ln(t.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(a),config:(n=t.config)!==null&&n!==void 0?n:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const o=await s;return this.processStreamResponse(o,a)}getHistory(t=!1){const n=t?o_(this.history):this.history;return structuredClone(n)}processStreamResponse(t,n){return Yi(this,arguments,function*(){var s,o,u,d,p,f;const m=[];try{for(var _=!0,b=Wi(t),E;E=yield Ze(b.next()),s=E.done,!s;_=!0){d=E.value,_=!1;const x=d;if(AR(x)){const I=(f=(p=x.candidates)===null||p===void 0?void 0:p[0])===null||f===void 0?void 0:f.content;I!==void 0&&m.push(I)}yield yield Ze(x)}}catch(x){o={error:x}}finally{try{!_&&!s&&(u=b.return)&&(yield Ze(u.call(b)))}finally{if(o)throw o.error}}this.recordHistory(n,m)})}recordHistory(t,n,a){let s=[];n.length>0&&n.every(o=>o.role!==void 0)?s=n:s.push({role:"model",parts:[]}),a&&a.length>0?this.history.push(...o_(a)):this.history.push(t),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xc extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Xc.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $R(e){const t={},n=h(e,["file"]);return n!=null&&g(t,["file"],n),t}function MR(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function OR(e){const t={},n=h(e,["name"]);return n!=null&&g(t,["_url","file"],vw(n)),t}function DR(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function kR(e){const t={},n=h(e,["name"]);return n!=null&&g(t,["_url","file"],vw(n)),t}function zR(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);return t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),n}function LR(e){const t={},n=h(e,["config"]);return n!=null&&zR(n,t),t}function UR(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["files"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["files"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PR extends Ma{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new uo($a.PAGED_ITEM_FILES,a=>this.listInternal(a),await this.listInternal(n),n)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(n=>n)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=LR(t);return o=xe("files",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>{const f=UR(p),m=new qA;return Object.assign(m,f),m})}}async createInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=$R(t);return o=xe("upload/v1beta/files",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=MR(p),m=new HA;return Object.assign(m,f),m})}}async get(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=kR(t);return o=xe("files/{file}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>p)}}async delete(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=OR(t);return o=xe("files/{file}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>{const f=DR(p),m=new FA;return Object.assign(m,f),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nc(e){const t={},n=h(e,["data"]);if(n!=null&&g(t,["data"],n),h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function BR(e){const t={},n=h(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>nN(o))),g(t,["parts"],s)}const a=h(e,["role"]);return a!=null&&g(t,["role"],a),t}function GR(e){const t={};if(h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=h(e,["fileUri"]);n!=null&&g(t,["fileUri"],n);const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function VR(e){const t={},n=h(e,["id"]);n!=null&&g(t,["id"],n);const a=h(e,["args"]);a!=null&&g(t,["args"],a);const s=h(e,["name"]);if(s!=null&&g(t,["name"],s),h(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function qR(e){const t={},n=h(e,["description"]);n!=null&&g(t,["description"],n);const a=h(e,["name"]);a!=null&&g(t,["name"],a);const s=h(e,["parameters"]);s!=null&&g(t,["parameters"],s);const o=h(e,["parametersJsonSchema"]);o!=null&&g(t,["parametersJsonSchema"],o);const u=h(e,["response"]);u!=null&&g(t,["response"],u);const d=h(e,["responseJsonSchema"]);if(d!=null&&g(t,["responseJsonSchema"],d),h(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function HR(e){const t={},n=h(e,["modelSelectionConfig"]);n!=null&&g(t,["modelConfig"],n);const a=h(e,["responseJsonSchema"]);a!=null&&g(t,["responseJsonSchema"],a);const s=h(e,["audioTimestamp"]);s!=null&&g(t,["audioTimestamp"],s);const o=h(e,["candidateCount"]);o!=null&&g(t,["candidateCount"],o);const u=h(e,["enableAffectiveDialog"]);u!=null&&g(t,["enableAffectiveDialog"],u);const d=h(e,["frequencyPenalty"]);d!=null&&g(t,["frequencyPenalty"],d);const p=h(e,["logprobs"]);p!=null&&g(t,["logprobs"],p);const f=h(e,["maxOutputTokens"]);f!=null&&g(t,["maxOutputTokens"],f);const m=h(e,["mediaResolution"]);m!=null&&g(t,["mediaResolution"],m);const _=h(e,["presencePenalty"]);_!=null&&g(t,["presencePenalty"],_);const b=h(e,["responseLogprobs"]);b!=null&&g(t,["responseLogprobs"],b);const E=h(e,["responseMimeType"]);E!=null&&g(t,["responseMimeType"],E);const x=h(e,["responseModalities"]);x!=null&&g(t,["responseModalities"],x);const I=h(e,["responseSchema"]);I!=null&&g(t,["responseSchema"],I);const N=h(e,["routingConfig"]);N!=null&&g(t,["routingConfig"],N);const R=h(e,["seed"]);R!=null&&g(t,["seed"],R);const $=h(e,["speechConfig"]);$!=null&&g(t,["speechConfig"],$);const O=h(e,["stopSequences"]);O!=null&&g(t,["stopSequences"],O);const k=h(e,["temperature"]);k!=null&&g(t,["temperature"],k);const P=h(e,["thinkingConfig"]);P!=null&&g(t,["thinkingConfig"],P);const G=h(e,["topK"]);G!=null&&g(t,["topK"],G);const B=h(e,["topP"]);if(B!=null&&g(t,["topP"],B),h(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function FR(e){const t={};if(h(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=h(e,["enableWidget"]);return n!=null&&g(t,["enableWidget"],n),t}function YR(e){const t={};if(h(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=h(e,["timeRangeFilter"]);return n!=null&&g(t,["timeRangeFilter"],n),t}function WR(e,t){const n={},a=h(e,["generationConfig"]);t!==void 0&&a!=null&&g(t,["setup","generationConfig"],a);const s=h(e,["responseModalities"]);t!==void 0&&s!=null&&g(t,["setup","generationConfig","responseModalities"],s);const o=h(e,["temperature"]);t!==void 0&&o!=null&&g(t,["setup","generationConfig","temperature"],o);const u=h(e,["topP"]);t!==void 0&&u!=null&&g(t,["setup","generationConfig","topP"],u);const d=h(e,["topK"]);t!==void 0&&d!=null&&g(t,["setup","generationConfig","topK"],d);const p=h(e,["maxOutputTokens"]);t!==void 0&&p!=null&&g(t,["setup","generationConfig","maxOutputTokens"],p);const f=h(e,["mediaResolution"]);t!==void 0&&f!=null&&g(t,["setup","generationConfig","mediaResolution"],f);const m=h(e,["seed"]);t!==void 0&&m!=null&&g(t,["setup","generationConfig","seed"],m);const _=h(e,["speechConfig"]);t!==void 0&&_!=null&&g(t,["setup","generationConfig","speechConfig"],im(_));const b=h(e,["thinkingConfig"]);t!==void 0&&b!=null&&g(t,["setup","generationConfig","thinkingConfig"],b);const E=h(e,["enableAffectiveDialog"]);t!==void 0&&E!=null&&g(t,["setup","generationConfig","enableAffectiveDialog"],E);const x=h(e,["systemInstruction"]);t!==void 0&&x!=null&&g(t,["setup","systemInstruction"],BR(Ln(x)));const I=h(e,["tools"]);if(t!==void 0&&I!=null){let G=cs(I);Array.isArray(G)&&(G=G.map(B=>aN(us(B)))),g(t,["setup","tools"],G)}const N=h(e,["sessionResumption"]);t!==void 0&&N!=null&&g(t,["setup","sessionResumption"],iN(N));const R=h(e,["inputAudioTranscription"]);t!==void 0&&R!=null&&g(t,["setup","inputAudioTranscription"],R);const $=h(e,["outputAudioTranscription"]);t!==void 0&&$!=null&&g(t,["setup","outputAudioTranscription"],$);const O=h(e,["realtimeInputConfig"]);t!==void 0&&O!=null&&g(t,["setup","realtimeInputConfig"],O);const k=h(e,["contextWindowCompression"]);t!==void 0&&k!=null&&g(t,["setup","contextWindowCompression"],k);const P=h(e,["proactivity"]);if(t!==void 0&&P!=null&&g(t,["setup","proactivity"],P),h(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function KR(e,t){const n={},a=h(e,["generationConfig"]);t!==void 0&&a!=null&&g(t,["setup","generationConfig"],HR(a));const s=h(e,["responseModalities"]);t!==void 0&&s!=null&&g(t,["setup","generationConfig","responseModalities"],s);const o=h(e,["temperature"]);t!==void 0&&o!=null&&g(t,["setup","generationConfig","temperature"],o);const u=h(e,["topP"]);t!==void 0&&u!=null&&g(t,["setup","generationConfig","topP"],u);const d=h(e,["topK"]);t!==void 0&&d!=null&&g(t,["setup","generationConfig","topK"],d);const p=h(e,["maxOutputTokens"]);t!==void 0&&p!=null&&g(t,["setup","generationConfig","maxOutputTokens"],p);const f=h(e,["mediaResolution"]);t!==void 0&&f!=null&&g(t,["setup","generationConfig","mediaResolution"],f);const m=h(e,["seed"]);t!==void 0&&m!=null&&g(t,["setup","generationConfig","seed"],m);const _=h(e,["speechConfig"]);t!==void 0&&_!=null&&g(t,["setup","generationConfig","speechConfig"],im(_));const b=h(e,["thinkingConfig"]);t!==void 0&&b!=null&&g(t,["setup","generationConfig","thinkingConfig"],b);const E=h(e,["enableAffectiveDialog"]);t!==void 0&&E!=null&&g(t,["setup","generationConfig","enableAffectiveDialog"],E);const x=h(e,["systemInstruction"]);t!==void 0&&x!=null&&g(t,["setup","systemInstruction"],Ln(x));const I=h(e,["tools"]);if(t!==void 0&&I!=null){let B=cs(I);Array.isArray(B)&&(B=B.map(K=>rN(us(K)))),g(t,["setup","tools"],B)}const N=h(e,["sessionResumption"]);t!==void 0&&N!=null&&g(t,["setup","sessionResumption"],N);const R=h(e,["inputAudioTranscription"]);t!==void 0&&R!=null&&g(t,["setup","inputAudioTranscription"],R);const $=h(e,["outputAudioTranscription"]);t!==void 0&&$!=null&&g(t,["setup","outputAudioTranscription"],$);const O=h(e,["realtimeInputConfig"]);t!==void 0&&O!=null&&g(t,["setup","realtimeInputConfig"],O);const k=h(e,["contextWindowCompression"]);t!==void 0&&k!=null&&g(t,["setup","contextWindowCompression"],k);const P=h(e,["proactivity"]);t!==void 0&&P!=null&&g(t,["setup","proactivity"],P);const G=h(e,["explicitVadSignal"]);return t!==void 0&&G!=null&&g(t,["setup","explicitVadSignal"],G),n}function JR(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["setup","model"],gt(e,a));const s=h(t,["config"]);return s!=null&&g(n,["config"],WR(s,n)),n}function XR(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["setup","model"],gt(e,a));const s=h(t,["config"]);return s!=null&&g(n,["config"],KR(s,n)),n}function ZR(e){const t={},n=h(e,["musicGenerationConfig"]);return n!=null&&g(t,["musicGenerationConfig"],n),t}function QR(e){const t={},n=h(e,["weightedPrompts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(s=>s)),g(t,["weightedPrompts"],a)}return t}function jR(e){const t={},n=h(e,["media"]);if(n!=null){let f=pw(n);Array.isArray(f)&&(f=f.map(m=>Nc(m))),g(t,["mediaChunks"],f)}const a=h(e,["audio"]);a!=null&&g(t,["audio"],Nc(mw(a)));const s=h(e,["audioStreamEnd"]);s!=null&&g(t,["audioStreamEnd"],s);const o=h(e,["video"]);o!=null&&g(t,["video"],Nc(hw(o)));const u=h(e,["text"]);u!=null&&g(t,["text"],u);const d=h(e,["activityStart"]);d!=null&&g(t,["activityStart"],d);const p=h(e,["activityEnd"]);return p!=null&&g(t,["activityEnd"],p),t}function eN(e){const t={},n=h(e,["media"]);if(n!=null){let f=pw(n);Array.isArray(f)&&(f=f.map(m=>m)),g(t,["mediaChunks"],f)}const a=h(e,["audio"]);a!=null&&g(t,["audio"],mw(a));const s=h(e,["audioStreamEnd"]);s!=null&&g(t,["audioStreamEnd"],s);const o=h(e,["video"]);o!=null&&g(t,["video"],hw(o));const u=h(e,["text"]);u!=null&&g(t,["text"],u);const d=h(e,["activityStart"]);d!=null&&g(t,["activityStart"],d);const p=h(e,["activityEnd"]);return p!=null&&g(t,["activityEnd"],p),t}function tN(e){const t={},n=h(e,["setupComplete"]);n!=null&&g(t,["setupComplete"],n);const a=h(e,["serverContent"]);a!=null&&g(t,["serverContent"],a);const s=h(e,["toolCall"]);s!=null&&g(t,["toolCall"],s);const o=h(e,["toolCallCancellation"]);o!=null&&g(t,["toolCallCancellation"],o);const u=h(e,["usageMetadata"]);u!=null&&g(t,["usageMetadata"],oN(u));const d=h(e,["goAway"]);d!=null&&g(t,["goAway"],d);const p=h(e,["sessionResumptionUpdate"]);p!=null&&g(t,["sessionResumptionUpdate"],p);const f=h(e,["voiceActivityDetectionSignal"]);return f!=null&&g(t,["voiceActivityDetectionSignal"],f),t}function nN(e){const t={},n=h(e,["mediaResolution"]);n!=null&&g(t,["mediaResolution"],n);const a=h(e,["codeExecutionResult"]);a!=null&&g(t,["codeExecutionResult"],a);const s=h(e,["executableCode"]);s!=null&&g(t,["executableCode"],s);const o=h(e,["fileData"]);o!=null&&g(t,["fileData"],GR(o));const u=h(e,["functionCall"]);u!=null&&g(t,["functionCall"],VR(u));const d=h(e,["functionResponse"]);d!=null&&g(t,["functionResponse"],d);const p=h(e,["inlineData"]);p!=null&&g(t,["inlineData"],Nc(p));const f=h(e,["text"]);f!=null&&g(t,["text"],f);const m=h(e,["thought"]);m!=null&&g(t,["thought"],m);const _=h(e,["thoughtSignature"]);_!=null&&g(t,["thoughtSignature"],_);const b=h(e,["videoMetadata"]);return b!=null&&g(t,["videoMetadata"],b),t}function iN(e){const t={},n=h(e,["handle"]);if(n!=null&&g(t,["handle"],n),h(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function aN(e){const t={};if(h(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=h(e,["computerUse"]);n!=null&&g(t,["computerUse"],n);const a=h(e,["fileSearch"]);a!=null&&g(t,["fileSearch"],a);const s=h(e,["codeExecution"]);if(s!=null&&g(t,["codeExecution"],s),h(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=h(e,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(_=>_)),g(t,["functionDeclarations"],m)}const u=h(e,["googleMaps"]);u!=null&&g(t,["googleMaps"],FR(u));const d=h(e,["googleSearch"]);d!=null&&g(t,["googleSearch"],YR(d));const p=h(e,["googleSearchRetrieval"]);p!=null&&g(t,["googleSearchRetrieval"],p);const f=h(e,["urlContext"]);return f!=null&&g(t,["urlContext"],f),t}function rN(e){const t={},n=h(e,["retrieval"]);n!=null&&g(t,["retrieval"],n);const a=h(e,["computerUse"]);if(a!=null&&g(t,["computerUse"],a),h(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=h(e,["codeExecution"]);s!=null&&g(t,["codeExecution"],s);const o=h(e,["enterpriseWebSearch"]);o!=null&&g(t,["enterpriseWebSearch"],o);const u=h(e,["functionDeclarations"]);if(u!=null){let _=u;Array.isArray(_)&&(_=_.map(b=>qR(b))),g(t,["functionDeclarations"],_)}const d=h(e,["googleMaps"]);d!=null&&g(t,["googleMaps"],d);const p=h(e,["googleSearch"]);p!=null&&g(t,["googleSearch"],p);const f=h(e,["googleSearchRetrieval"]);f!=null&&g(t,["googleSearchRetrieval"],f);const m=h(e,["urlContext"]);return m!=null&&g(t,["urlContext"],m),t}function oN(e){const t={},n=h(e,["promptTokenCount"]);n!=null&&g(t,["promptTokenCount"],n);const a=h(e,["cachedContentTokenCount"]);a!=null&&g(t,["cachedContentTokenCount"],a);const s=h(e,["candidatesTokenCount"]);s!=null&&g(t,["responseTokenCount"],s);const o=h(e,["toolUsePromptTokenCount"]);o!=null&&g(t,["toolUsePromptTokenCount"],o);const u=h(e,["thoughtsTokenCount"]);u!=null&&g(t,["thoughtsTokenCount"],u);const d=h(e,["totalTokenCount"]);d!=null&&g(t,["totalTokenCount"],d);const p=h(e,["promptTokensDetails"]);if(p!=null){let E=p;Array.isArray(E)&&(E=E.map(x=>x)),g(t,["promptTokensDetails"],E)}const f=h(e,["cacheTokensDetails"]);if(f!=null){let E=f;Array.isArray(E)&&(E=E.map(x=>x)),g(t,["cacheTokensDetails"],E)}const m=h(e,["candidatesTokensDetails"]);if(m!=null){let E=m;Array.isArray(E)&&(E=E.map(x=>x)),g(t,["responseTokensDetails"],E)}const _=h(e,["toolUsePromptTokensDetails"]);if(_!=null){let E=_;Array.isArray(E)&&(E=E.map(x=>x)),g(t,["toolUsePromptTokensDetails"],E)}const b=h(e,["trafficType"]);return b!=null&&g(t,["trafficType"],b),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sN(e){const t={},n=h(e,["data"]);if(n!=null&&g(t,["data"],n),h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function lN(e){const t={},n=h(e,["content"]);n!=null&&g(t,["content"],n);const a=h(e,["citationMetadata"]);a!=null&&g(t,["citationMetadata"],uN(a));const s=h(e,["tokenCount"]);s!=null&&g(t,["tokenCount"],s);const o=h(e,["finishReason"]);o!=null&&g(t,["finishReason"],o);const u=h(e,["avgLogprobs"]);u!=null&&g(t,["avgLogprobs"],u);const d=h(e,["groundingMetadata"]);d!=null&&g(t,["groundingMetadata"],d);const p=h(e,["index"]);p!=null&&g(t,["index"],p);const f=h(e,["logprobsResult"]);f!=null&&g(t,["logprobsResult"],f);const m=h(e,["safetyRatings"]);if(m!=null){let b=m;Array.isArray(b)&&(b=b.map(E=>E)),g(t,["safetyRatings"],b)}const _=h(e,["urlContextMetadata"]);return _!=null&&g(t,["urlContextMetadata"],_),t}function uN(e){const t={},n=h(e,["citationSources"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(s=>s)),g(t,["citations"],a)}return t}function cN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let o=xi(s);Array.isArray(o)&&(o=o.map(u=>u)),g(n,["contents"],o)}return n}function dN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["tokensInfo"]);if(a!=null){let s=a;Array.isArray(s)&&(s=s.map(o=>o)),g(t,["tokensInfo"],s)}return t}function fN(e){const t={},n=h(e,["values"]);n!=null&&g(t,["values"],n);const a=h(e,["statistics"]);return a!=null&&g(t,["statistics"],pN(a)),t}function pN(e){const t={},n=h(e,["truncated"]);n!=null&&g(t,["truncated"],n);const a=h(e,["token_count"]);return a!=null&&g(t,["tokenCount"],a),t}function Zc(e){const t={},n=h(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>w$(o))),g(t,["parts"],s)}const a=h(e,["role"]);return a!=null&&g(t,["role"],a),t}function hN(e){const t={},n=h(e,["controlType"]);n!=null&&g(t,["controlType"],n);const a=h(e,["enableControlImageComputation"]);return a!=null&&g(t,["computeControl"],a),t}function mN(e){const t={};if(h(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(h(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(h(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function gN(e,t){const n={},a=h(e,["systemInstruction"]);t!==void 0&&a!=null&&g(t,["systemInstruction"],Ln(a));const s=h(e,["tools"]);if(t!==void 0&&s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>Rw(d))),g(t,["tools"],u)}const o=h(e,["generationConfig"]);return t!==void 0&&o!=null&&g(t,["generationConfig"],s$(o)),n}function yN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let u=xi(s);Array.isArray(u)&&(u=u.map(d=>Zc(d))),g(n,["contents"],u)}const o=h(t,["config"]);return o!=null&&mN(o),n}function vN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let u=xi(s);Array.isArray(u)&&(u=u.map(d=>d)),g(n,["contents"],u)}const o=h(t,["config"]);return o!=null&&gN(o,n),n}function _N(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["totalTokens"]);a!=null&&g(t,["totalTokens"],a);const s=h(e,["cachedContentTokenCount"]);return s!=null&&g(t,["cachedContentTokenCount"],s),t}function bN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["totalTokens"]);return a!=null&&g(t,["totalTokens"],a),t}function TN(e,t){const n={},a=h(t,["model"]);return a!=null&&g(n,["_url","name"],gt(e,a)),n}function wN(e,t){const n={},a=h(t,["model"]);return a!=null&&g(n,["_url","name"],gt(e,a)),n}function EN(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function SN(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}function xN(e,t){const n={},a=h(e,["outputGcsUri"]);t!==void 0&&a!=null&&g(t,["parameters","storageUri"],a);const s=h(e,["negativePrompt"]);t!==void 0&&s!=null&&g(t,["parameters","negativePrompt"],s);const o=h(e,["numberOfImages"]);t!==void 0&&o!=null&&g(t,["parameters","sampleCount"],o);const u=h(e,["aspectRatio"]);t!==void 0&&u!=null&&g(t,["parameters","aspectRatio"],u);const d=h(e,["guidanceScale"]);t!==void 0&&d!=null&&g(t,["parameters","guidanceScale"],d);const p=h(e,["seed"]);t!==void 0&&p!=null&&g(t,["parameters","seed"],p);const f=h(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&g(t,["parameters","safetySetting"],f);const m=h(e,["personGeneration"]);t!==void 0&&m!=null&&g(t,["parameters","personGeneration"],m);const _=h(e,["includeSafetyAttributes"]);t!==void 0&&_!=null&&g(t,["parameters","includeSafetyAttributes"],_);const b=h(e,["includeRaiReason"]);t!==void 0&&b!=null&&g(t,["parameters","includeRaiReason"],b);const E=h(e,["language"]);t!==void 0&&E!=null&&g(t,["parameters","language"],E);const x=h(e,["outputMimeType"]);t!==void 0&&x!=null&&g(t,["parameters","outputOptions","mimeType"],x);const I=h(e,["outputCompressionQuality"]);t!==void 0&&I!=null&&g(t,["parameters","outputOptions","compressionQuality"],I);const N=h(e,["addWatermark"]);t!==void 0&&N!=null&&g(t,["parameters","addWatermark"],N);const R=h(e,["labels"]);t!==void 0&&R!=null&&g(t,["labels"],R);const $=h(e,["editMode"]);t!==void 0&&$!=null&&g(t,["parameters","editMode"],$);const O=h(e,["baseSteps"]);return t!==void 0&&O!=null&&g(t,["parameters","editConfig","baseSteps"],O),n}function CN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["prompt"]);s!=null&&g(n,["instances[0]","prompt"],s);const o=h(t,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>I$(p))),g(n,["instances[0]","referenceImages"],d)}const u=h(t,["config"]);return u!=null&&xN(u,n),n}function AN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["predictions"]);if(a!=null){let s=a;Array.isArray(s)&&(s=s.map(o=>Qc(o))),g(t,["generatedImages"],s)}return t}function IN(e,t){const n={},a=h(e,["taskType"]);t!==void 0&&a!=null&&g(t,["requests[]","taskType"],a);const s=h(e,["title"]);t!==void 0&&s!=null&&g(t,["requests[]","title"],s);const o=h(e,["outputDimensionality"]);if(t!==void 0&&o!=null&&g(t,["requests[]","outputDimensionality"],o),h(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(h(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function RN(e,t){const n={},a=h(e,["taskType"]);t!==void 0&&a!=null&&g(t,["instances[]","task_type"],a);const s=h(e,["title"]);t!==void 0&&s!=null&&g(t,["instances[]","title"],s);const o=h(e,["outputDimensionality"]);t!==void 0&&o!=null&&g(t,["parameters","outputDimensionality"],o);const u=h(e,["mimeType"]);t!==void 0&&u!=null&&g(t,["instances[]","mimeType"],u);const d=h(e,["autoTruncate"]);return t!==void 0&&d!=null&&g(t,["parameters","autoTruncate"],d),n}function NN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let d=em(e,s);Array.isArray(d)&&(d=d.map(p=>p)),g(n,["requests[]","content"],d)}const o=h(t,["config"]);o!=null&&IN(o,n);const u=h(t,["model"]);return u!==void 0&&g(n,["requests[]","model"],gt(e,u)),n}function $N(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let u=em(e,s);Array.isArray(u)&&(u=u.map(d=>d)),g(n,["instances[]","content"],u)}const o=h(t,["config"]);return o!=null&&RN(o,n),n}function MN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["embeddings"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["embeddings"],o)}const s=h(e,["metadata"]);return s!=null&&g(t,["metadata"],s),t}function ON(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["predictions[]","embeddings"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>fN(u))),g(t,["embeddings"],o)}const s=h(e,["metadata"]);return s!=null&&g(t,["metadata"],s),t}function DN(e){const t={},n=h(e,["endpoint"]);n!=null&&g(t,["name"],n);const a=h(e,["deployedModelId"]);return a!=null&&g(t,["deployedModelId"],a),t}function kN(e){const t={};if(h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=h(e,["fileUri"]);n!=null&&g(t,["fileUri"],n);const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function zN(e){const t={},n=h(e,["id"]);n!=null&&g(t,["id"],n);const a=h(e,["args"]);a!=null&&g(t,["args"],a);const s=h(e,["name"]);if(s!=null&&g(t,["name"],s),h(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function LN(e){const t={},n=h(e,["allowedFunctionNames"]);n!=null&&g(t,["allowedFunctionNames"],n);const a=h(e,["mode"]);if(a!=null&&g(t,["mode"],a),h(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function UN(e){const t={},n=h(e,["description"]);n!=null&&g(t,["description"],n);const a=h(e,["name"]);a!=null&&g(t,["name"],a);const s=h(e,["parameters"]);s!=null&&g(t,["parameters"],s);const o=h(e,["parametersJsonSchema"]);o!=null&&g(t,["parametersJsonSchema"],o);const u=h(e,["response"]);u!=null&&g(t,["response"],u);const d=h(e,["responseJsonSchema"]);if(d!=null&&g(t,["responseJsonSchema"],d),h(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function PN(e,t,n){const a={},s=h(t,["systemInstruction"]);n!==void 0&&s!=null&&g(n,["systemInstruction"],Zc(Ln(s)));const o=h(t,["temperature"]);o!=null&&g(a,["temperature"],o);const u=h(t,["topP"]);u!=null&&g(a,["topP"],u);const d=h(t,["topK"]);d!=null&&g(a,["topK"],d);const p=h(t,["candidateCount"]);p!=null&&g(a,["candidateCount"],p);const f=h(t,["maxOutputTokens"]);f!=null&&g(a,["maxOutputTokens"],f);const m=h(t,["stopSequences"]);m!=null&&g(a,["stopSequences"],m);const _=h(t,["responseLogprobs"]);_!=null&&g(a,["responseLogprobs"],_);const b=h(t,["logprobs"]);b!=null&&g(a,["logprobs"],b);const E=h(t,["presencePenalty"]);E!=null&&g(a,["presencePenalty"],E);const x=h(t,["frequencyPenalty"]);x!=null&&g(a,["frequencyPenalty"],x);const I=h(t,["seed"]);I!=null&&g(a,["seed"],I);const N=h(t,["responseMimeType"]);N!=null&&g(a,["responseMimeType"],N);const R=h(t,["responseSchema"]);R!=null&&g(a,["responseSchema"],tm(R));const $=h(t,["responseJsonSchema"]);if($!=null&&g(a,["responseJsonSchema"],$),h(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(h(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const O=h(t,["safetySettings"]);if(n!==void 0&&O!=null){let ge=O;Array.isArray(ge)&&(ge=ge.map($e=>R$($e))),g(n,["safetySettings"],ge)}const k=h(t,["tools"]);if(n!==void 0&&k!=null){let ge=cs(k);Array.isArray(ge)&&(ge=ge.map($e=>z$(us($e)))),g(n,["tools"],ge)}const P=h(t,["toolConfig"]);if(n!==void 0&&P!=null&&g(n,["toolConfig"],k$(P)),h(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const G=h(t,["cachedContent"]);n!==void 0&&G!=null&&g(n,["cachedContent"],Oa(e,G));const B=h(t,["responseModalities"]);B!=null&&g(a,["responseModalities"],B);const K=h(t,["mediaResolution"]);K!=null&&g(a,["mediaResolution"],K);const Y=h(t,["speechConfig"]);if(Y!=null&&g(a,["speechConfig"],nm(Y)),h(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const se=h(t,["thinkingConfig"]);se!=null&&g(a,["thinkingConfig"],se);const ve=h(t,["imageConfig"]);ve!=null&&g(a,["imageConfig"],f$(ve));const _e=h(t,["enableEnhancedCivicAnswers"]);return _e!=null&&g(a,["enableEnhancedCivicAnswers"],_e),a}function BN(e,t,n){const a={},s=h(t,["systemInstruction"]);n!==void 0&&s!=null&&g(n,["systemInstruction"],Ln(s));const o=h(t,["temperature"]);o!=null&&g(a,["temperature"],o);const u=h(t,["topP"]);u!=null&&g(a,["topP"],u);const d=h(t,["topK"]);d!=null&&g(a,["topK"],d);const p=h(t,["candidateCount"]);p!=null&&g(a,["candidateCount"],p);const f=h(t,["maxOutputTokens"]);f!=null&&g(a,["maxOutputTokens"],f);const m=h(t,["stopSequences"]);m!=null&&g(a,["stopSequences"],m);const _=h(t,["responseLogprobs"]);_!=null&&g(a,["responseLogprobs"],_);const b=h(t,["logprobs"]);b!=null&&g(a,["logprobs"],b);const E=h(t,["presencePenalty"]);E!=null&&g(a,["presencePenalty"],E);const x=h(t,["frequencyPenalty"]);x!=null&&g(a,["frequencyPenalty"],x);const I=h(t,["seed"]);I!=null&&g(a,["seed"],I);const N=h(t,["responseMimeType"]);N!=null&&g(a,["responseMimeType"],N);const R=h(t,["responseSchema"]);R!=null&&g(a,["responseSchema"],tm(R));const $=h(t,["responseJsonSchema"]);$!=null&&g(a,["responseJsonSchema"],$);const O=h(t,["routingConfig"]);O!=null&&g(a,["routingConfig"],O);const k=h(t,["modelSelectionConfig"]);k!=null&&g(a,["modelConfig"],k);const P=h(t,["safetySettings"]);if(n!==void 0&&P!=null){let H=P;Array.isArray(H)&&(H=H.map(j=>j)),g(n,["safetySettings"],H)}const G=h(t,["tools"]);if(n!==void 0&&G!=null){let H=cs(G);Array.isArray(H)&&(H=H.map(j=>Rw(us(j)))),g(n,["tools"],H)}const B=h(t,["toolConfig"]);n!==void 0&&B!=null&&g(n,["toolConfig"],B);const K=h(t,["labels"]);n!==void 0&&K!=null&&g(n,["labels"],K);const Y=h(t,["cachedContent"]);n!==void 0&&Y!=null&&g(n,["cachedContent"],Oa(e,Y));const se=h(t,["responseModalities"]);se!=null&&g(a,["responseModalities"],se);const ve=h(t,["mediaResolution"]);ve!=null&&g(a,["mediaResolution"],ve);const _e=h(t,["speechConfig"]);_e!=null&&g(a,["speechConfig"],nm(_e));const ge=h(t,["audioTimestamp"]);ge!=null&&g(a,["audioTimestamp"],ge);const $e=h(t,["thinkingConfig"]);$e!=null&&g(a,["thinkingConfig"],$e);const Ae=h(t,["imageConfig"]);if(Ae!=null&&g(a,["imageConfig"],p$(Ae)),h(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return a}function s_(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let u=xi(s);Array.isArray(u)&&(u=u.map(d=>Zc(d))),g(n,["contents"],u)}const o=h(t,["config"]);return o!=null&&g(n,["generationConfig"],PN(e,o,n)),n}function l_(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["contents"]);if(s!=null){let u=xi(s);Array.isArray(u)&&(u=u.map(d=>d)),g(n,["contents"],u)}const o=h(t,["config"]);return o!=null&&g(n,["generationConfig"],BN(e,o,n)),n}function u_(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["candidates"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(f=>lN(f))),g(t,["candidates"],p)}const s=h(e,["modelVersion"]);s!=null&&g(t,["modelVersion"],s);const o=h(e,["promptFeedback"]);o!=null&&g(t,["promptFeedback"],o);const u=h(e,["responseId"]);u!=null&&g(t,["responseId"],u);const d=h(e,["usageMetadata"]);return d!=null&&g(t,["usageMetadata"],d),t}function c_(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["candidates"]);if(a!=null){let f=a;Array.isArray(f)&&(f=f.map(m=>m)),g(t,["candidates"],f)}const s=h(e,["createTime"]);s!=null&&g(t,["createTime"],s);const o=h(e,["modelVersion"]);o!=null&&g(t,["modelVersion"],o);const u=h(e,["promptFeedback"]);u!=null&&g(t,["promptFeedback"],u);const d=h(e,["responseId"]);d!=null&&g(t,["responseId"],d);const p=h(e,["usageMetadata"]);return p!=null&&g(t,["usageMetadata"],p),t}function GN(e,t){const n={};if(h(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const a=h(e,["numberOfImages"]);t!==void 0&&a!=null&&g(t,["parameters","sampleCount"],a);const s=h(e,["aspectRatio"]);t!==void 0&&s!=null&&g(t,["parameters","aspectRatio"],s);const o=h(e,["guidanceScale"]);if(t!==void 0&&o!=null&&g(t,["parameters","guidanceScale"],o),h(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=h(e,["safetyFilterLevel"]);t!==void 0&&u!=null&&g(t,["parameters","safetySetting"],u);const d=h(e,["personGeneration"]);t!==void 0&&d!=null&&g(t,["parameters","personGeneration"],d);const p=h(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&g(t,["parameters","includeSafetyAttributes"],p);const f=h(e,["includeRaiReason"]);t!==void 0&&f!=null&&g(t,["parameters","includeRaiReason"],f);const m=h(e,["language"]);t!==void 0&&m!=null&&g(t,["parameters","language"],m);const _=h(e,["outputMimeType"]);t!==void 0&&_!=null&&g(t,["parameters","outputOptions","mimeType"],_);const b=h(e,["outputCompressionQuality"]);if(t!==void 0&&b!=null&&g(t,["parameters","outputOptions","compressionQuality"],b),h(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=h(e,["imageSize"]);if(t!==void 0&&E!=null&&g(t,["parameters","sampleImageSize"],E),h(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function VN(e,t){const n={},a=h(e,["outputGcsUri"]);t!==void 0&&a!=null&&g(t,["parameters","storageUri"],a);const s=h(e,["negativePrompt"]);t!==void 0&&s!=null&&g(t,["parameters","negativePrompt"],s);const o=h(e,["numberOfImages"]);t!==void 0&&o!=null&&g(t,["parameters","sampleCount"],o);const u=h(e,["aspectRatio"]);t!==void 0&&u!=null&&g(t,["parameters","aspectRatio"],u);const d=h(e,["guidanceScale"]);t!==void 0&&d!=null&&g(t,["parameters","guidanceScale"],d);const p=h(e,["seed"]);t!==void 0&&p!=null&&g(t,["parameters","seed"],p);const f=h(e,["safetyFilterLevel"]);t!==void 0&&f!=null&&g(t,["parameters","safetySetting"],f);const m=h(e,["personGeneration"]);t!==void 0&&m!=null&&g(t,["parameters","personGeneration"],m);const _=h(e,["includeSafetyAttributes"]);t!==void 0&&_!=null&&g(t,["parameters","includeSafetyAttributes"],_);const b=h(e,["includeRaiReason"]);t!==void 0&&b!=null&&g(t,["parameters","includeRaiReason"],b);const E=h(e,["language"]);t!==void 0&&E!=null&&g(t,["parameters","language"],E);const x=h(e,["outputMimeType"]);t!==void 0&&x!=null&&g(t,["parameters","outputOptions","mimeType"],x);const I=h(e,["outputCompressionQuality"]);t!==void 0&&I!=null&&g(t,["parameters","outputOptions","compressionQuality"],I);const N=h(e,["addWatermark"]);t!==void 0&&N!=null&&g(t,["parameters","addWatermark"],N);const R=h(e,["labels"]);t!==void 0&&R!=null&&g(t,["labels"],R);const $=h(e,["imageSize"]);t!==void 0&&$!=null&&g(t,["parameters","sampleImageSize"],$);const O=h(e,["enhancePrompt"]);return t!==void 0&&O!=null&&g(t,["parameters","enhancePrompt"],O),n}function qN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["prompt"]);s!=null&&g(n,["instances[0]","prompt"],s);const o=h(t,["config"]);return o!=null&&GN(o,n),n}function HN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["prompt"]);s!=null&&g(n,["instances[0]","prompt"],s);const o=h(t,["config"]);return o!=null&&VN(o,n),n}function FN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["predictions"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>i$(u))),g(t,["generatedImages"],o)}const s=h(e,["positivePromptSafetyAttributes"]);return s!=null&&g(t,["positivePromptSafetyAttributes"],Aw(s)),t}function YN(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["predictions"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>Qc(u))),g(t,["generatedImages"],o)}const s=h(e,["positivePromptSafetyAttributes"]);return s!=null&&g(t,["positivePromptSafetyAttributes"],Iw(s)),t}function WN(e,t){const n={},a=h(e,["numberOfVideos"]);if(t!==void 0&&a!=null&&g(t,["parameters","sampleCount"],a),h(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(h(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=h(e,["durationSeconds"]);if(t!==void 0&&s!=null&&g(t,["parameters","durationSeconds"],s),h(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=h(e,["aspectRatio"]);t!==void 0&&o!=null&&g(t,["parameters","aspectRatio"],o);const u=h(e,["resolution"]);t!==void 0&&u!=null&&g(t,["parameters","resolution"],u);const d=h(e,["personGeneration"]);if(t!==void 0&&d!=null&&g(t,["parameters","personGeneration"],d),h(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const p=h(e,["negativePrompt"]);t!==void 0&&p!=null&&g(t,["parameters","negativePrompt"],p);const f=h(e,["enhancePrompt"]);if(t!==void 0&&f!=null&&g(t,["parameters","enhancePrompt"],f),h(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const m=h(e,["lastFrame"]);t!==void 0&&m!=null&&g(t,["instances[0]","lastFrame"],jc(m));const _=h(e,["referenceImages"]);if(t!==void 0&&_!=null){let b=_;Array.isArray(b)&&(b=b.map(E=>J$(E))),g(t,["instances[0]","referenceImages"],b)}if(h(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(h(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function KN(e,t){const n={},a=h(e,["numberOfVideos"]);t!==void 0&&a!=null&&g(t,["parameters","sampleCount"],a);const s=h(e,["outputGcsUri"]);t!==void 0&&s!=null&&g(t,["parameters","storageUri"],s);const o=h(e,["fps"]);t!==void 0&&o!=null&&g(t,["parameters","fps"],o);const u=h(e,["durationSeconds"]);t!==void 0&&u!=null&&g(t,["parameters","durationSeconds"],u);const d=h(e,["seed"]);t!==void 0&&d!=null&&g(t,["parameters","seed"],d);const p=h(e,["aspectRatio"]);t!==void 0&&p!=null&&g(t,["parameters","aspectRatio"],p);const f=h(e,["resolution"]);t!==void 0&&f!=null&&g(t,["parameters","resolution"],f);const m=h(e,["personGeneration"]);t!==void 0&&m!=null&&g(t,["parameters","personGeneration"],m);const _=h(e,["pubsubTopic"]);t!==void 0&&_!=null&&g(t,["parameters","pubsubTopic"],_);const b=h(e,["negativePrompt"]);t!==void 0&&b!=null&&g(t,["parameters","negativePrompt"],b);const E=h(e,["enhancePrompt"]);t!==void 0&&E!=null&&g(t,["parameters","enhancePrompt"],E);const x=h(e,["generateAudio"]);t!==void 0&&x!=null&&g(t,["parameters","generateAudio"],x);const I=h(e,["lastFrame"]);t!==void 0&&I!=null&&g(t,["instances[0]","lastFrame"],Ji(I));const N=h(e,["referenceImages"]);if(t!==void 0&&N!=null){let O=N;Array.isArray(O)&&(O=O.map(k=>X$(k))),g(t,["instances[0]","referenceImages"],O)}const R=h(e,["mask"]);t!==void 0&&R!=null&&g(t,["instances[0]","mask"],K$(R));const $=h(e,["compressionQuality"]);return t!==void 0&&$!=null&&g(t,["parameters","compressionQuality"],$),n}function JN(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response","generateVideoResponse"]);return u!=null&&g(t,["response"],jN(u)),t}function XN(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response"]);return u!=null&&g(t,["response"],e$(u)),t}function ZN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["prompt"]);s!=null&&g(n,["instances[0]","prompt"],s);const o=h(t,["image"]);o!=null&&g(n,["instances[0]","image"],jc(o));const u=h(t,["video"]);u!=null&&g(n,["instances[0]","video"],Nw(u));const d=h(t,["source"]);d!=null&&t$(d,n);const p=h(t,["config"]);return p!=null&&WN(p,n),n}function QN(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["prompt"]);s!=null&&g(n,["instances[0]","prompt"],s);const o=h(t,["image"]);o!=null&&g(n,["instances[0]","image"],Ji(o));const u=h(t,["video"]);u!=null&&g(n,["instances[0]","video"],$w(u));const d=h(t,["source"]);d!=null&&n$(d,n);const p=h(t,["config"]);return p!=null&&KN(p,n),n}function jN(e){const t={},n=h(e,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>r$(u))),g(t,["generatedVideos"],o)}const a=h(e,["raiMediaFilteredCount"]);a!=null&&g(t,["raiMediaFilteredCount"],a);const s=h(e,["raiMediaFilteredReasons"]);return s!=null&&g(t,["raiMediaFilteredReasons"],s),t}function e$(e){const t={},n=h(e,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(u=>o$(u))),g(t,["generatedVideos"],o)}const a=h(e,["raiMediaFilteredCount"]);a!=null&&g(t,["raiMediaFilteredCount"],a);const s=h(e,["raiMediaFilteredReasons"]);return s!=null&&g(t,["raiMediaFilteredReasons"],s),t}function t$(e,t){const n={},a=h(e,["prompt"]);t!==void 0&&a!=null&&g(t,["instances[0]","prompt"],a);const s=h(e,["image"]);t!==void 0&&s!=null&&g(t,["instances[0]","image"],jc(s));const o=h(e,["video"]);return t!==void 0&&o!=null&&g(t,["instances[0]","video"],Nw(o)),n}function n$(e,t){const n={},a=h(e,["prompt"]);t!==void 0&&a!=null&&g(t,["instances[0]","prompt"],a);const s=h(e,["image"]);t!==void 0&&s!=null&&g(t,["instances[0]","image"],Ji(s));const o=h(e,["video"]);return t!==void 0&&o!=null&&g(t,["instances[0]","video"],$w(o)),n}function i$(e){const t={},n=h(e,["_self"]);n!=null&&g(t,["image"],h$(n));const a=h(e,["raiFilteredReason"]);a!=null&&g(t,["raiFilteredReason"],a);const s=h(e,["_self"]);return s!=null&&g(t,["safetyAttributes"],Aw(s)),t}function Qc(e){const t={},n=h(e,["_self"]);n!=null&&g(t,["image"],Cw(n));const a=h(e,["raiFilteredReason"]);a!=null&&g(t,["raiFilteredReason"],a);const s=h(e,["_self"]);s!=null&&g(t,["safetyAttributes"],Iw(s));const o=h(e,["prompt"]);return o!=null&&g(t,["enhancedPrompt"],o),t}function a$(e){const t={},n=h(e,["_self"]);n!=null&&g(t,["mask"],Cw(n));const a=h(e,["labels"]);if(a!=null){let s=a;Array.isArray(s)&&(s=s.map(o=>o)),g(t,["labels"],s)}return t}function r$(e){const t={},n=h(e,["video"]);return n!=null&&g(t,["video"],Y$(n)),t}function o$(e){const t={},n=h(e,["_self"]);return n!=null&&g(t,["video"],W$(n)),t}function s$(e){const t={},n=h(e,["modelSelectionConfig"]);n!=null&&g(t,["modelConfig"],n);const a=h(e,["responseJsonSchema"]);a!=null&&g(t,["responseJsonSchema"],a);const s=h(e,["audioTimestamp"]);s!=null&&g(t,["audioTimestamp"],s);const o=h(e,["candidateCount"]);o!=null&&g(t,["candidateCount"],o);const u=h(e,["enableAffectiveDialog"]);u!=null&&g(t,["enableAffectiveDialog"],u);const d=h(e,["frequencyPenalty"]);d!=null&&g(t,["frequencyPenalty"],d);const p=h(e,["logprobs"]);p!=null&&g(t,["logprobs"],p);const f=h(e,["maxOutputTokens"]);f!=null&&g(t,["maxOutputTokens"],f);const m=h(e,["mediaResolution"]);m!=null&&g(t,["mediaResolution"],m);const _=h(e,["presencePenalty"]);_!=null&&g(t,["presencePenalty"],_);const b=h(e,["responseLogprobs"]);b!=null&&g(t,["responseLogprobs"],b);const E=h(e,["responseMimeType"]);E!=null&&g(t,["responseMimeType"],E);const x=h(e,["responseModalities"]);x!=null&&g(t,["responseModalities"],x);const I=h(e,["responseSchema"]);I!=null&&g(t,["responseSchema"],I);const N=h(e,["routingConfig"]);N!=null&&g(t,["routingConfig"],N);const R=h(e,["seed"]);R!=null&&g(t,["seed"],R);const $=h(e,["speechConfig"]);$!=null&&g(t,["speechConfig"],$);const O=h(e,["stopSequences"]);O!=null&&g(t,["stopSequences"],O);const k=h(e,["temperature"]);k!=null&&g(t,["temperature"],k);const P=h(e,["thinkingConfig"]);P!=null&&g(t,["thinkingConfig"],P);const G=h(e,["topK"]);G!=null&&g(t,["topK"],G);const B=h(e,["topP"]);if(B!=null&&g(t,["topP"],B),h(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function l$(e,t){const n={},a=h(t,["model"]);return a!=null&&g(n,["_url","name"],gt(e,a)),n}function u$(e,t){const n={},a=h(t,["model"]);return a!=null&&g(n,["_url","name"],gt(e,a)),n}function c$(e){const t={};if(h(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=h(e,["enableWidget"]);return n!=null&&g(t,["enableWidget"],n),t}function d$(e){const t={};if(h(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=h(e,["timeRangeFilter"]);return n!=null&&g(t,["timeRangeFilter"],n),t}function f$(e){const t={},n=h(e,["aspectRatio"]);n!=null&&g(t,["aspectRatio"],n);const a=h(e,["imageSize"]);if(a!=null&&g(t,["imageSize"],a),h(e,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(h(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(h(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function p$(e){const t={},n=h(e,["aspectRatio"]);n!=null&&g(t,["aspectRatio"],n);const a=h(e,["imageSize"]);a!=null&&g(t,["imageSize"],a);const s=h(e,["personGeneration"]);s!=null&&g(t,["personGeneration"],s);const o=h(e,["outputMimeType"]);o!=null&&g(t,["imageOutputOptions","mimeType"],o);const u=h(e,["outputCompressionQuality"]);return u!=null&&g(t,["imageOutputOptions","compressionQuality"],u),t}function h$(e){const t={},n=h(e,["bytesBase64Encoded"]);n!=null&&g(t,["imageBytes"],wr(n));const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function Cw(e){const t={},n=h(e,["gcsUri"]);n!=null&&g(t,["gcsUri"],n);const a=h(e,["bytesBase64Encoded"]);a!=null&&g(t,["imageBytes"],wr(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["mimeType"],s),t}function jc(e){const t={};if(h(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=h(e,["imageBytes"]);n!=null&&g(t,["bytesBase64Encoded"],wr(n));const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function Ji(e){const t={},n=h(e,["gcsUri"]);n!=null&&g(t,["gcsUri"],n);const a=h(e,["imageBytes"]);a!=null&&g(t,["bytesBase64Encoded"],wr(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["mimeType"],s),t}function m$(e,t,n){const a={},s=h(t,["pageSize"]);n!==void 0&&s!=null&&g(n,["_query","pageSize"],s);const o=h(t,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const u=h(t,["filter"]);n!==void 0&&u!=null&&g(n,["_query","filter"],u);const d=h(t,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],_w(e,d)),a}function g$(e,t,n){const a={},s=h(t,["pageSize"]);n!==void 0&&s!=null&&g(n,["_query","pageSize"],s);const o=h(t,["pageToken"]);n!==void 0&&o!=null&&g(n,["_query","pageToken"],o);const u=h(t,["filter"]);n!==void 0&&u!=null&&g(n,["_query","filter"],u);const d=h(t,["queryBase"]);return n!==void 0&&d!=null&&g(n,["_url","models_url"],_w(e,d)),a}function y$(e,t){const n={},a=h(t,["config"]);return a!=null&&m$(e,a,n),n}function v$(e,t){const n={},a=h(t,["config"]);return a!=null&&g$(e,a,n),n}function _$(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["_self"]);if(s!=null){let o=bw(s);Array.isArray(o)&&(o=o.map(u=>xh(u))),g(t,["models"],o)}return t}function b$(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["_self"]);if(s!=null){let o=bw(s);Array.isArray(o)&&(o=o.map(u=>Ch(u))),g(t,["models"],o)}return t}function T$(e){const t={},n=h(e,["maskMode"]);n!=null&&g(t,["maskMode"],n);const a=h(e,["segmentationClasses"]);a!=null&&g(t,["maskClasses"],a);const s=h(e,["maskDilation"]);return s!=null&&g(t,["dilation"],s),t}function xh(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["displayName"]);a!=null&&g(t,["displayName"],a);const s=h(e,["description"]);s!=null&&g(t,["description"],s);const o=h(e,["version"]);o!=null&&g(t,["version"],o);const u=h(e,["_self"]);u!=null&&g(t,["tunedModelInfo"],L$(u));const d=h(e,["inputTokenLimit"]);d!=null&&g(t,["inputTokenLimit"],d);const p=h(e,["outputTokenLimit"]);p!=null&&g(t,["outputTokenLimit"],p);const f=h(e,["supportedGenerationMethods"]);f!=null&&g(t,["supportedActions"],f);const m=h(e,["temperature"]);m!=null&&g(t,["temperature"],m);const _=h(e,["maxTemperature"]);_!=null&&g(t,["maxTemperature"],_);const b=h(e,["topP"]);b!=null&&g(t,["topP"],b);const E=h(e,["topK"]);E!=null&&g(t,["topK"],E);const x=h(e,["thinking"]);return x!=null&&g(t,["thinking"],x),t}function Ch(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["displayName"]);a!=null&&g(t,["displayName"],a);const s=h(e,["description"]);s!=null&&g(t,["description"],s);const o=h(e,["versionId"]);o!=null&&g(t,["version"],o);const u=h(e,["deployedModels"]);if(u!=null){let _=u;Array.isArray(_)&&(_=_.map(b=>DN(b))),g(t,["endpoints"],_)}const d=h(e,["labels"]);d!=null&&g(t,["labels"],d);const p=h(e,["_self"]);p!=null&&g(t,["tunedModelInfo"],U$(p));const f=h(e,["defaultCheckpointId"]);f!=null&&g(t,["defaultCheckpointId"],f);const m=h(e,["checkpoints"]);if(m!=null){let _=m;Array.isArray(_)&&(_=_.map(b=>b)),g(t,["checkpoints"],_)}return t}function w$(e){const t={},n=h(e,["mediaResolution"]);n!=null&&g(t,["mediaResolution"],n);const a=h(e,["codeExecutionResult"]);a!=null&&g(t,["codeExecutionResult"],a);const s=h(e,["executableCode"]);s!=null&&g(t,["executableCode"],s);const o=h(e,["fileData"]);o!=null&&g(t,["fileData"],kN(o));const u=h(e,["functionCall"]);u!=null&&g(t,["functionCall"],zN(u));const d=h(e,["functionResponse"]);d!=null&&g(t,["functionResponse"],d);const p=h(e,["inlineData"]);p!=null&&g(t,["inlineData"],sN(p));const f=h(e,["text"]);f!=null&&g(t,["text"],f);const m=h(e,["thought"]);m!=null&&g(t,["thought"],m);const _=h(e,["thoughtSignature"]);_!=null&&g(t,["thoughtSignature"],_);const b=h(e,["videoMetadata"]);return b!=null&&g(t,["videoMetadata"],b),t}function E$(e){const t={},n=h(e,["productImage"]);return n!=null&&g(t,["image"],Ji(n)),t}function S$(e,t){const n={},a=h(e,["numberOfImages"]);t!==void 0&&a!=null&&g(t,["parameters","sampleCount"],a);const s=h(e,["baseSteps"]);t!==void 0&&s!=null&&g(t,["parameters","baseSteps"],s);const o=h(e,["outputGcsUri"]);t!==void 0&&o!=null&&g(t,["parameters","storageUri"],o);const u=h(e,["seed"]);t!==void 0&&u!=null&&g(t,["parameters","seed"],u);const d=h(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&g(t,["parameters","safetySetting"],d);const p=h(e,["personGeneration"]);t!==void 0&&p!=null&&g(t,["parameters","personGeneration"],p);const f=h(e,["addWatermark"]);t!==void 0&&f!=null&&g(t,["parameters","addWatermark"],f);const m=h(e,["outputMimeType"]);t!==void 0&&m!=null&&g(t,["parameters","outputOptions","mimeType"],m);const _=h(e,["outputCompressionQuality"]);t!==void 0&&_!=null&&g(t,["parameters","outputOptions","compressionQuality"],_);const b=h(e,["enhancePrompt"]);t!==void 0&&b!=null&&g(t,["parameters","enhancePrompt"],b);const E=h(e,["labels"]);return t!==void 0&&E!=null&&g(t,["labels"],E),n}function x$(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["source"]);s!=null&&A$(s,n);const o=h(t,["config"]);return o!=null&&S$(o,n),n}function C$(e){const t={},n=h(e,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(s=>Qc(s))),g(t,["generatedImages"],a)}return t}function A$(e,t){const n={},a=h(e,["prompt"]);t!==void 0&&a!=null&&g(t,["instances[0]","prompt"],a);const s=h(e,["personImage"]);t!==void 0&&s!=null&&g(t,["instances[0]","personImage","image"],Ji(s));const o=h(e,["productImages"]);if(t!==void 0&&o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>E$(d))),g(t,["instances[0]","productImages"],u)}return n}function I$(e){const t={},n=h(e,["referenceImage"]);n!=null&&g(t,["referenceImage"],Ji(n));const a=h(e,["referenceId"]);a!=null&&g(t,["referenceId"],a);const s=h(e,["referenceType"]);s!=null&&g(t,["referenceType"],s);const o=h(e,["maskImageConfig"]);o!=null&&g(t,["maskImageConfig"],T$(o));const u=h(e,["controlImageConfig"]);u!=null&&g(t,["controlImageConfig"],hN(u));const d=h(e,["styleImageConfig"]);d!=null&&g(t,["styleImageConfig"],d);const p=h(e,["subjectImageConfig"]);return p!=null&&g(t,["subjectImageConfig"],p),t}function Aw(e){const t={},n=h(e,["safetyAttributes","categories"]);n!=null&&g(t,["categories"],n);const a=h(e,["safetyAttributes","scores"]);a!=null&&g(t,["scores"],a);const s=h(e,["contentType"]);return s!=null&&g(t,["contentType"],s),t}function Iw(e){const t={},n=h(e,["safetyAttributes","categories"]);n!=null&&g(t,["categories"],n);const a=h(e,["safetyAttributes","scores"]);a!=null&&g(t,["scores"],a);const s=h(e,["contentType"]);return s!=null&&g(t,["contentType"],s),t}function R$(e){const t={},n=h(e,["category"]);if(n!=null&&g(t,["category"],n),h(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const a=h(e,["threshold"]);return a!=null&&g(t,["threshold"],a),t}function N$(e){const t={},n=h(e,["image"]);return n!=null&&g(t,["image"],Ji(n)),t}function $$(e,t){const n={},a=h(e,["mode"]);t!==void 0&&a!=null&&g(t,["parameters","mode"],a);const s=h(e,["maxPredictions"]);t!==void 0&&s!=null&&g(t,["parameters","maxPredictions"],s);const o=h(e,["confidenceThreshold"]);t!==void 0&&o!=null&&g(t,["parameters","confidenceThreshold"],o);const u=h(e,["maskDilation"]);t!==void 0&&u!=null&&g(t,["parameters","maskDilation"],u);const d=h(e,["binaryColorThreshold"]);t!==void 0&&d!=null&&g(t,["parameters","binaryColorThreshold"],d);const p=h(e,["labels"]);return t!==void 0&&p!=null&&g(t,["labels"],p),n}function M$(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["source"]);s!=null&&D$(s,n);const o=h(t,["config"]);return o!=null&&$$(o,n),n}function O$(e){const t={},n=h(e,["predictions"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(s=>a$(s))),g(t,["generatedMasks"],a)}return t}function D$(e,t){const n={},a=h(e,["prompt"]);t!==void 0&&a!=null&&g(t,["instances[0]","prompt"],a);const s=h(e,["image"]);t!==void 0&&s!=null&&g(t,["instances[0]","image"],Ji(s));const o=h(e,["scribbleImage"]);return t!==void 0&&o!=null&&g(t,["instances[0]","scribble"],N$(o)),n}function k$(e){const t={},n=h(e,["retrievalConfig"]);n!=null&&g(t,["retrievalConfig"],n);const a=h(e,["functionCallingConfig"]);return a!=null&&g(t,["functionCallingConfig"],LN(a)),t}function z$(e){const t={};if(h(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=h(e,["computerUse"]);n!=null&&g(t,["computerUse"],n);const a=h(e,["fileSearch"]);a!=null&&g(t,["fileSearch"],a);const s=h(e,["codeExecution"]);if(s!=null&&g(t,["codeExecution"],s),h(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=h(e,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(_=>_)),g(t,["functionDeclarations"],m)}const u=h(e,["googleMaps"]);u!=null&&g(t,["googleMaps"],c$(u));const d=h(e,["googleSearch"]);d!=null&&g(t,["googleSearch"],d$(d));const p=h(e,["googleSearchRetrieval"]);p!=null&&g(t,["googleSearchRetrieval"],p);const f=h(e,["urlContext"]);return f!=null&&g(t,["urlContext"],f),t}function Rw(e){const t={},n=h(e,["retrieval"]);n!=null&&g(t,["retrieval"],n);const a=h(e,["computerUse"]);if(a!=null&&g(t,["computerUse"],a),h(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=h(e,["codeExecution"]);s!=null&&g(t,["codeExecution"],s);const o=h(e,["enterpriseWebSearch"]);o!=null&&g(t,["enterpriseWebSearch"],o);const u=h(e,["functionDeclarations"]);if(u!=null){let _=u;Array.isArray(_)&&(_=_.map(b=>UN(b))),g(t,["functionDeclarations"],_)}const d=h(e,["googleMaps"]);d!=null&&g(t,["googleMaps"],d);const p=h(e,["googleSearch"]);p!=null&&g(t,["googleSearch"],p);const f=h(e,["googleSearchRetrieval"]);f!=null&&g(t,["googleSearchRetrieval"],f);const m=h(e,["urlContext"]);return m!=null&&g(t,["urlContext"],m),t}function L$(e){const t={},n=h(e,["baseModel"]);n!=null&&g(t,["baseModel"],n);const a=h(e,["createTime"]);a!=null&&g(t,["createTime"],a);const s=h(e,["updateTime"]);return s!=null&&g(t,["updateTime"],s),t}function U$(e){const t={},n=h(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&g(t,["baseModel"],n);const a=h(e,["createTime"]);a!=null&&g(t,["createTime"],a);const s=h(e,["updateTime"]);return s!=null&&g(t,["updateTime"],s),t}function P$(e,t){const n={},a=h(e,["displayName"]);t!==void 0&&a!=null&&g(t,["displayName"],a);const s=h(e,["description"]);t!==void 0&&s!=null&&g(t,["description"],s);const o=h(e,["defaultCheckpointId"]);return t!==void 0&&o!=null&&g(t,["defaultCheckpointId"],o),n}function B$(e,t){const n={},a=h(e,["displayName"]);t!==void 0&&a!=null&&g(t,["displayName"],a);const s=h(e,["description"]);t!==void 0&&s!=null&&g(t,["description"],s);const o=h(e,["defaultCheckpointId"]);return t!==void 0&&o!=null&&g(t,["defaultCheckpointId"],o),n}function G$(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","name"],gt(e,a));const s=h(t,["config"]);return s!=null&&P$(s,n),n}function V$(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["config"]);return s!=null&&B$(s,n),n}function q$(e,t){const n={},a=h(e,["outputGcsUri"]);t!==void 0&&a!=null&&g(t,["parameters","storageUri"],a);const s=h(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&g(t,["parameters","safetySetting"],s);const o=h(e,["personGeneration"]);t!==void 0&&o!=null&&g(t,["parameters","personGeneration"],o);const u=h(e,["includeRaiReason"]);t!==void 0&&u!=null&&g(t,["parameters","includeRaiReason"],u);const d=h(e,["outputMimeType"]);t!==void 0&&d!=null&&g(t,["parameters","outputOptions","mimeType"],d);const p=h(e,["outputCompressionQuality"]);t!==void 0&&p!=null&&g(t,["parameters","outputOptions","compressionQuality"],p);const f=h(e,["enhanceInputImage"]);t!==void 0&&f!=null&&g(t,["parameters","upscaleConfig","enhanceInputImage"],f);const m=h(e,["imagePreservationFactor"]);t!==void 0&&m!=null&&g(t,["parameters","upscaleConfig","imagePreservationFactor"],m);const _=h(e,["labels"]);t!==void 0&&_!=null&&g(t,["labels"],_);const b=h(e,["numberOfImages"]);t!==void 0&&b!=null&&g(t,["parameters","sampleCount"],b);const E=h(e,["mode"]);return t!==void 0&&E!=null&&g(t,["parameters","mode"],E),n}function H$(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["_url","model"],gt(e,a));const s=h(t,["image"]);s!=null&&g(n,["instances[0]","image"],Ji(s));const o=h(t,["upscaleFactor"]);o!=null&&g(n,["parameters","upscaleConfig","upscaleFactor"],o);const u=h(t,["config"]);return u!=null&&q$(u,n),n}function F$(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["predictions"]);if(a!=null){let s=a;Array.isArray(s)&&(s=s.map(o=>Qc(o))),g(t,["generatedImages"],s)}return t}function Y$(e){const t={},n=h(e,["uri"]);n!=null&&g(t,["uri"],n);const a=h(e,["encodedVideo"]);a!=null&&g(t,["videoBytes"],wr(a));const s=h(e,["encoding"]);return s!=null&&g(t,["mimeType"],s),t}function W$(e){const t={},n=h(e,["gcsUri"]);n!=null&&g(t,["uri"],n);const a=h(e,["bytesBase64Encoded"]);a!=null&&g(t,["videoBytes"],wr(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["mimeType"],s),t}function K$(e){const t={},n=h(e,["image"]);n!=null&&g(t,["_self"],Ji(n));const a=h(e,["maskMode"]);return a!=null&&g(t,["maskMode"],a),t}function J$(e){const t={},n=h(e,["image"]);n!=null&&g(t,["image"],jc(n));const a=h(e,["referenceType"]);return a!=null&&g(t,["referenceType"],a),t}function X$(e){const t={},n=h(e,["image"]);n!=null&&g(t,["image"],Ji(n));const a=h(e,["referenceType"]);return a!=null&&g(t,["referenceType"],a),t}function Nw(e){const t={},n=h(e,["uri"]);n!=null&&g(t,["uri"],n);const a=h(e,["videoBytes"]);a!=null&&g(t,["encodedVideo"],wr(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["encoding"],s),t}function $w(e){const t={},n=h(e,["uri"]);n!=null&&g(t,["gcsUri"],n);const a=h(e,["videoBytes"]);a!=null&&g(t,["bytesBase64Encoded"],wr(a));const s=h(e,["mimeType"]);return s!=null&&g(t,["mimeType"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Z$(e,t){const n={},a=h(e,["displayName"]);return t!==void 0&&a!=null&&g(t,["displayName"],a),n}function Q$(e){const t={},n=h(e,["config"]);return n!=null&&Z$(n,t),t}function j$(e,t){const n={},a=h(e,["force"]);return t!==void 0&&a!=null&&g(t,["_query","force"],a),n}function e3(e){const t={},n=h(e,["name"]);n!=null&&g(t,["_url","name"],n);const a=h(e,["config"]);return a!=null&&j$(a,t),t}function t3(e){const t={},n=h(e,["name"]);return n!=null&&g(t,["_url","name"],n),t}function n3(e,t){const n={},a=h(e,["customMetadata"]);if(t!==void 0&&a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["customMetadata"],o)}const s=h(e,["chunkingConfig"]);return t!==void 0&&s!=null&&g(t,["chunkingConfig"],s),n}function i3(e){const t={},n=h(e,["name"]);n!=null&&g(t,["name"],n);const a=h(e,["metadata"]);a!=null&&g(t,["metadata"],a);const s=h(e,["done"]);s!=null&&g(t,["done"],s);const o=h(e,["error"]);o!=null&&g(t,["error"],o);const u=h(e,["response"]);return u!=null&&g(t,["response"],r3(u)),t}function a3(e){const t={},n=h(e,["fileSearchStoreName"]);n!=null&&g(t,["_url","file_search_store_name"],n);const a=h(e,["fileName"]);a!=null&&g(t,["fileName"],a);const s=h(e,["config"]);return s!=null&&n3(s,t),t}function r3(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["parent"]);a!=null&&g(t,["parent"],a);const s=h(e,["documentName"]);return s!=null&&g(t,["documentName"],s),t}function o3(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);return t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),n}function s3(e){const t={},n=h(e,["config"]);return n!=null&&o3(n,t),t}function l3(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["fileSearchStores"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["fileSearchStores"],o)}return t}function Mw(e,t){const n={},a=h(e,["mimeType"]);t!==void 0&&a!=null&&g(t,["mimeType"],a);const s=h(e,["displayName"]);t!==void 0&&s!=null&&g(t,["displayName"],s);const o=h(e,["customMetadata"]);if(t!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(p=>p)),g(t,["customMetadata"],d)}const u=h(e,["chunkingConfig"]);return t!==void 0&&u!=null&&g(t,["chunkingConfig"],u),n}function u3(e){const t={},n=h(e,["fileSearchStoreName"]);n!=null&&g(t,["_url","file_search_store_name"],n);const a=h(e,["config"]);return a!=null&&Mw(a,t),t}function c3(e){const t={},n=h(e,["sdkHttpResponse"]);return n!=null&&g(t,["sdkHttpResponse"],n),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const d3="Content-Type",f3="X-Server-Timeout",p3="User-Agent",Ah="x-goog-api-client",h3="1.35.0",m3=`google-genai-sdk/${h3}`,g3="v1beta1",y3="v1beta";class v3{constructor(t){var n,a;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:g3,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(a=this.clientOptions.apiVersion)!==null&&a!==void 0?a:y3,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const a=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&a.push(t.apiVersion),a.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),n=new URL(t);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,n,a){const s=[this.getRequestUrlInternal(n)];return a&&s.push(this.getBaseResourcePath()),t!==""&&s.push(t),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.shouldPrependVertexProjectPath(t),s=this.constructUrl(t.path,n,a);if(t.queryParams)for(const[u,d]of Object.entries(t.queryParams))s.searchParams.append(u,String(d));let o={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=t.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,s.toString(),t.abortSignal),this.unaryApiCall(s,o,t.httpMethod)}patchHttpOptions(t,n){const a=JSON.parse(JSON.stringify(t));for(const[s,o]of Object.entries(n))typeof o=="object"?a[s]=Object.assign(Object.assign({},a[s]),o):o!==void 0&&(a[s]=o);return a}async requestStream(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.shouldPrependVertexProjectPath(t),s=this.constructUrl(t.path,n,a);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let o={};return o.body=t.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,s.toString(),t.abortSignal),this.streamApiCall(s,o,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,n,a,s){if(n&&n.timeout||s){const o=new AbortController,u=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>o.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}s&&s.addEventListener("abort",()=>{o.abort()}),t.signal=u}return n&&n.extraBody!==null&&_3(t,n.extraBody),t.headers=await this.getHeadersInternal(n,a),t}async unaryApiCall(t,n,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:a})).then(async s=>(await d_(s),new wh(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(t,n,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:a})).then(async s=>(await d_(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(t){return Yi(this,arguments,function*(){var a;const s=(a=t==null?void 0:t.body)===null||a===void 0?void 0:a.getReader(),o=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let u="";const d="data:",p=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:f,value:m}=yield Ze(s.read());if(f){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const _=o.decode(m,{stream:!0});try{const x=JSON.parse(_);if("error"in x){const I=JSON.parse(JSON.stringify(x.error)),N=I.status,R=I.code,$=`got status: ${N}. ${JSON.stringify(x)}`;if(R>=400&&R<600)throw new Xc({message:$,status:R})}}catch(x){if(x.name==="ApiError")throw x}u+=_;let b=-1,E=0;for(;;){b=-1,E=0;for(const N of p){const R=u.indexOf(N);R!==-1&&(b===-1||R<b)&&(b=R,E=N.length)}if(b===-1)break;const x=u.substring(0,b);u=u.substring(b+E);const I=x.trim();if(I.startsWith(d)){const N=I.substring(d.length).trim();try{const R=new Response(N,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield Ze(new wh(R))}catch(R){throw new Error(`exception parsing stream chunk ${N}. ${R}`)}}}}}finally{s.releaseLock()}})}async apiCall(t,n){return fetch(t,n).catch(a=>{throw new Error(`exception ${a} sending request`)})}getDefaultHeaders(){const t={},n=m3+" "+this.clientOptions.userAgentExtra;return t[p3]=n,t[Ah]=n,t[d3]="application/json",t}async getHeadersInternal(t,n){const a=new Headers;if(t&&t.headers){for(const[s,o]of Object.entries(t.headers))a.append(s,o);t.timeout&&t.timeout>0&&a.append(f3,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(a,n),a}getFileName(t){var n;let a="";return typeof t=="string"&&(a=t.replace(/[/\\]+$/,""),a=(n=a.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),a}async uploadFile(t,n){var a;const s={};n!=null&&(s.mimeType=n.mimeType,s.name=n.name,s.displayName=n.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const o=this.clientOptions.uploader,u=await o.stat(t);s.sizeBytes=String(u.size);const d=(a=n==null?void 0:n.mimeType)!==null&&a!==void 0?a:u.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=d;const p={file:s},f=this.getFileName(t),m=xe("upload/v1beta/files",p._url),_=await this.fetchUploadUrl(m,s.sizeBytes,s.mimeType,f,p,n==null?void 0:n.httpOptions);return o.upload(t,_,this)}async uploadFileToFileSearchStore(t,n,a){var s;const o=this.clientOptions.uploader,u=await o.stat(n),d=String(u.size),p=(s=a==null?void 0:a.mimeType)!==null&&s!==void 0?s:u.type;if(p===void 0||p==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const f=`upload/v1beta/${t}:uploadToFileSearchStore`,m=this.getFileName(n),_={};a!=null&&Mw(a,_);const b=await this.fetchUploadUrl(f,d,p,m,_,a==null?void 0:a.httpOptions);return o.uploadToFileSearchStore(n,b,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,n,a,s,o,u){var d;let p={};u?p=u:p={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${a}`},s?{"X-Goog-Upload-File-Name":s}:{})};const f=await this.request({path:t,body:JSON.stringify(o),httpMethod:"POST",httpOptions:p});if(!f||!(f!=null&&f.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(d=f==null?void 0:f.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function d_(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const n=e.status;let a;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?a=await e.json():a={error:{message:await e.text(),code:e.status,status:e.statusText}};const s=JSON.stringify(a);throw n>=400&&n<600?new Xc({message:s,status:n}):new Error(s)}}function _3(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof e.body=="string"&&e.body.length>0)try{const o=JSON.parse(e.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function a(o,u){const d=Object.assign({},o);for(const p in u)if(Object.prototype.hasOwnProperty.call(u,p)){const f=u[p],m=d[p];f&&typeof f=="object"&&!Array.isArray(f)&&m&&typeof m=="object"&&!Array.isArray(m)?d[p]=a(m,f):(m&&f&&typeof m!=typeof f&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${p}". Original type: ${typeof m}, New type: ${typeof f}. Overwriting.`),d[p]=f)}return d}const s=a(n,t);e.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const b3="mcp_used/unknown";let T3=!1;function Ow(e){for(const t of e)if(w3(t)||typeof t=="object"&&"inputSchema"in t)return!0;return T3}function Dw(e){var t;const n=(t=e[Ah])!==null&&t!==void 0?t:"";e[Ah]=(n+` ${b3}`).trimStart()}function w3(e){return e!==null&&typeof e=="object"&&e instanceof am}function E3(e){return Yi(this,arguments,function*(n,a=100){let s,o=0;for(;o<a;){const u=yield Ze(n.listTools({cursor:s}));for(const d of u.tools)yield yield Ze(d),o++;if(!u.nextCursor)break;s=u.nextCursor}})}class am{constructor(t=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=n}static create(t,n){return new am(t,n)}async initialize(){var t,n,a,s;if(this.mcpTools.length>0)return;const o={},u=[];for(const m of this.mcpClients)try{for(var d=!0,p=(n=void 0,Wi(E3(m))),f;f=await p.next(),t=f.done,!t;d=!0){s=f.value,d=!1;const _=s;u.push(_);const b=_.name;if(o[b])throw new Error(`Duplicate function name ${b} found in MCP tools. Please ensure function names are unique.`);o[b]=m}}catch(_){n={error:_}}finally{try{!d&&!t&&(a=p.return)&&await a.call(p)}finally{if(n)throw n.error}}this.mcpTools=u,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),tI(this.mcpTools,this.config)}async callTool(t){await this.initialize();const n=[];for(const a of t)if(a.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[a.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const u=await s.callTool({name:a.name,arguments:a.args},void 0,o);n.push({functionResponse:{name:a.name,response:u.isError?{error:u}:u}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function S3(e,t,n){const a=new WA;let s;n.data instanceof Blob?s=JSON.parse(await n.data.text()):s=JSON.parse(n.data),Object.assign(a,s),t(a)}class x3{constructor(t,n,a){this.apiClient=t,this.auth=n,this.webSocketFactory=a}async connect(t){var n,a;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),u=I3(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),p=`${s}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let f=()=>{};const m=new Promise(O=>{f=O}),_=t.callbacks,b=function(){f({})},E=this.apiClient,x={onopen:b,onmessage:O=>{S3(E,_.onmessage,O)},onerror:(n=_==null?void 0:_.onerror)!==null&&n!==void 0?n:function(O){},onclose:(a=_==null?void 0:_.onclose)!==null&&a!==void 0?a:function(O){}},I=this.webSocketFactory.create(p,A3(u),x);I.connect(),await m;const $={setup:{model:gt(this.apiClient,t.model)}};return I.send(JSON.stringify($)),new C3(I,this.apiClient)}}class C3{constructor(t,n){this.conn=t,this.apiClient=n}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=QR(t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const n=ZR(t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(t){const n={playbackControl:t};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(es.PLAY)}pause(){this.sendPlaybackControl(es.PAUSE)}stop(){this.sendPlaybackControl(es.STOP)}resetContext(){this.sendPlaybackControl(es.RESET_CONTEXT)}close(){this.conn.close()}}function A3(e){const t={};return e.forEach((n,a)=>{t[a]=n}),t}function I3(e){const t=new Headers;for(const[n,a]of Object.entries(e))t.append(n,a);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const R3="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function N3(e,t,n){const a=new YA;let s;n.data instanceof Blob?s=await n.data.text():n.data instanceof ArrayBuffer?s=new TextDecoder().decode(n.data):s=n.data;const o=JSON.parse(s);if(e.isVertexAI()){const u=tN(o);Object.assign(a,u)}else Object.assign(a,o);t(a)}class $3{constructor(t,n,a){this.apiClient=t,this.auth=n,this.webSocketFactory=a,this.music=new x3(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var n,a,s,o,u,d;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const p=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion();let m;const _=this.apiClient.getHeaders();t.config&&t.config.tools&&Ow(t.config.tools)&&Dw(_);const b=k3(_);if(this.apiClient.isVertexAI())m=`${p}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(b,m);else{const Y=this.apiClient.getApiKey();let se="BidiGenerateContent",ve="key";Y!=null&&Y.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),f!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),se="BidiGenerateContentConstrained",ve="access_token"),m=`${p}/ws/google.ai.generativelanguage.${f}.GenerativeService.${se}?${ve}=${Y}`}let E=()=>{};const x=new Promise(Y=>{E=Y}),I=t.callbacks,N=function(){var Y;(Y=I==null?void 0:I.onopen)===null||Y===void 0||Y.call(I),E({})},R=this.apiClient,$={onopen:N,onmessage:Y=>{N3(R,I.onmessage,Y)},onerror:(n=I==null?void 0:I.onerror)!==null&&n!==void 0?n:function(Y){},onclose:(a=I==null?void 0:I.onclose)!==null&&a!==void 0?a:function(Y){}},O=this.webSocketFactory.create(m,D3(b),$);O.connect(),await x;let k=gt(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const Y=this.apiClient.getProject(),se=this.apiClient.getLocation();k=`projects/${Y}/locations/${se}/`+k}let P={};this.apiClient.isVertexAI()&&((s=t.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[Oc.AUDIO]}:t.config.responseModalities=[Oc.AUDIO]),!((o=t.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const G=(d=(u=t.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[],B=[];for(const Y of G)if(this.isCallableTool(Y)){const se=Y;B.push(await se.tool())}else B.push(Y);B.length>0&&(t.config.tools=B);const K={model:k,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?P=XR(this.apiClient,K):P=JR(this.apiClient,K),delete P.config,O.send(JSON.stringify(P)),new O3(O,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const M3={turnComplete:!0};class O3{constructor(t,n){this.conn=t,this.apiClient=n}tLiveClientContent(t,n){if(n.turns!==null&&n.turns!==void 0){let a=[];try{a=xi(n.turns),t.isVertexAI()||(a=a.map(s=>Zc(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:a,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(t,n){let a=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?a=n.functionResponses:a=[n.functionResponses],a.length===0)throw new Error("functionResponses is required.");for(const o of a){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!t.isVertexAI()&&!("id"in o))throw new Error(R3)}return{toolResponse:{functionResponses:a}}}sendClientContent(t){t=Object.assign(Object.assign({},M3),t);const n=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendRealtimeInput(t){let n={};this.apiClient.isVertexAI()?n={realtimeInput:eN(t)}:n={realtimeInput:jR(t)},this.conn.send(JSON.stringify(n))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function D3(e){const t={};return e.forEach((n,a)=>{t[a]=n}),t}function k3(e){const t=new Headers;for(const[n,a]of Object.entries(e))t.append(n,a);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const f_=10;function p_(e){var t,n,a;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let s=!1;for(const u of(n=e==null?void 0:e.tools)!==null&&n!==void 0?n:[])if(os(u)){s=!0;break}if(!s)return!0;const o=(a=e==null?void 0:e.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function os(e){return"callTool"in e&&typeof e.callTool=="function"}function z3(e){var t,n,a;return(a=(n=(t=e.config)===null||t===void 0?void 0:t.tools)===null||n===void 0?void 0:n.some(s=>os(s)))!==null&&a!==void 0?a:!1}function h_(e){var t;const n=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((a,s)=>{if(os(a))return;const o=a;o.functionDeclarations&&o.functionDeclarations.length>0&&n.push(s)}),n}function m_(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class L3 extends Ma{constructor(t){super(),this.apiClient=t,this.generateContent=async n=>{var a,s,o,u,d;const p=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!z3(n)||p_(n.config))return await this.generateContentInternal(p);const f=h_(n);if(f.length>0){const I=f.map(N=>`tools[${N}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${I}.`)}let m,_;const b=xi(p.contents),E=(o=(s=(a=p.config)===null||a===void 0?void 0:a.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:f_;let x=0;for(;x<E&&(m=await this.generateContentInternal(p),!(!m.functionCalls||m.functionCalls.length===0));){const I=m.candidates[0].content,N=[];for(const R of(d=(u=n.config)===null||u===void 0?void 0:u.tools)!==null&&d!==void 0?d:[])if(os(R)){const O=await R.callTool(m.functionCalls);N.push(...O)}x++,_={role:"user",parts:N},p.contents=xi(p.contents),p.contents.push(I),p.contents.push(_),m_(p.config)&&(b.push(I),b.push(_))}return m_(p.config)&&(m.automaticFunctionCallingHistory=b),m},this.generateContentStream=async n=>{var a,s,o,u,d;if(this.maybeMoveToResponseJsonSchem(n),p_(n.config)){const _=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(_)}const p=h_(n);if(p.length>0){const _=p.map(b=>`tools[${b}]`).join(", ");throw new Error(`Incompatible tools found at ${_}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const f=(o=(s=(a=n==null?void 0:n.config)===null||a===void 0?void 0:a.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,m=(d=(u=n==null?void 0:n.config)===null||u===void 0?void 0:u.automaticFunctionCalling)===null||d===void 0?void 0:d.disable;if(f&&!m)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(a=>{var s;let o;const u=[];if(a!=null&&a.generatedImages)for(const p of a.generatedImages)p&&(p!=null&&p.safetyAttributes)&&((s=p==null?void 0:p.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?o=p==null?void 0:p.safetyAttributes:u.push(p);let d;return o?d={generatedImages:u,positivePromptSafetyAttributes:o,sdkHttpResponse:a.sdkHttpResponse}:d={generatedImages:u,sdkHttpResponse:a.sdkHttpResponse},d}),this.list=async n=>{var a;const u={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!u.config.queryBase){if(!((a=u.config)===null||a===void 0)&&a.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");u.config.filter="labels.tune-type:*"}return new uo($a.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(u),u)},this.editImage=async n=>{const a={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(a.referenceImages=n.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(a)},this.upscaleImage=async n=>{let a={numberOfImages:1,mode:"upscale"};n.config&&(a=Object.assign(Object.assign({},a),n.config));const s={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:a};return await this.upscaleImageInternal(s)},this.generateVideos=async n=>{var a,s,o,u,d,p;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((a=n.video)===null||a===void 0)&&a.uri&&(!((s=n.video)===null||s===void 0)&&s.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((u=(o=n.source)===null||o===void 0?void 0:o.video)===null||u===void 0)&&u.uri&&(!((p=(d=n.source)===null||d===void 0?void 0:d.video)===null||p===void 0)&&p.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var n,a,s;const o=(n=t.config)===null||n===void 0?void 0:n.tools;if(!o)return t;const u=await Promise.all(o.map(async p=>os(p)?await p.tool():p)),d={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:u})};if(d.config.tools=u,t.config&&t.config.tools&&Ow(t.config.tools)){const p=(s=(a=t.config.httpOptions)===null||a===void 0?void 0:a.headers)!==null&&s!==void 0?s:{};let f=Object.assign({},p);Object.keys(f).length===0&&(f=this.apiClient.getDefaultHeaders()),Dw(f),d.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:f})}return d}async initAfcToolsMap(t){var n,a,s;const o=new Map;for(const u of(a=(n=t.config)===null||n===void 0?void 0:n.tools)!==null&&a!==void 0?a:[])if(os(u)){const d=u,p=await d.tool();for(const f of(s=p.functionDeclarations)!==null&&s!==void 0?s:[]){if(!f.name)throw new Error("Function declaration name is required.");if(o.has(f.name))throw new Error(`Duplicate tool declaration name: ${f.name}`);o.set(f.name,d)}}return o}async processAfcStream(t){var n,a,s;const o=(s=(a=(n=t.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&s!==void 0?s:f_;let u=!1,d=0;const p=await this.initAfcToolsMap(t);return(function(f,m,_){return Yi(this,arguments,function*(){for(var b,E,x,I,N,R;d<o;){u&&(d++,u=!1);const P=yield Ze(f.processParamsMaybeAddMcpUsage(_)),G=yield Ze(f.generateContentStreamInternal(P)),B=[],K=[];try{for(var $=!0,O=(E=void 0,Wi(G)),k;k=yield Ze(O.next()),b=k.done,!b;$=!0){I=k.value,$=!1;const Y=I;if(yield yield Ze(Y),Y.candidates&&(!((N=Y.candidates[0])===null||N===void 0)&&N.content)){K.push(Y.candidates[0].content);for(const se of(R=Y.candidates[0].content.parts)!==null&&R!==void 0?R:[])if(d<o&&se.functionCall){if(!se.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(se.functionCall.name)){const ve=yield Ze(m.get(se.functionCall.name).callTool([se.functionCall]));B.push(...ve)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${se.functionCall.name}`)}}}}catch(Y){E={error:Y}}finally{try{!$&&!b&&(x=O.return)&&(yield Ze(x.call(O)))}finally{if(E)throw E.error}}if(B.length>0){u=!0;const Y=new Tl;Y.candidates=[{content:{role:"user",parts:B}}],yield yield Ze(Y);const se=[];se.push(...K),se.push({role:"user",parts:B});const ve=xi(_.contents).concat(se);_.contents=ve}else break}})})(this,p,t)}async generateContentInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=l_(this.apiClient,t);return d=xe("{model}:generateContent",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=c_(m),b=new Tl;return Object.assign(b,_),b})}else{const f=s_(this.apiClient,t);return d=xe("{model}:generateContent",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=u_(m),b=new Tl;return Object.assign(b,_),b})}}async generateContentStreamInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=l_(this.apiClient,t);return d=xe("{model}:streamGenerateContent?alt=sse",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}),u.then(function(_){return Yi(this,arguments,function*(){var b,E,x,I;try{for(var N=!0,R=Wi(_),$;$=yield Ze(R.next()),b=$.done,!b;N=!0){I=$.value,N=!1;const O=I,k=c_(yield Ze(O.json()));k.sdkHttpResponse={headers:O.headers};const P=new Tl;Object.assign(P,k),yield yield Ze(P)}}catch(O){E={error:O}}finally{try{!N&&!b&&(x=R.return)&&(yield Ze(x.call(R)))}finally{if(E)throw E.error}}})})}else{const f=s_(this.apiClient,t);return d=xe("{model}:streamGenerateContent?alt=sse",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.requestStream({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}),u.then(function(_){return Yi(this,arguments,function*(){var b,E,x,I;try{for(var N=!0,R=Wi(_),$;$=yield Ze(R.next()),b=$.done,!b;N=!0){I=$.value,N=!1;const O=I,k=u_(yield Ze(O.json()));k.sdkHttpResponse={headers:O.headers};const P=new Tl;Object.assign(P,k),yield yield Ze(P)}}catch(O){E={error:O}}finally{try{!N&&!b&&(x=R.return)&&(yield Ze(x.call(R)))}finally{if(E)throw E.error}}})})}}async embedContent(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=$N(this.apiClient,t);return d=xe("{model}:predict",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=ON(m),b=new Hv;return Object.assign(b,_),b})}else{const f=NN(this.apiClient,t);return d=xe("{model}:batchEmbedContents",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=MN(m),b=new Hv;return Object.assign(b,_),b})}}async generateImagesInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=HN(this.apiClient,t);return d=xe("{model}:predict",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=YN(m),b=new Fv;return Object.assign(b,_),b})}else{const f=qN(this.apiClient,t);return d=xe("{model}:predict",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=FN(m),b=new Fv;return Object.assign(b,_),b})}}async editImageInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=CN(this.apiClient,t);return o=xe("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>{const f=AN(p),m=new kA;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=H$(this.apiClient,t);return o=xe("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>{const f=F$(p),m=new zA;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=x$(this.apiClient,t);return o=xe("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=C$(p),m=new LA;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=M$(this.apiClient,t);return o=xe("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=O$(p),m=new UA;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=u$(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>Ch(m))}else{const f=l$(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>xh(m))}}async listInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=v$(this.apiClient,t);return d=xe("{models_url}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=b$(m),b=new Yv;return Object.assign(b,_),b})}else{const f=y$(this.apiClient,t);return d=xe("{models_url}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=_$(m),b=new Yv;return Object.assign(b,_),b})}}async update(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=V$(this.apiClient,t);return d=xe("{model}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>Ch(m))}else{const f=G$(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>xh(m))}}async delete(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=wN(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=SN(m),b=new Wv;return Object.assign(b,_),b})}else{const f=TN(this.apiClient,t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=EN(m),b=new Wv;return Object.assign(b,_),b})}}async countTokens(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=vN(this.apiClient,t);return d=xe("{model}:countTokens",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=bN(m),b=new Kv;return Object.assign(b,_),b})}else{const f=yN(this.apiClient,t);return d=xe("{model}:countTokens",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=_N(m),b=new Kv;return Object.assign(b,_),b})}}async computeTokens(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=cN(this.apiClient,t);return o=xe("{model}:computeTokens",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>{const f=dN(p),m=new PA;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=QN(this.apiClient,t);return d=xe("{model}:predictLongRunning",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u.then(m=>{const _=XN(m),b=new Dc;return Object.assign(b,_),b})}else{const f=ZN(this.apiClient,t);return d=xe("{model}:predictLongRunning",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u.then(m=>{const _=JN(m),b=new Dc;return Object.assign(b,_),b})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class U3 extends Ma{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const n=t.operation,a=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=n.name.split("/operations/")[0];let o;a&&"httpOptions"in a&&(o=a.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:s,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:n.name,config:a});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(t){const n=t.operation,a=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=n.name.split("/operations/")[0];let o;a&&"httpOptions"in a&&(o=a.httpOptions);const u=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:s,config:{httpOptions:o}});return n._fromAPIResponse({apiResponse:u,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:n.name,config:a});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=RA(t);return d=xe("{operationName}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json()),u}else{const f=IA(t);return d=xe("{operationName}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),u}}async fetchPredictVideosOperationInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=TA(t);return o=xe("{resourceName}:fetchPredictOperation",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function P3(e){const t={},n=h(e,["data"]);if(n!=null&&g(t,["data"],n),h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function B3(e){const t={},n=h(e,["parts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>J3(o))),g(t,["parts"],s)}const a=h(e,["role"]);return a!=null&&g(t,["role"],a),t}function G3(e,t,n){const a={},s=h(t,["expireTime"]);n!==void 0&&s!=null&&g(n,["expireTime"],s);const o=h(t,["newSessionExpireTime"]);n!==void 0&&o!=null&&g(n,["newSessionExpireTime"],o);const u=h(t,["uses"]);n!==void 0&&u!=null&&g(n,["uses"],u);const d=h(t,["liveConnectConstraints"]);n!==void 0&&d!=null&&g(n,["bidiGenerateContentSetup"],K3(e,d));const p=h(t,["lockAdditionalFields"]);return n!==void 0&&p!=null&&g(n,["fieldMask"],p),a}function V3(e,t){const n={},a=h(t,["config"]);return a!=null&&g(n,["config"],G3(e,a,n)),n}function q3(e){const t={};if(h(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=h(e,["fileUri"]);n!=null&&g(t,["fileUri"],n);const a=h(e,["mimeType"]);return a!=null&&g(t,["mimeType"],a),t}function H3(e){const t={},n=h(e,["id"]);n!=null&&g(t,["id"],n);const a=h(e,["args"]);a!=null&&g(t,["args"],a);const s=h(e,["name"]);if(s!=null&&g(t,["name"],s),h(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(h(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function F3(e){const t={};if(h(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=h(e,["enableWidget"]);return n!=null&&g(t,["enableWidget"],n),t}function Y3(e){const t={};if(h(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(h(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=h(e,["timeRangeFilter"]);return n!=null&&g(t,["timeRangeFilter"],n),t}function W3(e,t){const n={},a=h(e,["generationConfig"]);t!==void 0&&a!=null&&g(t,["setup","generationConfig"],a);const s=h(e,["responseModalities"]);t!==void 0&&s!=null&&g(t,["setup","generationConfig","responseModalities"],s);const o=h(e,["temperature"]);t!==void 0&&o!=null&&g(t,["setup","generationConfig","temperature"],o);const u=h(e,["topP"]);t!==void 0&&u!=null&&g(t,["setup","generationConfig","topP"],u);const d=h(e,["topK"]);t!==void 0&&d!=null&&g(t,["setup","generationConfig","topK"],d);const p=h(e,["maxOutputTokens"]);t!==void 0&&p!=null&&g(t,["setup","generationConfig","maxOutputTokens"],p);const f=h(e,["mediaResolution"]);t!==void 0&&f!=null&&g(t,["setup","generationConfig","mediaResolution"],f);const m=h(e,["seed"]);t!==void 0&&m!=null&&g(t,["setup","generationConfig","seed"],m);const _=h(e,["speechConfig"]);t!==void 0&&_!=null&&g(t,["setup","generationConfig","speechConfig"],im(_));const b=h(e,["thinkingConfig"]);t!==void 0&&b!=null&&g(t,["setup","generationConfig","thinkingConfig"],b);const E=h(e,["enableAffectiveDialog"]);t!==void 0&&E!=null&&g(t,["setup","generationConfig","enableAffectiveDialog"],E);const x=h(e,["systemInstruction"]);t!==void 0&&x!=null&&g(t,["setup","systemInstruction"],B3(Ln(x)));const I=h(e,["tools"]);if(t!==void 0&&I!=null){let G=cs(I);Array.isArray(G)&&(G=G.map(B=>Z3(us(B)))),g(t,["setup","tools"],G)}const N=h(e,["sessionResumption"]);t!==void 0&&N!=null&&g(t,["setup","sessionResumption"],X3(N));const R=h(e,["inputAudioTranscription"]);t!==void 0&&R!=null&&g(t,["setup","inputAudioTranscription"],R);const $=h(e,["outputAudioTranscription"]);t!==void 0&&$!=null&&g(t,["setup","outputAudioTranscription"],$);const O=h(e,["realtimeInputConfig"]);t!==void 0&&O!=null&&g(t,["setup","realtimeInputConfig"],O);const k=h(e,["contextWindowCompression"]);t!==void 0&&k!=null&&g(t,["setup","contextWindowCompression"],k);const P=h(e,["proactivity"]);if(t!==void 0&&P!=null&&g(t,["setup","proactivity"],P),h(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function K3(e,t){const n={},a=h(t,["model"]);a!=null&&g(n,["setup","model"],gt(e,a));const s=h(t,["config"]);return s!=null&&g(n,["config"],W3(s,n)),n}function J3(e){const t={},n=h(e,["mediaResolution"]);n!=null&&g(t,["mediaResolution"],n);const a=h(e,["codeExecutionResult"]);a!=null&&g(t,["codeExecutionResult"],a);const s=h(e,["executableCode"]);s!=null&&g(t,["executableCode"],s);const o=h(e,["fileData"]);o!=null&&g(t,["fileData"],q3(o));const u=h(e,["functionCall"]);u!=null&&g(t,["functionCall"],H3(u));const d=h(e,["functionResponse"]);d!=null&&g(t,["functionResponse"],d);const p=h(e,["inlineData"]);p!=null&&g(t,["inlineData"],P3(p));const f=h(e,["text"]);f!=null&&g(t,["text"],f);const m=h(e,["thought"]);m!=null&&g(t,["thought"],m);const _=h(e,["thoughtSignature"]);_!=null&&g(t,["thoughtSignature"],_);const b=h(e,["videoMetadata"]);return b!=null&&g(t,["videoMetadata"],b),t}function X3(e){const t={},n=h(e,["handle"]);if(n!=null&&g(t,["handle"],n),h(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function Z3(e){const t={};if(h(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=h(e,["computerUse"]);n!=null&&g(t,["computerUse"],n);const a=h(e,["fileSearch"]);a!=null&&g(t,["fileSearch"],a);const s=h(e,["codeExecution"]);if(s!=null&&g(t,["codeExecution"],s),h(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=h(e,["functionDeclarations"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(_=>_)),g(t,["functionDeclarations"],m)}const u=h(e,["googleMaps"]);u!=null&&g(t,["googleMaps"],F3(u));const d=h(e,["googleSearch"]);d!=null&&g(t,["googleSearch"],Y3(d));const p=h(e,["googleSearchRetrieval"]);p!=null&&g(t,["googleSearchRetrieval"],p);const f=h(e,["urlContext"]);return f!=null&&g(t,["urlContext"],f),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Q3(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const a=e[n];if(typeof a=="object"&&a!=null&&Object.keys(a).length>0){const s=Object.keys(a).map(o=>`${n}.${o}`);t.push(...s)}else t.push(n)}return t.join(",")}function j3(e,t){let n=null;const a=e.bidiGenerateContentSetup;if(typeof a=="object"&&a!==null&&"setup"in a){const o=a.setup;typeof o=="object"&&o!==null?(e.bidiGenerateContentSetup=o,n=o):delete e.bidiGenerateContentSetup}else a!==void 0&&delete e.bidiGenerateContentSetup;const s=e.fieldMask;if(n){const o=Q3(n);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)o?e.fieldMask=o:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const u=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];s.length>0&&(d=s.map(f=>u.includes(f)?`generationConfig.${f}`:f));const p=[];o&&p.push(o),d.length>0&&p.push(...d),p.length>0?e.fieldMask=p.join(","):delete e.fieldMask}else delete e.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?e.fieldMask=s.join(","):delete e.fieldMask;return e}class eM extends Ma{constructor(t){super(),this.apiClient=t}async create(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=V3(this.apiClient,t);o=xe("auth_tokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query;const p=j3(d,t.config);return s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(f=>f.json()),s.then(f=>f)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tM(e,t){const n={},a=h(e,["force"]);return t!==void 0&&a!=null&&g(t,["_query","force"],a),n}function nM(e){const t={},n=h(e,["name"]);n!=null&&g(t,["_url","name"],n);const a=h(e,["config"]);return a!=null&&tM(a,t),t}function iM(e){const t={},n=h(e,["name"]);return n!=null&&g(t,["_url","name"],n),t}function aM(e,t){const n={},a=h(e,["pageSize"]);t!==void 0&&a!=null&&g(t,["_query","pageSize"],a);const s=h(e,["pageToken"]);return t!==void 0&&s!=null&&g(t,["_query","pageToken"],s),n}function rM(e){const t={},n=h(e,["parent"]);n!=null&&g(t,["_url","parent"],n);const a=h(e,["config"]);return a!=null&&aM(a,t),t}function oM(e){const t={},n=h(e,["sdkHttpResponse"]);n!=null&&g(t,["sdkHttpResponse"],n);const a=h(e,["nextPageToken"]);a!=null&&g(t,["nextPageToken"],a);const s=h(e,["documents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(u=>u)),g(t,["documents"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sM extends Ma{constructor(t){super(),this.apiClient=t,this.list=async n=>new uo($a.PAGED_ITEM_DOCUMENTS,a=>this.listInternal({parent:n.parent,config:a.config}),await this.listInternal(n),n)}async get(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=iM(t);return o=xe("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>p)}}async delete(t){var n,a;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=nM(t);s=xe("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=rM(t);return o=xe("{parent}/documents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=oM(p),m=new BA;return Object.assign(m,f),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lM extends Ma{constructor(t,n=new sM(t)){super(),this.apiClient=t,this.documents=n,this.list=async(a={})=>new uo($a.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(a),a)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Q$(t);return o=xe("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>p)}}async get(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=t3(t);return o=xe("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>p)}}async delete(t){var n,a;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=e3(t);s=xe("{name}",u._url),o=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal})}}async listInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=s3(t);return o=xe("fileSearchStores",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=l3(p),m=new GA;return Object.assign(m,f),m})}}async uploadToFileSearchStoreInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=u3(t);return o=xe("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=c3(p),m=new VA;return Object.assign(m,f),m})}}async importFile(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=a3(t);return o=xe("{file_search_store_name}:importFile",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json()),s.then(p=>{const f=i3(p),m=new Qh;return Object.assign(m,f),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kw=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return kw=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(+a^n()&15>>+a/4).toString(16))};const uM=()=>kw();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ih(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const Rh=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ci extends Error{}class qn extends Ci{constructor(t,n,a,s){super(`${qn.makeMessage(t,n,a)}`),this.status=t,this.headers=s,this.error=n}static makeMessage(t,n,a){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):a;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,n,a,s){if(!t||!s)return new ed({message:a,cause:Rh(n)});const o=n;return t===400?new Lw(t,o,a,s):t===401?new Uw(t,o,a,s):t===403?new Pw(t,o,a,s):t===404?new Bw(t,o,a,s):t===409?new Gw(t,o,a,s):t===422?new Vw(t,o,a,s):t===429?new qw(t,o,a,s):t>=500?new Hw(t,o,a,s):new qn(t,o,a,s)}}class Nh extends qn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class ed extends qn{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class zw extends ed{constructor({message:t}={}){super({message:t??"Request timed out."})}}class Lw extends qn{}class Uw extends qn{}class Pw extends qn{}class Bw extends qn{}class Gw extends qn{}class Vw extends qn{}class qw extends qn{}class Hw extends qn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cM=/^[a-z][a-z0-9+.-]*:/i,dM=e=>cM.test(e);let $h=e=>($h=Array.isArray,$h(e));const fM=$h;let pM=fM;const g_=pM;function hM(e){if(!e)return!0;for(const t in e)return!1;return!0}function mM(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const gM=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Ci(`${e} must be an integer`);if(t<0)throw new Ci(`${e} must be a positive integer`);return t},yM=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vM=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jo="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _M(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const bM=()=>{var e,t,n,a,s;const o=_M();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jo,"X-Stainless-OS":v_(Deno.build.os),"X-Stainless-Arch":y_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jo,"X-Stainless-OS":v_((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":y_((a=globalThis.process.arch)!==null&&a!==void 0?a:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};const u=TM();return u?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${u.browser}`,"X-Stainless-Runtime-Version":u.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function TM(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const a=n.exec(navigator.userAgent);if(a){const s=a[1]||0,o=a[2]||0,u=a[3]||0;return{browser:t,version:`${s}.${o}.${u}`}}}return null}const y_=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",v_=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let dc;const wM=()=>dc??(dc=bM());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function EM(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Fw(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function SM(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Fw({start(){},async pull(n){const{done:a,value:s}=await t.next();a?n.close():n.enqueue(s)},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}function Yw(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function xM(e){var t,n;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((n=(t=e[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(t));return}const a=e.getReader(),s=a.cancel();a.releaseLock(),await s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const CM=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ww=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,n=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function bp(e,t,n){return Ww(),new File(e,t??"unknown_file",n)}function AM(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const IM=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kw=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",RM=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&Kw(e),NM=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function $M(e,t,n){if(Ww(),e=await e,RM(e))return e instanceof File?e:bp([await e.arrayBuffer()],e.name);if(NM(e)){const s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),bp(await Mh(s),t,n)}const a=await Mh(e);if(t||(t=AM(e)),!(n!=null&&n.type)){const s=a.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof s=="string"&&(n=Object.assign(Object.assign({},n),{type:s}))}return bp(a,t,n)}async function Mh(e){var t,n,a,s,o;let u=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)u.push(e);else if(Kw(e))u.push(e instanceof Blob?e:await e.arrayBuffer());else if(IM(e))try{for(var d=!0,p=Wi(e),f;f=await p.next(),t=f.done,!t;d=!0){s=f.value,d=!1;const m=s;u.push(...await Mh(m))}}catch(m){n={error:m}}finally{try{!d&&!t&&(a=p.return)&&await a.call(p)}finally{if(n)throw n.error}}else{const m=(o=e==null?void 0:e.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof e}${m?`; constructor: ${m}`:""}${MM(e)}`)}return u}function MM(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jw{constructor(t){this._client=t}}Jw._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xw(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const __=Object.freeze(Object.create(null)),OM=(e=Xw)=>(function(n,...a){if(n.length===1)return n[0];let s=!1;const o=[],u=n.reduce((m,_,b)=>{var E,x,I;/[?#]/.test(_)&&(s=!0);const N=a[b];let R=(s?encodeURIComponent:e)(""+N);return b!==a.length&&(N==null||typeof N=="object"&&N.toString===((I=Object.getPrototypeOf((x=Object.getPrototypeOf((E=N.hasOwnProperty)!==null&&E!==void 0?E:__))!==null&&x!==void 0?x:__))===null||I===void 0?void 0:I.toString))&&(R=N+"",o.push({start:m.length+_.length,length:R.length,error:`Value of type ${Object.prototype.toString.call(N).slice(8,-1)} is not a valid path parameter`})),m+_+(b===a.length?"":R)},""),d=u.split(/[?#]/,1)[0],p=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=p.exec(d))!==null;)o.push({start:f.index,length:f[0].length,error:`Value "${f[0]}" can't be safely passed as a path parameter`});if(o.sort((m,_)=>m.start-_.start),o.length>0){let m=0;const _=o.reduce((b,E)=>{const x=" ".repeat(E.start-m),I="^".repeat(E.length);return m=E.start+E.length,b+x+I},"");throw new Ci(`Path parameters result in path with invalid segments:
${o.map(b=>b.error).join(`
`)}
${u}
${_}`)}return u}),fc=OM(Xw);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zw extends Jw{create(t,n){var a;const{api_version:s=this._client.apiVersion}=t,o=zc(t,["api_version"]);if("model"in o&&"agent_config"in o)throw new Ci("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new Ci("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(fc`/${s}/interactions`,Object.assign(Object.assign({body:o},n),{stream:(a=t.stream)!==null&&a!==void 0?a:!1}))}delete(t,n={},a){const{api_version:s=this._client.apiVersion}=n??{};return this._client.delete(fc`/${s}/interactions/${t}`,a)}cancel(t,n={},a){const{api_version:s=this._client.apiVersion}=n??{};return this._client.post(fc`/${s}/interactions/${t}/cancel`,a)}get(t,n={},a){var s;const o=n??{},{api_version:u=this._client.apiVersion}=o,d=zc(o,["api_version"]);return this._client.get(fc`/${u}/interactions/${t}`,Object.assign(Object.assign({query:d},a),{stream:(s=n==null?void 0:n.stream)!==null&&s!==void 0?s:!1}))}}Zw._key=Object.freeze(["interactions"]);class Qw extends Zw{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function DM(e){let t=0;for(const s of e)t+=s.length;const n=new Uint8Array(t);let a=0;for(const s of e)n.set(s,a),a+=s.length;return n}let pc;function rm(e){let t;return(pc??(t=new globalThis.TextEncoder,pc=t.encode.bind(t)))(e)}let hc;function b_(e){let t;return(hc??(t=new globalThis.TextDecoder,hc=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class td{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?rm(t):t;this.buffer=DM([this.buffer,n]);const a=[];let s;for(;(s=kM(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){a.push(b_(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const o=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,u=b_(this.buffer.subarray(0,o));a.push(u),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return a}flush(){return this.buffer.length?this.decode(`
`):[]}}td.NEWLINE_CHARS=new Set([`
`,"\r"]);td.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function kM(e,t){for(let s=t??0;s<e.length;s++){if(e[s]===10)return{preceding:s,index:s+1,carriage:!1};if(e[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function zM(e){for(let a=0;a<e.length-1;a++){if(e[a]===10&&e[a+1]===10||e[a]===13&&e[a+1]===13)return a+2;if(e[a]===13&&e[a+1]===10&&a+3<e.length&&e[a+2]===13&&e[a+3]===10)return a+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Lc={off:0,error:200,warn:300,info:400,debug:500},T_=(e,t,n)=>{if(e){if(mM(Lc,e))return e;Vn(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Lc))}`)}};function Dl(){}function mc(e,t,n){return!t||Lc[e]>Lc[n]?Dl:t[e].bind(t)}const LM={error:Dl,warn:Dl,info:Dl,debug:Dl};let w_=new WeakMap;function Vn(e){var t;const n=e.logger,a=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!n)return LM;const s=w_.get(n);if(s&&s[0]===a)return s[1];const o={error:mc("error",n,a),warn:mc("warn",n,a),info:mc("info",n,a),debug:mc("debug",n,a)};return w_.set(n,[a,o]),o}const eo=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,n])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ts{constructor(t,n,a){this.iterator=t,this.controller=n,this.client=a}static fromSSEResponse(t,n,a){let s=!1;const o=a?Vn(a):console;function u(){return Yi(this,arguments,function*(){var p,f,m,_;if(s)throw new Ci("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let b=!1;try{try{for(var E=!0,x=Wi(UM(t,n)),I;I=yield Ze(x.next()),p=I.done,!p;E=!0){_=I.value,E=!1;const N=_;if(!b)if(N.data.startsWith("[DONE]")){b=!0;continue}else try{yield yield Ze(JSON.parse(N.data))}catch(R){throw o.error("Could not parse message into JSON:",N.data),o.error("From chunk:",N.raw),R}}}catch(N){f={error:N}}finally{try{!E&&!p&&(m=x.return)&&(yield Ze(m.call(x)))}finally{if(f)throw f.error}}b=!0}catch(N){if(Ih(N))return yield Ze(void 0);throw N}finally{b||n.abort()}})}return new ts(u,n,a)}static fromReadableStream(t,n,a){let s=!1;function o(){return Yi(this,arguments,function*(){var p,f,m,_;const b=new td,E=Yw(t);try{for(var x=!0,I=Wi(E),N;N=yield Ze(I.next()),p=N.done,!p;x=!0){_=N.value,x=!1;const R=_;for(const $ of b.decode(R))yield yield Ze($)}}catch(R){f={error:R}}finally{try{!x&&!p&&(m=I.return)&&(yield Ze(m.call(I)))}finally{if(f)throw f.error}}for(const R of b.flush())yield yield Ze(R)})}function u(){return Yi(this,arguments,function*(){var p,f,m,_;if(s)throw new Ci("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let b=!1;try{try{for(var E=!0,x=Wi(o()),I;I=yield Ze(x.next()),p=I.done,!p;E=!0){_=I.value,E=!1;const N=_;b||N&&(yield yield Ze(JSON.parse(N)))}}catch(N){f={error:N}}finally{try{!E&&!p&&(m=x.return)&&(yield Ze(m.call(x)))}finally{if(f)throw f.error}}b=!0}catch(N){if(Ih(N))return yield Ze(void 0);throw N}finally{b||n.abort()}})}return new ts(u,n,a)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],a=this.iterator(),s=o=>({next:()=>{if(o.length===0){const u=a.next();t.push(u),n.push(u)}return o.shift()}});return[new ts(()=>s(t),this.controller,this.client),new ts(()=>s(n),this.controller,this.client)]}toReadableStream(){const t=this;let n;return Fw({async start(){n=t[Symbol.asyncIterator]()},async pull(a){try{const{value:s,done:o}=await n.next();if(o)return a.close();const u=rm(JSON.stringify(s)+`
`);a.enqueue(u)}catch(s){a.error(s)}},async cancel(){var a;await((a=n.return)===null||a===void 0?void 0:a.call(n))}})}}function UM(e,t){return Yi(this,arguments,function*(){var a,s,o,u;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Ci("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ci("Attempted to iterate over a response with no body");const d=new BM,p=new td,f=Yw(e.body);try{for(var m=!0,_=Wi(PM(f)),b;b=yield Ze(_.next()),a=b.done,!a;m=!0){u=b.value,m=!1;const E=u;for(const x of p.decode(E)){const I=d.decode(x);I&&(yield yield Ze(I))}}}catch(E){s={error:E}}finally{try{!m&&!a&&(o=_.return)&&(yield Ze(o.call(_)))}finally{if(s)throw s.error}}for(const E of p.flush()){const x=d.decode(E);x&&(yield yield Ze(x))}})}function PM(e){return Yi(this,arguments,function*(){var n,a,s,o;let u=new Uint8Array;try{for(var d=!0,p=Wi(e),f;f=yield Ze(p.next()),n=f.done,!n;d=!0){o=f.value,d=!1;const m=o;if(m==null)continue;const _=m instanceof ArrayBuffer?new Uint8Array(m):typeof m=="string"?rm(m):m;let b=new Uint8Array(u.length+_.length);b.set(u),b.set(_,u.length),u=b;let E;for(;(E=zM(u))!==-1;)yield yield Ze(u.slice(0,E)),u=u.slice(E)}}catch(m){a={error:m}}finally{try{!d&&!n&&(s=p.return)&&(yield Ze(s.call(p)))}finally{if(a)throw a.error}}u.length>0&&(yield yield Ze(u))})}class BM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,a,s]=GM(t,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function GM(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function VM(e,t){const{response:n,requestLogID:a,retryOfRequestLogID:s,startTime:o}=t,u=await(async()=>{var d;if(t.options.stream)return Vn(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):ts.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;const p=n.headers.get("content-type"),f=(d=p==null?void 0:p.split(";")[0])===null||d===void 0?void 0:d.trim();return(f==null?void 0:f.includes("application/json"))||(f==null?void 0:f.endsWith("+json"))?await n.json():await n.text()})();return Vn(e).debug(`[${a}] response parsed`,eo({retryOfRequestLogID:s,url:n.url,status:n.status,body:u,durationMs:Date.now()-o})),u}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class om extends Promise{constructor(t,n,a=VM){super(s=>{s(null)}),this.responsePromise=n,this.parseResponse=a,this.client=t}_thenUnwrap(t){return new om(this.client,this.responsePromise,async(n,a)=>t(await this.parseResponse(n,a),a))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jw=Symbol("brand.privateNullableHeaders");function*qM(e){if(!e)return;if(jw in e){const{values:a,nulls:s}=e;yield*a.entries();for(const o of s)yield[o,null];return}let t=!1,n;e instanceof Headers?n=e.entries():g_(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let a of n){const s=a[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const o=g_(a[1])?a[1]:[a[1]];let u=!1;for(const d of o)d!==void 0&&(t&&!u&&(u=!0,yield[s,null]),yield[s,d])}}const wl=e=>{const t=new Headers,n=new Set;for(const a of e){const s=new Set;for(const[o,u]of qM(a)){const d=o.toLowerCase();s.has(d)||(t.delete(o),s.add(d)),u===null?(t.delete(o),n.add(d)):(t.append(o,u),n.delete(d))}}return{[jw]:!0,values:t,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tp=e=>{var t,n,a,s,o,u;if(typeof globalThis.process<"u")return(a=(n=(t=mA)===null||t===void 0?void 0:t[e])===null||n===void 0?void 0:n.trim())!==null&&a!==void 0?a:void 0;if(typeof globalThis.Deno<"u")return(u=(o=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||o===void 0?void 0:o.call(s,e))===null||u===void 0?void 0:u.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var eE;class nd{constructor(t){var n,a,s,o,u,d,p,{baseURL:f=Tp("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:m=(n=Tp("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:_="v1beta"}=t,b=zc(t,["baseURL","apiKey","apiVersion"]);const E=Object.assign(Object.assign({apiKey:m,apiVersion:_},b),{baseURL:f||"https://generativelanguage.googleapis.com"});this.baseURL=E.baseURL,this.timeout=(a=E.timeout)!==null&&a!==void 0?a:nd.DEFAULT_TIMEOUT,this.logger=(s=E.logger)!==null&&s!==void 0?s:console;const x="warn";this.logLevel=x,this.logLevel=(u=(o=T_(E.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:T_(Tp("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&u!==void 0?u:x,this.fetchOptions=E.fetchOptions,this.maxRetries=(d=E.maxRetries)!==null&&d!==void 0?d:2,this.fetch=(p=E.fetch)!==null&&p!==void 0?p:EM(),this.encoder=CM,this._options=E,this.apiKey=m,this.apiVersion=_,this.clientAdapter=E.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const n=wl([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return wl([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return wl([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,a])=>typeof a<"u").map(([n,a])=>{if(typeof a=="string"||typeof a=="number"||typeof a=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(a)}`;if(a===null)return`${encodeURIComponent(n)}=`;throw new Ci(`Cannot stringify type ${typeof a}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${jo}`}defaultIdempotencyKey(){return`stainless-node-retry-${uM()}`}makeStatusError(t,n,a,s){return qn.generate(t,n,a,s)}buildURL(t,n,a){const s=!this.baseURLOverridden()&&a||this.baseURL,o=dM(t)?new URL(t):new URL(s+(s.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),u=this.defaultQuery();return hM(u)||(n=Object.assign(Object.assign({},u),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(o.search=this.stringifyQuery(n)),o.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:a}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,a){return this.request(Promise.resolve(a).then(s=>Object.assign({method:t,path:n},s)))}request(t,n=null){return new om(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,a){var s,o,u;const d=await t,p=(s=d.maxRetries)!==null&&s!==void 0?s:this.maxRetries;n==null&&(n=p),await this.prepareOptions(d);const{req:f,url:m,timeout:_}=await this.buildRequest(d,{retryCount:p-n});await this.prepareRequest(f,{url:m,options:d});const b="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),E=a===void 0?"":`, retryOf: ${a}`,x=Date.now();if(Vn(this).debug(`[${b}] sending request`,eo({retryOfRequestLogID:a,method:d.method,url:m,options:d,headers:f.headers})),!((o=d.signal)===null||o===void 0)&&o.aborted)throw new Nh;const I=new AbortController,N=await this.fetchWithTimeout(m,f,_,I).catch(Rh),R=Date.now();if(N instanceof globalThis.Error){const O=`retrying, ${n} attempts remaining`;if(!((u=d.signal)===null||u===void 0)&&u.aborted)throw new Nh;const k=Ih(N)||/timed? ?out/i.test(String(N)+("cause"in N?String(N.cause):""));if(n)return Vn(this).info(`[${b}] connection ${k?"timed out":"failed"} - ${O}`),Vn(this).debug(`[${b}] connection ${k?"timed out":"failed"} (${O})`,eo({retryOfRequestLogID:a,url:m,durationMs:R-x,message:N.message})),this.retryRequest(d,n,a??b);throw Vn(this).info(`[${b}] connection ${k?"timed out":"failed"} - error; no more retries left`),Vn(this).debug(`[${b}] connection ${k?"timed out":"failed"} (error; no more retries left)`,eo({retryOfRequestLogID:a,url:m,durationMs:R-x,message:N.message})),k?new zw:new ed({cause:N})}const $=`[${b}${E}] ${f.method} ${m} ${N.ok?"succeeded":"failed"} with status ${N.status} in ${R-x}ms`;if(!N.ok){const O=await this.shouldRetry(N);if(n&&O){const Y=`retrying, ${n} attempts remaining`;return await xM(N.body),Vn(this).info(`${$} - ${Y}`),Vn(this).debug(`[${b}] response error (${Y})`,eo({retryOfRequestLogID:a,url:N.url,status:N.status,headers:N.headers,durationMs:R-x})),this.retryRequest(d,n,a??b,N.headers)}const k=O?"error; no more retries left":"error; not retryable";Vn(this).info(`${$} - ${k}`);const P=await N.text().catch(Y=>Rh(Y).message),G=yM(P),B=G?void 0:P;throw Vn(this).debug(`[${b}] response error (${k})`,eo({retryOfRequestLogID:a,url:N.url,status:N.status,headers:N.headers,message:B,durationMs:Date.now()-x})),this.makeStatusError(N.status,G,B,N.headers)}return Vn(this).info($),Vn(this).debug(`[${b}] response start`,eo({retryOfRequestLogID:a,url:N.url,status:N.status,headers:N.headers,durationMs:R-x})),{response:N,options:d,controller:I,requestLogID:b,retryOfRequestLogID:a,startTime:x}}async fetchWithTimeout(t,n,a,s){const o=n||{},{signal:u,method:d}=o,p=zc(o,["signal","method"]);u&&u.addEventListener("abort",()=>s.abort());const f=setTimeout(()=>s.abort(),a),m=globalThis.ReadableStream&&p.body instanceof globalThis.ReadableStream||typeof p.body=="object"&&p.body!==null&&Symbol.asyncIterator in p.body,_=Object.assign(Object.assign(Object.assign({signal:s.signal},m?{duplex:"half"}:{}),{method:"GET"}),p);d&&(_.method=d.toUpperCase());try{return await this.fetch.call(void 0,t,_)}finally{clearTimeout(f)}}async shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,a,s){var o;let u;const d=s==null?void 0:s.get("retry-after-ms");if(d){const f=parseFloat(d);Number.isNaN(f)||(u=f)}const p=s==null?void 0:s.get("retry-after");if(p&&!u){const f=parseFloat(p);Number.isNaN(f)?u=Date.parse(p)-Date.now():u=f*1e3}if(!(u&&0<=u&&u<60*1e3)){const f=(o=t.maxRetries)!==null&&o!==void 0?o:this.maxRetries;u=this.calculateDefaultRetryTimeoutMillis(n,f)}return await vM(u),this.makeRequest(t,n-1,a)}calculateDefaultRetryTimeoutMillis(t,n){const o=n-t,u=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return u*d*1e3}async buildRequest(t,{retryCount:n=0}={}){var a,s,o;const u=Object.assign({},t),{method:d,path:p,query:f,defaultBaseURL:m}=u,_=this.buildURL(p,f,m);"timeout"in u&&gM("timeout",u.timeout),u.timeout=(a=u.timeout)!==null&&a!==void 0?a:this.timeout;const{bodyHeaders:b,body:E}=this.buildBody({options:u}),x=await this.buildHeaders({options:t,method:d,bodyHeaders:b,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:d,headers:x},u.signal&&{signal:u.signal}),globalThis.ReadableStream&&E instanceof globalThis.ReadableStream&&{duplex:"half"}),E&&{body:E}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(o=u.fetchOptions)!==null&&o!==void 0?o:{}),url:_,timeout:u.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:a,retryCount:s}){let o={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const u=await this.authHeaders(t);let d=wl([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),wM()),this._options.defaultHeaders,a,t.headers,u]);return this.validateHeaders(d),d.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};const a=wl([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&a.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:SM(t)}:this.encoder({body:t,headers:a})}}nd.DEFAULT_TIMEOUT=6e4;class wn extends nd{constructor(){super(...arguments),this.interactions=new Qw(this)}}eE=wn;wn.GeminiNextGenAPIClient=eE;wn.GeminiNextGenAPIClientError=Ci;wn.APIError=qn;wn.APIConnectionError=ed;wn.APIConnectionTimeoutError=zw;wn.APIUserAbortError=Nh;wn.NotFoundError=Bw;wn.ConflictError=Gw;wn.RateLimitError=qw;wn.BadRequestError=Lw;wn.AuthenticationError=Uw;wn.InternalServerError=Hw;wn.PermissionDeniedError=Pw;wn.UnprocessableEntityError=Vw;wn.toFile=$M;wn.Interactions=Qw;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HM(e,t){const n={},a=h(e,["name"]);return a!=null&&g(n,["_url","name"],a),n}function FM(e,t){const n={},a=h(e,["name"]);return a!=null&&g(n,["_url","name"],a),n}function YM(e,t){const n={},a=h(e,["sdkHttpResponse"]);return a!=null&&g(n,["sdkHttpResponse"],a),n}function WM(e,t){const n={},a=h(e,["sdkHttpResponse"]);return a!=null&&g(n,["sdkHttpResponse"],a),n}function KM(e,t,n){const a={};if(h(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=h(e,["tunedModelDisplayName"]);if(t!==void 0&&s!=null&&g(t,["displayName"],s),h(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=h(e,["epochCount"]);t!==void 0&&o!=null&&g(t,["tuningTask","hyperparameters","epochCount"],o);const u=h(e,["learningRateMultiplier"]);if(u!=null&&g(a,["tuningTask","hyperparameters","learningRateMultiplier"],u),h(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(h(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(h(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=h(e,["batchSize"]);t!==void 0&&d!=null&&g(t,["tuningTask","hyperparameters","batchSize"],d);const p=h(e,["learningRate"]);if(t!==void 0&&p!=null&&g(t,["tuningTask","hyperparameters","learningRate"],p),h(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(h(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return a}function JM(e,t,n){const a={};let s=h(n,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const E=h(e,["validationDataset"]);t!==void 0&&E!=null&&g(t,["supervisedTuningSpec"],E_(E))}else if(s==="PREFERENCE_TUNING"){const E=h(e,["validationDataset"]);t!==void 0&&E!=null&&g(t,["preferenceOptimizationSpec"],E_(E))}const o=h(e,["tunedModelDisplayName"]);t!==void 0&&o!=null&&g(t,["tunedModelDisplayName"],o);const u=h(e,["description"]);t!==void 0&&u!=null&&g(t,["description"],u);let d=h(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const E=h(e,["epochCount"]);t!==void 0&&E!=null&&g(t,["supervisedTuningSpec","hyperParameters","epochCount"],E)}else if(d==="PREFERENCE_TUNING"){const E=h(e,["epochCount"]);t!==void 0&&E!=null&&g(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],E)}let p=h(n,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const E=h(e,["learningRateMultiplier"]);t!==void 0&&E!=null&&g(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],E)}else if(p==="PREFERENCE_TUNING"){const E=h(e,["learningRateMultiplier"]);t!==void 0&&E!=null&&g(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],E)}let f=h(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const E=h(e,["exportLastCheckpointOnly"]);t!==void 0&&E!=null&&g(t,["supervisedTuningSpec","exportLastCheckpointOnly"],E)}else if(f==="PREFERENCE_TUNING"){const E=h(e,["exportLastCheckpointOnly"]);t!==void 0&&E!=null&&g(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],E)}let m=h(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const E=h(e,["adapterSize"]);t!==void 0&&E!=null&&g(t,["supervisedTuningSpec","hyperParameters","adapterSize"],E)}else if(m==="PREFERENCE_TUNING"){const E=h(e,["adapterSize"]);t!==void 0&&E!=null&&g(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],E)}if(h(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(h(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const _=h(e,["labels"]);t!==void 0&&_!=null&&g(t,["labels"],_);const b=h(e,["beta"]);return t!==void 0&&b!=null&&g(t,["preferenceOptimizationSpec","hyperParameters","beta"],b),a}function XM(e,t){const n={},a=h(e,["baseModel"]);a!=null&&g(n,["baseModel"],a);const s=h(e,["preTunedModel"]);s!=null&&g(n,["preTunedModel"],s);const o=h(e,["trainingDataset"]);o!=null&&sO(o);const u=h(e,["config"]);return u!=null&&KM(u,n),n}function ZM(e,t){const n={},a=h(e,["baseModel"]);a!=null&&g(n,["baseModel"],a);const s=h(e,["preTunedModel"]);s!=null&&g(n,["preTunedModel"],s);const o=h(e,["trainingDataset"]);o!=null&&lO(o,n,t);const u=h(e,["config"]);return u!=null&&JM(u,n,t),n}function QM(e,t){const n={},a=h(e,["name"]);return a!=null&&g(n,["_url","name"],a),n}function jM(e,t){const n={},a=h(e,["name"]);return a!=null&&g(n,["_url","name"],a),n}function eO(e,t,n){const a={},s=h(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);const o=h(e,["pageToken"]);t!==void 0&&o!=null&&g(t,["_query","pageToken"],o);const u=h(e,["filter"]);return t!==void 0&&u!=null&&g(t,["_query","filter"],u),a}function tO(e,t,n){const a={},s=h(e,["pageSize"]);t!==void 0&&s!=null&&g(t,["_query","pageSize"],s);const o=h(e,["pageToken"]);t!==void 0&&o!=null&&g(t,["_query","pageToken"],o);const u=h(e,["filter"]);return t!==void 0&&u!=null&&g(t,["_query","filter"],u),a}function nO(e,t){const n={},a=h(e,["config"]);return a!=null&&eO(a,n),n}function iO(e,t){const n={},a=h(e,["config"]);return a!=null&&tO(a,n),n}function aO(e,t){const n={},a=h(e,["sdkHttpResponse"]);a!=null&&g(n,["sdkHttpResponse"],a);const s=h(e,["nextPageToken"]);s!=null&&g(n,["nextPageToken"],s);const o=h(e,["tunedModels"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>tE(d))),g(n,["tuningJobs"],u)}return n}function rO(e,t){const n={},a=h(e,["sdkHttpResponse"]);a!=null&&g(n,["sdkHttpResponse"],a);const s=h(e,["nextPageToken"]);s!=null&&g(n,["nextPageToken"],s);const o=h(e,["tuningJobs"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(d=>Oh(d))),g(n,["tuningJobs"],u)}return n}function oO(e,t){const n={},a=h(e,["name"]);a!=null&&g(n,["model"],a);const s=h(e,["name"]);return s!=null&&g(n,["endpoint"],s),n}function sO(e,t){const n={};if(h(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(h(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const a=h(e,["examples"]);if(a!=null){let s=a;Array.isArray(s)&&(s=s.map(o=>o)),g(n,["examples","examples"],s)}return n}function lO(e,t,n){const a={};let s=h(n,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const u=h(e,["gcsUri"]);t!==void 0&&u!=null&&g(t,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(s==="PREFERENCE_TUNING"){const u=h(e,["gcsUri"]);t!==void 0&&u!=null&&g(t,["preferenceOptimizationSpec","trainingDatasetUri"],u)}let o=h(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const u=h(e,["vertexDatasetResource"]);t!==void 0&&u!=null&&g(t,["supervisedTuningSpec","trainingDatasetUri"],u)}else if(o==="PREFERENCE_TUNING"){const u=h(e,["vertexDatasetResource"]);t!==void 0&&u!=null&&g(t,["preferenceOptimizationSpec","trainingDatasetUri"],u)}if(h(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return a}function tE(e,t){const n={},a=h(e,["sdkHttpResponse"]);a!=null&&g(n,["sdkHttpResponse"],a);const s=h(e,["name"]);s!=null&&g(n,["name"],s);const o=h(e,["state"]);o!=null&&g(n,["state"],yw(o));const u=h(e,["createTime"]);u!=null&&g(n,["createTime"],u);const d=h(e,["tuningTask","startTime"]);d!=null&&g(n,["startTime"],d);const p=h(e,["tuningTask","completeTime"]);p!=null&&g(n,["endTime"],p);const f=h(e,["updateTime"]);f!=null&&g(n,["updateTime"],f);const m=h(e,["description"]);m!=null&&g(n,["description"],m);const _=h(e,["baseModel"]);_!=null&&g(n,["baseModel"],_);const b=h(e,["_self"]);return b!=null&&g(n,["tunedModel"],oO(b)),n}function Oh(e,t){const n={},a=h(e,["sdkHttpResponse"]);a!=null&&g(n,["sdkHttpResponse"],a);const s=h(e,["name"]);s!=null&&g(n,["name"],s);const o=h(e,["state"]);o!=null&&g(n,["state"],yw(o));const u=h(e,["createTime"]);u!=null&&g(n,["createTime"],u);const d=h(e,["startTime"]);d!=null&&g(n,["startTime"],d);const p=h(e,["endTime"]);p!=null&&g(n,["endTime"],p);const f=h(e,["updateTime"]);f!=null&&g(n,["updateTime"],f);const m=h(e,["error"]);m!=null&&g(n,["error"],m);const _=h(e,["description"]);_!=null&&g(n,["description"],_);const b=h(e,["baseModel"]);b!=null&&g(n,["baseModel"],b);const E=h(e,["tunedModel"]);E!=null&&g(n,["tunedModel"],E);const x=h(e,["preTunedModel"]);x!=null&&g(n,["preTunedModel"],x);const I=h(e,["supervisedTuningSpec"]);I!=null&&g(n,["supervisedTuningSpec"],I);const N=h(e,["preferenceOptimizationSpec"]);N!=null&&g(n,["preferenceOptimizationSpec"],N);const R=h(e,["tuningDataStats"]);R!=null&&g(n,["tuningDataStats"],R);const $=h(e,["encryptionSpec"]);$!=null&&g(n,["encryptionSpec"],$);const O=h(e,["partnerModelTuningSpec"]);O!=null&&g(n,["partnerModelTuningSpec"],O);const k=h(e,["customBaseModel"]);k!=null&&g(n,["customBaseModel"],k);const P=h(e,["experiment"]);P!=null&&g(n,["experiment"],P);const G=h(e,["labels"]);G!=null&&g(n,["labels"],G);const B=h(e,["outputUri"]);B!=null&&g(n,["outputUri"],B);const K=h(e,["pipelineJob"]);K!=null&&g(n,["pipelineJob"],K);const Y=h(e,["serviceAccount"]);Y!=null&&g(n,["serviceAccount"],Y);const se=h(e,["tunedModelDisplayName"]);se!=null&&g(n,["tunedModelDisplayName"],se);const ve=h(e,["veoTuningSpec"]);return ve!=null&&g(n,["veoTuningSpec"],ve),n}function uO(e,t){const n={},a=h(e,["sdkHttpResponse"]);a!=null&&g(n,["sdkHttpResponse"],a);const s=h(e,["name"]);s!=null&&g(n,["name"],s);const o=h(e,["metadata"]);o!=null&&g(n,["metadata"],o);const u=h(e,["done"]);u!=null&&g(n,["done"],u);const d=h(e,["error"]);return d!=null&&g(n,["error"],d),n}function E_(e,t){const n={},a=h(e,["gcsUri"]);a!=null&&g(n,["validationDatasetUri"],a);const s=h(e,["vertexDatasetResource"]);return s!=null&&g(n,["validationDatasetUri"],s),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cO extends Ma{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new uo($a.PAGED_ITEM_TUNING_JOBS,a=>this.listInternal(a),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var a;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const s={tunedModelName:n.baseModel};!((a=n.config)===null||a===void 0)&&a.preTunedModelCheckpointId&&(s.checkpointId=n.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},n),{preTunedModel:s});return o.baseModel=void 0,await this.tuneInternal(o)}else{const s=Object.assign({},n);return await this.tuneInternal(s)}else{const s=Object.assign({},n),o=await this.tuneMldevInternal(s);let u="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?u=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(u=o.name.split("/operations/")[0]),{name:u,state:Th.JOB_STATE_QUEUED}}}}async getInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=jM(t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>Oh(m))}else{const f=QM(t);return d=xe("{name}",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>tE(m))}}async listInternal(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=iO(t);return d=xe("tuningJobs",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=rO(m),b=new Jv;return Object.assign(b,_),b})}else{const f=nO(t);return d=xe("tunedModels",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=aO(m),b=new Jv;return Object.assign(b,_),b})}}async cancel(t){var n,a,s,o;let u,d="",p={};if(this.apiClient.isVertexAI()){const f=FM(t);return d=xe("{name}:cancel",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=WM(m),b=new Xv;return Object.assign(b,_),b})}else{const f=HM(t);return d=xe("{name}:cancel",f._url),p=f._query,delete f._url,delete f._query,u=this.apiClient.request({path:d,queryParams:p,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=t.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(_=>{const b=_;return b.sdkHttpResponse={headers:m.headers},b})),u.then(m=>{const _=YM(m),b=new Xv;return Object.assign(b,_),b})}}async tuneInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const d=ZM(t,t);return o=xe("tuningJobs",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>Oh(p))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var n,a;let s,o="",u={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=XM(t);return o=xe("tunedModels",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(a=t.config)===null||a===void 0?void 0:a.abortSignal}).then(p=>p.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:p.headers},m})),s.then(p=>uO(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dO{async download(t,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const fO=1024*1024*8,pO=3,hO=1e3,mO=2,Uc="x-goog-upload-status";async function gO(e,t,n){var a;const s=await nE(e,t,n),o=await(s==null?void 0:s.json());if(((a=s==null?void 0:s.headers)===null||a===void 0?void 0:a[Uc])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function yO(e,t,n){var a;const s=await nE(e,t,n),o=await(s==null?void 0:s.json());if(((a=s==null?void 0:s.headers)===null||a===void 0?void 0:a[Uc])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const u=dw(o),d=new jh;return Object.assign(d,u),d}async function nE(e,t,n){var a,s;let o=0,u=0,d=new wh(new Response),p="upload";for(o=e.size;u<o;){const f=Math.min(fO,o-u),m=e.slice(u,u+f);u+f>=o&&(p+=", finalize");let _=0,b=hO;for(;_<pO&&(d=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(u),"Content-Length":String(f)}}}),!(!((a=d==null?void 0:d.headers)===null||a===void 0)&&a[Uc]));)_++,await _O(b),b=b*mO;if(u+=f,((s=d==null?void 0:d.headers)===null||s===void 0?void 0:s[Uc])!=="active")break;if(o<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function vO(e){return{size:e.size,type:e.type}}function _O(e){return new Promise(t=>setTimeout(t,e))}class bO{async upload(t,n,a){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await gO(t,n,a)}async uploadToFileSearchStore(t,n,a){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await yO(t,n,a)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await vO(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class TO{create(t,n,a){return new wO(t,n,a)}}class wO{constructor(t,n,a){this.url=t,this.headers=n,this.callbacks=a}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const S_="x-goog-api-key";class EO{constructor(t){this.apiKey=t}async addAuthHeaders(t,n){if(t.get(S_)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(S_,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const SO="gl-node/";class xO{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new wn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=n.interactions,this._interactions}constructor(t){var n;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=t.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=t.apiKey;const a=_A(t.httpOptions,t.vertexai,void 0,void 0);a&&(t.httpOptions?t.httpOptions.baseUrl=a:t.httpOptions={baseUrl:a}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const s=new EO(this.apiKey);this.apiClient=new v3({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:SO+"web",uploader:new bO,downloader:new dO}),this.models=new L3(this.apiClient),this.live=new $3(this.apiClient,s,new TO),this.batches=new KI(this.apiClient),this.chats=new RR(this.models,this.apiClient),this.caches=new CR(this.apiClient),this.files=new PR(this.apiClient),this.operations=new U3(this.apiClient),this.authTokens=new eM(this.apiClient),this.tunings=new cO(this.apiClient),this.fileSearchStores=new lM(this.apiClient)}}/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CO=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iE=(...e)=>e.filter((t,n,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var AO={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IO=We.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:s="",children:o,iconNode:u,...d},p)=>We.createElement("svg",{ref:p,...AO,width:t,height:t,stroke:e,strokeWidth:a?Number(n)*24/Number(t):n,className:iE("lucide",s),...d},[...u.map(([f,m])=>We.createElement(f,m)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=(e,t)=>{const n=We.forwardRef(({className:a,...s},o)=>We.createElement(IO,{ref:o,iconNode:t,className:iE(`lucide-${CO(e)}`,a),...s}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=en("Binary",[["rect",{x:"14",y:"14",width:"4",height:"6",rx:"2",key:"p02svl"}],["rect",{x:"6",y:"4",width:"4",height:"6",rx:"2",key:"xm4xkj"}],["path",{d:"M6 20h4",key:"1i6q5t"}],["path",{d:"M14 10h4",key:"ru81e7"}],["path",{d:"M6 14h2v6",key:"16z9wg"}],["path",{d:"M14 4h2v6",key:"1idq9u"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=en("BrainCircuit",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_=en("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RO=en("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NO=en("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $O=en("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MO=en("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OO=en("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DO=en("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_=en("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=en("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zO=en("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=en("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UO=en("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PO=en("Signal",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_=en("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BO=en("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_=en("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GO=en("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VO=en("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qO=en("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $_=en("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var sm=Object.defineProperty,HO=Object.getOwnPropertyDescriptor,FO=Object.getOwnPropertyNames,YO=Object.prototype.hasOwnProperty,WO=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),be=(e,t)=>()=>(e&&(t=e(e=0)),t),fs=(e,t)=>{for(var n in t)sm(e,n,{get:t[n],enumerable:!0})},KO=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of FO(t))!YO.call(e,s)&&s!==n&&sm(e,s,{get:()=>t[s],enumerable:!(a=HO(t,s))||a.enumerable});return e},Bl=e=>KO(sm({},"__esModule",{value:!0}),e),El,yr,ns,M_,aE,rE=be(()=>{El=new Map,yr=[],ns=(e,t,n)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let a=El.get(e);if(a===void 0)El.set(e,{backend:t,priority:n});else{if(a.priority>n)return;if(a.priority===n&&a.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${n}`)}if(n>=0){let s=yr.indexOf(e);s!==-1&&yr.splice(s,1);for(let o=0;o<yr.length;o++)if(El.get(yr[o]).priority<=n){yr.splice(o,0,e);return}yr.push(e)}return}throw new TypeError("not a valid backend")},M_=async e=>{let t=El.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let n=!!t.initPromise;try{return n||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(a){return n||(t.error=`${a}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},aE=async e=>{let t=e.executionProviders||[],n=t.map(p=>typeof p=="string"?p:p.name),a=n.length===0?yr:n,s,o=[],u=new Set;for(let p of a){let f=await M_(p);typeof f=="string"?o.push({name:p,err:f}):(s||(s=f),s===f&&u.add(p))}if(!s)throw new Error(`no available backend found. ERR: ${o.map(p=>`[${p.name}] ${p.err}`).join(", ")}`);for(let{name:p,err:f}of o)n.includes(p)&&console.warn(`removing requested execution provider "${p}" from session options because it is not available: ${f}`);let d=t.filter(p=>u.has(typeof p=="string"?p:p.name));return[s,new Proxy(e,{get:(p,f)=>f==="executionProviders"?d:Reflect.get(p,f)})]}}),JO=be(()=>{rE()}),oE,XO=be(()=>{oE="1.23.2"}),wp,bn,sE=be(()=>{XO(),wp="warning",bn={wasm:{},webgl:{},webgpu:{},versions:{common:oE},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);wp=e}},get logLevel(){return wp}},Object.defineProperty(bn,"logLevel",{enumerable:!0})}),Mt,ZO=be(()=>{sE(),Mt=bn}),lE,uE,QO=be(()=>{lE=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=e.dims[3],n.height=e.dims[2];let a=n.getContext("2d");if(a!=null){let s,o;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[3]):(s=e.dims[3],o=e.dims[2]);let u=(t==null?void 0:t.format)!==void 0?t.format:"RGB",d=t==null?void 0:t.norm,p,f;d===void 0||d.mean===void 0?p=[255,255,255,255]:typeof d.mean=="number"?p=[d.mean,d.mean,d.mean,d.mean]:(p=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(p[3]=d.mean[3])),d===void 0||d.bias===void 0?f=[0,0,0,0]:typeof d.bias=="number"?f=[d.bias,d.bias,d.bias,d.bias]:(f=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(f[3]=d.bias[3]));let m=o*s,_=0,b=m,E=m*2,x=-1;u==="RGBA"?(_=0,b=m,E=m*2,x=m*3):u==="RGB"?(_=0,b=m,E=m*2):u==="RBG"&&(_=0,E=m,b=m*2);for(let I=0;I<o;I++)for(let N=0;N<s;N++){let R=(e.data[_++]-f[0])*p[0],$=(e.data[b++]-f[1])*p[1],O=(e.data[E++]-f[2])*p[2],k=x===-1?255:(e.data[x++]-f[3])*p[3];a.fillStyle="rgba("+R+","+$+","+O+","+k+")",a.fillRect(N,I,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},uE=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),a;if(n!=null){let s,o,u;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(s=e.dims[2],o=e.dims[1],u=e.dims[3]):(s=e.dims[3],o=e.dims[2],u=e.dims[1]);let d=t!==void 0&&t.format!==void 0?t.format:"RGB",p=t==null?void 0:t.norm,f,m;p===void 0||p.mean===void 0?f=[255,255,255,255]:typeof p.mean=="number"?f=[p.mean,p.mean,p.mean,p.mean]:(f=[p.mean[0],p.mean[1],p.mean[2],255],p.mean[3]!==void 0&&(f[3]=p.mean[3])),p===void 0||p.bias===void 0?m=[0,0,0,0]:typeof p.bias=="number"?m=[p.bias,p.bias,p.bias,p.bias]:(m=[p.bias[0],p.bias[1],p.bias[2],0],p.bias[3]!==void 0&&(m[3]=p.bias[3]));let _=o*s;if(t!==void 0&&(t.format!==void 0&&u===4&&t.format!=="RGBA"||u===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let b=4,E=0,x=1,I=2,N=3,R=0,$=_,O=_*2,k=-1;d==="RGBA"?(R=0,$=_,O=_*2,k=_*3):d==="RGB"?(R=0,$=_,O=_*2):d==="RBG"&&(R=0,O=_,$=_*2),a=n.createImageData(s,o);for(let P=0;P<o*s;E+=b,x+=b,I+=b,N+=b,P++)a.data[E]=(e.data[R++]-m[0])*f[0],a.data[x]=(e.data[$++]-m[1])*f[1],a.data[I]=(e.data[O++]-m[2])*f[2],a.data[N]=k===-1?255:(e.data[k++]-m[3])*f[3]}else throw new Error("Can not access image data");return a}}),gc,cE,dE,fE,pE,hE,jO=be(()=>{lm(),gc=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:a}=t,s=t.norm??{mean:255,bias:0},o,u;typeof s.mean=="number"?o=[s.mean,s.mean,s.mean,s.mean]:o=[s.mean[0],s.mean[1],s.mean[2],s.mean[3]??255],typeof s.bias=="number"?u=[s.bias,s.bias,s.bias,s.bias]:u=[s.bias[0],s.bias[1],s.bias[2],s.bias[3]??0];let d=t.format!==void 0?t.format:"RGBA",p=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",f=n*a,m=p==="RGBA"?new Float32Array(f*4):new Float32Array(f*3),_=4,b=0,E=1,x=2,I=3,N=0,R=f,$=f*2,O=-1;d==="RGB"&&(_=3,b=0,E=1,x=2,I=-1),p==="RGBA"?O=f*3:p==="RBG"?(N=0,$=f,R=f*2):p==="BGR"&&($=0,R=f,N=f*2);for(let k=0;k<f;k++,b+=_,x+=_,E+=_,I+=_)m[N++]=(e[b]+u[0])/o[0],m[R++]=(e[E]+u[1])/o[1],m[$++]=(e[x]+u[2])/o[2],O!==-1&&I!==-1&&(m[O++]=(e[I]+u[3])/o[3]);return p==="RGBA"?new di("float32",m,[1,4,n,a]):new di("float32",m,[1,3,n,a])},cE=async(e,t)=>{let n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,a=typeof ImageData<"u"&&e instanceof ImageData,s=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",u,d=t??{},p=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(n){let m=p();m.width=e.width,m.height=e.height;let _=f(m);if(_!=null){let b=e.height,E=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(b=t.resizedHeight,E=t.resizedWidth),t!==void 0){if(d=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=b,d.width=E}else d.tensorFormat="RGBA",d.height=b,d.width=E;_.drawImage(e,0,0),u=_.getImageData(0,0,E,b).data}else throw new Error("Can not access image data")}else if(a){let m,_;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(m=t.resizedHeight,_=t.resizedWidth):(m=e.height,_=e.width),t!==void 0&&(d=t),d.format="RGBA",d.height=m,d.width=_,t!==void 0){let b=p();b.width=_,b.height=m;let E=f(b);if(E!=null)E.putImageData(e,0,0),u=E.getImageData(0,0,_,m).data;else throw new Error("Can not access image data")}else u=e.data}else if(s){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let m=p();m.width=e.width,m.height=e.height;let _=f(m);if(_!=null){let b=e.height,E=e.width;return _.drawImage(e,0,0,E,b),u=_.getImageData(0,0,E,b).data,d.height=b,d.width=E,gc(u,d)}else throw new Error("Can not access image data")}else{if(o)return new Promise((m,_)=>{let b=p(),E=f(b);if(!e||!E)return _();let x=new Image;x.crossOrigin="Anonymous",x.src=e,x.onload=()=>{b.width=x.width,b.height=x.height,E.drawImage(x,0,0,b.width,b.height);let I=E.getImageData(0,0,b.width,b.height);d.height=b.height,d.width=b.width,m(gc(I.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(u!==void 0)return gc(u,d);throw new Error("Input data provided is not supported - aborted tensor creation")},dE=(e,t)=>{let{width:n,height:a,download:s,dispose:o}=t,u=[1,a,n,4];return new di({location:"texture",type:"float32",texture:e,dims:u,download:s,dispose:o})},fE=(e,t)=>{let{dataType:n,dims:a,download:s,dispose:o}=t;return new di({location:"gpu-buffer",type:n??"float32",gpuBuffer:e,dims:a,download:s,dispose:o})},pE=(e,t)=>{let{dataType:n,dims:a,download:s,dispose:o}=t;return new di({location:"ml-tensor",type:n??"float32",mlTensor:e,dims:a,download:s,dispose:o})},hE=(e,t,n)=>new di({location:"cpu-pinned",type:e,data:t,dims:n??[t.length]})}),to,kl,Ep,mE,eD=be(()=>{to=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),kl=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Ep=!1,mE=()=>{if(!Ep){Ep=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,a=typeof n<"u"&&n.from;e&&(to.set("int64",BigInt64Array),kl.set(BigInt64Array,"int64")),t&&(to.set("uint64",BigUint64Array),kl.set(BigUint64Array,"uint64")),a?(to.set("float16",n),kl.set(n,"float16")):to.set("float16",Uint16Array)}}}),gE,yE,tD=be(()=>{lm(),gE=e=>{let t=1;for(let n=0;n<e.length;n++){let a=e[n];if(typeof a!="number"||!Number.isSafeInteger(a))throw new TypeError(`dims[${n}] must be an integer, got: ${a}`);if(a<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${a}`);t*=a}return t},yE=(e,t)=>{switch(e.location){case"cpu":return new di(e.type,e.data,t);case"cpu-pinned":return new di({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new di({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new di({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new di({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),di,lm=be(()=>{QO(),jO(),eD(),tD(),di=class{constructor(e,t,n){mE();let a,s;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,a=e.type,s=e.dims,e.location){case"cpu-pinned":{let u=to.get(a);if(!u)throw new TypeError(`unsupported type "${a}" to create tensor from pinned buffer`);if(!(e.data instanceof u))throw new TypeError(`buffer should be of type ${u.name}`);this.cpuData=e.data;break}case"texture":{if(a!=="float32")throw new TypeError(`unsupported type "${a}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(a!=="float32"&&a!=="float16"&&a!=="int32"&&a!=="int64"&&a!=="uint32"&&a!=="uint64"&&a!=="int8"&&a!=="uint8"&&a!=="bool"&&a!=="uint4"&&a!=="int4")throw new TypeError(`unsupported type "${a}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let u,d;if(typeof e=="string")if(a=e,d=n,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");u=t}else{let p=to.get(e);if(p===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&p===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${p.name} as data.`);e==="uint64"||e==="int64"?u=p.from(t,BigInt):u=p.from(t)}else if(t instanceof p)u=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")u=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&p!==Uint16Array)u=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${a} tensor's data must be type of ${p}`)}else if(d=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let p=typeof e[0];if(p==="string")a="string",u=e;else if(p==="boolean")a="bool",u=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${p}.`)}else if(e instanceof Uint8ClampedArray)a="uint8",u=Uint8Array.from(e);else{let p=kl.get(e.constructor);if(p===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);a=p,u=e}if(d===void 0)d=[u.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");s=d,this.cpuData=u,this.dataLocation="cpu"}let o=gE(s);if(this.cpuData&&o!==this.cpuData.length&&!((a==="uint4"||a==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=a,this.dims=s,this.size=o}static async fromImage(e,t){return cE(e,t)}static fromTexture(e,t){return dE(e,t)}static fromGpuBuffer(e,t){return fE(e,t)}static fromMLTensor(e,t){return pE(e,t)}static fromPinnedBuffer(e,t,n){return hE(e,t,n)}toDataURL(e){return lE(this,e)}toImageData(e){return uE(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return yE(this,e)}}}),Si,vE=be(()=>{lm(),Si=di}),Pc,Sp,sa,Ki,ao,ro,_E=be(()=>{sE(),Pc=(e,t)=>{(typeof bn.trace>"u"?!bn.wasm.trace:!bn.trace)||console.timeStamp(`${e}::ORT::${t}`)},Sp=(e,t)=>{var s;let n=((s=new Error().stack)==null?void 0:s.split(/\r\n|\r|\n/g))||[],a=!1;for(let o=0;o<n.length;o++){if(a&&!n[o].includes("TRACE_FUNC")){let u=`FUNC_${e}::${n[o].trim().split(" ")[1]}`;t&&(u+=`::${t}`),Pc("CPU",u);return}n[o].includes("TRACE_FUNC")&&(a=!0)}},sa=e=>{(typeof bn.trace>"u"?!bn.wasm.trace:!bn.trace)||Sp("BEGIN",e)},Ki=e=>{(typeof bn.trace>"u"?!bn.wasm.trace:!bn.trace)||Sp("END",e)},ao=e=>{(typeof bn.trace>"u"?!bn.wasm.trace:!bn.trace)||console.time(`ORT::${e}`)},ro=e=>{(typeof bn.trace>"u"?!bn.wasm.trace:!bn.trace)||console.timeEnd(`ORT::${e}`)}}),bE,nD=be(()=>{rE(),vE(),_E(),bE=class TE{constructor(t){this.handler=t}async run(t,n,a){sa(),ao("InferenceSession.run");let s={},o={};if(typeof t!="object"||t===null||t instanceof Si||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let u=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof Si)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");u=!1;for(let f of n){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);s[f]=null}if(typeof a=="object"&&a!==null)o=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else{let f=!1,m=Object.getOwnPropertyNames(n);for(let _ of this.outputNames)if(m.indexOf(_)!==-1){let b=n[_];(b===null||b instanceof Si)&&(f=!0,u=!1,s[_]=b)}if(f){if(typeof a=="object"&&a!==null)o=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else o=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let f of this.inputNames)if(typeof t[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(u)for(let f of this.outputNames)s[f]=null;let d=await this.handler.run(t,s,o),p={};for(let f in d)if(Object.hasOwnProperty.call(d,f)){let m=d[f];m instanceof Si?p[f]=m:p[f]=new Si(m.type,m.data,m.dims)}return ro("InferenceSession.run"),Ki(),p}async release(){return this.handler.dispose()}static async create(t,n,a,s){sa(),ao("InferenceSession.create");let o,u={};if(typeof t=="string"){if(o=t,typeof n=="object"&&n!==null)u=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof n=="object"&&n!==null)u=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let m=t,_=0,b=t.byteLength;if(typeof n=="object"&&n!==null)u=n;else if(typeof n=="number"){if(_=n,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(b=t.byteLength-_,typeof a=="number"){if(b=a,!Number.isSafeInteger(b))throw new RangeError("'byteLength' must be an integer.");if(b<=0||_+b>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-_}].`);if(typeof s=="object"&&s!==null)u=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(typeof a<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(m,_,b)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,p]=await aE(u),f=await d.createInferenceSessionHandler(o,p);return ro("InferenceSession.create"),Ki(),new TE(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Bc,iD=be(()=>{nD(),Bc=bE}),aD=be(()=>{}),rD=be(()=>{}),oD=be(()=>{}),sD=be(()=>{}),lD={};fs(lD,{InferenceSession:()=>Bc,TRACE:()=>Pc,TRACE_EVENT_BEGIN:()=>ao,TRACE_EVENT_END:()=>ro,TRACE_FUNC_BEGIN:()=>sa,TRACE_FUNC_END:()=>Ki,Tensor:()=>Si,env:()=>Mt,registerBackend:()=>ns});var Ai=be(()=>{JO(),ZO(),iD(),vE(),aD(),rD(),_E(),oD(),sD()}),um=be(()=>{}),wE={};fs(wE,{default:()=>EE});var xp,Cp,EE,uD=be(()=>{var e;I2(),co(),cm(),xp="ort-wasm-proxy-worker",Cp=((e=globalThis.self)==null?void 0:e.name)===xp,Cp&&(self.onmessage=t=>{let{type:n,in:a}=t.data;try{switch(n){case"init-wasm":dm(a.wasm).then(()=>{Im(a).then(()=>{postMessage({type:n})},s=>{postMessage({type:n,err:s})})},s=>{postMessage({type:n,err:s})});break;case"init-ep":{let{epName:s,env:o}=a;Rm(o,s).then(()=>{postMessage({type:n})},u=>{postMessage({type:n,err:u})});break}case"copy-from":{let{buffer:s}=a,o=Wc(s);postMessage({type:n,out:o});break}case"create":{let{model:s,options:o}=a;Nm(s,o).then(u=>{postMessage({type:n,out:u})},u=>{postMessage({type:n,err:u})});break}case"release":$m(a),postMessage({type:n});break;case"run":{let{sessionId:s,inputIndices:o,inputs:u,outputIndices:d,options:p}=a;Mm(s,o,u,d,new Array(d.length).fill(null),p).then(f=>{f.some(m=>m[3]!=="cpu")?postMessage({type:n,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:n,out:f},Dm([...u,...f]))},f=>{postMessage({type:n,err:f})});break}case"end-profiling":Om(a),postMessage({type:n});break;default:}}catch(s){postMessage({type:n,err:s})}}),EE=Cp?null:t=>new Worker(t??ci,{type:"module",name:xp})}),SE={};fs(SE,{default:()=>xE});var Ap,xE,O_,cD=be(()=>{var e,t;Ap=async function(n={}){var Bs;var a,s,o=n,u=new Promise((v,w)=>{a=v,s=w}),d=typeof window=="object",p=typeof WorkerGlobalScope<"u",f=p&&((Bs=self.name)==null?void 0:Bs.startsWith("em-pthread"));o.mountExternalData=(v,w)=>{v.startsWith("./")&&(v=v.substring(2)),(o.Fb||(o.Fb=new Map)).set(v,w)},o.unmountExternalData=()=>{delete o.Fb};var m=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let _=v=>async(...w)=>{var S;try{if(o.Gb)throw Error("Session already started");let A=o.Gb={ec:w[0],errors:[]},M=await v(...w);if(o.Gb!==A)throw Error("Session mismatch");(S=o.Kb)==null||S.flush();let U=A.errors;if(0<U.length){let W=await Promise.all(U);if(W=W.filter(ne=>ne),0<W.length)throw Error(W.join(`
`))}return M}finally{o.Gb=null}};o.jsepInit=(v,w)=>{if(v==="webgpu"){[o.Kb,o.Vb,o.Zb,o.Lb,o.Yb,o.Ab,o.$b,o.bc,o.Wb,o.Xb,o.ac]=w;let S=o.Kb;o.jsepRegisterBuffer=(A,M,U,W)=>S.registerBuffer(A,M,U,W),o.jsepGetBuffer=A=>S.getBuffer(A),o.jsepCreateDownloader=(A,M,U)=>S.createDownloader(A,M,U),o.jsepOnCreateSession=A=>{S.onCreateSession(A)},o.jsepOnReleaseSession=A=>{S.onReleaseSession(A)},o.jsepOnRunStart=A=>S.onRunStart(A),o.cc=(A,M)=>{S.upload(A,M)}}else if(v==="webnn"){let S=w[0];[o.oc,o.Ob,o.webnnEnsureTensor,o.Pb,o.webnnDownloadTensor,o.nc,o.webnnEnableTraceEvent]=w.slice(1),o.webnnReleaseTensorId=o.Ob,o.webnnUploadTensor=o.Pb,o.webnnRegisterMLContext=o.nc,o.webnnOnRunStart=A=>S.onRunStart(A),o.webnnOnRunEnd=S.onRunEnd.bind(S),o.webnnOnReleaseSession=A=>{S.onReleaseSession(A)},o.webnnCreateMLTensorDownloader=(A,M)=>S.createMLTensorDownloader(A,M),o.webnnRegisterMLTensor=(A,M,U,W)=>S.registerMLTensor(A,M,U,W),o.webnnCreateMLContext=A=>S.createMLContext(A),o.webnnRegisterMLConstant=(A,M,U,W,ne,he)=>S.registerMLConstant(A,M,U,W,ne,o.Fb,he),o.webnnRegisterGraphInput=S.registerGraphInput.bind(S),o.webnnIsGraphInput=S.isGraphInput.bind(S),o.webnnRegisterGraphOutput=S.registerGraphOutput.bind(S),o.webnnIsGraphOutput=S.isGraphOutput.bind(S),o.webnnCreateTemporaryTensor=S.createTemporaryTensor.bind(S),o.webnnIsGraphInputOutputTypeSupported=S.isGraphInputOutputTypeSupported.bind(S)}};let b=()=>{let v=(w,S,A)=>(...M)=>{let U=Sn,W=S==null?void 0:S();M=w(...M);let ne=S==null?void 0:S();return W!==ne&&(w=ne,A(W),S=A=null),Sn!=U?new Promise((he,Te)=>{Ir={resolve:he,reject:Te}}):M};(()=>{for(let w of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])o[w]=v(o[w],()=>o[w],S=>o[w]=S)})(),_!==void 0&&(o._OrtRun=_(o._OrtRun),o._OrtRunWithBinding=_(o._OrtRunWithBinding)),b=void 0};o.asyncInit=()=>{b==null||b()};var E,x,I=(v,w)=>{throw w},N=import.meta.url,R="";if(d||p){try{R=new URL(".",N).href}catch{}p&&(x=v=>{var w=new XMLHttpRequest;return w.open("GET",v,!1),w.responseType="arraybuffer",w.send(null),new Uint8Array(w.response)}),E=async v=>{if(q(v))return new Promise((S,A)=>{var M=new XMLHttpRequest;M.open("GET",v,!0),M.responseType="arraybuffer",M.onload=()=>{M.status==200||M.status==0&&M.response?S(M.response):A(M.status)},M.onerror=A,M.send(null)});var w=await fetch(v,{credentials:"same-origin"});if(w.ok)return w.arrayBuffer();throw Error(w.status+" : "+w.url)}}var $,O,k,P,G,B,K,Y,se,ve,_e,ge,$e,Ae,H,j=console.log.bind(console),fe=console.error.bind(console),Ee=j,Ie=fe,z=!1,q=v=>v.startsWith("file://");function te(){return O.buffer!=G.buffer&&nt(),G}function de(){return O.buffer!=G.buffer&&nt(),B}function Me(){return O.buffer!=G.buffer&&nt(),K}function Fe(){return O.buffer!=G.buffer&&nt(),Y}function oe(){return O.buffer!=G.buffer&&nt(),se}function Be(){return O.buffer!=G.buffer&&nt(),ve}function je(){return O.buffer!=G.buffer&&nt(),_e}function Pt(){return O.buffer!=G.buffer&&nt(),Ae}if(f){let v=function(w){try{var S=w.data,A=S.Db;if(A==="load"){let M=[];self.onmessage=U=>M.push(U),self.startWorker=()=>{postMessage({Db:"loaded"});for(let U of M)v(U);self.onmessage=v};for(let U of S.Sb)o[U]&&!o[U].proxy||(o[U]=(...W)=>{postMessage({Db:"callHandler",Rb:U,args:W})},U=="print"&&(Ee=o[U]),U=="printErr"&&(Ie=o[U]));O=S.kc,nt(),H(S.lc)}else if(A==="run"){ie(S.Bb),xn(S.Bb,0,0,1,0,0),dn(),mo(S.Bb),cn||(du(),cn=!0);try{we(S.hc,S.Jb)}catch(M){if(M!="unwind")throw M}}else S.target!=="setimmediate"&&(A==="checkMailbox"?cn&&Cr():A&&(Ie(`worker: received unknown command ${A}`),Ie(S)))}catch(M){throw Ka(),M}};var cn=!1;self.onunhandledrejection=w=>{throw w.reason||w},self.onmessage=v}function nt(){var v=O.buffer;o.HEAP8=G=new Int8Array(v),K=new Int16Array(v),o.HEAPU8=B=new Uint8Array(v),Y=new Uint16Array(v),o.HEAP32=se=new Int32Array(v),o.HEAPU32=ve=new Uint32Array(v),_e=new Float32Array(v),Ae=new Float64Array(v),ge=new BigInt64Array(v),$e=new BigUint64Array(v)}function yt(){f?startWorker(o):le.Da()}var Bt,ei=0,Ot=null;function pi(){if(--ei==0&&Ot){var v=Ot;Ot=null,v()}}function Dt(v){throw Ie(v="Aborted("+v+")"),z=!0,v=new WebAssembly.RuntimeError(v+". Build with -sASSERTIONS for more info."),s(v),v}function Nn(){return{a:{L:uu,Aa:lu,b:Ye,$:Ft,A:Yt,pa:Rt,X:Wt,Z:gn,qa:la,na:mi,ga:Ua,ma:ye,J:zt,Y:at,V:Ue,oa:$n,W:Nt,va:Ke,E:Pa,Q:Zt,O:ad,D:ql,v:rd,s:po,P:Fn,z:ms,R:Fl,ja:gs,T:Ga,aa:Yl,M:Wl,F:vs,ia:mo,sa:ld,r:Mi,Ca:_s,w:ws,o:Kl,m:Jl,c:Kt,Ba:Dn,n:vo,j:Es,u:Ss,p:$r,f:_o,t:Xl,l:cd,e:dd,k:fd,h:xs,g:pd,d:hd,da:md,ea:gd,fa:yd,ba:jl,ca:eu,N:tu,xa:_d,ua:bd,i:Td,C:wd,G:Ed,ta:nu,x:Sd,ra:xd,U:Cd,q:vd,y:Is,K:Mr,S:Ad,za:au,ya:ru,ka:su,la:$s,_:Ri,B:Ms,I:Ya,ha:Wa,H:Dr,a:O,wa:La}}}class tn{constructor(w){z0(this,"name","ExitStatus");this.message=`Program terminated with exit(${w})`,this.status=w}}var Ii=v=>{v.terminate(),v.onmessage=()=>{}},ka=[],za=v=>{ti.length==0&&(fn(),Hn(ti[0]));var w=ti.pop();if(!w)return 6;Xi.push(w),hi[v.Bb]=w,w.Bb=v.Bb;var S={Db:"run",hc:v.fc,Jb:v.Jb,Bb:v.Bb};return w.postMessage(S,v.Nb),0},Gt=0,vt=(v,w,...S)=>{for(var A=2*S.length,M=fa(),U=Lr(8*A),W=U>>>3,ne=0;ne<S.length;ne++){var he=S[ne];typeof he=="bigint"?(ge[W+2*ne]=1n,ge[W+2*ne+1]=he):(ge[W+2*ne]=0n,Pt()[W+2*ne+1>>>0]=he)}return v=zs(v,0,A,U,w),zi(M),v};function La(v){if(f)return vt(0,1,v);if(P=v,!(0<Gt)){for(var w of Xi)Ii(w);for(w of ti)Ii(w);ti=[],Xi=[],hi={},z=!0}I(0,new tn(v))}function Sr(v){if(f)return vt(1,0,v);Ri(v)}var Ri=v=>{if(P=v,f)throw Sr(v),"unwind";La(v)},ti=[],Xi=[],xr=[],hi={},Ni=v=>{var w=v.Bb;delete hi[w],ti.push(v),Xi.splice(Xi.indexOf(v),1),v.Bb=0,Ls(w)};function dn(){xr.forEach(v=>v())}var Hn=v=>new Promise(w=>{v.onmessage=M=>{var U=(M=M.data).Db;if(M.Hb&&M.Hb!=ks()){var W=hi[M.Hb];W?W.postMessage(M,M.Nb):Ie(`Internal error! Worker sent a message "${U}" to target pthread ${M.Hb}, but that thread no longer exists!`)}else U==="checkMailbox"?Cr():U==="spawnThread"?za(M):U==="cleanupThread"?Ni(hi[M.ic]):U==="loaded"?(v.loaded=!0,w(v)):M.target==="setimmediate"?v.postMessage(M):U==="callHandler"?o[M.Rb](...M.args):U&&Ie(`worker sent an unknown command ${U}`)},v.onerror=M=>{throw Ie(`worker sent an error! ${M.filename}:${M.lineno}: ${M.message}`),M};var S,A=[];for(S of[])o.propertyIsEnumerable(S)&&A.push(S);v.postMessage({Db:"load",Sb:A,kc:O,lc:k})});function fn(){var v=new Worker((()=>{let w=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new w("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ti.push(v)}var ie=v=>{nt();var w=Be()[v+52>>>2>>>0];v=Be()[v+56>>>2>>>0],fu(w,w-v),zi(w)},we=(v,w)=>{Gt=0,v=Eo(v,w),0<Gt?P=v:To(v)};class J{constructor(w){this.Ib=w-24}}function Ye(v,w,S){var A=new J(v>>>=0);throw w>>>=0,S>>>=0,Be()[A.Ib+16>>>2>>>0]=0,Be()[A.Ib+4>>>2>>>0]=w,Be()[A.Ib+8>>>2>>>0]=S,v}function kt(v,w,S,A){return f?vt(2,1,v,w,S,A):Ft(v,w,S,A)}function Ft(v,w,S,A){if(v>>>=0,S>>>=0,A>>>=0,m===void 0)return 6;var M=[];return f&&M.length===0?kt(v,w>>>=0,S,A):(v={fc:S,Bb:v,Jb:A,Nb:M},f?(v.Db="spawnThread",postMessage(v,M),0):za(v))}var Et=typeof TextDecoder<"u"?new TextDecoder:void 0,De=(v,w=0,S=NaN)=>{var A=(w>>>=0)+S;for(S=w;v[S]&&!(S>=A);)++S;if(16<S-w&&v.buffer&&Et)return Et.decode(v.buffer instanceof ArrayBuffer?v.subarray(w,S):v.slice(w,S));for(A="";w<S;){var M=v[w++];if(128&M){var U=63&v[w++];if((224&M)==192)A+=String.fromCharCode((31&M)<<6|U);else{var W=63&v[w++];65536>(M=(240&M)==224?(15&M)<<12|U<<6|W:(7&M)<<18|U<<12|W<<6|63&v[w++])?A+=String.fromCharCode(M):(M-=65536,A+=String.fromCharCode(55296|M>>10,56320|1023&M))}}else A+=String.fromCharCode(M)}return A},Le=(v,w)=>(v>>>=0)?De(de(),v,w):"";function Yt(v,w,S){return f?vt(3,1,v,w,S):0}function Rt(v,w){if(f)return vt(4,1,v,w)}function Wt(v,w){if(f)return vt(5,1,v,w)}function gn(v,w,S){if(f)return vt(6,1,v,w,S)}function la(v,w,S){return f?vt(7,1,v,w,S):0}function mi(v,w){if(f)return vt(8,1,v,w)}function Ua(v,w,S){if(f)return vt(9,1,v,w,S)}function ye(v,w,S,A){if(f)return vt(10,1,v,w,S,A)}function zt(v,w,S,A){if(f)return vt(11,1,v,w,S,A)}function at(v,w,S,A){if(f)return vt(12,1,v,w,S,A)}function Ue(v){if(f)return vt(13,1,v)}function $n(v,w){if(f)return vt(14,1,v,w)}function Nt(v,w,S){if(f)return vt(15,1,v,w,S)}var qe,Ke=()=>Dt(""),et=v=>{for(var w="";de()[v>>>0];)w+=qe[de()[v++>>>0]];return w},Xt={},Mn={},On=o.BindingError=class extends Error{constructor(v){super(v),this.name="BindingError"}};function pn(v,w,S={}){return(function(A,M,U={}){var W=M.name;if(!A)throw new On(`type "${W}" must have a positive integer typeid pointer`);if(Mn.hasOwnProperty(A)){if(U.Tb)return;throw new On(`Cannot register type '${W}' twice`)}Mn[A]=M,Xt.hasOwnProperty(A)&&(M=Xt[A],delete Xt[A],M.forEach(ne=>ne()))})(v,w,S)}var Zi=(v,w,S)=>{switch(w){case 1:return S?A=>te()[A>>>0]:A=>de()[A>>>0];case 2:return S?A=>Me()[A>>>1>>>0]:A=>Fe()[A>>>1>>>0];case 4:return S?A=>oe()[A>>>2>>>0]:A=>Be()[A>>>2>>>0];case 8:return S?A=>ge[A>>>3]:A=>$e[A>>>3];default:throw new TypeError(`invalid integer width (${w}): ${v}`)}};function Pa(v,w,S){S>>>=0,pn(v>>>=0,{name:w=et(w>>>0),fromWireType:A=>A,toWireType:function(A,M){if(typeof M!="bigint"&&typeof M!="number")throw M=M===null?"null":(A=typeof M)=="object"||A==="array"||A==="function"?M.toString():""+M,new TypeError(`Cannot convert "${M}" to ${this.name}`);return typeof M=="number"&&(M=BigInt(M)),M},Cb:St,readValueFromPointer:Zi(w,S,w.indexOf("u")==-1),Eb:null})}var St=8;function Zt(v,w,S,A){pn(v>>>=0,{name:w=et(w>>>0),fromWireType:function(M){return!!M},toWireType:function(M,U){return U?S:A},Cb:St,readValueFromPointer:function(M){return this.fromWireType(de()[M>>>0])},Eb:null})}var yn=[],En=[];function Kt(v){9<(v>>>=0)&&--En[v+1]==0&&(En[v]=void 0,yn.push(v))}var rn=v=>{if(!v)throw new On(`Cannot use deleted val. handle = ${v}`);return En[v]},Un=v=>{switch(v){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let w=yn.pop()||En.length;return En[w]=v,En[w+1]=1,w}};function $i(v){return this.fromWireType(Be()[v>>>2>>>0])}var Ba={name:"emscripten::val",fromWireType:v=>{var w=rn(v);return Kt(v),w},toWireType:(v,w)=>Un(w),Cb:St,readValueFromPointer:$i,Eb:null};function ad(v){return pn(v>>>0,Ba)}var Vl=(v,w)=>{switch(w){case 4:return function(S){return this.fromWireType(je()[S>>>2>>>0])};case 8:return function(S){return this.fromWireType(Pt()[S>>>3>>>0])};default:throw new TypeError(`invalid float width (${w}): ${v}`)}};function ql(v,w,S){S>>>=0,pn(v>>>=0,{name:w=et(w>>>0),fromWireType:A=>A,toWireType:(A,M)=>M,Cb:St,readValueFromPointer:Vl(w,S),Eb:null})}function rd(v,w,S,A,M){if(v>>>=0,S>>>=0,w=et(w>>>0),M===-1&&(M=4294967295),M=ne=>ne,A===0){var U=32-8*S;M=ne=>ne<<U>>>U}var W=w.includes("unsigned")?function(ne,he){return he>>>0}:function(ne,he){return he};pn(v,{name:w,fromWireType:M,toWireType:W,Cb:St,readValueFromPointer:Zi(w,S,A!==0),Eb:null})}function po(v,w,S){function A(U){var W=Be()[U>>>2>>>0];return U=Be()[U+4>>>2>>>0],new M(te().buffer,U,W)}var M=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][w];pn(v>>>=0,{name:S=et(S>>>0),fromWireType:A,Cb:St,readValueFromPointer:A},{Tb:!0})}var gi=(v,w,S)=>{var A=de();if(w>>>=0,0<S){var M=w;S=w+S-1;for(var U=0;U<v.length;++U){var W=v.charCodeAt(U);if(55296<=W&&57343>=W&&(W=65536+((1023&W)<<10)|1023&v.charCodeAt(++U)),127>=W){if(w>=S)break;A[w++>>>0]=W}else{if(2047>=W){if(w+1>=S)break;A[w++>>>0]=192|W>>6}else{if(65535>=W){if(w+2>=S)break;A[w++>>>0]=224|W>>12}else{if(w+3>=S)break;A[w++>>>0]=240|W>>18,A[w++>>>0]=128|W>>12&63}A[w++>>>0]=128|W>>6&63}A[w++>>>0]=128|63&W}}A[w>>>0]=0,v=w-M}else v=0;return v},ni=v=>{for(var w=0,S=0;S<v.length;++S){var A=v.charCodeAt(S);127>=A?w++:2047>=A?w+=2:55296<=A&&57343>=A?(w+=4,++S):w+=3}return w};function Fn(v,w){pn(v>>>=0,{name:w=et(w>>>0),fromWireType:function(S){for(var A,M=Be()[S>>>2>>>0],U=S+4,W=U,ne=0;ne<=M;++ne){var he=U+ne;ne!=M&&de()[he>>>0]!=0||(W=Le(W,he-W),A===void 0?A=W:(A+="\0",A+=W),W=he+1)}return ki(S),A},toWireType:function(S,A){A instanceof ArrayBuffer&&(A=new Uint8Array(A));var M=typeof A=="string";if(!(M||ArrayBuffer.isView(A)&&A.BYTES_PER_ELEMENT==1))throw new On("Cannot pass non-string to std::string");var U=M?ni(A):A.length,W=bo(4+U+1),ne=W+4;return Be()[W>>>2>>>0]=U,M?gi(A,ne,U+1):de().set(A,ne>>>0),S!==null&&S.push(ki,W),W},Cb:St,readValueFromPointer:$i,Eb(S){ki(S)}})}var ps=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,od=(v,w)=>{for(var S=v>>1,A=S+w/2;!(S>=A)&&Fe()[S>>>0];)++S;if(32<(S<<=1)-v&&ps)return ps.decode(de().slice(v,S));for(S="",A=0;!(A>=w/2);++A){var M=Me()[v+2*A>>>1>>>0];if(M==0)break;S+=String.fromCharCode(M)}return S},hs=(v,w,S)=>{if(S??(S=2147483647),2>S)return 0;var A=w;S=(S-=2)<2*v.length?S/2:v.length;for(var M=0;M<S;++M){var U=v.charCodeAt(M);Me()[w>>>1>>>0]=U,w+=2}return Me()[w>>>1>>>0]=0,w-A},Hl=v=>2*v.length,ho=(v,w)=>{for(var S=0,A="";!(S>=w/4);){var M=oe()[v+4*S>>>2>>>0];if(M==0)break;++S,65536<=M?(M-=65536,A+=String.fromCharCode(55296|M>>10,56320|1023&M)):A+=String.fromCharCode(M)}return A},sd=(v,w,S)=>{if(w>>>=0,S??(S=2147483647),4>S)return 0;var A=w;S=A+S-4;for(var M=0;M<v.length;++M){var U=v.charCodeAt(M);if(55296<=U&&57343>=U&&(U=65536+((1023&U)<<10)|1023&v.charCodeAt(++M)),oe()[w>>>2>>>0]=U,(w+=4)+4>S)break}return oe()[w>>>2>>>0]=0,w-A},Yn=v=>{for(var w=0,S=0;S<v.length;++S){var A=v.charCodeAt(S);55296<=A&&57343>=A&&++S,w+=4}return w};function ms(v,w,S){if(v>>>=0,w>>>=0,S=et(S>>>=0),w===2)var A=od,M=hs,U=Hl,W=ne=>Fe()[ne>>>1>>>0];else w===4&&(A=ho,M=sd,U=Yn,W=ne=>Be()[ne>>>2>>>0]);pn(v,{name:S,fromWireType:ne=>{for(var he,Te=Be()[ne>>>2>>>0],Se=ne+4,ze=0;ze<=Te;++ze){var Pe=ne+4+ze*w;ze!=Te&&W(Pe)!=0||(Se=A(Se,Pe-Se),he===void 0?he=Se:(he+="\0",he+=Se),Se=Pe+w)}return ki(ne),he},toWireType:(ne,he)=>{if(typeof he!="string")throw new On(`Cannot pass non-string to C++ string type ${S}`);var Te=U(he),Se=bo(4+Te+w);return Be()[Se>>>2>>>0]=Te/w,M(he,Se+4,Te+w),ne!==null&&ne.push(ki,Se),Se},Cb:St,readValueFromPointer:$i,Eb(ne){ki(ne)}})}function Fl(v,w){pn(v>>>=0,{Ub:!0,name:w=et(w>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function gs(v){xn(v>>>0,!p,1,!d,131072,!1),dn()}var Qi=v=>{if(!z)try{if(v(),!(0<Gt))try{f?To(P):Ri(P)}catch(w){w instanceof tn||w=="unwind"||I(0,w)}}catch(w){w instanceof tn||w=="unwind"||I(0,w)}};function mo(v){v>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(oe(),v>>>2,v).value.then(Cr),v+=128,Atomics.store(oe(),v>>>2,1))}var Cr=()=>{var v=ks();v&&(mo(v),Qi(wo))};function Ga(v,w){(v>>>=0)==w>>>0?setTimeout(Cr):f?postMessage({Hb:v,Db:"checkMailbox"}):(v=hi[v])&&v.postMessage({Db:"checkMailbox"})}var ys=[];function Yl(v,w,S,A,M){for(w>>>=0,A/=2,ys.length=A,S=M>>>0>>>3,M=0;M<A;M++)ys[M]=ge[S+2*M]?ge[S+2*M+1]:Pt()[S+2*M+1>>>0];return(w?zr[w]:Ds[v])(...ys)}var Wl=()=>{Gt=0};function vs(v){v>>>=0,f?postMessage({Db:"cleanupThread",ic:v}):Ni(hi[v])}function ld(v){}var go=(v,w)=>{var S=Mn[v];if(S===void 0)throw v=cu(v),S=et(v),ki(v),new On(`${w} has unknown type ${S}`);return S},Ar=(v,w,S)=>{var A=[];return v=v.toWireType(A,S),A.length&&(Be()[w>>>2>>>0]=Un(A)),v};function Mi(v,w,S){return w>>>=0,S>>>=0,v=rn(v>>>0),w=go(w,"emval::as"),Ar(w,S,v)}function _s(v,w){return w>>>=0,v=rn(v>>>0),(w=go(w,"emval::as")).toWireType(null,v)}var Va=v=>{try{v()}catch(w){Dt(w)}},Pn=0,Sn=null,bs=0,qa=[],Ts={},Ha={},Oi=0,Ir=null,Rr=[];function Di(v){return(function(w){if(!z){if(Pn===0){var S=!1,A=!1;w((M=0)=>{if(!z&&(bs=M,S=!0,A)){Pn=2,Va(()=>pa(Sn)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),M=!1;try{var U=(function(){var he=oe()[Sn+8>>>2>>>0];return he=le[Ha[he]],--Gt,he()})()}catch(he){U=he,M=!0}var W=!1;if(!Sn){var ne=Ir;ne&&(Ir=null,(M?ne.reject:ne.resolve)(U),W=!0)}if(M&&!W)throw U}}),A=!0,S||(Pn=1,Sn=(function(){var M=bo(65548),U=M+12;Be()[M>>>2>>>0]=U,Be()[M+4>>>2>>>0]=U+65536,U=qa[0];var W=Ts[U];return W===void 0&&(W=Oi++,Ts[U]=W,Ha[W]=U),U=W,oe()[M+8>>>2>>>0]=U,M})(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Va(()=>Ps(Sn)))}else Pn===2?(Pn=0,Va(So),ki(Sn),Sn=null,Rr.forEach(Qi)):Dt(`invalid state: ${Pn}`);return bs}})(w=>{v().then(w)})}function ws(v){return v>>>=0,Di(async()=>{var w=await rn(v);return Un(w)})}var ua=[];function Kl(v,w,S,A){return S>>>=0,A>>>=0,(v=ua[v>>>0])(null,w=rn(w>>>0),S,A)}var yo={},ca=v=>{var w=yo[v];return w===void 0?et(v):w};function Jl(v,w,S,A,M){return S>>>=0,A>>>=0,M>>>=0,(v=ua[v>>>0])(w=rn(w>>>0),w[S=ca(S)],A,M)}function Dn(v,w){return w>>>=0,(v=rn(v>>>0))==rn(w)}var ji=()=>typeof globalThis=="object"?globalThis:Function("return this")();function vo(v){return(v>>>=0)==0?Un(ji()):(v=ca(v),Un(ji()[v]))}var Nr=v=>{var w=ua.length;return ua.push(v),w},ud=(v,w)=>{for(var S=Array(v),A=0;A<v;++A)S[A]=go(Be()[w+4*A>>>2>>>0],`parameter ${A}`);return S};function Es(v,w,S){var A=(w=ud(v,w>>>0)).shift();v--;var M=`return function (obj, func, destructorsRef, args) {
`,U=0,W=[];S===0&&W.push("obj");for(var ne=["retType"],he=[A],Te=0;Te<v;++Te)W.push(`arg${Te}`),ne.push(`argType${Te}`),he.push(w[Te]),M+=`  var arg${Te} = argType${Te}.readValueFromPointer(args${U?"+"+U:""});
`,U+=w[Te].Cb;return M+=`  var rv = ${S===1?"new func":"func.call"}(${W.join(", ")});
`,A.Ub||(ne.push("emval_returnValue"),he.push(Ar),M+=`  return emval_returnValue(retType, destructorsRef, rv);
`),v=new Function(...ne,M+`};
`)(...he),S=`methodCaller<(${w.map(Se=>Se.name).join(", ")}) => ${A.name}>`,Nr(Object.defineProperty(v,"name",{value:S}))}function Ss(v){return v=ca(v>>>0),Un(o[v])}function $r(v,w){return w>>>=0,v=rn(v>>>0),w=rn(w),Un(v[w])}function _o(v){9<(v>>>=0)&&(En[v+1]+=1)}function Xl(){return Un([])}function cd(v){v=rn(v>>>0);for(var w=Array(v.length),S=0;S<v.length;S++)w[S]=v[S];return Un(w)}function dd(v){return Un(ca(v>>>0))}function fd(){return Un({})}function xs(v){for(var w=rn(v>>>=0);w.length;){var S=w.pop();w.pop()(S)}Kt(v)}function pd(v,w,S){w>>>=0,S>>>=0,v=rn(v>>>0),w=rn(w),S=rn(S),v[w]=S}function hd(v,w){return w>>>=0,v=(v=go(v>>>0,"_emval_take_value")).readValueFromPointer(w),Un(v)}function md(v,w){v=-9007199254740992>v||9007199254740992<v?NaN:Number(v),w>>>=0,v=new Date(1e3*v),oe()[w>>>2>>>0]=v.getUTCSeconds(),oe()[w+4>>>2>>>0]=v.getUTCMinutes(),oe()[w+8>>>2>>>0]=v.getUTCHours(),oe()[w+12>>>2>>>0]=v.getUTCDate(),oe()[w+16>>>2>>>0]=v.getUTCMonth(),oe()[w+20>>>2>>>0]=v.getUTCFullYear()-1900,oe()[w+24>>>2>>>0]=v.getUTCDay(),v=(v.getTime()-Date.UTC(v.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,oe()[w+28>>>2>>>0]=v}var Zl=v=>v%4==0&&(v%100!=0||v%400==0),Ql=[0,31,60,91,121,152,182,213,244,274,305,335],Cs=[0,31,59,90,120,151,181,212,243,273,304,334];function gd(v,w){v=-9007199254740992>v||9007199254740992<v?NaN:Number(v),w>>>=0,v=new Date(1e3*v),oe()[w>>>2>>>0]=v.getSeconds(),oe()[w+4>>>2>>>0]=v.getMinutes(),oe()[w+8>>>2>>>0]=v.getHours(),oe()[w+12>>>2>>>0]=v.getDate(),oe()[w+16>>>2>>>0]=v.getMonth(),oe()[w+20>>>2>>>0]=v.getFullYear()-1900,oe()[w+24>>>2>>>0]=v.getDay();var S=(Zl(v.getFullYear())?Ql:Cs)[v.getMonth()]+v.getDate()-1|0;oe()[w+28>>>2>>>0]=S,oe()[w+36>>>2>>>0]=-60*v.getTimezoneOffset(),S=new Date(v.getFullYear(),6,1).getTimezoneOffset();var A=new Date(v.getFullYear(),0,1).getTimezoneOffset();v=0|(S!=A&&v.getTimezoneOffset()==Math.min(A,S)),oe()[w+32>>>2>>>0]=v}function yd(v){v>>>=0;var w=new Date(oe()[v+20>>>2>>>0]+1900,oe()[v+16>>>2>>>0],oe()[v+12>>>2>>>0],oe()[v+8>>>2>>>0],oe()[v+4>>>2>>>0],oe()[v>>>2>>>0],0),S=oe()[v+32>>>2>>>0],A=w.getTimezoneOffset(),M=new Date(w.getFullYear(),6,1).getTimezoneOffset(),U=new Date(w.getFullYear(),0,1).getTimezoneOffset(),W=Math.min(U,M);return 0>S?oe()[v+32>>>2>>>0]=+(M!=U&&W==A):0<S!=(W==A)&&(M=Math.max(U,M),w.setTime(w.getTime()+6e4*((0<S?W:M)-A))),oe()[v+24>>>2>>>0]=w.getDay(),S=(Zl(w.getFullYear())?Ql:Cs)[w.getMonth()]+w.getDate()-1|0,oe()[v+28>>>2>>>0]=S,oe()[v>>>2>>>0]=w.getSeconds(),oe()[v+4>>>2>>>0]=w.getMinutes(),oe()[v+8>>>2>>>0]=w.getHours(),oe()[v+12>>>2>>>0]=w.getDate(),oe()[v+16>>>2>>>0]=w.getMonth(),oe()[v+20>>>2>>>0]=w.getYear(),v=w.getTime(),BigInt(isNaN(v)?-1:v/1e3)}function jl(v,w,S,A,M,U,W){return f?vt(16,1,v,w,S,A,M,U,W):-52}function eu(v,w,S,A,M,U){if(f)return vt(17,1,v,w,S,A,M,U)}var da={},vd=()=>performance.timeOrigin+performance.now();function tu(v,w){if(f)return vt(18,1,v,w);if(da[v]&&(clearTimeout(da[v].id),delete da[v]),!w)return 0;var S=setTimeout(()=>{delete da[v],Qi(()=>Us(v,performance.timeOrigin+performance.now()))},w);return da[v]={id:S,rc:w},0}function _d(v,w,S,A){v>>>=0,w>>>=0,S>>>=0,A>>>=0;var M=new Date().getFullYear(),U=new Date(M,0,1).getTimezoneOffset();M=new Date(M,6,1).getTimezoneOffset();var W=Math.max(U,M);Be()[v>>>2>>>0]=60*W,oe()[w>>>2>>>0]=+(U!=M),v=(w=ne=>{var he=Math.abs(ne);return`UTC${0<=ne?"-":"+"}${String(Math.floor(he/60)).padStart(2,"0")}${String(he%60).padStart(2,"0")}`})(U),w=w(M),M<U?(gi(v,S,17),gi(w,A,17)):(gi(v,A,17),gi(w,S,17))}var nu=()=>Date.now();function bd(v,w,S){return 0<=v&&3>=v?(v===0?v=Date.now():v=performance.timeOrigin+performance.now(),ge[S>>>0>>>3]=BigInt(Math.round(1e6*v)),0):28}var As=[],iu=(v,w)=>{As.length=0;for(var S;S=de()[v++>>>0];){var A=S!=105;w+=(A&=S!=112)&&w%8?4:0,As.push(S==112?Be()[w>>>2>>>0]:S==106?ge[w>>>3]:S==105?oe()[w>>>2>>>0]:Pt()[w>>>3>>>0]),w+=A?8:4}return As};function Td(v,w,S){return v>>>=0,w=iu(w>>>0,S>>>0),zr[v](...w)}function wd(v,w,S){return v>>>=0,w=iu(w>>>0,S>>>0),zr[v](...w)}var Ed=()=>{};function Sd(v,w){return Ie(Le(v>>>0,w>>>0))}var xd=()=>{throw Gt+=1,"unwind"};function Cd(){return 4294901760}var Is=()=>navigator.hardwareConcurrency;function Mr(){return Dt("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Ad(v){v>>>=0;var w=de().length;if(v<=w||4294901760<v)return!1;for(var S=1;4>=S;S*=2){var A=w*(1+.2/S);A=Math.min(A,v+100663296);e:{A=(Math.min(4294901760,65536*Math.ceil(Math.max(v,A)/65536))-O.buffer.byteLength+65535)/65536|0;try{O.grow(A),nt();var M=1;break e}catch{}M=void 0}if(M)return!0}return!1}var Or=()=>(Dt("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Fa={},Rs=v=>{v.forEach(w=>{Or()})};function au(){var v=Error().stack.toString().split(`
`);return v[0]=="Error"&&v.shift(),Rs(v),Fa.Mb=Or(),Fa.dc=v,Fa.Mb}function ru(v,w,S){if(v>>>=0,w>>>=0,Fa.Mb==v)var A=Fa.dc;else(A=Error().stack.toString().split(`
`))[0]=="Error"&&A.shift(),Rs(A);for(var M=3;A[M]&&Or()!=v;)++M;for(v=0;v<S&&A[v+M];++v)oe()[w+4*v>>>2>>>0]=Or();return v}var ea,Ns={},ou=()=>{if(!ea){var v,w={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(v in Ns)Ns[v]===void 0?delete w[v]:w[v]=Ns[v];var S=[];for(v in w)S.push(`${v}=${w[v]}`);ea=S}return ea};function su(v,w){if(f)return vt(19,1,v,w);v>>>=0,w>>>=0;var S,A=0,M=0;for(S of ou()){var U=w+A;Be()[v+M>>>2>>>0]=U,A+=gi(S,U,1/0)+1,M+=4}return 0}function $s(v,w){if(f)return vt(20,1,v,w);v>>>=0,w>>>=0;var S=ou();for(var A of(Be()[v>>>2>>>0]=S.length,v=0,S))v+=ni(A)+1;return Be()[w>>>2>>>0]=v,0}function Ms(v){return f?vt(21,1,v):52}function Ya(v,w,S,A){return f?vt(22,1,v,w,S,A):52}function Wa(v,w,S,A){return f?vt(23,1,v,w,S,A):70}var Id=[null,[],[]];function Dr(v,w,S,A){if(f)return vt(24,1,v,w,S,A);w>>>=0,S>>>=0,A>>>=0;for(var M=0,U=0;U<S;U++){var W=Be()[w>>>2>>>0],ne=Be()[w+4>>>2>>>0];w+=8;for(var he=0;he<ne;he++){var Te=v,Se=de()[W+he>>>0],ze=Id[Te];Se===0||Se===10?((Te===1?Ee:Ie)(De(ze)),ze.length=0):ze.push(Se)}M+=ne}return Be()[A>>>2>>>0]=M,0}f||(function(){for(var v=o.numThreads-1;v--;)fn();ka.push(()=>{ei++,(function(w){f?w():Promise.all(ti.map(Hn)).then(w)})(()=>pi())})})();for(var Os=Array(256),kr=0;256>kr;++kr)Os[kr]=String.fromCharCode(kr);qe=Os,En.push(0,1,void 0,1,null,1,!0,1,!1,1),o.count_emval_handles=()=>En.length/2-5-yn.length,f||(O=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),nt()),o.wasmBinary&&($=o.wasmBinary),o.stackSave=()=>fa(),o.stackRestore=v=>zi(v),o.stackAlloc=v=>Lr(v),o.setValue=function(v,w,S="i8"){switch(S.endsWith("*")&&(S="*"),S){case"i1":case"i8":te()[v>>>0]=w;break;case"i16":Me()[v>>>1>>>0]=w;break;case"i32":oe()[v>>>2>>>0]=w;break;case"i64":ge[v>>>3]=BigInt(w);break;case"float":je()[v>>>2>>>0]=w;break;case"double":Pt()[v>>>3>>>0]=w;break;case"*":Be()[v>>>2>>>0]=w;break;default:Dt(`invalid type for setValue: ${S}`)}},o.getValue=function(v,w="i8"){switch(w.endsWith("*")&&(w="*"),w){case"i1":case"i8":return te()[v>>>0];case"i16":return Me()[v>>>1>>>0];case"i32":return oe()[v>>>2>>>0];case"i64":return ge[v>>>3];case"float":return je()[v>>>2>>>0];case"double":return Pt()[v>>>3>>>0];case"*":return Be()[v>>>2>>>0];default:Dt(`invalid type for getValue: ${w}`)}},o.UTF8ToString=Le,o.stringToUTF8=gi,o.lengthBytesUTF8=ni;var Ds=[La,Sr,kt,Yt,Rt,Wt,gn,la,mi,Ua,ye,zt,at,Ue,$n,Nt,jl,eu,tu,su,$s,Ms,Ya,Wa,Dr],zr={893836:(v,w,S,A,M)=>{if(o===void 0||!o.Fb)return 1;if((v=Le(Number(v>>>0))).startsWith("./")&&(v=v.substring(2)),!(v=o.Fb.get(v)))return 2;if(w=Number(w>>>0),S=Number(S>>>0),A=Number(A>>>0),w+S>v.byteLength)return 3;try{let U=v.subarray(w,w+S);switch(M){case 0:de().set(U,A>>>0);break;case 1:o.mc?o.mc(A,U):o.cc(A,U);break;default:return 4}return 0}catch{return 4}},894660:(v,w,S)=>{o.Pb(v,de().subarray(w>>>0,w+S>>>0))},894724:()=>o.oc(),894766:v=>{o.Ob(v)},894803:()=>{o.Wb()},894834:()=>{o.Xb()},894863:()=>{o.ac()},894888:v=>o.Vb(v),894921:v=>o.Zb(v),894953:(v,w,S)=>{o.Lb(Number(v),Number(w),Number(S),!0)},895016:(v,w,S)=>{o.Lb(Number(v),Number(w),Number(S))},895073:()=>typeof wasmOffsetConverter<"u",895130:v=>{o.Ab("Abs",v,void 0)},895181:v=>{o.Ab("Neg",v,void 0)},895232:v=>{o.Ab("Floor",v,void 0)},895285:v=>{o.Ab("Ceil",v,void 0)},895337:v=>{o.Ab("Reciprocal",v,void 0)},895395:v=>{o.Ab("Sqrt",v,void 0)},895447:v=>{o.Ab("Exp",v,void 0)},895498:v=>{o.Ab("Erf",v,void 0)},895549:v=>{o.Ab("Sigmoid",v,void 0)},895604:(v,w,S)=>{o.Ab("HardSigmoid",v,{alpha:w,beta:S})},895683:v=>{o.Ab("Log",v,void 0)},895734:v=>{o.Ab("Sin",v,void 0)},895785:v=>{o.Ab("Cos",v,void 0)},895836:v=>{o.Ab("Tan",v,void 0)},895887:v=>{o.Ab("Asin",v,void 0)},895939:v=>{o.Ab("Acos",v,void 0)},895991:v=>{o.Ab("Atan",v,void 0)},896043:v=>{o.Ab("Sinh",v,void 0)},896095:v=>{o.Ab("Cosh",v,void 0)},896147:v=>{o.Ab("Asinh",v,void 0)},896200:v=>{o.Ab("Acosh",v,void 0)},896253:v=>{o.Ab("Atanh",v,void 0)},896306:v=>{o.Ab("Tanh",v,void 0)},896358:v=>{o.Ab("Not",v,void 0)},896409:(v,w,S)=>{o.Ab("Clip",v,{min:w,max:S})},896478:v=>{o.Ab("Clip",v,void 0)},896530:(v,w)=>{o.Ab("Elu",v,{alpha:w})},896588:v=>{o.Ab("Gelu",v,void 0)},896640:v=>{o.Ab("Relu",v,void 0)},896692:(v,w)=>{o.Ab("LeakyRelu",v,{alpha:w})},896756:(v,w)=>{o.Ab("ThresholdedRelu",v,{alpha:w})},896826:(v,w)=>{o.Ab("Cast",v,{to:w})},896884:v=>{o.Ab("Add",v,void 0)},896935:v=>{o.Ab("Sub",v,void 0)},896986:v=>{o.Ab("Mul",v,void 0)},897037:v=>{o.Ab("Div",v,void 0)},897088:v=>{o.Ab("Pow",v,void 0)},897139:v=>{o.Ab("Equal",v,void 0)},897192:v=>{o.Ab("Greater",v,void 0)},897247:v=>{o.Ab("GreaterOrEqual",v,void 0)},897309:v=>{o.Ab("Less",v,void 0)},897361:v=>{o.Ab("LessOrEqual",v,void 0)},897420:(v,w,S,A,M)=>{o.Ab("ReduceMean",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},897595:(v,w,S,A,M)=>{o.Ab("ReduceMax",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},897769:(v,w,S,A,M)=>{o.Ab("ReduceMin",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},897943:(v,w,S,A,M)=>{o.Ab("ReduceProd",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898118:(v,w,S,A,M)=>{o.Ab("ReduceSum",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898292:(v,w,S,A,M)=>{o.Ab("ReduceL1",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898465:(v,w,S,A,M)=>{o.Ab("ReduceL2",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898638:(v,w,S,A,M)=>{o.Ab("ReduceLogSum",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898815:(v,w,S,A,M)=>{o.Ab("ReduceSumSquare",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},898995:(v,w,S,A,M)=>{o.Ab("ReduceLogSumExp",v,{keepDims:!!w,noopWithEmptyAxes:!!S,axes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},899175:v=>{o.Ab("Where",v,void 0)},899228:(v,w,S)=>{o.Ab("Transpose",v,{perm:w?Array.from(oe().subarray(Number(w)>>>0,Number(S)>>>0)):[]})},899352:(v,w,S,A)=>{o.Ab("DepthToSpace",v,{blocksize:w,mode:Le(S),format:A?"NHWC":"NCHW"})},899485:(v,w,S,A)=>{o.Ab("DepthToSpace",v,{blocksize:w,mode:Le(S),format:A?"NHWC":"NCHW"})},899618:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt)=>{o.Ab("ConvTranspose",v,{format:he?"NHWC":"NCHW",autoPad:w,dilations:[S],group:A,kernelShape:[M],pads:[U,W],strides:[ne],wIsConst:()=>!!te()[Te>>>0],outputPadding:Se?Array.from(oe().subarray(Number(Se)>>>0,Number(ze)>>>0)):[],outputShape:Pe?Array.from(oe().subarray(Number(Pe)>>>0,Number(rt)>>>0)):[],activation:Le(Vt)})},900051:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("ConvTranspose",v,{format:ne?"NHWC":"NCHW",autoPad:w,dilations:Array.from(oe().subarray(Number(S)>>>0,2+(Number(S)>>>0)>>>0)),group:A,kernelShape:Array.from(oe().subarray(Number(M)>>>0,2+(Number(M)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(U)>>>0,4+(Number(U)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),wIsConst:()=>!!te()[he>>>0],outputPadding:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],outputShape:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[],activation:Le(rt)})},900712:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt)=>{o.Ab("ConvTranspose",v,{format:he?"NHWC":"NCHW",autoPad:w,dilations:[S],group:A,kernelShape:[M],pads:[U,W],strides:[ne],wIsConst:()=>!!te()[Te>>>0],outputPadding:Se?Array.from(oe().subarray(Number(Se)>>>0,Number(ze)>>>0)):[],outputShape:Pe?Array.from(oe().subarray(Number(Pe)>>>0,Number(rt)>>>0)):[],activation:Le(Vt)})},901145:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("ConvTranspose",v,{format:ne?"NHWC":"NCHW",autoPad:w,dilations:Array.from(oe().subarray(Number(S)>>>0,2+(Number(S)>>>0)>>>0)),group:A,kernelShape:Array.from(oe().subarray(Number(M)>>>0,2+(Number(M)>>>0)>>>0)),pads:Array.from(oe().subarray(Number(U)>>>0,4+(Number(U)>>>0)>>>0)),strides:Array.from(oe().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),wIsConst:()=>!!te()[he>>>0],outputPadding:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],outputShape:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[],activation:Le(rt)})},901806:(v,w)=>{o.Ab("GlobalAveragePool",v,{format:w?"NHWC":"NCHW"})},901897:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("AveragePool",v,{format:rt?"NHWC":"NCHW",auto_pad:w,ceil_mode:S,count_include_pad:A,storage_order:M,dilations:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[],kernel_shape:ne?Array.from(oe().subarray(Number(ne)>>>0,Number(he)>>>0)):[],pads:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],strides:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[]})},902376:(v,w)=>{o.Ab("GlobalAveragePool",v,{format:w?"NHWC":"NCHW"})},902467:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("AveragePool",v,{format:rt?"NHWC":"NCHW",auto_pad:w,ceil_mode:S,count_include_pad:A,storage_order:M,dilations:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[],kernel_shape:ne?Array.from(oe().subarray(Number(ne)>>>0,Number(he)>>>0)):[],pads:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],strides:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[]})},902946:(v,w)=>{o.Ab("GlobalMaxPool",v,{format:w?"NHWC":"NCHW"})},903033:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("MaxPool",v,{format:rt?"NHWC":"NCHW",auto_pad:w,ceil_mode:S,count_include_pad:A,storage_order:M,dilations:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[],kernel_shape:ne?Array.from(oe().subarray(Number(ne)>>>0,Number(he)>>>0)):[],pads:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],strides:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[]})},903508:(v,w)=>{o.Ab("GlobalMaxPool",v,{format:w?"NHWC":"NCHW"})},903595:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>{o.Ab("MaxPool",v,{format:rt?"NHWC":"NCHW",auto_pad:w,ceil_mode:S,count_include_pad:A,storage_order:M,dilations:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[],kernel_shape:ne?Array.from(oe().subarray(Number(ne)>>>0,Number(he)>>>0)):[],pads:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],strides:ze?Array.from(oe().subarray(Number(ze)>>>0,Number(Pe)>>>0)):[]})},904070:(v,w,S,A,M)=>{o.Ab("Gemm",v,{alpha:w,beta:S,transA:A,transB:M})},904174:v=>{o.Ab("MatMul",v,void 0)},904228:(v,w,S,A)=>{o.Ab("ArgMax",v,{keepDims:!!w,selectLastIndex:!!S,axis:A})},904336:(v,w,S,A)=>{o.Ab("ArgMin",v,{keepDims:!!w,selectLastIndex:!!S,axis:A})},904444:(v,w)=>{o.Ab("Softmax",v,{axis:w})},904507:(v,w)=>{o.Ab("Concat",v,{axis:w})},904567:(v,w,S,A,M)=>{o.Ab("Split",v,{axis:w,numOutputs:S,splitSizes:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},904723:v=>{o.Ab("Expand",v,void 0)},904777:(v,w)=>{o.Ab("Gather",v,{axis:Number(w)})},904848:(v,w)=>{o.Ab("GatherElements",v,{axis:Number(w)})},904927:(v,w)=>{o.Ab("GatherND",v,{batch_dims:Number(w)})},905006:(v,w,S,A,M,U,W,ne,he,Te,Se)=>{o.Ab("Resize",v,{antialias:w,axes:S?Array.from(oe().subarray(Number(S)>>>0,Number(A)>>>0)):[],coordinateTransformMode:Le(M),cubicCoeffA:U,excludeOutside:W,extrapolationValue:ne,keepAspectRatioPolicy:Le(he),mode:Le(Te),nearestMode:Le(Se)})},905368:(v,w,S,A,M,U,W)=>{o.Ab("Slice",v,{starts:w?Array.from(oe().subarray(Number(w)>>>0,Number(S)>>>0)):[],ends:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[],axes:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[]})},905632:v=>{o.Ab("Tile",v,void 0)},905684:(v,w,S)=>{o.Ab("InstanceNormalization",v,{epsilon:w,format:S?"NHWC":"NCHW"})},905798:(v,w,S)=>{o.Ab("InstanceNormalization",v,{epsilon:w,format:S?"NHWC":"NCHW"})},905912:v=>{o.Ab("Range",v,void 0)},905965:(v,w)=>{o.Ab("Einsum",v,{equation:Le(w)})},906046:(v,w,S,A,M)=>{o.Ab("Pad",v,{mode:w,value:S,pads:A?Array.from(oe().subarray(Number(A)>>>0,Number(M)>>>0)):[]})},906189:(v,w,S,A,M,U)=>{o.Ab("BatchNormalization",v,{epsilon:w,momentum:S,spatial:!!M,trainingMode:!!A,format:U?"NHWC":"NCHW"})},906358:(v,w,S,A,M,U)=>{o.Ab("BatchNormalization",v,{epsilon:w,momentum:S,spatial:!!M,trainingMode:!!A,format:U?"NHWC":"NCHW"})},906527:(v,w,S)=>{o.Ab("CumSum",v,{exclusive:Number(w),reverse:Number(S)})},906624:(v,w,S)=>{o.Ab("DequantizeLinear",v,{axis:w,blockSize:S})},906714:(v,w,S,A,M)=>{o.Ab("GridSample",v,{align_corners:w,mode:Le(S),padding_mode:Le(A),format:M?"NHWC":"NCHW"})},906884:(v,w,S,A,M)=>{o.Ab("GridSample",v,{align_corners:w,mode:Le(S),padding_mode:Le(A),format:M?"NHWC":"NCHW"})},907054:(v,w)=>{o.Ab("ScatterND",v,{reduction:Le(w)})},907139:(v,w,S,A,M,U,W,ne,he)=>{o.Ab("Attention",v,{numHeads:w,isUnidirectional:S,maskFilterValue:A,scale:M,doRotary:U,qkvHiddenSizes:W?Array.from(oe().subarray(Number(ne)>>>0,Number(ne)+W>>>0)):[],pastPresentShareBuffer:!!he})},907411:v=>{o.Ab("BiasAdd",v,void 0)},907466:v=>{o.Ab("BiasSplitGelu",v,void 0)},907527:v=>{o.Ab("FastGelu",v,void 0)},907583:(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn)=>{o.Ab("Conv",v,{format:ze?"NHWC":"NCHW",auto_pad:w,dilations:S?Array.from(oe().subarray(Number(S)>>>0,Number(A)>>>0)):[],group:M,kernel_shape:U?Array.from(oe().subarray(Number(U)>>>0,Number(W)>>>0)):[],pads:ne?Array.from(oe().subarray(Number(ne)>>>0,Number(he)>>>0)):[],strides:Te?Array.from(oe().subarray(Number(Te)>>>0,Number(Se)>>>0)):[],w_is_const:()=>!!te()[Number(Pe)>>>0],activation:Le(rt),activation_params:Vt?Array.from(je().subarray(Number(Vt)>>>0,Number(vn)>>>0)):[]})},908167:v=>{o.Ab("Gelu",v,void 0)},908219:(v,w,S,A,M,U,W,ne,he)=>{o.Ab("GroupQueryAttention",v,{numHeads:w,kvNumHeads:S,scale:A,softcap:M,doRotary:U,rotaryInterleaved:W,smoothSoftmax:ne,localWindowSize:he})},908436:(v,w,S,A)=>{o.Ab("LayerNormalization",v,{axis:w,epsilon:S,simplified:!!A})},908547:(v,w,S,A)=>{o.Ab("LayerNormalization",v,{axis:w,epsilon:S,simplified:!!A})},908658:(v,w,S,A,M,U)=>{o.Ab("MatMulNBits",v,{k:w,n:S,accuracyLevel:A,bits:M,blockSize:U})},908785:(v,w,S,A,M,U)=>{o.Ab("MultiHeadAttention",v,{numHeads:w,isUnidirectional:S,maskFilterValue:A,scale:M,doRotary:U})},908944:(v,w)=>{o.Ab("QuickGelu",v,{alpha:w})},909008:(v,w,S,A,M)=>{o.Ab("RotaryEmbedding",v,{interleaved:!!w,numHeads:S,rotaryEmbeddingDim:A,scale:M})},909147:(v,w,S)=>{o.Ab("SkipLayerNormalization",v,{epsilon:w,simplified:!!S})},909249:(v,w,S)=>{o.Ab("SkipLayerNormalization",v,{epsilon:w,simplified:!!S})},909351:(v,w,S,A)=>{o.Ab("GatherBlockQuantized",v,{gatherAxis:w,quantizeAxis:S,blockSize:A})},909472:v=>{o.$b(v)},909506:(v,w)=>o.bc(Number(v),Number(w),o.Gb.ec,o.Gb.errors)};function lu(v,w,S){return Di(async()=>{await o.Yb(Number(v),Number(w),Number(S))})}function uu(){return typeof wasmOffsetConverter<"u"}var le=await(async function(){function v(A,M){return le=A.exports,le=(function(){var U=le,W={};for(let[ne,he]of Object.entries(U))W[ne]=typeof he=="function"?(...Te)=>{qa.push(ne);try{return he(...Te)}finally{z||(qa.pop(),Sn&&Pn===1&&qa.length===0&&(Pn=0,Gt+=1,Va(ta),typeof Fibers<"u"&&Fibers.sc()))}}:he;return W})(),le=(function(){var U=le,W=he=>Te=>he(Te)>>>0,ne=he=>()=>he()>>>0;return(U=Object.assign({},U)).Ea=W(U.Ea),U.gb=ne(U.gb),U.ib=W(U.ib),U.tb=W(U.tb),U.ub=ne(U.ub),U.__cxa_get_exception_ptr=W(U.__cxa_get_exception_ptr),U})(),xr.push(le.jb),k=M,pi(),le}ei++;var w=Nn();if(o.instantiateWasm)return new Promise(A=>{o.instantiateWasm(w,(M,U)=>{A(v(M,U))})});if(f)return new Promise(A=>{H=M=>{var U=new WebAssembly.Instance(M,Nn());A(v(U,M))}});Bt??(Bt=o.locateFile?o.locateFile?o.locateFile("ort-wasm-simd-threaded.jsep.wasm",R):R+"ort-wasm-simd-threaded.jsep.wasm":new URL("/SENTINELV15/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href);try{var S=await(async function(A){var M=Bt;if(!$&&typeof WebAssembly.instantiateStreaming=="function"&&!q(M))try{var U=fetch(M,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(U,A)}catch(W){Ie(`wasm streaming compile failed: ${W}`),Ie("falling back to ArrayBuffer instantiation")}return(async function(W,ne){try{var he=await(async function(Te){if(!$)try{var Se=await E(Te);return new Uint8Array(Se)}catch{}if(Te==Bt&&$)Te=new Uint8Array($);else{if(!x)throw"both async and sync fetching of the wasm failed";Te=x(Te)}return Te})(W);return await WebAssembly.instantiate(he,ne)}catch(Te){Ie(`failed to asynchronously prepare wasm: ${Te}`),Dt(Te)}})(M,A)})(w);return v(S.instance,S.module)}catch(A){return s(A),Promise.reject(A)}})(),cu=v=>(cu=le.Ea)(v),du=()=>(du=le.Fa)();o._OrtInit=(v,w)=>(o._OrtInit=le.Ga)(v,w),o._OrtGetLastError=(v,w)=>(o._OrtGetLastError=le.Ha)(v,w),o._OrtCreateSessionOptions=(v,w,S,A,M,U,W,ne,he,Te)=>(o._OrtCreateSessionOptions=le.Ia)(v,w,S,A,M,U,W,ne,he,Te),o._OrtAppendExecutionProvider=(v,w,S,A,M)=>(o._OrtAppendExecutionProvider=le.Ja)(v,w,S,A,M),o._OrtAddFreeDimensionOverride=(v,w,S)=>(o._OrtAddFreeDimensionOverride=le.Ka)(v,w,S),o._OrtAddSessionConfigEntry=(v,w,S)=>(o._OrtAddSessionConfigEntry=le.La)(v,w,S),o._OrtReleaseSessionOptions=v=>(o._OrtReleaseSessionOptions=le.Ma)(v),o._OrtCreateSession=(v,w,S)=>(o._OrtCreateSession=le.Na)(v,w,S),o._OrtReleaseSession=v=>(o._OrtReleaseSession=le.Oa)(v),o._OrtGetInputOutputCount=(v,w,S)=>(o._OrtGetInputOutputCount=le.Pa)(v,w,S),o._OrtGetInputOutputMetadata=(v,w,S,A)=>(o._OrtGetInputOutputMetadata=le.Qa)(v,w,S,A),o._OrtFree=v=>(o._OrtFree=le.Ra)(v),o._OrtCreateTensor=(v,w,S,A,M,U)=>(o._OrtCreateTensor=le.Sa)(v,w,S,A,M,U),o._OrtGetTensorData=(v,w,S,A,M)=>(o._OrtGetTensorData=le.Ta)(v,w,S,A,M),o._OrtReleaseTensor=v=>(o._OrtReleaseTensor=le.Ua)(v),o._OrtCreateRunOptions=(v,w,S,A)=>(o._OrtCreateRunOptions=le.Va)(v,w,S,A),o._OrtAddRunConfigEntry=(v,w,S)=>(o._OrtAddRunConfigEntry=le.Wa)(v,w,S),o._OrtReleaseRunOptions=v=>(o._OrtReleaseRunOptions=le.Xa)(v),o._OrtCreateBinding=v=>(o._OrtCreateBinding=le.Ya)(v),o._OrtBindInput=(v,w,S)=>(o._OrtBindInput=le.Za)(v,w,S),o._OrtBindOutput=(v,w,S,A)=>(o._OrtBindOutput=le._a)(v,w,S,A),o._OrtClearBoundOutputs=v=>(o._OrtClearBoundOutputs=le.$a)(v),o._OrtReleaseBinding=v=>(o._OrtReleaseBinding=le.ab)(v),o._OrtRunWithBinding=(v,w,S,A,M)=>(o._OrtRunWithBinding=le.bb)(v,w,S,A,M),o._OrtRun=(v,w,S,A,M,U,W,ne)=>(o._OrtRun=le.cb)(v,w,S,A,M,U,W,ne),o._OrtEndProfiling=v=>(o._OrtEndProfiling=le.db)(v),o._JsepOutput=(v,w,S)=>(o._JsepOutput=le.eb)(v,w,S),o._JsepGetNodeName=v=>(o._JsepGetNodeName=le.fb)(v);var ks=()=>(ks=le.gb)(),ki=o._free=v=>(ki=o._free=le.hb)(v),bo=o._malloc=v=>(bo=o._malloc=le.ib)(v),xn=(v,w,S,A,M,U)=>(xn=le.kb)(v,w,S,A,M,U),Ka=()=>(Ka=le.lb)(),zs=(v,w,S,A,M)=>(zs=le.mb)(v,w,S,A,M),Ls=v=>(Ls=le.nb)(v),To=v=>(To=le.ob)(v),Us=(v,w)=>(Us=le.pb)(v,w),wo=()=>(wo=le.qb)(),fu=(v,w)=>(fu=le.rb)(v,w),zi=v=>(zi=le.sb)(v),Lr=v=>(Lr=le.tb)(v),fa=()=>(fa=le.ub)(),Eo=o.dynCall_ii=(v,w)=>(Eo=o.dynCall_ii=le.vb)(v,w);o.dynCall_vii=(v,w,S)=>(o.dynCall_vii=le.dynCall_vii)(v,w,S),o.dynCall_iiiii=(v,w,S,A,M)=>(o.dynCall_iiiii=le.dynCall_iiiii)(v,w,S,A,M),o.dynCall_iii=(v,w,S)=>(o.dynCall_iii=le.dynCall_iii)(v,w,S),o.dynCall_iiiiii=(v,w,S,A,M,U)=>(o.dynCall_iiiiii=le.dynCall_iiiiii)(v,w,S,A,M,U),o.dynCall_iiiiiiii=(v,w,S,A,M,U,W,ne)=>(o.dynCall_iiiiiiii=le.dynCall_iiiiiiii)(v,w,S,A,M,U,W,ne),o.dynCall_iiiiiii=(v,w,S,A,M,U,W)=>(o.dynCall_iiiiiii=le.dynCall_iiiiiii)(v,w,S,A,M,U,W),o.dynCall_vi=(v,w)=>(o.dynCall_vi=le.dynCall_vi)(v,w),o.dynCall_iiii=(v,w,S,A)=>(o.dynCall_iiii=le.dynCall_iiii)(v,w,S,A),o.dynCall_i=v=>(o.dynCall_i=le.dynCall_i)(v),o.dynCall_viiiiiiii=(v,w,S,A,M,U,W,ne,he)=>(o.dynCall_viiiiiiii=le.dynCall_viiiiiiii)(v,w,S,A,M,U,W,ne,he),o.dynCall_viii=(v,w,S,A)=>(o.dynCall_viii=le.dynCall_viii)(v,w,S,A),o.dynCall_viijj=(v,w,S,A,M)=>(o.dynCall_viijj=le.dynCall_viijj)(v,w,S,A,M),o.dynCall_viiiiii=(v,w,S,A,M,U,W)=>(o.dynCall_viiiiii=le.dynCall_viiiiii)(v,w,S,A,M,U,W),o.dynCall_viiii=(v,w,S,A,M)=>(o.dynCall_viiii=le.dynCall_viiii)(v,w,S,A,M),o.dynCall_viiiii=(v,w,S,A,M,U)=>(o.dynCall_viiiii=le.dynCall_viiiii)(v,w,S,A,M,U),o.dynCall_vfiii=(v,w,S,A,M)=>(o.dynCall_vfiii=le.dynCall_vfiii)(v,w,S,A,M),o.dynCall_viiiiff=(v,w,S,A,M,U,W)=>(o.dynCall_viiiiff=le.dynCall_viiiiff)(v,w,S,A,M,U,W),o.dynCall_viiiiiff=(v,w,S,A,M,U,W,ne)=>(o.dynCall_viiiiiff=le.dynCall_viiiiiff)(v,w,S,A,M,U,W,ne),o.dynCall_ffff=(v,w,S,A)=>(o.dynCall_ffff=le.dynCall_ffff)(v,w,S,A),o.dynCall_viiff=(v,w,S,A,M)=>(o.dynCall_viiff=le.dynCall_viiff)(v,w,S,A,M),o.dynCall_fffffff=(v,w,S,A,M,U,W)=>(o.dynCall_fffffff=le.dynCall_fffffff)(v,w,S,A,M,U,W),o.dynCall_jjjjjjj=(v,w,S,A,M,U,W)=>(o.dynCall_jjjjjjj=le.dynCall_jjjjjjj)(v,w,S,A,M,U,W),o.dynCall_jjjjjj=(v,w,S,A,M,U)=>(o.dynCall_jjjjjj=le.dynCall_jjjjjj)(v,w,S,A,M,U),o.dynCall_iijjii=(v,w,S,A,M,U)=>(o.dynCall_iijjii=le.dynCall_iijjii)(v,w,S,A,M,U),o.dynCall_viiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt)=>(o.dynCall_viiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt),o.dynCall_viiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se)=>(o.dynCall_viiiiiiiiii=le.dynCall_viiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se),o.dynCall_viiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze)=>(o.dynCall_viiiiiiiiiii=le.dynCall_viiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze),o.dynCall_viiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe)=>(o.dynCall_viiiiiiiiiiii=le.dynCall_viiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe),o.dynCall_viiiiiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii)=>(o.dynCall_viiiiiiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii),o.dynCall_viiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te)=>(o.dynCall_viiiiiiiii=le.dynCall_viiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te),o.dynCall_viiiiiiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii,xo)=>(o.dynCall_viiiiiiiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii,xo),o.dynCall_viiiiiii=(v,w,S,A,M,U,W,ne)=>(o.dynCall_viiiiiii=le.dynCall_viiiiiii)(v,w,S,A,M,U,W,ne),o.dynCall_viiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn)=>(o.dynCall_viiiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn),o.dynCall_jiji=(v,w,S,A)=>(o.dynCall_jiji=le.dynCall_jiji)(v,w,S,A),o.dynCall_v=v=>(o.dynCall_v=le.dynCall_v)(v),o.dynCall_iidiiii=(v,w,S,A,M,U,W)=>(o.dynCall_iidiiii=le.dynCall_iidiiii)(v,w,S,A,M,U,W),o.dynCall_iiiiiiiii=(v,w,S,A,M,U,W,ne,he)=>(o.dynCall_iiiiiiiii=le.dynCall_iiiiiiiii)(v,w,S,A,M,U,W,ne,he),o.dynCall_iiij=(v,w,S,A)=>(o.dynCall_iiij=le.dynCall_iiij)(v,w,S,A),o.dynCall_iiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te)=>(o.dynCall_iiiiiiiiii=le.dynCall_iiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te),o.dynCall_iiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe)=>(o.dynCall_iiiiiiiiiiiii=le.dynCall_iiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe),o.dynCall_iiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se)=>(o.dynCall_iiiiiiiiiii=le.dynCall_iiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se),o.dynCall_ji=(v,w)=>(o.dynCall_ji=le.dynCall_ji)(v,w),o.dynCall_iijii=(v,w,S,A,M)=>(o.dynCall_iijii=le.dynCall_iijii)(v,w,S,A,M),o.dynCall_vij=(v,w,S)=>(o.dynCall_vij=le.dynCall_vij)(v,w,S),o.dynCall_viiijii=(v,w,S,A,M,U,W)=>(o.dynCall_viiijii=le.dynCall_viiijii)(v,w,S,A,M,U,W),o.dynCall_viijiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li)=>(o.dynCall_viijiiiiiiiiiiiiii=le.dynCall_viijiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li),o.dynCall_viiiji=(v,w,S,A,M,U)=>(o.dynCall_viiiji=le.dynCall_viiiji)(v,w,S,A,M,U),o.dynCall_fiii=(v,w,S,A)=>(o.dynCall_fiii=le.dynCall_fiii)(v,w,S,A),o.dynCall_viijii=(v,w,S,A,M,U)=>(o.dynCall_viijii=le.dynCall_viijii)(v,w,S,A,M,U),o.dynCall_viij=(v,w,S,A)=>(o.dynCall_viij=le.dynCall_viij)(v,w,S,A),o.dynCall_jiij=(v,w,S,A)=>(o.dynCall_jiij=le.dynCall_jiij)(v,w,S,A),o.dynCall_fi=(v,w)=>(o.dynCall_fi=le.dynCall_fi)(v,w),o.dynCall_fii=(v,w,S)=>(o.dynCall_fii=le.dynCall_fii)(v,w,S),o.dynCall_jii=(v,w,S)=>(o.dynCall_jii=le.dynCall_jii)(v,w,S),o.dynCall_dii=(v,w,S)=>(o.dynCall_dii=le.dynCall_dii)(v,w,S),o.dynCall_fiiii=(v,w,S,A,M)=>(o.dynCall_fiiii=le.dynCall_fiiii)(v,w,S,A,M),o.dynCall_fif=(v,w,S)=>(o.dynCall_fif=le.dynCall_fif)(v,w,S),o.dynCall_jfi=(v,w,S)=>(o.dynCall_jfi=le.dynCall_jfi)(v,w,S),o.dynCall_viiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt)=>(o.dynCall_viiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt),o.dynCall_viiiiiiiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii,xo,Co)=>(o.dynCall_viiiiiiiiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn,Li,ii,xo,Co),o.dynCall_viiiiiiiiiiiiiiii=(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn)=>(o.dynCall_viiiiiiiiiiiiiiii=le.dynCall_viiiiiiiiiiiiiiii)(v,w,S,A,M,U,W,ne,he,Te,Se,ze,Pe,rt,Vt,vn,Wn),o.dynCall_iif=(v,w,S)=>(o.dynCall_iif=le.dynCall_iif)(v,w,S),o.dynCall_jiiii=(v,w,S,A,M)=>(o.dynCall_jiiii=le.dynCall_jiiii)(v,w,S,A,M),o.dynCall_jiii=(v,w,S,A)=>(o.dynCall_jiii=le.dynCall_jiii)(v,w,S,A),o.dynCall_viif=(v,w,S,A)=>(o.dynCall_viif=le.dynCall_viif)(v,w,S,A),o.dynCall_viiij=(v,w,S,A,M)=>(o.dynCall_viiij=le.dynCall_viiij)(v,w,S,A,M),o.dynCall_viiiijii=(v,w,S,A,M,U,W,ne)=>(o.dynCall_viiiijii=le.dynCall_viiiijii)(v,w,S,A,M,U,W,ne),o.dynCall_iiiiij=(v,w,S,A,M,U)=>(o.dynCall_iiiiij=le.dynCall_iiiiij)(v,w,S,A,M,U),o.dynCall_iiiiid=(v,w,S,A,M,U)=>(o.dynCall_iiiiid=le.dynCall_iiiiid)(v,w,S,A,M,U),o.dynCall_iiiiijj=(v,w,S,A,M,U,W)=>(o.dynCall_iiiiijj=le.dynCall_iiiiijj)(v,w,S,A,M,U,W),o.dynCall_iiiiiijj=(v,w,S,A,M,U,W,ne)=>(o.dynCall_iiiiiijj=le.dynCall_iiiiiijj)(v,w,S,A,M,U,W,ne);var Ps=v=>(Ps=le.wb)(v),ta=()=>(ta=le.xb)(),pa=v=>(pa=le.yb)(v),So=()=>(So=le.zb)();return(function v(){if(0<ei)Ot=v;else if(f)a(o),yt();else{for(;0<ka.length;)ka.shift()(o);0<ei?Ot=v:(o.calledRun=!0,z||(yt(),a(o)))}})(),o.PTR_SIZE=4,u},xE=Ap,O_=(t=(e=globalThis.self)==null?void 0:e.name)==null?void 0:t.startsWith("em-pthread"),O_&&Ap()}),Ip,Dh,D_,ci,CE,yc,k_,z_,Rp,L_,Np,AE,$p,IE,cm=be(()=>{um(),Ip=typeof location>"u"?void 0:location.origin,Dh=import.meta.url>"file:"&&import.meta.url<"file;",D_=()=>{{if(Dh){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,Ip).href}return import.meta.url}},ci=D_(),CE=()=>{if(ci&&!ci.startsWith("blob:"))return ci.substring(0,ci.lastIndexOf("/")+1)},yc=(e,t)=>{try{let n=t??ci;return(n?new URL(e,n):new URL(e)).origin===Ip}catch{return!1}},k_=(e,t)=>{let n=t??ci;try{return(n?new URL(e,n):new URL(e)).href}catch{return}},z_=(e,t)=>`${t??"./"}${e}`,Rp=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},L_=async e=>(await import(e)).default,Np=(uD(),Bl(wE)).default,AE=async()=>{if(!ci)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(yc(ci))return[void 0,Np()];let e=await Rp(ci);return[e,Np(e)]},$p=(cD(),Bl(SE)).default,IE=async(e,t,n,a)=>{let s=$p&&!(e||t);if(s)if(ci)s=yc(ci);else if(a&&!n)s=!0;else throw new Error("cannot determine the script source URL.");if(s)return[void 0,$p];{let o="ort-wasm-simd-threaded.jsep.mjs",u=e??k_(o,t),d=n&&u&&!yc(u,t),p=d?await Rp(u):u??z_(o,t);return[d?p:void 0,await L_(p)]}}}),Mp,vc,Sl,Op,U_,P_,B_,dm,It,co=be(()=>{cm(),vc=!1,Sl=!1,Op=!1,U_=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},P_=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},B_=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},dm=async e=>{if(vc)return Promise.resolve();if(Sl)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Op)throw new Error("previous call to 'initializeWebAssembly()' failed.");Sl=!0;let t=e.initTimeout,n=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!B_())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!P_())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let a=U_();n>1&&!a&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=n=1);let s=e.wasmPaths,o=typeof s=="string"?s:void 0,u=s==null?void 0:s.mjs,d=(u==null?void 0:u.href)??u,p=s==null?void 0:s.wasm,f=(p==null?void 0:p.href)??p,m=e.wasmBinary,[_,b]=await IE(d,o,n>1,!!m||!!f),E=!1,x=[];if(t>0&&x.push(new Promise(I=>{setTimeout(()=>{E=!0,I()},t)})),x.push(new Promise((I,N)=>{let R={numThreads:n};if(m)R.wasmBinary=m;else if(f||o)R.locateFile=$=>f??o+$;else if(d&&d.indexOf("blob:")!==0)R.locateFile=$=>new URL($,d).href;else if(_){let $=CE();$&&(R.locateFile=O=>$+O)}b(R).then($=>{Sl=!1,vc=!0,Mp=$,I(),_&&URL.revokeObjectURL(_)},$=>{Sl=!1,Op=!0,N($)})})),await Promise.race(x),E)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},It=()=>{if(vc&&Mp)return Mp;throw new Error("WebAssembly is not initialized yet.")}}),Fi,Gc,bt,fm=be(()=>{co(),Fi=(e,t)=>{let n=It(),a=n.lengthBytesUTF8(e)+1,s=n._malloc(a);return n.stringToUTF8(e,s,a),t.push(s),s},Gc=(e,t,n,a)=>{if(typeof e=="object"&&e!==null){if(n.has(e))throw new Error("Circular reference in options");n.add(e)}Object.entries(e).forEach(([s,o])=>{let u=t?t+s:s;if(typeof o=="object")Gc(o,u+".",n,a);else if(typeof o=="string"||typeof o=="number")a(u,o.toString());else if(typeof o=="boolean")a(u,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},bt=e=>{let t=It(),n=t.stackSave();try{let a=t.PTR_SIZE,s=t.stackAlloc(2*a);t._OrtGetLastError(s,s+a);let o=Number(t.getValue(s,a===4?"i32":"i64")),u=t.getValue(s+a,"*"),d=u?t.UTF8ToString(u):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${d}`)}finally{t.stackRestore(n)}}}),RE,dD=be(()=>{co(),fm(),RE=e=>{let t=It(),n=0,a=[],s=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)s.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)s.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(s.terminate=!1);let o=0;return(e==null?void 0:e.tag)!==void 0&&(o=Fi(e.tag,a)),n=t._OrtCreateRunOptions(s.logSeverityLevel,s.logVerbosityLevel,!!s.terminate,o),n===0&&bt("Can't create run options."),(e==null?void 0:e.extra)!==void 0&&Gc(e.extra,"",new WeakSet,(u,d)=>{let p=Fi(u,a),f=Fi(d,a);t._OrtAddRunConfigEntry(n,p,f)!==0&&bt(`Can't set a run config entry: ${u} - ${d}.`)}),[n,a]}catch(o){throw n!==0&&t._OrtReleaseRunOptions(n),a.forEach(u=>t._free(u)),o}}}),G_,V_,q_,xl,H_,NE,fD=be(()=>{co(),fm(),G_=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},V_=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},q_=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(e.enableMemPattern=!1)},xl=(e,t,n,a)=>{let s=Fi(t,a),o=Fi(n,a);It()._OrtAddSessionConfigEntry(e,s,o)!==0&&bt(`Can't set a session config entry: ${t} - ${n}.`)},H_=async(e,t,n)=>{for(let a of t){let s=typeof a=="string"?a:a.name,o=[];switch(s){case"webnn":if(s="WEBNN",typeof a!="string"){let m=a==null?void 0:a.deviceType;m&&xl(e,"deviceType",m,n)}break;case"webgpu":if(s="JS",typeof a!="string"){let m=a;if(m!=null&&m.preferredLayout){if(m.preferredLayout!=="NCHW"&&m.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${m.preferredLayout}`);xl(e,"preferredLayout",m.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let u=Fi(s,n),d=o.length,p=0,f=0;if(d>0){p=It()._malloc(d*It().PTR_SIZE),n.push(p),f=It()._malloc(d*It().PTR_SIZE),n.push(f);for(let m=0;m<d;m++)It().setValue(p+m*It().PTR_SIZE,o[m][0],"*"),It().setValue(f+m*It().PTR_SIZE,o[m][1],"*")}await It()._OrtAppendExecutionProvider(e,u,p,f,d)!==0&&bt(`Can't append execution provider: ${s}.`)}},NE=async e=>{let t=It(),n=0,a=[],s=e||{};q_(s);try{let o=G_(s.graphOptimizationLevel??"all"),u=V_(s.executionMode??"sequential"),d=typeof s.logId=="string"?Fi(s.logId,a):0,p=s.logSeverityLevel??2;if(!Number.isInteger(p)||p<0||p>4)throw new Error(`log severity level is not valid: ${p}`);let f=s.logVerbosityLevel??0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let m=typeof s.optimizedModelFilePath=="string"?Fi(s.optimizedModelFilePath,a):0;if(n=t._OrtCreateSessionOptions(o,!!s.enableCpuMemArena,!!s.enableMemPattern,u,!!s.enableProfiling,0,d,p,f,m),n===0&&bt("Can't create session options."),s.executionProviders&&await H_(n,s.executionProviders,a),s.enableGraphCapture!==void 0){if(typeof s.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);xl(n,"enableGraphCapture",s.enableGraphCapture.toString(),a)}if(s.freeDimensionOverrides)for(let[_,b]of Object.entries(s.freeDimensionOverrides)){if(typeof _!="string")throw new Error(`free dimension override name must be a string: ${_}`);if(typeof b!="number"||!Number.isInteger(b)||b<0)throw new Error(`free dimension override value must be a non-negative integer: ${b}`);let E=Fi(_,a);t._OrtAddFreeDimensionOverride(n,E,b)!==0&&bt(`Can't set a free dimension override: ${_} - ${b}.`)}return s.extra!==void 0&&Gc(s.extra,"",new WeakSet,(_,b)=>{xl(n,_,b,a)}),[n,a]}catch(o){throw n!==0&&t._OrtReleaseSessionOptions(n)!==0&&bt("Can't release session options."),a.forEach(u=>t._free(u)),o}}}),no,Na,io,id,Vc,pm,hm,kh,Ve=be(()=>{no=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Na=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},io=(e,t)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],a=typeof t=="number"?t:t.reduce((s,o)=>s*o,1);return n>0?Math.ceil(a*n):void 0},id=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Vc=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},pm=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",hm=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",kh=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),mm,$E=be(()=>{um(),mm=async e=>{if(typeof e=="string"){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let n=t.headers.get("Content-Length"),a=n?parseInt(n,10):0;if(a<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let s=t.body.getReader(),o;try{o=new ArrayBuffer(a)}catch(d){if(d instanceof RangeError){let p=Math.ceil(a/65536);o=new WebAssembly.Memory({initial:p,maximum:p}).buffer}else throw d}let u=0;for(;;){let{done:d,value:p}=await s.read();if(d)break;let f=p.byteLength;new Uint8Array(o,u,f).set(p),u+=f}return new Uint8Array(o,0,a)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),F_,Y_,W_,K_,gm,J_,lt,Da=be(()=>{Ve(),F_=["V","I","W","E","F"],Y_=(e,t)=>{console.log(`[${F_[e]},${new Date().toISOString()}]${t}`)},gm=(e,t)=>{W_=e,K_=t},J_=(e,t)=>{let n=Vc(e),a=Vc(W_);n>=a&&Y_(n,typeof t=="function"?t():t)},lt=(...e)=>{K_&&J_(...e)}}),X_,ss,ae,qc,ME,OE,DE,Je=be(()=>{X_=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},ss=class{static calcShape(e,t,n=!1){let a=e.length,s=t.length;if(a===0)return t;if(s===0)return e;let o=Math.max(e.length,t.length),u=new Array(o);if(n){if(a<2||s<2)return;let d=X_.calcMatMulShape([e[a-2],e[a-1]],[t[s-2],t[s-1]]);if(d===void 0)return;[u[o-2],u[o-1]]=d}for(let d=n?3:1;d<=o;d++){let p=a-d<0?1:e[a-d],f=s-d<0?1:t[s-d];if(p!==f&&p>1&&f>1)return;let m=Math.max(p,f);if(p&&f)u[o-d]=Math.max(p,f);else{if(m>1)return;u[o-d]=0}}return u}static isValidBroadcast(e,t){let n=e.length,a=t.length;if(n>a)return!1;for(let s=1;s<=n;s++)if(e[n-s]!==1&&e[n-s]!==t[a-s])return!1;return!0}},ae=class $c{static size(t){return $c.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,n=4){let a=t.length;if(a===0)return[];let s=new Array(a),o=a-1;for(;o>=0;){if(t[o]%n===0){s[o]=t[o]/n;break}if(n%t[o]!==0)throw new Error("cannot convert shape");s[o]=1,n/=t[o],o--}for(o--;o>=0;o--)s[o]=t[o];return s}static sizeFromDimension(t,n){if(n<0||n>t.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return $c.getSizeFromDimensionRange(t,n,t.length)}static sizeToDimension(t,n){if(n<0||n>t.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${t.length} dimensions.`);return $c.getSizeFromDimensionRange(t,0,n)}static getSizeFromDimensionRange(t,n,a){let s=1;for(let o=n;o<a;o++){if(t[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");s*=Number(t[o])}return s}static computeStrides(t){let n=t.length;if(n===0)return[];if(n===1)return[1];let a=new Array(n);a[n-1]=1,a[n-2]=t[n-1];for(let s=n-3;s>=0;--s)a[s]=a[s+1]*t[s+1];return a}static normalizeAxis(t,n){if(t<-n&&t>=n)throw new Error("unsupported axis for this operation.");return t<0?t+n:t}static normalizeAxes(t,n){return t.map(a=>this.normalizeAxis(a,n??t.length))}static sortBasedOnPerm(t,n){return n?n.map(a=>t[a]):t.slice().reverse()}static padShape(t,n){let a=t.length;return t.map((s,o)=>s+n[o]+n[o+a])}static areEqual(t,n){return t.length!==n.length?!1:t.every((a,s)=>a===n[s])}},qc=class zl{static adjustPoolAttributes(t,n,a,s,o,u){if(!t&&a.length!==n.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let d=0;d<n.length-2;d++)d>=a.length?a.push(n[d+2]):a[d]=n[d+2];for(let d=0;d<a.length;d++)if(d<s.length){if(s[d]<0)throw new Error("strides should be greater than or equal to 1")}else s.push(1);for(let d=0;d<a.length;d++)if(d<o.length){if(o[d]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let d=0;d<a.length*2;d++)if(d<u.length){if(u[d]<0)throw new Error("pad should be greater than or equal to 1")}else u.push(0);for(let d=0;d<a.length;d++){if(a[d]<=0)throw new Error("kernel shapes need to be greater than 0");if(u[d]>=a[d]||u[d+a.length]>=a[d])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,n,a,s,o,u,d){if(d){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(s.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let p=0;p<t.length-2;p++)zl.adjustPadAndReturnShape(t[p+(u?1:2)],n[p],a[p],s[p],o,p,p+t.length-2,d)}}static computePoolOutputShape(t,n,a,s,o,u,d){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let p=[n[0],n[1]];return zl.computeShapeHelper(t,n,p,a,s,o,u,d),p}static computeConvOutputShape(t,n,a,s,o,u,d){if(t.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let p=[t[0],n[0]];return zl.computeShapeHelper(!1,t,p,a,s,o,u,d),p}static computeShapeHelper(t,n,a,s,o,u,d,p){if(t)for(let f=0;f<n.length-2;f++)a.push(1);else for(let f=0;f<n.length-2;f++)a.push(zl.adjustPadAndReturnShape(n[f+2],s[f],o[f],u[f],d,f,f+n.length-2,p))}static adjustPadAndReturnShape(t,n,a,s,o,u,d,p){let f=a*(s-1)+1;if(p&&p!=="NOTSET")switch(p){case"VALID":return o[u]=0,o[d]=0,Math.floor((t-f)/n+1);case"SAME_LOWER":case"SAME_UPPER":if(a!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let m=((t+n-1)/n-1)*n+s-t;return o[u]=Math.floor(p==="SAME_LOWER"?(m+1)/2:m/2),o[d]=m-o[u],Math.floor((t+m-s)/n+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+o[u]+o[d]-f)/n+1)}},ME=class{static getShapeOfGemmResult(e,t,n,a,s){if(e.length!==2||n.length!==2)throw new Error("shape need to be of size 2");let o,u,d;t?(o=e[1],u=e[0]):(o=e[0],u=e[1]);let p=-1;if(a?(d=n[0],p=1):(d=n[1],p=0),n[p]!==u)throw new Error("dimension mismatch");if(o<=0||d<=0||u<=0)throw new Error("invalid shape specified");if(s&&!ss.isValidBroadcast(s,[o,d]))throw new Error("gemm: invalid bias shape for broadcast");return[o,d,u]}},OE=-34028234663852886e22,DE=34028234663852886e22}),ym,kE=be(()=>{Ve(),ym=(e,t)=>new(id(t))(e)}),Dp,zh,kp,Z_,zp,Q_,Lp,Up,Pp,j_,zE,pD=be(()=>{Ve(),Da(),Dp=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),zh=(e,t)=>{if(t==="int32")return e;let n=Dp.get(t);if(!n)throw new Error(`WebNN backend does not support data type: ${t}`);let a=n/8;if(e.byteLength%a!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${a}.`);let s=e.byteLength/a,o=new(id(t))(e.buffer,e.byteOffset,s);switch(t){case"int64":case"uint64":{let u=new Int32Array(s);for(let d=0;d<s;d++){let p=o[d];if(p>2147483647n||p<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");u[d]=Number(p)}return new Uint8Array(u.buffer)}case"int8":case"uint8":case"uint32":{if(t==="uint32"&&o.some(d=>d>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let u=Int32Array.from(o,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},kp=(e,t)=>{if(t==="int32")return e;if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let n=e.byteLength/4,a=new Int32Array(e.buffer,e.byteOffset,n);switch(t){case"int64":{let s=BigInt64Array.from(a,BigInt);return new Uint8Array(s.buffer)}case"uint64":{if(a.some(o=>o<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let s=BigUint64Array.from(a,BigInt);return new Uint8Array(s.buffer)}case"int8":{if(a.some(o=>o<-128||o>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let s=Int8Array.from(a,Number);return new Uint8Array(s.buffer)}case"uint8":{if(a.some(s=>s<0||s>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(a,Number)}case"uint32":{if(a.some(o=>o<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let s=Uint32Array.from(a,Number);return new Uint8Array(s.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},Z_=1,zp=()=>Z_++,Q_=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Lp=(e,t)=>{let n=Dp.get(e);if(!n)throw new Error(`WebNN backend does not support data type: ${e}`);return t.length>0?Math.ceil(t.reduce((a,s)=>a*s)*n/8):0},Up=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:n,tensor:a,dataType:s,shape:o,fallbackDataType:u}=e;this.sessionId=t,this.mlContext=n,this.mlTensor=a,this.dataType=s,this.tensorShape=o,this.fallbackDataType=u}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Lp(this.dataType,this.tensorShape)}destroy(){lt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),n=kp(new Uint8Array(t),this.dataType);if(e){(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(n);return}else return n.buffer}else return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,n){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===n.length&&this.tensorShape.every((a,s)=>a===n[s])}setIsDataConverted(e){this.isDataConverted=e}},Pp=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,n,a){let s=this.tensorManager.getMLContext(e),o;if(!s.opSupportLimits().input.dataTypes.includes(t)){if(o=Q_.get(t),!o||!s.opSupportLimits().input.dataTypes.includes(o))throw new Error(`WebNN backend does not support data type: ${t}`);lt("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${t} to ${o}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(s,t,n))return this.wrapper.tensor;if(a){if(this.wrapper.byteLength!==Lp(t,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let u=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,n,u,!0,!0,o),a&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")t=zh(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(e.byteLength===this.wrapper.byteLength){this.wrapper.write(t);return}else lt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){var t,n;if(this.activeUpload){let a=(t=this.wrapper)!=null&&t.isDataConverted?kp(this.activeUpload,(n=this.wrapper)==null?void 0:n.type):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(a):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},j_=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=zp();return this.tensorTrackersById.set(e,new Pp(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,n,a,s){lt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${n}, shape: ${a}, copyOld: ${s}}`);let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,n,a,s)}upload(e,t){let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");n.upload(t)}async download(e,t){lt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t==null?void 0:t.byteLength}}`);let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");return n.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,n,a){let s=this.getMLContext(e),o=zp(),u=new Up({sessionId:e,context:s,tensor:t,dataType:n,shape:a});return this.tensorTrackersById.set(o,new Pp(this,u)),this.externalTensors.add(u),o}async getCachedTensor(e,t,n,a,s,o,u){let d=this.getMLContext(e);for(let[f,m]of this.freeTensors.entries())if(m.canReuseTensor(d,t,n)){lt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, ${u?`fallbackDataType: ${u},`:""} shape: ${n}`);let _=this.freeTensors.splice(f,1)[0];return _.sessionId=e,_}lt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, ${u?`fallbackDataType: ${u},`:""} shape: ${n}}`);let p=await d.createTensor({dataType:u??t,shape:n,dimensions:n,usage:a,writable:s,readable:o});return new Up({sessionId:e,context:d,tensor:p,dataType:t,shape:n,fallbackDataType:u})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},zE=(...e)=>new j_(...e)}),Cl,eb,LE,hD=be(()=>{Ve(),co(),kE(),pD(),Da(),Cl=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),eb=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let n=Object.keys(e).sort(),a=Object.keys(t).sort();return n.length===a.length&&n.every((s,o)=>s===a[o]&&e[s]===t[s])},LE=class{constructor(e){this.tensorManager=zE(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,gm(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){lt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){lt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let n of t)lt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let n=this.mlContextCache.findIndex(a=>a.gpuDevice===e);if(n!==-1)return this.mlContextCache[n].mlContext;{let a=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:a}),a}}else if(e===void 0){let n=this.mlContextCache.findIndex(a=>a.options===void 0&&a.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let a=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:a}),a}}let t=this.mlContextCache.findIndex(n=>eb(n.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let n=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:n}),n}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let n=this.sessionIdsByMLContext.get(t);n||(n=new Set,this.sessionIdsByMLContext.set(t,n)),n.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let n=this.sessionIdsByMLContext.get(t);if(n.delete(e),n.size===0){this.sessionIdsByMLContext.delete(t);let a=this.mlContextCache.findIndex(s=>s.mlContext===t);a!==-1&&this.mlContextCache.splice(a,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){lt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,n,a,s){let o=Cl.get(n);if(!o)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,a,s)}async createTemporaryTensor(e,t,n){lt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${n}}`);let a=Cl.get(t);if(!a)throw new Error(`Unsupported ONNX data type: ${t}`);let s=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,s,a,n,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(s):this.temporarySessionTensorIds.set(e,[s]),s}uploadTensor(e,t){if(!It().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");lt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let n=await this.tensorManager.download(e);return ym(n,t)}}registerMLTensor(e,t,n,a){let s=Cl.get(n);if(!s)throw new Error(`Unsupported ONNX data type: ${n}`);let o=this.tensorManager.registerTensor(e,t,s,a);return lt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${s}, dimensions: ${a}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,n,a,s,o,u=!1){if(!o)throw new Error("External mounted files are not available.");let d=e;e.startsWith("./")&&(d=e.substring(2));let p=o.get(d);if(!p)throw new Error(`File with name ${d} not found in preloaded files.`);if(t+n>p.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let f=p.slice(t,t+n).buffer,m;switch(s.dataType){case"float32":m=new Float32Array(f);break;case"float16":m=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":m=new Int32Array(f);break;case"uint32":m=new Uint32Array(f);break;case"int64":if(u){let _=zh(new Uint8Array(f),"int64");m=new Int32Array(_.buffer),s.dataType="int32"}else m=new BigInt64Array(f);break;case"uint64":m=new BigUint64Array(f);break;case"int8":m=new Int8Array(f);break;case"int4":case"uint4":case"uint8":m=new Uint8Array(f);break;default:throw new Error(`Unsupported data type: ${s.dataType} in creating WebNN Constant from external data.`)}return lt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${s.dataType}, shape: ${s.shape}}} ${u?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),a.constant(s,m)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let n=this.sessionGraphInputs.get(e);return n?n.includes(t):!1}isGraphOutput(e,t){let n=this.sessionGraphOutputs.get(e);return n?n.includes(t):!1}isGraphInputOutputTypeSupported(e,t,n=!0){let a=this.mlContextBySessionId.get(e),s=Cl.get(no(t));return typeof s>"u"?!1:n?!!(a!=null&&a.opSupportLimits().input.dataTypes.includes(s)):!!(a!=null&&a.opSupportLimits().output.dataTypes.includes(s))}flush(){}}}),vm=be(()=>{}),Bp,_c,bc,tb,nb,Gp,Lh,ib,UE,mD=be(()=>{Da(),vm(),Bp=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),_c=[],bc=e=>Math.ceil(Number(e)/16)*16,tb=e=>{for(let t=0;t<_c.length;t++){let n=_c[t];if(e<=n)return n}return Math.ceil(e/16)*16},nb=1,Gp=()=>nb++,Lh=async(e,t,n,a)=>{let s=bc(n),o=e.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let u=e.getCommandEncoder();e.endComputePass(),u.copyBufferToBuffer(t,0,o,0,s),e.flush(),await o.mapAsync(GPUMapMode.READ);let d=o.getMappedRange();if(a){let p=a();return p.set(new Uint8Array(d,0,n)),p}else return new Uint8Array(d.slice(0,n))}finally{o.destroy()}},ib=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of Bp)_c.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let n=t.buffer,a=t.byteOffset,s=t.byteLength,o=bc(s),u=this.storageCache.get(e);if(!u)throw new Error("gpu data for uploading does not exist");if(Number(u.originalSize)!==s)throw new Error(`inconsistent data size. gpu data size=${u.originalSize}, data size=${s}`);let d=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),p=d.getMappedRange();new Uint8Array(p).set(new Uint8Array(n,a,s)),d.unmap();let f=this.backend.device.createCommandEncoder();f.copyBufferToBuffer(d,0,u.gpuData.buffer,0,o),this.backend.device.queue.submit([f.finish()]),d.destroy(),lt("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let n=this.storageCache.get(e);if(!n)throw new Error("source gpu data for memcpy does not exist");let a=this.storageCache.get(t);if(!a)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==a.originalSize)throw new Error("inconsistent source and destination gpu data size");let s=bc(n.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(n.gpuData.buffer,0,a.gpuData.buffer,0,s)}registerExternalBuffer(e,t,n){let a;if(n){if(a=n[0],e===n[1])return lt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${a}, buffer is the same, skip.`),a;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else a=Gp();return this.storageCache.set(a,{gpuData:{id:a,type:0,buffer:e},originalSize:t}),lt("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${a}, registered.`),a}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),lt("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n=tb(e),a,s=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(s||o){let d=(s?this.freeBuffers:this.freeUniformBuffers).get(n);d?d.length>0?a=d.pop():a=this.backend.device.createBuffer({size:n,usage:t}):a=this.backend.device.createBuffer({size:n,usage:t})}else a=this.backend.device.createBuffer({size:n,usage:t});let u={id:Gp(),type:0,buffer:a};return this.storageCache.set(u.id,{gpuData:u,originalSize:Number(e)}),lt("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${u.id}`),u}get(e){var t;return(t=this.storageCache.get(e))==null?void 0:t.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,n=this.storageCache.get(t);if(!n){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return lt("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${n.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(e,t){let n=this.storageCache.get(Number(e));if(!n)throw new Error("data does not exist");await Lh(this.backend,n.gpuData.buffer,n.originalSize,t)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=Bp.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(e.size)||[];t===void 0||n.length>=t?e.destroy():n.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(e.size)||[];t===void 0||n.length>=t?e.destroy():n.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(n=>{n.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(lt("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.storageCache=new Map)}},UE=(...e)=>new ib(...e)}),ab,pt,Jt=be(()=>{ab=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},pt=e=>new ab(e)}),ls,Tc,mn,zn,Oe,Ht,Uh,is,Tr,Ne,Al,ue,Ce,PE,_m,rb,BE,Xe=be(()=>{Ve(),Je(),ls=64,Tc=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},mn=(e,t=1)=>{let n=Tc(e,t);return typeof n=="string"?n:n[0]},zn=(e,t=1)=>{let n=Tc(e,t);return typeof n=="string"?n:n[1]},Oe=(...e)=>{let t=[];return e.forEach(n=>{n.length!==0&&t.push({type:12,data:n},{type:12,data:ae.computeStrides(n)})}),t},Ht=e=>e%4===0?4:e%2===0?2:1,Uh=(e="f32",t,n="0")=>!t||t===1?`${e}(${n})`:`vec${t}<${e}>(${n})`,is=(e,t,n)=>e==="f32"?n:t===1?`f32(${n})`:`vec${t}<f32>(${n})`,Tr=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,Ne=(e,t,n,a)=>e.startsWith("uniforms.")&&n>4?typeof t=="string"?a==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:a==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:n>1?`${e}[${t}]`:e,Al=(e,t,n,a,s)=>{let o=typeof n=="number",u=o?n:n.length,d=[...new Array(u).keys()],p=u<2?"u32":u<=4?`vec${u}<u32>`:`array<u32, ${u}>`,f=Tc(t,s),m=typeof f=="string"?f:f[1],_=typeof f=="string"?f:f[0],b={indices:p,value:m,storage:_,tensor:t},E=z=>typeof z=="string"?z:`${z}u`,x={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},I=o?"uniforms.":"",N=`${I}${e}_shape`,R=`${I}${e}_strides`,$="";for(let z=0;z<u-1;z++)$+=`
    let dim${z} = current / ${Ne(R,z,u)};
    let rest${z} = current % ${Ne(R,z,u)};
    indices[${z}] = dim${z};
    current = rest${z};
    `;$+=`indices[${u-1}] = current;`;let O=u<2?"":`
  fn o2i_${e}(offset: u32) -> ${b.indices} {
    var indices: ${b.indices};
    var current = offset;
    ${$}
    return indices;
  }`,k=z=>(x.offsetToIndices=!0,u<2?z:`o2i_${e}(${z})`),P=[];if(u>=2)for(let z=u-1;z>=0;z--)P.push(`${Ne(R,z,u)} * (indices[${z}])`);let G=u<2?"":`
  fn i2o_${e}(indices: ${b.indices}) -> u32 {
    return ${P.join("+")};
  }`,B=z=>(x.indicesToOffset=!0,u<2?z:`i2o_${e}(${z})`),K=(...z)=>u===0?"0u":`${b.indices}(${z.map(E).join(",")})`,Y=(z,q)=>u<2?`${z}`:`${Ne(z,q,u)}`,se=(z,q,te)=>u<2?`${z}=${te};`:`${Ne(z,q,u)}=${te};`,ve={},_e=(z,q)=>{x.broadcastedIndicesToOffset=!0;let te=`${q.name}broadcastedIndicesTo${e}Offset`;if(te in ve)return`${te}(${z})`;let de=[];for(let Me=u-1;Me>=0;Me--){let Fe=q.indicesGet("outputIndices",Me+q.rank-u);de.push(`${Y(R,Me)} * (${Fe} % ${Y(N,Me)})`)}return ve[te]=`fn ${te}(outputIndices: ${q.type.indices}) -> u32 {
             return ${de.length>0?de.join("+"):"0u"};
           }`,`${te}(${z})`},ge=(z,q)=>(()=>{if(b.storage===b.value)return`${e}[${z}]=${q};`;if(b.storage==="vec2<u32>"&&b.value==="i32")return`${e}[${z}]=vec2<u32>(u32(${q}), select(0u, 0xFFFFFFFFu, ${q} < 0));`;if(b.storage==="vec2<u32>"&&b.value==="u32")return`${e}[${z}]=vec2<u32>(u32(${q}), 0u);`;if(b.storage==="u32"&&b.value==="vec4<bool>")return`${e}[${z}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${q}));`;throw new Error(`not supported combination of storage type ${b.storage} and value type ${b.value} yet`)})(),$e=z=>(()=>{if(b.storage===b.value)return`${e}[${z}]`;if(b.storage==="vec2<u32>"&&b.value==="i32")return`i32(${e}[${z}].x)`;if(b.storage==="vec2<u32>"&&b.value==="u32")return`u32(${e}[${z}].x)`;if(b.storage==="u32"&&b.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${z}] & 0xFFu), bool(${e}[${z}] & 0xFF00u), bool(${e}[${z}] & 0xFF0000u), bool(${e}[${z}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${b.storage} and value type ${b.value} yet`)})(),Ae=u<2?"":`
  fn get_${e}ByIndices(indices: ${b.indices}) -> ${m} {
    return ${$e(`i2o_${e}(indices)`)};
  }`,H=u<2?"":(()=>{let z=d.map(te=>`d${te}: u32`).join(", "),q=d.map(te=>`d${te}`).join(", ");return`
  fn get_${e}(${z}) -> ${m} {
    return get_${e}ByIndices(${K(q)});
  }`})(),j=(...z)=>{if(z.length!==u)throw new Error(`indices length must be ${u}`);let q=z.map(E).join(",");return u===0?$e("0u"):u===1?$e(q[0]):(x.get=!0,x.getByIndices=!0,x.indicesToOffset=!0,`get_${e}(${q})`)},fe=z=>u<2?$e(z):(x.getByIndices=!0,x.indicesToOffset=!0,`get_${e}ByIndices(${z})`),Ee=u<2?"":`
  fn set_${e}ByIndices(indices: ${b.indices}, value: ${m}) {
    ${ge(`i2o_${e}(indices)`,"value")}
  }`,Ie=u<2?"":(()=>{let z=d.map(te=>`d${te}: u32`).join(", "),q=d.map(te=>`d${te}`).join(", ");return`
  fn set_${e}(${z}, value: ${m}) {
    set_${e}ByIndices(${K(q)}, value);
  }`})();return{impl:()=>{let z=[],q=!1;return x.offsetToIndices&&(z.push(O),q=!0),x.indicesToOffset&&(z.push(G),q=!0),x.broadcastedIndicesToOffset&&(Object.values(ve).forEach(te=>z.push(te)),q=!0),x.set&&(z.push(Ie),q=!0),x.setByIndices&&(z.push(Ee),q=!0),x.get&&(z.push(H),q=!0),x.getByIndices&&(z.push(Ae),q=!0),!o&&q&&z.unshift(`const ${N} = ${b.indices}(${n.join(",")});`,`const ${R} = ${b.indices}(${ae.computeStrides(n).join(",")});`),z.join(`
`)},type:b,offsetToIndices:k,indicesToOffset:B,broadcastedIndicesToOffset:_e,indices:K,indicesGet:Y,indicesSet:se,set:(...z)=>{if(z.length!==u+1)throw new Error(`indices length must be ${u}`);let q=z[u];if(typeof q!="string")throw new Error("value must be string");let te=z.slice(0,u).map(E).join(",");return u===0?ge("0u",q):u===1?ge(te[0],q):(x.set=!0,x.setByIndices=!0,x.indicesToOffset=!0,`set_${e}(${te}, ${q})`)},setByOffset:ge,setByIndices:(z,q)=>u<2?ge(z,q):(x.setByIndices=!0,x.indicesToOffset=!0,`set_${e}ByIndices(${z}, ${q});`),get:j,getByOffset:$e,getByIndices:fe,usage:a,name:e,strides:R,shape:N,rank:u}},ue=(e,t,n,a=1)=>Al(e,t,n,"input",a),Ce=(e,t,n,a=1)=>Al(e,t,n,"output",a),PE=(e,t,n)=>Al(e,t,n,"atomicOutput",1),_m=(e,t,n,a=1)=>Al(e,t,n,"internal",a),rb=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=ls){let t=typeof e=="number"?e:e[0],n=typeof e=="number"?1:e[1],a=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||a>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${n}, ${a}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*n*a>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${n}, ${a}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let s=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=s?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,u=s?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*n*a}u + local_idx;`;return`@compute @workgroup_size(${t}, ${n}, ${a})
  fn main(${o}) {
    ${u}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let n=e.usage==="input"?"read":"read_write",a=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${n}> ${e.name}: array<${a}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,n=1){return this.uniforms.push({name:e,type:t,length:n}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:n,length:a}of this.uniforms)if(a&&a>4)n==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${n}>, ${Math.ceil(a/8)}>`):e.push(`${t}:array<vec4<${n}>, ${Math.ceil(a/4)}>`);else{let s=a==null||a===1?n:`vec${a}<${n}>`;e.push(`${t}:${s}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},BE=(e,t)=>new rb(e,t)}),ob,Vp,sb,lb,ub,cb,fi,GE,VE,Er=be(()=>{Ve(),Je(),Jt(),Xe(),ob=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},Vp=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),sb=(e,t)=>ae.sortBasedOnPerm(e,Vp(e.length,t)),lb=(e,t,n,a)=>{let s=`fn perm(i: ${a.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`;for(let o=0;o<t;++o)s+=`a[${e[o]}]=i[${o}];`;return s+="return a;}"},ub=(e,t)=>{let n=[],a=[];for(let s=0;s<e.length;++s)e[s]!==1&&n.push(e[s]),e[t[s]]!==1&&a.push(t[s]);return{newShape:n,newPerm:a}},cb=(e,t)=>{let n=0;for(let a=0;a<e.length;++a)if(t[e[a]]!==1){if(e[a]<n)return!1;n=e[a]}return!0},fi=(e,t)=>{let n=e.dataType,a=e.dims.length,s=Vp(a,t),o=sb(e.dims,s),u=e.dims,d=o,p=a<2||cb(s,e.dims),f;if(p)return f=x=>{let I=ue("input",n,u,4),N=Ce("output",n,d,4);return`
  ${x.registerUniform("output_size","u32").declareVariables(I,N)}
  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let x=ae.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(x/64/4)},programUniforms:[{type:12,data:Math.ceil(x/4)}]}},getShaderSource:f};let{newShape:m,newPerm:_}=ub(e.dims,s),b=ae.areEqual(_,[2,3,1]),E=ae.areEqual(_,[3,1,2]);if(m.length===2||b||E){u=b?[m[0],m[1]*m[2]]:E?[m[0]*m[1],m[2]]:m,d=[u[1],u[0]];let x=16;return f=I=>{let N=ue("a",n,u.length),R=Ce("output",n,d.length);return`
  ${I.registerUniform("output_size","u32").declareVariables(N,R)}
  var<workgroup> tile : array<array<${R.type.value}, ${x+1}>, ${x}>;
  ${I.mainStart([x,x,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${x} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${x}u + local_id.x;
    let input_row = workgroup_id_x * ${x}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${N.getByIndices(`${N.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${x}u + local_id.x;
    let output_row = workgroup_id_y * ${x}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${R.setByIndices(`${R.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let I=ae.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(d[1]/x),y:Math.ceil(d[0]/x)},programUniforms:[{type:12,data:I},...Oe(u,d)]}},getShaderSource:f}}return f=x=>{let I=ue("a",n,u.length),N=Ce("output",n,d.length);return`
  ${x.registerUniform("output_size","u32").declareVariables(I,N)}

  ${lb(s,a,I,N)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${N.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${N.setByOffset("global_idx",I.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let x=ae.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(x/64)},programUniforms:[{type:12,data:x},...Oe(u,d)]}},getShaderSource:f}},GE=(e,t)=>{ob(e.inputs,t.perm),e.compute(fi(e.inputs[0],t.perm))},VE=e=>pt({perm:e.perm})}),db,fb,pb,hb,mb,gb,yb,vb,_b,bb,Bi,qE,HE,FE,YE,WE,KE,JE,XE,ZE,QE,gD=be(()=>{Ve(),Je(),Xe(),bm(),Er(),db={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},fb={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},pb={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},hb={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},mb=(e,t)=>{let n=[];for(let a=t-e;a<t;++a)n.push(a);return n},gb=(e,t)=>{let n=[],a=e.length;for(let o=0;o<a;o++)t.indexOf(o)===-1&&n.push(e[o]);let s=t.map(o=>e[o]);return[n,s]},yb=(e,t)=>{let n=e.length+t.length,a=[],s=0;for(let o=0;o<n;o++)t.indexOf(o)===-1?a.push(e[s++]):a.push(1);return a},vb=(e,t)=>{for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0},_b=(e,t)=>{let n=[];if(!vb(e,t)){for(let a=0;a<t;++a)e.indexOf(a)===-1&&n.push(a);e.forEach(a=>n.push(a))}return n},bb=(e,t,n,a,s,o,u)=>{let d=n[0].dims,p=ae.size(o),f=ae.size(u),m=ue("_A",n[0].dataType,d),_=Ce("output",s,o),b=64;p===1&&(b=256);let E=`
          var<workgroup> aBestValues : array<f32, ${b}>;
       `,x=I=>`
        ${I.registerUniform("reduceSize","u32").declareVariables(m,_)}
        ${E}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${I.mainStart(b)}

          let outputIndex = global_idx / ${b};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${pb[a]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${b}) {
           let candidate = f32(${m.getByOffset("offset + k")});
           bestValue = ${db[a]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${b}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${fb[a]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${_.setByOffset("outputIndex",`${a==="mean"?`${_.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${_.type.storage}(${hb[a]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${b}`,inputDependencies:["type"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:p},programUniforms:[{type:12,data:f}]})}},Bi=(e,t,n,a)=>{let s=e.inputs.length===1?n:Ph(e.inputs,n),o=s.axes;o.length===0&&!s.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((E,x)=>x));let u=ae.normalizeAxes(o,e.inputs[0].dims.length),d=u,p=e.inputs[0],f=_b(d,e.inputs[0].dims.length);f.length>0&&(p=e.compute(fi(e.inputs[0],f),{inputs:[0],outputs:[-1]})[0],d=mb(d.length,p.dims.length));let[m,_]=gb(p.dims,d),b=m;s.keepDims&&(b=yb(m,u)),e.compute(bb(t,s.cacheKey,[p],a,e.inputs[0].dataType,b,_),{inputs:[p]})},qE=(e,t)=>{Bi(e,"ReduceMeanShared",t,"mean")},HE=(e,t)=>{Bi(e,"ReduceL1Shared",t,"l1")},FE=(e,t)=>{Bi(e,"ReduceL2Shared",t,"l2")},YE=(e,t)=>{Bi(e,"ReduceLogSumExpShared",t,"logSumExp")},WE=(e,t)=>{Bi(e,"ReduceMaxShared",t,"max")},KE=(e,t)=>{Bi(e,"ReduceMinShared",t,"min")},JE=(e,t)=>{Bi(e,"ReduceProdShared",t,"prod")},XE=(e,t)=>{Bi(e,"ReduceSumShared",t,"sum")},ZE=(e,t)=>{Bi(e,"ReduceSumSquareShared",t,"sumSquare")},QE=(e,t)=>{Bi(e,"ReduceLogSumShared",t,"logSum")}}),Gi,Tb,Hc,Ph,Vi,wb,Eb,Sb,xb,Cb,Ab,Ib,Rb,Nb,$b,qi,jE,eS,tS,nS,iS,aS,rS,oS,sS,lS,bm=be(()=>{Ve(),Je(),Jt(),Xe(),gD(),Gi=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Tb=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],Hc=(e,t,n,a,s,o,u=!1,d=!1)=>{let p=[],f=n[0].dims,m=f.length,_=ae.normalizeAxes(s,m),b=!d&&_.length===0;f.forEach((I,N)=>{b||_.indexOf(N)>=0?u&&p.push(1):p.push(I)});let E=p.length,x=ae.size(p);return{name:e,shaderCache:t,getShaderSource:I=>{let N=[],R=ue("_A",n[0].dataType,m),$=Ce("output",o,E),O=a(R,$,_),k=O[2];for(let P=0,G=0;P<m;P++)b||_.indexOf(P)>=0?(u&&G++,k=`for(var j${P}: u32 = 0; j${P} < ${f[P]}; j${P}++) {
                  ${O[2].includes("last_index")?`let last_index = j${P};`:""}
                  ${R.indicesSet("input_indices",P,`j${P}`)}
                  ${k}
                }`):(N.push(`${R.indicesSet("input_indices",P,$.indicesGet("output_indices",G))};`),G++);return`

        ${I.registerUniform("output_size","u32").declareVariables(R,$)}

        ${I.mainStart()}
          ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${R.type.indices};
          let output_indices = ${$.offsetToIndices("global_idx")};

          ${N.join(`
`)}
          ${O[0]}       // init ops for reduce max/min
          ${O[1]}
          ${k}
          ${O[3]}
          ${O.length===4?$.setByOffset("global_idx","value"):O.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:p,dataType:o}],dispatchGroup:{x:Math.ceil(x/64)},programUniforms:[{type:12,data:x},...Oe(f,p)]})}},Ph=(e,t)=>{let n=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(a=>n.push(Number(a))),pt({axes:n,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},Vi=(e,t,n,a)=>{let s=e.inputs,o=s.length===1?n:Ph(s,n);e.compute(Hc(t,{hint:o.cacheKey,inputDependencies:["rank"]},[s[0]],o.noopWithEmptyAxes&&o.axes.length===0?Tb:a,o.axes,s[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},wb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceLogSum",t,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,"value = log(value);"])},Eb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceL1",t,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += abs(${n.getByIndices("input_indices")});`,""])},Sb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceL2",t,(n,a)=>[`var t = ${a.type.value}(0); var value = ${a.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},xb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceLogSumExp",t,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += exp(${n.getByIndices("input_indices")});`,"value = log(value);"])},Cb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceMax",t,(n,a,s)=>{let o=[];for(let u=0;u<n.rank;u++)(s.indexOf(u)>=0||s.length===0)&&o.push(n.indicesSet("input_indices",u,0));return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = max(value, ${n.getByIndices("input_indices")});`,""]})},Ab=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceMean",t,(n,a,s)=>{let o=1;for(let u=0;u<n.rank;u++)(s.indexOf(u)>=0||s.length===0)&&(o*=e.inputs[0].dims[u]);return["var sum = f32(0);","",`sum += f32(${n.getByIndices("input_indices")});`,`let value = ${a.type.value}(sum / ${o});`]})},Ib=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceMin",t,(n,a,s)=>{let o=[];for(let u=0;u<n.rank;u++)(s.indexOf(u)>=0||s.length===0)&&o.push(`input_indices[${u}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = min(value, ${n.getByIndices("input_indices")});`,""]})},Rb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceProd",t,(n,a)=>[`var value = ${a.type.storage}(1);`,"",`value *= ${n.getByIndices("input_indices")};`,""])},Nb=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceSum",t,(n,a)=>[`var value = ${a.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,""])},$b=(e,t)=>{Gi(e.inputs),Vi(e,"ReduceSumSquare",t,(n,a)=>[`var t = ${a.type.value}(0); var value = ${a.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += t * t;`,""])},qi=(e,t,n)=>{if(t.length===0)return n;let a=1,s=1;for(let o=0;o<t.length;o++)t.indexOf(o)===-1?a*=e[o]:s*=e[o];return s<32&&a>1024},jE=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Ab(e,t):qE(e,t)},eS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Eb(e,t):HE(e,t)},tS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Sb(e,t):FE(e,t)},nS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?xb(e,t):YE(e,t)},iS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Cb(e,t):WE(e,t)},aS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Ib(e,t):KE(e,t)},rS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Rb(e,t):JE(e,t)},oS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Nb(e,t):XE(e,t)},sS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?$b(e,t):ZE(e,t)},lS=(e,t)=>{qi(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?wb(e,t):QE(e,t)}}),qp,uS,cS,Bh,yD=be(()=>{Ve(),Jt(),bm(),qp=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},uS=(e,t)=>{qp(e.inputs);let n=(a,s,o)=>{let u=[];for(let d=0;d<a.rank;d++)(o.indexOf(d)>=0||o.length===0)&&u.push(`input_indices[${d}] = 0;`);return[`${u.join(`
`)}`,`var value = ${a.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${a.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${a.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Hc("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],n,[t.axis],7,t.keepDims),{inputs:[0]})},cS=(e,t)=>{qp(e.inputs);let n=(a,s,o)=>{let u=[];for(let d=0;d<a.rank;d++)(o.indexOf(d)>=0||o.length===0)&&u.push(`input_indices[${d}] = 0;`);return[`${u.join(`
`)}`,`var value = ${a.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${a.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${a.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",s.setByOffset("global_idx","best_index")]};e.compute(Hc("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],n,[t.axis],7,t.keepDims),{inputs:[0]})},Bh=e=>pt(e)}),Mb,wc,Ob,Db,kb,Gl,zb,dS,Tm=be(()=>{Ve(),Je(),vm(),Xe(),Mb=(e,t)=>{let n=e[0],a=e[1],s=e[2],o=e[3],u=e[4],d=e[5];if(u&&d)throw new Error("Attention cannot have both past and attention_bias");if(n.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let p=n.dims[0],f=n.dims[1],m=n.dims[2];if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(a.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(a.dims[0]!==m)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(s.dims[0]!==a.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let _=s.dims[0]/3,b=_,E=b;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let O of t.qkvHiddenSizes)if(O%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");_=t.qkvHiddenSizes[0],b=t.qkvHiddenSizes[1],E=t.qkvHiddenSizes[2]}let x=f;if(_!==b)throw new Error("qkv_hidden_sizes first element should be same as the second");if(s.dims[0]!==_+b+E)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let I=0;if(u){if(b!==E)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(u.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(u.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(u.dims[1]!==p)throw new Error('Input "past" second dimension must be batch_size');if(u.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(u.dims[4]!==b/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(I=u.dims[3])}let N=x+I,R=-1,$=0;if(o)throw new Error("Mask not supported");if(u)throw new Error("past is not supported");if(d){if(d.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(d.dims[0]!==p||d.dims[1]!==t.numHeads||d.dims[2]!==f||d.dims[3]!==N)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:p,sequenceLength:f,pastSequenceLength:I,kvSequenceLength:x,totalSequenceLength:N,maxSequenceLength:R,inputHiddenSize:m,hiddenSize:_,vHiddenSize:E,headSize:Math.floor(_/t.numHeads),vHeadSize:Math.floor(E/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:$,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},wc=(e,t,n)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e==null?void 0:e.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${n?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Ob=(e,t,n,a,s,o,u,d)=>{let p=Ht(u?1:o),f=64,m=o/p;m<f&&(f=32);let _=Math.ceil(o/p/f),b=[{type:12,data:t},{type:12,data:n},{type:12,data:a},{type:12,data:s},{type:12,data:m},{type:12,data:_}],E=mn(e.dataType,p),x=zn(1,p),I=["type"];u&&I.push("type"),d&&I.push("type");let N=R=>{let $=Ce("x",e.dataType,e.dims,p),O=[$],k=u?ue("seq_lens",u.dataType,u.dims):void 0;k&&O.push(k);let P=d?ue("total_sequence_length_input",d.dataType,d.dims):void 0;P&&O.push(P);let G=zn(e.dataType),B=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${f}>;
  var<workgroup> thread_sum: array<f32, ${f}>;
  ${R.registerUniforms(B).declareVariables(...O)}
  ${R.mainStart([f,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${wc(k,P,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${f}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${u?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${x}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${x}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(p){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${p}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${f}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${x}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${x}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(p){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${p}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${f}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${$.type.value}(${G}(1.0) / ${G}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${x}(x[offset + i]);
        x[offset + i] = ${$.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${u?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${$.type.value}(${G}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${f};${E};${p}`,inputDependencies:I},getShaderSource:N,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:s,z:t*n},programUniforms:b})}},Db=(e,t,n,a,s,o,u,d,p)=>{let f=u+o.kvSequenceLength,m=[o.batchSize,o.numHeads,o.sequenceLength,f],_=e>1&&a,b=o.kvNumHeads?o.kvNumHeads:o.numHeads,E=_?[o.batchSize,b,f,o.headSize]:void 0,x=o.nReps?o.nReps:1,I=o.scale===0?1/Math.sqrt(o.headSize):o.scale,N=Ht(o.headSize),R=o.headSize/N,$=12,O={x:Math.ceil(f/$),y:Math.ceil(o.sequenceLength/$),z:o.batchSize*o.numHeads},k=[{type:12,data:o.sequenceLength},{type:12,data:R},{type:12,data:f},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:I},{type:12,data:u},{type:12,data:o.kvSequenceLength},{type:12,data:x}],P=_&&a&&ae.size(a.dims)>0,G=["type","type"];P&&G.push("type"),s&&G.push("type"),d&&G.push("type"),p&&G.push("type");let B=[{dims:m,dataType:t.dataType,gpuDataType:0}];_&&B.push({dims:E,dataType:t.dataType,gpuDataType:0});let K=Y=>{let se=ue("q",t.dataType,t.dims,N),ve=ue("key",n.dataType,n.dims,N),_e=[se,ve];if(P){let Ee=ue("past_key",a.dataType,a.dims,N);_e.push(Ee)}s&&_e.push(ue("attention_bias",s.dataType,s.dims));let ge=d?ue("seq_lens",d.dataType,d.dims):void 0;ge&&_e.push(ge);let $e=p?ue("total_sequence_length_input",p.dataType,p.dims):void 0;$e&&_e.push($e);let Ae=Ce("output",t.dataType,m),H=[Ae];_&&H.push(Ce("present_key",t.dataType,E,N));let j=zn(1,N),fe=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${$}u;

  var<workgroup> tileQ: array<${se.type.storage}, ${$*$}>;
  var<workgroup> tileK: array<${se.type.storage}, ${$*$}>;
  ${Y.registerUniforms(fe).declareVariables(..._e,...H)}
  ${Y.mainStart([$,$,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${x===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${x===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${wc(ge,$e,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${P&&_?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${_?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${j}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${P&&_?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${_?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${j}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(N){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${N}`)}})()};
        output[outputIdx] = ${Ae.type.value} (sum * uniforms.alpha) + ${s?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${N};${s!==void 0};${a!==void 0};${e}`,inputDependencies:G},getRunData:()=>({outputs:B,dispatchGroup:O,programUniforms:k}),getShaderSource:K}},kb=(e,t,n,a,s,o,u=void 0,d=void 0)=>{let p=o+s.kvSequenceLength,f=s.nReps?s.nReps:1,m=s.vHiddenSize*f,_=e>1&&a,b=s.kvNumHeads?s.kvNumHeads:s.numHeads,E=_?[s.batchSize,b,p,s.headSize]:void 0,x=[s.batchSize,s.sequenceLength,m],I=12,N={x:Math.ceil(s.vHeadSize/I),y:Math.ceil(s.sequenceLength/I),z:s.batchSize*s.numHeads},R=[{type:12,data:s.sequenceLength},{type:12,data:p},{type:12,data:s.vHeadSize},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:12,data:m},{type:12,data:o},{type:12,data:s.kvSequenceLength},{type:12,data:f}],$=_&&a&&ae.size(a.dims)>0,O=["type","type"];$&&O.push("type"),u&&O.push("type"),d&&O.push("type");let k=[{dims:x,dataType:t.dataType,gpuDataType:0}];_&&k.push({dims:E,dataType:t.dataType,gpuDataType:0});let P=G=>{let B=ue("probs",t.dataType,t.dims),K=ue("v",n.dataType,n.dims),Y=[B,K];$&&Y.push(ue("past_value",a.dataType,a.dims));let se=u?ue("seq_lens",u.dataType,u.dims):void 0;u&&Y.push(se);let ve=d?ue("total_sequence_length_input",d.dataType,d.dims):void 0;d&&Y.push(ve);let _e=[Ce("output",t.dataType,x)];_&&_e.push(Ce("present_value",t.dataType,E));let ge=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${I}u;
  var<workgroup> tileQ: array<${B.type.value}, ${I*I}>;
  var<workgroup> tileV: array<${B.type.value}, ${I*I}>;
  ${G.registerUniforms(ge).declareVariables(...Y,..._e)}
  ${G.mainStart([I,I,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${f===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${f===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${wc(se,ve,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${$&&_?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${_?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${B.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${$&&_?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${_?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${a!==void 0};${e}`,inputDependencies:O},getRunData:()=>({outputs:k,dispatchGroup:N,programUniforms:R}),getShaderSource:P}},Gl=(e,t,n,a,s,o,u,d,p,f,m=void 0,_=void 0)=>{let b=Math.min(e.outputCount,1+(u?1:0)+(d?1:0)),E=b>1?f.pastSequenceLength:0,x=E+f.kvSequenceLength,I=p&&ae.size(p.dims)>0?p:void 0,N=[t,n];b>1&&u&&ae.size(u.dims)>0&&N.push(u),I&&N.push(I),m&&N.push(m),_&&N.push(_);let R=e.compute(Db(b,t,n,u,I,f,E,m,_),{inputs:N,outputs:b>1?[-1,1]:[-1]})[0];e.compute(Ob(R,f.batchSize,f.numHeads,E,f.sequenceLength,x,m,_),{inputs:m&&_?[R,m,_]:[R],outputs:[]});let $=[R,a];b>1&&d&&ae.size(d.dims)>0&&$.push(d),m&&$.push(m),_&&$.push(_),e.compute(kb(b,R,a,d,f,E,m,_),{inputs:$,outputs:b>1?[0,2]:[0]})},zb=(e,t)=>{let n=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],a=t.sequenceLength,s=t.inputHiddenSize,o=t.headSize,u=12,d={x:Math.ceil(t.headSize/u),y:Math.ceil(t.sequenceLength/u),z:t.batchSize*t.numHeads},p=[e.inputs[0],e.inputs[1],e.inputs[2]],f=[{type:12,data:a},{type:12,data:s},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],m=_=>{let b=Ce("output_q",p[0].dataType,n),E=Ce("output_k",p[0].dataType,n),x=Ce("output_v",p[0].dataType,n),I=ue("input",p[0].dataType,p[0].dims),N=ue("weight",p[1].dataType,p[1].dims),R=ue("bias",p[2].dataType,p[2].dims),$=I.type.storage,O=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${u}u;
  var<workgroup> tileInput: array<${$}, ${u*u}>;
  var<workgroup> tileWeightQ: array<${$}, ${u*u}>;
  var<workgroup> tileWeightK: array<${$}, ${u*u}>;
  var<workgroup> tileWeightV: array<${$}, ${u*u}>;
  ${_.registerUniforms(O).declareVariables(I,N,R,b,E,x)}
  ${_.mainStart([u,u,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${$}(0);
    var valueK = ${$}(0);
    var valueV = ${$}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:d,programUniforms:f}),getShaderSource:m},{inputs:p,outputs:[-1,-1,-1]})},dS=(e,t)=>{let n=Mb(e.inputs,t),[a,s,o]=zb(e,n);return Gl(e,a,s,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],n)}}),Lb,Ub,Pb,fS,vD=be(()=>{Ai(),Ve(),Je(),Jt(),Xe(),Lb=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let n=(a,s,o)=>{let u=s.length;if(u!==a.length)throw new Error(`${o}: num dimensions != ${u}`);s.forEach((d,p)=>{if(d!==a[p])throw new Error(`${o}: dim[${p}] do not match`)})};if(e[0].dims.length>1){let a=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);n(e[1].dims,a,"Invalid input scale"),n(e[2].dims,a,"Invalid input B"),n(e[3].dims,a,"Invalid input mean"),n(e[4].dims,a,"Invalid input var")}else n(e[1].dims,[1],"Invalid input scale"),n(e[2].dims,[1],"Invalid input B"),n(e[3].dims,[1],"Invalid input mean"),n(e[4].dims,[1],"Invalid input var")},Ub=(e,t)=>{let{epsilon:n,spatial:a,format:s}=t,o=e[0].dims,u=a?Ht(o[o.length-1]):1,d=s==="NHWC"&&o.length>1?u:1,p=ae.size(o)/u,f=a,m=f?o.length:o,_=ue("x",e[0].dataType,e[0].dims,u),b=ue("scale",e[1].dataType,e[1].dims,d),E=ue("bias",e[2].dataType,e[2].dims,d),x=ue("inputMean",e[3].dataType,e[3].dims,d),I=ue("inputVar",e[4].dataType,e[4].dims,d),N=Ce("y",e[0].dataType,m,u),R=()=>{let O="";if(a)O=`let cOffset = ${o.length===1?"0u":s==="NHWC"?`outputIndices[${o.length-1}] / ${u}`:"outputIndices[1]"};`;else if(s==="NCHW")O=`
            ${N.indicesSet("outputIndices","0","0")}
            let cOffset = ${N.indicesToOffset("outputIndices")};`;else{O=`var cIndices = ${b.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let k=1;k<b.rank;k++)O+=`cIndices[${k}] = outputIndices[${k}];`;O+=`let cOffset = ${b.indicesToOffset("cIndices")};`}return O},$=O=>`
  const epsilon = ${n};
  ${O.registerUniform("outputSize","u32").declareVariables(_,b,E,x,I,N)}
  ${O.mainStart()}
  ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${N.offsetToIndices(`global_idx * ${u}`)};
    ${R()}
    let scale = ${b.getByOffset("cOffset")};
    let bias = ${E.getByOffset("cOffset")};
    let inputMean = ${x.getByOffset("cOffset")};
    let inputVar = ${I.getByOffset("cOffset")};
    let x = ${_.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${N.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${a}_${u}`,inputDependencies:f?["rank","type","type","type","type"]:void 0},getShaderSource:$,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:f?[{type:12,data:p},...Oe(o)]:[{type:12,data:p}]})}},Pb=e=>pt(e),fS=(e,t)=>{let{inputs:n,outputCount:a}=e,s=Pb({...t,outputCount:a});if(Mt.webgpu.validateInputContent&&Lb(n,s),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(Ub(n,s))}}),Bb,Gb,pS,_D=be(()=>{Je(),Xe(),Bb=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Gb=e=>{let t=e[0].dims,n=e[0].dims[2],a=ae.size(t)/4,s=e[0].dataType,o=ue("input",s,t,4),u=ue("bias",s,[n],4),d=ue("residual",s,t,4),p=Ce("output",s,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)}}),getShaderSource:f=>`
  const channels = ${n}u / 4;
  ${f.declareVariables(o,u,d,p)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes(a)}
    let value = ${o.getByOffset("global_idx")}
      + ${u.getByOffset("global_idx % channels")} + ${d.getByOffset("global_idx")};
    ${p.setByOffset("global_idx","value")}
  }`}},pS=e=>{Bb(e.inputs),e.compute(Gb(e.inputs))}}),Vb,ft,hS,mS,gS,yS,vS,_S,bS,TS,wS,qb,ES,SS,xS,CS,Ll,AS,Mc,IS,RS,NS,$S,MS,OS,DS,kS,zS,LS,US,PS,BS,GS,VS,qS,Hp,HS,Gh,Vh,FS,YS,WS,Hb,Fb,KS,wm=be(()=>{Ve(),Je(),Jt(),Xe(),Vb=(e,t,n,a,s,o,u)=>{let d=Math.ceil(t/4),p="";typeof s=="string"?p=`${s}(a)`:p=s("a");let f=ue("inputData",n,[d],4),m=Ce("outputData",a,[d],4),_=[{name:"vec_size",type:"u32"}];return u&&_.push(...u),`
      ${e.registerUniforms(_).declareVariables(f,m)}

  ${o??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${f.getByOffset("global_idx")};
    ${m.setByOffset("global_idx",p)}
  }`},ft=(e,t,n,a,s,o=e.dataType,u,d)=>{let p=[{type:12,data:Math.ceil(ae.size(e.dims)/4)}];return u&&p.push(...u),{name:t,shaderCache:{hint:s,inputDependencies:["type"]},getShaderSource:f=>Vb(f,ae.size(e.dims),e.dataType,o,n,a,d),getRunData:f=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(ae.size(f[0].dims)/64/4)},programUniforms:p})}},hS=e=>{e.compute(ft(e.inputs[0],"Abs","abs"))},mS=e=>{e.compute(ft(e.inputs[0],"Acos","acos"))},gS=e=>{e.compute(ft(e.inputs[0],"Acosh","acosh"))},yS=e=>{e.compute(ft(e.inputs[0],"Asin","asin"))},vS=e=>{e.compute(ft(e.inputs[0],"Asinh","asinh"))},_S=e=>{e.compute(ft(e.inputs[0],"Atan","atan"))},bS=e=>{e.compute(ft(e.inputs[0],"Atanh","atanh"))},TS=e=>pt(e),wS=(e,t)=>{let n;switch(t.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(ft(e.inputs[0],"Cast",n,void 0,t.cacheKey,t.to))},qb=e=>{let t,n,a=e.length>=2&&e[1].data!==0,s=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=a?e[1].getFloat32Array()[0]:-34028234663852886e22,n=s?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=a?e[1].getUint16Array()[0]:64511,n=s?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return pt({min:t,max:n})},ES=(e,t)=>{let n=t||qb(e.inputs),a=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"Clip",s=>`clamp(${s}, vec4<${a}>(uniforms.min), vec4<${a}>(uniforms.max))`,void 0,n.cacheKey,void 0,[{type:e.inputs[0].dataType,data:n.min},{type:e.inputs[0].dataType,data:n.max}],[{name:"min",type:a},{name:"max",type:a}]),{inputs:[0]})},SS=e=>{e.compute(ft(e.inputs[0],"Ceil","ceil"))},xS=e=>{e.compute(ft(e.inputs[0],"Cos","cos"))},CS=e=>{e.compute(ft(e.inputs[0],"Cosh","cosh"))},Ll=e=>pt(e),AS=(e,t)=>{let n=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"Elu",a=>`elu_vf32(${a})`,`
  const elu_alpha_ = ${n}(${t.alpha});

  fn elu_f32(a: ${n}) -> ${n} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Mc=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,IS=e=>{let t=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"Erf",n=>`erf_vf32(${n})`,Mc(t)))},RS=e=>{e.compute(ft(e.inputs[0],"Exp","exp"))},NS=e=>{e.compute(ft(e.inputs[0],"Floor","floor"))},$S=e=>{let t=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"Gelu",n=>`0.5 * ${n} * (1.0 + erf_vf32(${n} * 0.7071067811865475))`,Mc(t)))},MS=(e,t)=>{let n=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"LeakyRelu",a=>`select(leaky_relu_alpha_ * ${a}, ${a}, ${a} >= vec4<${n}>(0.0))`,`const leaky_relu_alpha_ = ${n}(${t.alpha});`,t.cacheKey))},OS=e=>{e.compute(ft(e.inputs[0],"Not",t=>`!${t}`))},DS=e=>{e.compute(ft(e.inputs[0],"Neg",t=>`-${t}`))},kS=e=>{e.compute(ft(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},zS=e=>{let t=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"Relu",n=>`select(vec4<${t}>(0.0), ${n}, ${n} > vec4<${t}>(0.0))`))},LS=e=>{e.compute(ft(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},US=e=>pt(e),PS=(e,t)=>{let n=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"HardSigmoid",a=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${t.alpha} * ${a} + vec4<${n}>(${t.beta})))`,void 0,t.cacheKey))},BS=e=>{e.compute(ft(e.inputs[0],"Sin","sin"))},GS=e=>{e.compute(ft(e.inputs[0],"Sinh","sinh"))},VS=e=>{e.compute(ft(e.inputs[0],"Sqrt","sqrt"))},qS=e=>{e.compute(ft(e.inputs[0],"Tan","tan"))},Hp=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,HS=e=>{e.compute(ft(e.inputs[0],"Tanh",Hp))},Gh=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${Hp("v")};
}
`,Vh=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,FS=e=>{let t=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"FastGelu",Vh,Gh(t),void 0,e.inputs[0].dataType))},YS=(e,t)=>{let n=zn(e.inputs[0].dataType);return e.compute(ft(e.inputs[0],"ThresholdedRelu",a=>`select(vec4<${n}>(0.0), ${a}, ${a} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${n}>(${t.alpha});`,t.cacheKey)),0},WS=e=>{e.compute(ft(e.inputs[0],"Log","log"))},Hb=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Fb=e=>`quick_gelu_impl(${e})`,KS=(e,t)=>{let n=zn(e.inputs[0].dataType);e.compute(ft(e.inputs[0],"QuickGelu",Fb,Hb(n,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),Yb,Wb,JS,bD=be(()=>{Je(),Xe(),wm(),Yb=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Wb=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let n=ue("input",e[0].dataType,e[0].dims,4),a=ue("bias",e[0].dataType,[e[0].dims[2]],4),s=Ce("output",e[0].dataType,t,4),o=ae.size(t)/4,u=mn(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:d=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${d.declareVariables(n,a,s)}

  ${Mc(u)}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${s.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},JS=e=>{Yb(e.inputs),e.compute(Wb(e.inputs))}}),Kb,Jb,Hi,XS,ZS,QS,jS,ex,tx,nx,ix,ax,rx,TD=be(()=>{Ve(),Je(),Xe(),Kb=(e,t,n,a,s,o,u,d,p,f,m,_)=>{let b,E;typeof d=="string"?b=E=($,O)=>`${d}((${$}),(${O}))`:typeof d=="function"?b=E=d:(b=d.scalar,E=d.vector);let x=Ce("outputData",m,a.length,4),I=ue("aData",p,t.length,4),N=ue("bData",f,n.length,4),R;if(s)if(o){let $=ae.size(t)===1,O=ae.size(n)===1,k=t.length>0&&t[t.length-1]%4===0,P=n.length>0&&n[n.length-1]%4===0;$||O?R=x.setByOffset("global_idx",E($?`${I.type.value}(${I.getByOffset("0")}.x)`:I.getByOffset("global_idx"),O?`${N.type.value}(${N.getByOffset("0")}.x)`:N.getByOffset("global_idx"))):R=`
            let outputIndices = ${x.offsetToIndices("global_idx * 4u")};
            let offsetA = ${I.broadcastedIndicesToOffset("outputIndices",x)};
            let offsetB = ${N.broadcastedIndicesToOffset("outputIndices",x)};
            ${x.setByOffset("global_idx",E(u||k?I.getByOffset("offsetA / 4u"):`${I.type.value}(${I.getByOffset("offsetA / 4u")}[offsetA % 4u])`,u||P?N.getByOffset("offsetB / 4u"):`${N.type.value}(${N.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else R=x.setByOffset("global_idx",E(I.getByOffset("global_idx"),N.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let $=(O,k,P="")=>{let G=`aData[indexA${k}][componentA${k}]`,B=`bData[indexB${k}][componentB${k}]`;return`
            let outputIndices${k} = ${x.offsetToIndices(`global_idx * 4u + ${k}u`)};
            let offsetA${k} = ${I.broadcastedIndicesToOffset(`outputIndices${k}`,x)};
            let offsetB${k} = ${N.broadcastedIndicesToOffset(`outputIndices${k}`,x)};
            let indexA${k} = offsetA${k} / 4u;
            let indexB${k} = offsetB${k} / 4u;
            let componentA${k} = offsetA${k} % 4u;
            let componentB${k} = offsetB${k} % 4u;
            ${O}[${k}] = ${P}(${b(G,B)});
          `};m===9?R=`
            var data = vec4<u32>(0);
            ${$("data",0,"u32")}
            ${$("data",1,"u32")}
            ${$("data",2,"u32")}
            ${$("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:R=`
            ${$("outputData[global_idx]",0)}
            ${$("outputData[global_idx]",1)}
            ${$("outputData[global_idx]",2)}
            ${$("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(I,N,x)}

        ${_??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${R}
      }`},Jb=(e,t,n,a,s,o,u=n.dataType)=>{let d=n.dims.map(I=>Number(I)??1),p=a.dims.map(I=>Number(I)??1),f=!ae.areEqual(d,p),m=d,_=ae.size(d),b=!1,E=!1,x=[f];if(f){let I=ss.calcShape(d,p,!1);if(!I)throw new Error("Can't perform binary op on the given tensors");m=I.slice(),_=ae.size(m);let N=ae.size(d)===1,R=ae.size(p)===1,$=d.length>0&&d[d.length-1]%4===0,O=p.length>0&&p[p.length-1]%4===0;x.push(N),x.push(R),x.push($),x.push(O);let k=1;for(let P=1;P<m.length;P++){let G=d[d.length-P],B=p[p.length-P];if(G===B)k*=G;else break}k%4===0?(E=!0,b=!0):(N||R||$||O)&&(b=!0)}else b=!0;return x.push(b),{name:e,shaderCache:{hint:t+x.map(I=>I.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:I=>Kb(I,d,p,m,b,f,E,s,n.dataType,a.dataType,u,o),getRunData:()=>({outputs:[{dims:m,dataType:u}],dispatchGroup:{x:Math.ceil(_/64/4)},programUniforms:[{type:12,data:Math.ceil(ae.size(m)/4)},...Oe(d,p,m)]})}},Hi=(e,t,n,a,s,o)=>{e.compute(Jb(t,s??"",e.inputs[0],e.inputs[1],n,a,o))},XS=e=>{Hi(e,"Add",(t,n)=>`${t}+${n}`)},ZS=e=>{Hi(e,"Div",(t,n)=>`${t}/${n}`)},QS=e=>{Hi(e,"Equal",{scalar:(t,n)=>`u32(${t}==${n})`,vector:(t,n)=>`vec4<u32>(${t}==${n})`},void 0,void 0,9)},jS=e=>{Hi(e,"Mul",(t,n)=>`${t}*${n}`)},ex=e=>{let t=ue("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Hi(e,"Pow",{scalar:(n,a)=>`pow_custom(${n},${a})`,vector:(n,a)=>`pow_vector_custom(${n},${a})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},tx=e=>{Hi(e,"Sub",(t,n)=>`${t}-${n}`)},nx=e=>{Hi(e,"Greater",{scalar:(t,n)=>`u32(${t}>${n})`,vector:(t,n)=>`vec4<u32>(${t}>${n})`},void 0,void 0,9)},ix=e=>{Hi(e,"Less",{scalar:(t,n)=>`u32(${t}<${n})`,vector:(t,n)=>`vec4<u32>(${t}<${n})`},void 0,void 0,9)},ax=e=>{Hi(e,"GreaterOrEqual",{scalar:(t,n)=>`u32(${t}>=${n})`,vector:(t,n)=>`vec4<u32>(${t}>=${n})`},void 0,void 0,9)},rx=e=>{Hi(e,"LessOrEqual",{scalar:(t,n)=>`u32(${t}<=${n})`,vector:(t,n)=>`vec4<u32>(${t}<=${n})`},void 0,void 0,9)}}),Xb,Zb,Qb,jb,ox,sx,wD=be(()=>{Ve(),Je(),Jt(),Xe(),Xb=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let n=0,a=e[n],s=a.dataType,o=a.dims.length;e.forEach((u,d)=>{if(d!==n){if(u.dataType!==s)throw new Error("input tensors should be one type");if(u.dims.length!==o)throw new Error("input tensors should have the same shape");u.dims.forEach((p,f)=>{if(f!==t&&p!==a.dims[f])throw new Error("non concat dimensions must match")})}})},Zb=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,Qb=(e,t)=>{let n=e.length,a=[];for(let s=0;s<n;++s){let o=t.setByOffset("global_idx",e[s].getByIndices("indices"));n===1?a.push(o):s===0?a.push(`if (inputIndex == ${s}u) { ${o} }`):s===n-1?a.push(`else { ${o} }`):a.push(`else if (inputIndex == ${s}) { ${o} }`)}return a.join(`
`)},jb=(e,t,n,a)=>{let s=ae.size(n),o=new Array(e.length),u=new Array(e.length),d=0,p=[],f=[],m=[{type:12,data:s}];for(let I=0;I<e.length;++I)d+=e[I].dims[t],o[I]=d,f.push(e[I].dims.length),u[I]=ue(`input${I}`,a,f[I]),p.push("rank"),m.push({type:12,data:o[I]});for(let I=0;I<e.length;++I)m.push(...Oe(e[I].dims));m.push(...Oe(n));let _=Ce("output",a,n.length),b=_.indicesGet("indices",t),E=Array.from(Array(o.length).keys()).map(I=>`uniforms.sizeInConcatAxis${I}`).join(","),x=I=>`

  ${(()=>{I.registerUniform("outputSize","u32");for(let N=0;N<e.length;N++)I.registerUniform(`sizeInConcatAxis${N}`,"u32");return I.declareVariables(...u,_)})()}

  ${Zb(o.length,E)}

  ${I.mainStart()}
    ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${_.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${b});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${E});
      ${b} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${Qb(u,_)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:n,dataType:a}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:m}),getShaderSource:x}},ox=(e,t)=>{let n=e.inputs,a=n[0].dims,s=ae.normalizeAxis(t.axis,a.length);Xb(n,s);let o=a.slice();o[s]=n.reduce((d,p)=>d+(p.dims.length>s?p.dims[s]:0),0);let u=n.filter(d=>ae.size(d.dims)>0);e.compute(jb(u,s,o,n[0].dataType),{inputs:u})},sx=e=>pt({axis:e.axis})}),oo,so,lo,Em,fo=be(()=>{Ve(),Je(),oo=(e,t,n="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${n}(uniforms.clip_min)), ${t}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},so=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},lo=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},Em=e=>{let t=(e==null?void 0:e.activation)||"";if(t==="HardSigmoid"){let[n,a]=(e==null?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:n,beta:a}}else if(t==="Clip"){let[n,a]=(e==null?void 0:e.activation_params)||[OE,DE];return{activation:t,clipMax:a,clipMin:n}}else if(t==="LeakyRelu"){let[n]=(e==null?void 0:e.activation_params)||[.01];return{activation:t,alpha:n}}return{activation:t}}}),Tn,lx,Sm=be(()=>{Tn=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},lx=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),ux,ED=be(()=>{ux=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),Pl,xm,Cm=be(()=>{Ve(),Je(),Xe(),fo(),Pl=(e,t,n,a,s)=>{let o=a-n;return`
      ${Array.from({length:n}).map((u,d)=>`
      if (${Ne(t.shape,d,t.rank)} != 1) {
        ${t.indicesSet(e,d,Ne(s,d+o,a))}
      } else {
        ${t.indicesSet(e,d,0)}
      }`).join("")}
`},xm=(e,t,n,a,s=!1,o)=>{let u=e[0].dims,d=e[1].dims,p=u[u.length-2],f=d[d.length-1],m=u[u.length-1],_=Ht(f),b=Ht(m),E=Ht(p),x=ae.size(n)/_/E,I=e.length>2,N=a?a.slice(0,-2):n.slice(0,-2),R=[ae.size(N),p,f],$=[{type:12,data:x},{type:12,data:p},{type:12,data:f},{type:12,data:m}];so(t,$),$.push(...Oe(N,u,d)),I&&$.push(...Oe(e[2].dims)),$.push(...Oe(R));let O=k=>{let P=_m("batch_dims",e[0].dataType,N.length),G=ue("a",e[0].dataType,u.length,b),B=ue("b",e[1].dataType,d.length,_),K=Ce("output",e[0].dataType,R.length,_),Y=mn(K.type.tensor),se=oo(t,K.type.value,Y),ve=[G,B],_e="";if(I){let Ae=s?_:1;ve.push(ue("bias",e[2].dataType,e[2].dims.length,Ae)),_e=`${s?`value += bias[col / ${Ae}];`:`value += ${K.type.value}(bias[row + i]);`}`}let ge=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];lo(t,ge);let $e=()=>{let Ae=`var a_data: ${G.type.value};`;for(let H=0;H<b;H++)Ae+=`
              let b_data${H} = b[(b_offset + (k + ${H}) * uniforms.N + col) / ${_}];`;for(let H=0;H<E;H++){Ae+=`a_data = a[(a_offset + (row + ${H}) * uniforms.K + k) / ${b}];`;for(let j=0;j<b;j++)Ae+=`
            values[${H}] = fma(${B.type.value}(a_data${b===1?"":`[${j}]`}), b_data${j}, values[${H}]);
`}return Ae};return`
  ${k.registerUniforms(ge).registerInternalVariables(P).declareVariables(...ve,K)}
  ${k.mainStart()}
    ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${_})) * ${_};
    var index1 = global_idx / (uniforms.N / ${_});
    let stride1 = uniforms.M / ${E};
    let row = (index1 % stride1) * ${E};
    let batch = index1 / stride1;

    ${n.length===2?"":`let batch_indices = ${P.offsetToIndices("batch")};`}

    var a_indices: ${G.type.indices};
    ${Pl("a_indices",G,G.rank-2,P.rank,"batch_indices")}
    ${G.indicesSet("a_indices",G.rank-2,0)}
    ${G.indicesSet("a_indices",G.rank-1,0)}
    let a_offset = ${G.indicesToOffset("a_indices")};

    var b_indices: ${B.type.indices};
    ${Pl("b_indices",B,B.rank-2,P.rank,"batch_indices")}
    ${B.indicesSet("b_indices",B.rank-2,0)}
    ${B.indicesSet("b_indices",B.rank-1,0)}
    let b_offset = ${B.indicesToOffset("b_indices")};
    var values: array<${K.type.value}, ${E}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${b}) {
      ${$e()}
    }
    for (var i = 0u; i < ${E}u; i++) {
      var value = values[i];
      ${_e}
      ${se}
      let cur_indices = ${K.type.indices}(batch, row + i, col);
      let offset = ${K.indicesToOffset("cur_indices")};
      ${K.setByOffset(`offset / ${_}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${_};${b};${E};${s}`,inputDependencies:I?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(x/64)},programUniforms:$}),getShaderSource:O}}}),eT,tT,qh,Fp,nT,Hh,iT,Fc,Am=be(()=>{Ve(),Je(),Xe(),fo(),Cm(),Sm(),eT=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,tT=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,qh=(e,t,n="f32",a,s=!1,o=32,u=!1,d=32)=>{let p=t[1]*e[1],f=t[0]*e[0],m=s?p:o,_=s?o:p,b=m/t[0],E=o/t[1];if(!((s&&b===4&&e[1]===4||!s&&(b===3||b===4))&&m%t[0]===0&&o%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${s} is true, innerElementSize ${b} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${b} must be 3 or 4.
  tileAWidth ${m} must be divisible by workgroupSize[0]${t[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${b}<${n}>, ${m/b}>, ${_}>;
var<workgroup> mm_Bsub: array<array<vec4<${n}>, ${f/e[0]}>, ${o}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${b};
const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${u?"0":"i32(globalId.z)"};
  ${a?`let batchIndices = ${a.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${p};

  let num_tiles = ${u?`${Math.ceil(d/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${u?`i32(globalId.z) * ${d}`:"0"};

  var acc: array<vec4<${n}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${E};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${eT(s,a)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${E}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${a?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${b===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${tT(s,b)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Fp=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,nT=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",Hh=(e,t,n="f32",a,s=!1,o=32,u=!1,d=32,p=!1)=>{let f=e[1]*t[1],m=e[0]*t[0],_=s?f:o,b=s?o:f;if(!(b%t[1]===0&&_%t[0]===0&&o%t[1]===0))throw new Error(`tileAHight ${b} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${_} must be divisible by workgroupSize[0]${t[0]}, tileInner ${o} must be divisible by workgroupSize[1]${t[1]}`);let E=b/t[1],x=_/t[0],I=o/t[1],N=p?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${f};
    let globalColStart = i32(workgroupId.x) * ${m};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${b}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${_}; inputCol = inputCol + ${t[0]}) {
          ${Fp(s,a)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${m}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${a?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${n}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${s?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${f};

let tileRowA = i32(localId.y) * ${E};
let tileColA = i32(localId.x) * ${x};
let tileRowB = i32(localId.y) * ${I};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${E}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${x}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Fp(s,a)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${I}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${a?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${n}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${nT(s)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${n}, ${_}>, ${b}>;
  var<workgroup> mm_Bsub : array<array<${n}, ${m}>, ${o}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${u?"0":"i32(globalId.z)"};
    ${a?`let batchIndices = ${a.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${u?`${Math.ceil(d/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${u?`i32(globalId.z) * ${d}`:"0"};

    var acc : array<array<${n}, colPerThread>, rowPerThread>;
    ${N}
  }
`},iT=(e,t,n,a,s=!1)=>{let[o,u,d,p]=a,f=mn(a[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Tn(e,f)} {
      var value = ${Tn(e,f)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${u.type.indices};
        ${Pl("aIndices",u,u.rank-2,o.rank,"batchIndices")}
        ${u.indicesSet("aIndices",u.rank-2,"u32(row)")}
        ${u.indicesSet("aIndices",u.rank-1,"u32(colIn)")}
        value = ${u.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Tn(e,f)} {
      var value = ${Tn(e,f)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${d.type.indices};
        ${Pl("bIndices",d,d.rank-2,o.rank,"batchIndices")}
        ${d.indicesSet("bIndices",d.rank-2,"u32(row)")}
        ${d.indicesSet("bIndices",d.rank-1,"u32(colIn)")}
        value = ${d.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Tn(e,f)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${s?"bias[colIn]":`${Tn(e,f)}(bias[row])`};`:""}
        ${n}
        ${p.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Fc=(e,t,n,a,s=!1,o)=>{let u=e[0].dims,d=e[1].dims,p=u.slice(0,-2),f=d.slice(0,-2),m=a?a.slice(0,-2):n.slice(0,-2),_=ae.size(m),b=u[u.length-2],E=u[u.length-1],x=d[d.length-1],I=E%4===0&&x%4===0,N=b<=8?[4,1,1]:[4,4,1],R=[8,8,1],$=[Math.ceil(x/R[0]/N[0]),Math.ceil(b/R[1]/N[1]),Math.ceil(_/R[2]/N[2])],O=I?4:1,k=[...p,b,E/O],P=k.length,G=[...f,E,x/O],B=G.length,K=[_,b,x/O],Y=[{type:6,data:b},{type:6,data:x},{type:6,data:E}];so(t,Y),Y.push(...Oe(m,k,G));let se=["rank","rank"],ve=e.length>2;ve&&(Y.push(...Oe(e[2].dims)),se.push("rank")),Y.push(...Oe(K));let _e=ge=>{let $e=m.length,Ae=_m("batchDims",e[0].dataType,$e,1),H=mn(e[0].dataType),j=ue("a",e[0].dataType,P,O),fe=ue("b",e[1].dataType,B,O),Ee=Ce("result",e[0].dataType,K.length,O),Ie=[j,fe];if(ve){let Me=s?O:1;Ie.push(ue("bias",e[2].dataType,e[2].dims.length,Me))}let z=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];lo(t,z);let q=mn(Ee.type.tensor),te=oo(t,Ee.type.value,q),de=iT(O,ve,te,[Ae,j,fe,Ee],s);return`
  ${ge.registerUniforms(z).registerInternalVariables(Ae).declareVariables(...Ie,Ee)}
  ${de}
  ${I?qh(N,R,H,Ae):Hh(N,R,H,Ae)}
                   `};return{name:"MatMul",shaderCache:{hint:`${N};${t.activation};${I};${s}`,inputDependencies:se},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:$[0],y:$[1],z:$[2]},programUniforms:Y}),getShaderSource:_e}}}),aT,cx,SD=be(()=>{Ve(),Da(),Xe(),fo(),Sm(),ED(),Am(),aT=(e,t,n,a,s=!1,o,u=4,d=4,p=4,f="f32")=>{let m=Y=>{switch(Y){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${f}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${Y} is not supported.`)}},_=Y=>{switch(Y){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${Y} is not supported.`)}},b=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,E=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,x=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",I=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",N=e?"row":"col",R=e?"col":"row",$=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${N} / outWidth;
    let outCol = ${N} % outWidth;

    let WRow = ${R} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${R} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${R} % inChannels;
    var resData = ${Tn(u,f)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${x} && xCol >= 0 && xCol < ${I}) {
      ${b}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${m(u)}
    }
    return resData;`,O=e?t&&a?`
    let col = colIn * ${u};
    ${$}`:`
    let col = colIn * ${u};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${$}
    }
    return ${Tn(u,f)}(0.0);`:a&&n?`
    let col = colIn * ${u};
    ${$}`:`
    let col = colIn * ${u};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${$}
    }
    return ${Tn(u,f)}(0.0);`,k=e?a&&n?_(d):`
    let col = colIn * ${d};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_(d)}
    }
    return ${Tn(d,f)}(0.0);`:`
    let col = colIn * ${d};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${_(d)}
    }
    return ${Tn(d,f)}(0.0);`,P=Tn(p,f),G=Tn(e?u:d,f),B=Tn(e?d:u,f),K=oo(o,P,f);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${G} {
      ${e?O:k}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${B} {
      ${e?k:O}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${P}) {
      let col = colIn * ${p};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${E}
      ${lx(s)}
      ${K}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},cx=(e,t,n,a,s,o,u,d,p)=>{let f=t.format==="NHWC",m=f?e[0].dims[3]:e[0].dims[1],_=n[0],b=f?n[2]:n[3],E=f?n[1]:n[2],x=f?n[3]:n[1],I=f&&(m%4===0||m%3===0)&&x%4===0,N=f?x:b*E,R=f?b*E:x,$=[8,8,1],O=a<=8?[4,1,1]:[4,4,1],k=[Math.ceil(N/$[0]/O[0]),Math.ceil(R/$[1]/O[1]),Math.ceil(_/$[2]/O[2])];lt("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${k}`);let P=I?f&&m%4!==0?3:4:1,G=$[1]*O[1],B=$[0]*O[0],K=Math.max($[0]*P,$[1]),Y=a%G===0,se=s%B===0,ve=o%K===0,_e=I?[P,4,4]:[1,1,1],ge=[{type:6,data:a},{type:6,data:s},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];so(t,ge),ge.push(...Oe(e[0].dims,e[1].dims));let $e=["rank","rank"];u&&(ge.push(...Oe(e[2].dims)),$e.push("rank")),ge.push(...Oe(n));let Ae=H=>{let j=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];lo(t,j);let fe=I?4:1,Ee=mn(e[0].dataType),Ie=`
      fn setOutputAtIndex(flatIndex : i32, value : ${I?`vec4<${Ee}>`:Ee}) {
        result[flatIndex] = ${I?`vec4<${Ee}>`:Ee}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${I?`vec4<${Ee}>`:Ee}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${I?"/ 4":""}, value);
      }`,z=ue("x",e[0].dataType,e[0].dims.length,P===3?1:P),q=ue("w",e[1].dataType,e[1].dims.length,fe),te=[z,q],de=Ce("result",e[0].dataType,n.length,fe);if(u){let Me=ue("bias",e[2].dataType,e[2].dims.length,fe);te.push(Me),Ie+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${I?`vec4<${Ee}>`:Ee} {
          return bias[coords.${f?"w":"y"}${I?"/ 4":""}];
        }`}return`
        ${ux("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${H.registerUniforms(j).declareVariables(...te,de)}
        ${Ie}
        ${aT(f,Y,se,ve,u,t,_e[0],_e[1],_e[2],Ee)}
        ${I?qh(O,$,Ee,void 0,!f,K):Hh(O,$,Ee,void 0,!f,K,!1,void 0,d)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${P};${I};${Y};${se};${ve};${G};${B};${K}`,inputDependencies:$e},getRunData:()=>({outputs:[{dims:p?p(n):n,dataType:e[0].dataType}],dispatchGroup:{x:k[0],y:k[1],z:k[2]},programUniforms:ge}),getShaderSource:Ae}}}),rT,Yp,Il,oT,Wp,sT,dx,fx,xD=be(()=>{Ve(),Da(),Je(),Xe(),fo(),Sm(),rT=e=>{let t=1;for(let n=0;n<e.length;n++)t*=e[n];return t},Yp=e=>typeof e=="number"?[e,e,e]:e,Il=(e,t)=>t<=1?e:e+(e-1)*(t-1),oT=(e,t,n,a=1)=>{let s=Il(t,a);return Math.floor((e[0]*(n-1)-n+s)/2)},Wp=(e,t,n,a,s)=>{s==null&&(s=oT(e,t[0],a[0]));let o=[0,0,0,n];for(let u=0;u<3;u++)e[u]+2*s>=t[u]&&(o[u]=Math.trunc((e[u]-t[u]+2*s)/a[u]+1));return o},sT=(e,t,n,a,s,o,u,d,p,f)=>{let m,_,b,E;if(e==="VALID"&&(e=0),typeof e=="number"){m={top:e,bottom:e,left:e,right:e,front:e,back:e};let x=Wp([t,n,a,1],[d,p,f],1,[s,o,u],e);_=x[0],b=x[1],E=x[2]}else if(Array.isArray(e)){if(!e.every((I,N,R)=>I===R[0]))throw Error(`Unsupported padding parameter: ${e}`);m={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let x=Wp([t,n,a,1],[d,p,f],1,[s,o,u],e[0]);_=x[0],b=x[1],E=x[2]}else if(e==="SAME_UPPER"){_=Math.ceil(t/s),b=Math.ceil(n/o),E=Math.ceil(a/u);let x=(_-1)*s+d-t,I=(b-1)*o+p-n,N=(E-1)*u+f-a,R=Math.floor(x/2),$=x-R,O=Math.floor(I/2),k=I-O,P=Math.floor(N/2),G=N-P;m={top:O,bottom:k,left:P,right:G,front:R,back:$}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:m,outDepth:_,outHeight:b,outWidth:E}},dx=(e,t,n,a,s,o=!1,u="channelsLast")=>{let d,p,f,m,_;if(u==="channelsLast")[d,p,f,m,_]=e;else if(u==="channelsFirst")[d,_,p,f,m]=e;else throw new Error(`Unknown dataFormat ${u}`);let[b,,E,x,I]=t,[N,R,$]=Yp(n),[O,k,P]=Yp(a),G=Il(E,O),B=Il(x,k),K=Il(I,P),{padInfo:Y,outDepth:se,outHeight:ve,outWidth:_e}=sT(s,p,f,m,N,R,$,G,B,K),ge=o?b*_:b,$e=[0,0,0,0,0];return u==="channelsFirst"?$e=[d,ge,se,ve,_e]:u==="channelsLast"&&($e=[d,se,ve,_e,ge]),{batchSize:d,dataFormat:u,inDepth:p,inHeight:f,inWidth:m,inChannels:_,outDepth:se,outHeight:ve,outWidth:_e,outChannels:ge,padInfo:Y,strideDepth:N,strideHeight:R,strideWidth:$,filterDepth:E,filterHeight:x,filterWidth:I,effectiveFilterDepth:G,effectiveFilterHeight:B,effectiveFilterWidth:K,dilationDepth:O,dilationHeight:k,dilationWidth:P,inShape:e,outShape:$e,filterShape:t}},fx=(e,t,n,a,s,o)=>{let u=o==="channelsLast";u?e[0].dims[3]:e[0].dims[1];let d=[64,1,1],p={x:n.map((N,R)=>R)},f=[Math.ceil(rT(p.x.map(N=>n[N]))/d[0]),1,1];lt("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${f}`);let m=1,_=ae.size(n),b=[{type:12,data:_},{type:12,data:a},{type:12,data:s},{type:12,data:t.strides},{type:12,data:t.dilations}];so(t,b),b.push(...Oe(e[0].dims,e[1].dims));let E=["rank","rank"],x=e.length===3;x&&(b.push(...Oe(e[2].dims)),E.push("rank")),b.push(...Oe(n));let I=N=>{let R=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:a.length},{name:"pads",type:"u32",length:s.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];lo(t,R);let $=1,O=mn(e[0].dataType),k=ue("x",e[0].dataType,e[0].dims.length,m),P=ue("W",e[1].dataType,e[1].dims.length,$),G=[k,P],B=Ce("result",e[0].dataType,n.length,$),K="";if(x){let ve=ue("bias",e[2].dataType,e[2].dims.length,$);G.push(ve),K+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${O} {
          return bias[${u?Ne("coords",4,5):Ne("coords",1,5)}];
        }`}let Y=Tn(m,O),se=oo(t,Y,O);return`
            ${K}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${k.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${P.getByIndices("aIndices")};
            }
          ${N.registerUniforms(R).declareVariables(...G,B)}
          ${N.mainStart()}
          ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${B.offsetToIndices("global_idx")};
              let batch = ${Ne("coords",0,k.rank)};
              let d2 = ${u?Ne("coords",k.rank-1,k.rank):Ne("coords",1,k.rank)};
              let xFRCCorner = vec3<u32>(${u?Ne("coords",1,k.rank):Ne("coords",2,k.rank)},
              ${u?Ne("coords",2,k.rank):Ne("coords",3,k.rank)},
              ${u?Ne("coords",3,k.rank):Ne("coords",4,k.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${u?Ne("uniforms.x_shape",1,k.rank):Ne("uniforms.x_shape",2,k.rank)};
              let xShapeZ = ${u?Ne("uniforms.x_shape",2,k.rank):Ne("uniforms.x_shape",3,k.rank)};
              let xShapeW = ${u?Ne("uniforms.x_shape",3,k.rank):Ne("uniforms.x_shape",4,k.rank)};
              let xShapeU = ${u?Ne("uniforms.x_shape",4,k.rank):Ne("uniforms.x_shape",1,k.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${u?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${u?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${u?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${u?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${x?"value = value + getBiasByOutputCoords(coords)":""};
              ${se}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${u};${m};${x}`,inputDependencies:E},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:f[0],y:f[1],z:f[2]},programUniforms:b}),getShaderSource:I}}}),px,hx,CD=be(()=>{Ve(),Je(),Xe(),fo(),px=(e,t,n,a)=>{let s=e.length>2,o=s?"value += b[output_channel];":"",u=e[0].dims,d=e[1].dims,p=t.format==="NHWC",f=p?n[3]:n[1],m=f/t.group,_=p&&m>=4?Ht(f):1,b=ae.size(n)/_,E=[{type:12,data:b},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:m}];so(t,E),E.push(...Oe(u,[d[0],d[1],d[2],d[3]/_]));let x=s?["rank","rank","rank"]:["rank","rank"];E.push(...Oe([n[0],n[1],n[2],n[3]/_]));let I=N=>{let R=Ce("output",e[0].dataType,n.length,_),$=mn(R.type.tensor),O=oo(t,R.type.value,$),k=ue("x",e[0].dataType,u.length),P=ue("w",e[1].dataType,d.length,_),G=[k,P];s&&G.push(ue("b",e[2].dataType,e[2].dims,_));let B=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];lo(t,B);let K=p?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${k.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${P.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${k.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${P.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${N.registerUniforms(B).declareVariables(...G,R)}

  ${N.mainStart()}
    ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${R.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${p?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${p?1:2}], outputIndices[${p?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${_} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${p?2:1}];

    var value: ${R.type.value} = ${R.type.value}(0);
    ${K}
    ${o}
    ${O}
    ${R.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${_}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:E}),getShaderSource:I}},hx=(e,t,n,a)=>{let s=e.length>2,o=Ht(n[3]),u=Ht(n[2]),d=ae.size(n)/o/u,p=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],f=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],m=[n[0],n[1],n[2],n[3]/o],_=[{type:12,data:d},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];so(t,_),_.push(...Oe(p,f,m));let b=(u-1)*t.strides[1]+f[1],E=x=>{let I=Ce("output",e[0].dataType,m.length,o),N=mn(I.type.tensor),R=oo(t,I.type.value,N),$=ue("x",e[0].dataType,p.length,o),O=ue("w",e[1].dataType,f.length,o),k=[$,O];s&&k.push(ue("b",e[2].dataType,e[2].dims,o));let P=s?"value += b[output_channel];":"",G=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return lo(t,G),`
  ${x.registerUniforms(G).declareVariables(...k,I)}
  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${u}u;
    let col = (index1 % width1) * ${u}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${$.type.value}, ${b}>;
    var values: array<${I.type.value}, ${u}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${f[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${b}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${$.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${$.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${f[1]}; w_width++) {
          let w_val = ${O.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${u}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${u}u; i++) {
      var value = values[i];
      ${P}
      ${R}
      ${I.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${o};${u};${b};${f[0]};${f[1]}`,inputDependencies:s?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:a?a(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:_}),getShaderSource:E}}}),lT,Ec,uT,Sc,Fh,Kp,cT,dT,Yh,AD=be(()=>{Je(),SD(),xD(),Am(),CD(),fo(),Cm(),Er(),lT=(e,t,n,a,s,o)=>{let u=e[0],d=e.slice(o?1:2,o?3:4),p=d.length,f=t[0],m=t.slice(2).map((b,E)=>b+(b-1)*(n[E]-1)),_=d.map((b,E)=>b+a[E]+a[E+p]).map((b,E)=>Math.floor((b-m[E]+s[E])/s[E]));return _.splice(0,0,u),_.splice(o?3:1,0,f),_},Ec=[2,3,1,0],uT=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let n=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],a=e[1].dims[1]*t.group;if(n!==a)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let s=e[0].dims.length-2;if(t.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(t.strides.length!==s)throw new Error(`strides should be ${s}D`);if(t.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Sc=(e,t)=>{let n=e.kernelShape.slice();n.length<t[1].dims.length-2&&n.push(...Array(t[1].dims.length-2-n.length).fill(0));for(let o=2;o<t[1].dims.length;++o)n[o-2]===0&&(n[o-2]=t[1].dims[o]);let a=e.pads.slice();qc.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,n,a,e.format==="NHWC",e.autoPad);let s=Object.assign({},e);return Object.assign(s,{kernelShape:n,pads:a}),s},Fh=e=>{let t=Em(e),n=e.format,a=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],s=e.dilations,o=e.group,u=e.kernel_shape,d=e.pads,p=e.strides,f=e.w_is_const();return{autoPad:a,format:n,dilations:s,group:o,kernelShape:u,pads:d,strides:p,wIsConst:f,...t,cacheKey:`${e.format};${t.activation};`}},Kp=(e,t,n,a)=>{let s=n.format==="NHWC",o=lT(t[0].dims,t[1].dims,n.dilations,n.pads,n.strides,s);if(n.group!==1){let G=[t[0]];if(s){let B=e.kernelCustomData.wT??e.compute(fi(t[1],Ec),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=B),G.push(B)}else G.push(t[1]);t.length===3&&G.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&s&&t[1].dims[0]===n.group&&t[1].dims[1]===1&&n.dilations[0]===1&&n.dilations[1]===1?e.compute(hx(G,n,o,a),{inputs:G}):e.compute(px(G,n,o,a),{inputs:G});return}let u=t.length===3,d=t[0].dims[s?1:2],p=t[0].dims[s?2:3],f=t[0].dims[s?3:1],m=t[1].dims[2],_=t[1].dims[3],b=o[s?1:2],E=o[s?2:3],x=o[s?3:1],I=s&&m===d&&_===p&&n.pads[0]===0&&n.pads[1]===0;if(I||m===1&&_===1&&n.dilations[0]===1&&n.dilations[1]===1&&n.strides[0]===1&&n.strides[1]===1&&n.pads[0]===0&&n.pads[1]===0){let G=o[0],B,K,Y,se=[];if(s){let ge=e.kernelCustomData.wT??e.compute(fi(t[1],Ec),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=ge),I){let $e=d*p*f;B=t[0].reshape([1,G,$e]),K=ge.reshape([1,$e,x]),Y=[1,G,x]}else B=t[0].reshape([G,d*p,f]),K=ge.reshape([1,f,x]),Y=[G,b*E,x];se.push(B),se.push(K)}else B=t[0].reshape([G,f,d*p]),K=t[1].reshape([1,x,f]),Y=[G,x,b*E],se.push(K),se.push(B);u&&se.push(t[2]);let ve=Y[2],_e=se[0].dims[se[0].dims.length-1];ve<8&&_e<8?e.compute(xm(se,n,o,Y,s,a),{inputs:se}):e.compute(Fc(se,n,o,Y,s,a),{inputs:se});return}let N=!0,R=e.kernelCustomData.wT??e.compute(fi(t[1],Ec),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=R);let $=[t[0],R];u&&$.push(t[2]);let O=s?b*E:x,k=s?x:b*E,P=m*_*f;e.compute(cx($,n,o,O,k,P,u,N,a),{inputs:$})},cT=(e,t)=>{let n=t.format==="NHWC",a=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&a.push(e.inputs[2]);let s=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),u=[1].concat(t.dilations),d=[1].concat(t.kernelShape),p=Sc({...t,pads:s,strides:o,dilations:u,kernelShape:d},a);Kp(e,a,p,f=>n?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},dT=(e,t,n)=>{let a=n.format==="NHWC"?"channelsLast":"channelsFirst",s=Sc(n,t),o=n.autoPad==="NOTSET"?n.pads:n.autoPad,u=dx(t[0].dims,t[1].dims,n.strides,n.dilations,o,!1,a);e.compute(fx(t,s,u.outShape,[u.filterDepth,u.filterHeight,u.filterWidth],[u.padInfo.front,u.padInfo.top,u.padInfo.left],a))},Yh=(e,t)=>{if(uT(e.inputs,t),e.inputs[0].dims.length===3)cT(e,t);else if(e.inputs[0].dims.length===5)dT(e,e.inputs,t);else{let n=Sc(t,e.inputs);Kp(e,e.inputs,n)}}}),mx,ID=be(()=>{Ve(),Da(),Je(),Xe(),mx=(e,t,n)=>{let a=e.length>2,s=t.outputShape,o=t.format==="NHWC",u=t.group,d=e[1].dims,p=d[2]/u,f=d[3],m=o?Ht(p):1,_=o&&f===1&&p>=4,b=_?Math.floor(p/4)*4:Math.floor(p/m)*m,E=p-b,x=o?Ht(f):1,I=o?f===1?m:x:1,N=ae.size(s)/x,R=[Math.ceil(N/64),1,1];lt("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${R}`);let $=["rank","rank"],O=[t.strides[0],t.strides[1]],k=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],P=[t.dilations[0],t.dilations[1]],G=[k[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),k[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],B=[G[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),G[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],K=[{type:12,data:N},{type:12,data:O},{type:12,data:k},{type:12,data:P},{type:12,data:G},{type:6,data:B},{type:12,data:b},{type:12,data:p},{type:12,data:f},...Oe(e[0].dims,e[1].dims)];a&&(K.push(...Oe(e[2].dims)),$.push("rank")),K.push(...Oe(s));let Y=se=>{let ve=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:O.length},{name:"filter_dims",type:"u32",length:k.length},{name:"dilations",type:"u32",length:k.length},{name:"effective_filter_dims",type:"u32",length:G.length},{name:"pads",type:"i32",length:B.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],_e=mn(e[0].dataType),ge=o?1:2,$e=o?2:3,Ae=o?3:1,H=ue("W",e[1].dataType,e[1].dims.length,I),j=ue("Dy",e[0].dataType,e[0].dims.length,m),fe=[j,H];a&&fe.push(ue("bias",e[2].dataType,[s[Ae]].length,x));let Ee=Ce("result",e[0].dataType,s.length,x),Ie=()=>{let te="";if(_)m===4?te+=`
        let xValue = ${j.getByOffset("x_offset")};
        let wValue = ${H.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:m===2?te+=`
          dotProd = dotProd + dot(vec4<${_e}>(${j.getByOffset("x_offset")}, ${j.getByOffset("x_offset + 1u")}), vec4<${_e}>(${H.getByOffset("w_offset")}, ${H.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:m===1&&(te+=`
          dotProd = dotProd + dot(vec4<${_e}>(${j.getByOffset("x_offset")}, ${j.getByOffset("x_offset + 1u")}, ${j.getByOffset("x_offset + 2u")}, ${j.getByOffset("x_offset + 3u")}), vec4<${_e}>(${H.getByOffset("w_offset")}, ${H.getByOffset("w_offset + 1u")}, ${H.getByOffset("w_offset + 2u")}, ${H.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(te+=`
                  let xValue = ${o?j.getByOffset(`${j.indicesToOffset(`${j.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m}`):j.get("batch","inputChannel","idyR","idyC")};
        `,m===1)te+=`
          let w_offset = ${H.indicesToOffset(`${H.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${H.getByOffset(`w_offset / ${I}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let de=0;de<m;de++)te+=`
            let wValue${de} = ${H.getByOffset(`${H.indicesToOffset(`${H.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${de}, wOutChannel)`)} / ${I}`)};
            dotProd = dotProd + xValue[${de}] * wValue${de};`;return te},z=()=>{if(E===0)return"";if(!_)throw new Error(`packInputAs4 ${_} is not true.`);let te="";if(m===1){te+="dotProd = dotProd";for(let de=0;de<E;de++)te+=`
            + ${j.getByOffset(`x_offset + ${de}`)} * ${H.getByOffset(`w_offset + ${de}`)}`;te+=";"}else if(m===2){if(E!==2)throw new Error(`Invalid inputChannelsRemainder ${E}.`);te+=`
          let xValue = ${j.getByOffset("x_offset")};
          let wValue = ${H.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return te},q=`
            let outputIndices = ${Ee.offsetToIndices(`global_idx * ${x}`)};
            let batch = ${Ee.indicesGet("outputIndices",0)};
            let d1 = ${Ee.indicesGet("outputIndices",Ae)};
            let r = ${Ee.indicesGet("outputIndices",ge)};
            let c = ${Ee.indicesGet("outputIndices",$e)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${Ee.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${_e}(dyRCorner) + ${_e}(wR)) / ${_e}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${_e}(uniforms.Dy_shape[${ge}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${_e}(dyCCorner) + ${_e}(wC)) / ${_e}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${_e}(uniforms.Dy_shape[${$e}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${_?`
                var x_offset = ${j.indicesToOffset(`${j.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m};
                var w_offset = ${H.indicesToOffset(`${H.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${I};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${_?4:m}) {
                  ${Ie()}
                  inputChannel = inputChannel + ${_?4:m};
                }
                ${z()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${a?` + bias[d1 / ${x}]`:""};
            ${Ee.setByOffset("global_idx","value")};
          `;return`
    ${se.registerUniforms(ve).declareVariables(...fe,Ee)}
      ${se.mainStart()}
      ${se.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${q}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${m}${I}${x}${_}${E}`,inputDependencies:$},getRunData:()=>({dispatchGroup:{x:R[0],y:R[1],z:R[2]},outputs:[{dims:n?n(s):s,dataType:e[0].dataType}],programUniforms:K}),getShaderSource:Y}}}),fT,pT,hT,Jp,gx,mT,Xp,gT,yx,RD=be(()=>{ID(),fo(),Er(),fT=(e,t,n,a,s,o)=>(e-1)*t+n+(a-1)*s+1-o,pT=(e,t,n,a,s)=>{let o=Math.floor(e/2);t==="SAME_UPPER"?(n[a]=o,n[s]=e-o):t==="SAME_LOWER"&&(n[a]=e-o,n[s]=o)},hT=(e,t,n,a,s,o,u,d,p,f)=>{let m=e.length-2,_=f.length===0;p.length<m&&p.push(...Array(m-p.length).fill(0));let b=e[0],E=t[d?3:1]*s;for(let x=0,I=e.length-m-(d?1:0);x<m;++x,++I){let N=e[I],R=_?N*u[x]:f[x],$=fT(N,u[x],o[x],t[I],n[x],R);pT($,a,o,x,x+m),_&&f.push(u[x]*(N-1)+p[x]+(t[I]-1)*n[x]+1-o[x]-o[x+m])}f.splice(0,0,b),f.splice(d?3:1,0,E)},Jp=(e,t)=>{let n=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((_,b)=>_*b,1)===0){n.length=0;for(let _=2;_<t[1].dims.length;++_)n.push(t[1].dims[_])}let a=e.format==="NHWC";n.splice(0,0,t[1].dims[0]),n.splice(a?3:1,0,t[1].dims[1]);let s=e.pads.slice(),o=e.outputShape.slice(),u=e.outputPadding.slice(),d=t[0].dims,p=e.dilations.slice();if(p.reduce((_,b)=>_+b,0)===0){let _=t[0].dims.length-2;p=new Array(_).fill(1)}let f=e.strides.slice();if(f.reduce((_,b)=>_+b,0)===0){let _=t[0].dims.length-2;f=new Array(_).fill(1)}hT(d,n,p,e.autoPad,e.group,s,f,a,u,o);let m=Object.assign({},e);return Object.assign(m,{kernelShape:n,pads:s,outputPadding:u,outputShape:o,dilations:p,strides:f}),m},gx=e=>{let t=Em(e),n=e.format,a=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],s=e.dilations,o=e.group,u=e.kernelShape,d=e.pads,p=e.strides,f=e.wIsConst(),m=e.outputPadding,_=e.outputShape;return{autoPad:a,format:n,dilations:s,group:o,kernelShape:u,outputPadding:m,outputShape:_,pads:d,strides:p,wIsConst:f,...t,cacheKey:`${e.format};${t.activation};`}},mT=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let n=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],a=e[1].dims[0];if(n!==a)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let s=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==s))throw new Error("invalid bias");let o=e[0].dims.length-2;if(t.dilations.reduce((u,d)=>u+d,0)>0&&t.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(t.strides.reduce((u,d)=>u+d,0)>0&&t.strides.length!==o)throw new Error(`strides should be ${o}D`);if(t.pads.reduce((u,d)=>u+d,0)>0&&t.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(t.outputPadding.length!==o&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(t.kernelShape.reduce((u,d)=>u+d,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},Xp=(e,t,n,a)=>{let s=e.kernelCustomData.wT??e.compute(fi(t[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=s);let o=[t[0],s];t.length===3&&o.push(t[2]),e.compute(mx(o,n,a),{inputs:o})},gT=(e,t)=>{let n=t.format==="NHWC",a=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&a.push(e.inputs[2]);let s=t.kernelShape;(s.length===0||s[0]===0)&&(s=[e.inputs[1].dims[2]]);let o=t.dilations;(o.length===0||o[0]===0)&&(o=[1]);let u=t.strides;(u.length===0||u[0]===0)&&(u=[1]);let d=t.pads;d.length===0&&(d=[0,0]),d=[0,d[0],0,d[1]],u=[1].concat(u),o=[1].concat(o),s=[1].concat(s);let p=t.outputPadding;p=[0].concat(p);let f=Jp({...t,pads:d,strides:u,dilations:o,kernelShape:s,outputPadding:p},a);Xp(e,a,f,m=>n?[m[0],m[2],m[3]]:[m[0],m[1],m[3]])},yx=(e,t)=>{if(mT(e.inputs,t),e.inputs[0].dims.length===3)gT(e,t);else{let n=Jp(t,e.inputs);Xp(e,e.inputs,n)}}}),yT,vx,_x,ND=be(()=>{Ve(),Je(),Jt(),Xe(),yT=(e,t,n,a)=>{let s=ae.size(t),o=t.length,u=ue("input",e,o),d=Ce("output",e,o),p=n.dataType===6?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),f=ae.normalizeAxis(p,o),m=_=>{let b=` i32(${u.indicesGet("inputIndices","uniforms.axis")}) `,E=Ne("uniforms.input_shape","uniforms.axis",o),x=a.reverse?b+(a.exclusive?" + 1":""):"0",I=a.reverse?E:b+(a.exclusive?"":" + 1");return`
                ${_.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(u,d)}
                ${_.mainStart()}
                  ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${d.offsetToIndices("global_idx")};
                  var sum = ${d.type.value}(0);
                  let first : i32 = ${x};
                  let last : i32 = ${I};
                  for (var i : i32 = first; i < last; i++) {
                    ${u.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${u.getByIndices("inputIndices")};
                  }
                  ${d.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:a.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},{type:12,data:f},...Oe(t,t)]}),getShaderSource:m}},vx=(e,t)=>{let n=e.inputs[0].dims,a=e.inputs[0].dataType,s=e.inputs[1];e.compute(yT(a,n,s,t),{inputs:[0]})},_x=e=>{let t=e.exclusive===1,n=e.reverse===1;return pt({exclusive:t,reverse:n})}}),vT,_T,bT,bx,Tx,$D=be(()=>{Ve(),Je(),Jt(),Xe(),vT=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},_T=(e,t,n,a)=>{let s=[];s.push(`fn perm(i: ${a.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`);for(let o=0;o<t;++o)s.push(n.indicesSet("a",e[o],`i[${o}]`));return s.push("return a;}"),s.join(`
`)},bT=(e,t)=>{let n,a,s,o,u,d,p=t.format==="NHWC",f=t.blocksize,m=t.mode==="DCR";p?([n,a,s,o]=e.dims,u=m?[n,a,s,f,f,o/f**2]:[n,a,s,o/f**2,f,f],d=m?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,a,s,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],u=m?[n,f,f,o/f**2,a,s]:[n,o/f**2,f,f,a,s],d=m?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let _=e.reshape(u),b=_.dims.length,E=e.dataType,x=ue("a",E,b),I=Ce("output",E,b),N=R=>`
  ${R.registerUniform("output_size","u32").declareVariables(x,I)}

  ${_T(d,b,x,I)}

  ${R.mainStart()}
    ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${I.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${I.setByOffset("global_idx",x.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:R=>{let $=p?[n,a*f,s*f,o/f**2]:[n,o/f**2,a*f,s*f],O=ae.size($),k=_.dims,P=ae.sortBasedOnPerm(k,d);return{outputs:[{dims:$,dataType:R[0].dataType}],dispatchGroup:{x:Math.ceil(O/64)},programUniforms:[{type:12,data:O},...Oe(k,P)]}},getShaderSource:N}},bx=(e,t)=>{vT(e.inputs),e.compute(bT(e.inputs[0],t))},Tx=e=>pt({blocksize:e.blocksize,mode:e.mode,format:e.format})}),xc,Rl,Zp,TT,wT,ET,ST,Qp,xT,wx,Ex,MD=be(()=>{Ve(),Je(),Jt(),Xe(),xc="[a-zA-Z]|\\.\\.\\.",Rl="("+xc+")+",Zp="^"+Rl+"$",TT="("+Rl+",)*"+Rl,wT="^"+TT+"$",ET=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let n=this.symbolToIndices.get(e);n===void 0?n=[t]:n.push(t),this.symbolToIndices.set(e,n)}},ST=class{constructor(e,t){var s;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,a]=t.includes("->")?t.split("->",2):[t,""];if(!n.match(RegExp(wT)))throw new Error("Invalid LHS term");if(n.split(",").forEach((o,u)=>{let d=e[u].dims.slice();if(!o.match(RegExp(Zp)))throw new Error("Invalid LHS term");let p=this.processTerm(o,!0,d,u);this.lhs.push(p)}),a==="")a+=[...this.symbolToInfo.entries()].filter(([o,u])=>u.count===1||o==="...").map(([o])=>o).join("");else if(!a.match(RegExp(Rl)))throw new Error("Invalid RHS");(s=a.match(RegExp(xc,"g")))==null||s.forEach(o=>{if(o==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let u=this.symbolToInfo.get(o);if(u===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(u.dimValue)}}),this.rhs=this.processTerm(a,!1,this.outputDims)}addSymbol(e,t,n){let a=this.symbolToInfo.get(e);if(a!==void 0){if(a.dimValue!==t&&a.count!==1)throw new Error("Dimension mismatch");a.count++,a.inputIndices.push(n)}else a={count:1,dimValue:t,inputIndices:[n]};this.symbolToInfo.set(e,a)}processTerm(e,t,n,a=-1){let s=n.length,o=!1,u=[],d=0;if(!e.match(RegExp(Zp))&&!t&&e!=="")throw new Error("Invalid LHS term");let p=e.match(RegExp(xc,"g")),f=new ET(a);return p==null||p.forEach((m,_)=>{if(m==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let b=s-p.length+1;if(b<0)throw new Error("Ellipsis out of bounds");if(u=n.slice(d,d+b),this.hasEllipsis){if(this.ellipsisDims.length!==u.length||this.ellipsisDims.toString()!==u.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=u;else throw new Error("Ellipsis must be specified in the LHS");for(let E=0;E<u.length;E++){let x=String.fromCharCode(48+E);f.addSymbol(x,_+E),this.addSymbol(x,n[d++],a)}}else f.addSymbol(m,_+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(m,n[d++],a)}),f}},Qp=e=>e+"_max",xT=(e,t,n,a)=>{let s=e.map(f=>f.length).map((f,m)=>ue(`input${m}`,t,f)),o=ae.size(a),u=Ce("output",t,a.length),d=[...n.symbolToInfo.keys()].filter(f=>!n.rhs.symbolToIndices.has(f)),p=f=>{let m=[],_="var prod = 1.0;",b="var sum = 0.0;",E="sum += prod;",x=[],I=[],N=[],R=[],$=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((k,P)=>{var G;if(n.rhs.symbolToIndices.has(P)){let B=(G=n.rhs.symbolToIndices.get(P))==null?void 0:G[0];B!==void 0&&n.lhs.forEach((K,Y)=>{if(k.inputIndices.includes(Y)){let se=K.symbolToIndices.get(P);if(se===void 0)throw new Error("Invalid symbol error");se.forEach(ve=>{m.push(`${s[Y].indicesSet(`input${Y}Indices`,ve,u.indicesGet("outputIndices",B))}`)})}})}else n.lhs.forEach((B,K)=>{if(k.inputIndices.includes(K)){let Y=B.symbolToIndices.get(P);if(Y===void 0)throw new Error("Invalid symbol error");Y.forEach(se=>{x.push(`${s[K].indicesSet(`input${K}Indices`,se,`${P}`)}`)}),R.push(`prod *= ${s[K].getByIndices(`input${K}Indices`)};`)}}),I.push(`for(var ${P}: u32 = 0; ${P} < uniforms.${Qp(P)}; ${P}++) {`),N.push("}")});let O=$?[...m,`let sum = ${s.map((k,P)=>k.getByIndices(`input${P}Indices`)).join(" * ")};`]:[...m,b,...I,...x,_,...R,E,...N];return`
            ${f.registerUniforms(d.map(k=>({name:`${Qp(k)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...s,u)}

            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${u.offsetToIndices("global_idx")};
            ${s.map((k,P)=>`var input${P}Indices: ${s[P].type.indices};`).join(`
`)}
            ${O.join(`
`)};
            ${u.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let f=d.filter(_=>n.symbolToInfo.has(_)).map(_=>{var b;return{type:12,data:((b=n.symbolToInfo.get(_))==null?void 0:b.dimValue)||0}});f.push({type:12,data:o});let m=e.map((_,b)=>[...Oe(_)]).reduce((_,b)=>_.concat(b),f);return m.push(...Oe(a)),{outputs:[{dims:a,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:m}},getShaderSource:p}},wx=(e,t)=>{let n=new ST(e.inputs,t.equation),a=n.outputDims,s=e.inputs.map((o,u)=>o.dims);e.compute(xT(s,e.inputs[0].dataType,n,a))},Ex=e=>{let t=e.equation.replace(/\s+/g,"");return pt({equation:t})}}),CT,jp,AT,IT,Sx,OD=be(()=>{Ve(),Je(),Xe(),CT=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),a=n.length<t.length?0:n.length-t.length,s=t.length<n.length?0:t.length-n.length;for(;a<n.length&&s<t.length;++a,++s)if(n[a]!==t[s]&&n[a]!==1&&t[s]!==1)throw new Error("Expand requires shape to be broadcastable to input")},jp=(e,t)=>{let n=e.length-t.length,a=[];for(let s=0;s<n;++s)a.push(e[s]);for(let s=0;s<t.length;++s)a.push(t[s]===1?e[s+n]:t[s]);return a},AT=(e,t)=>e.length>t.length?jp(e,t):jp(t,e),IT=e=>{let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),a=AT(t,n),s=e[0].dataType,o=s===9||ae.size(t)===1,u=s===9||t.length>0&&t[t.length-1]%4===0?4:1,d=o||a.length>0&&a[a.length-1]%4===0?4:1,p=Math.ceil(ae.size(a)/d),f=_=>{let b=ue("input",s,t.length,u),E=Ce("output",s,a.length,d),x;if(s===9){let I=(N,R,$="")=>`
          let outputIndices${R} = ${E.offsetToIndices(`outputOffset + ${R}u`)};
          let offset${R} = ${b.broadcastedIndicesToOffset(`outputIndices${R}`,E)};
          let index${R} = offset${R} / 4u;
          let component${R} = offset${R} % 4u;
          ${N}[${R}] = ${$}(${b.getByOffset(`index${R}`)}[component${R}]);
        `;x=`
        let outputOffset = global_idx * ${d};
        var data = vec4<u32>(0);
        ${I("data",0,"u32")}
        ${I("data",1,"u32")}
        ${I("data",2,"u32")}
        ${I("data",3,"u32")}
        ${E.setByOffset("global_idx","data")}
      }`}else x=`
        let outputIndices = ${E.offsetToIndices(`global_idx * ${d}`)};
        let inputOffset = ${b.broadcastedIndicesToOffset("outputIndices",E)};
        let data = ${E.type.value}(${b.getByOffset(`inputOffset / ${u}`)});
        ${E.setByOffset("global_idx","data")}
      }`;return`
    ${_.registerUniform("vec_size","u32").declareVariables(b,E)}
    ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${x}`},m=[{type:12,data:p},...Oe(t,a)];return{name:"Expand",shaderCache:{hint:`${a.length};${u}${d}`,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:[{dims:a,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:m})}},Sx=e=>{CT(e.inputs),e.compute(IT(e.inputs),{inputs:[0]})}}),RT,xx,DD=be(()=>{Ve(),Je(),Xe(),wm(),RT=e=>{let t=e[0].dataType,n=ae.size(e[0].dims),a=ae.size(e[1].dims),s=a%4===0,o=u=>{let d=ue("x",t,[1],4),p=ue("bias",t,[1],4),f=Ce("y",t,[1],4),m=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],_=E=>`
      let bias${E}_offset: u32 = (global_idx * 4 + ${E}) % uniforms.bias_size;
      let bias${E} = ${p.getByOffset(`bias${E}_offset / 4`)}[bias${E}_offset % 4];`,b=s?`
      let bias = ${p.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${_(0)}${_(1)}${_(2)}${_(3)}
      let bias = ${d.type.value}(bias0, bias1, bias2, bias3);`;return`${u.registerUniforms(m).declareVariables(d,p,f)}

    ${Gh(zn(t))}

    ${u.mainStart(ls)}
      ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${d.getByOffset("global_idx")};
      ${b}
      let x_in = x + bias;
      ${f.setByOffset("global_idx",Vh("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${s}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:u=>({outputs:[{dims:u[0].dims,dataType:u[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:a}],dispatchGroup:{x:Math.ceil(n/ls/4)}})}},xx=e=>{e.inputs.length<2||ae.size(e.inputs[1].dims)===0?FS(e):e.compute(RT(e.inputs))}}),NT,$T,Cx,Ax,kD=be(()=>{Ve(),Je(),Jt(),Xe(),NT=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},$T=(e,t)=>{let n=e[0].dims,a=e[1].dims,s=n.length,o=ae.normalizeAxis(t.axis,s),u=n.slice(0);u.splice(o,1,...a);let d=n[o],p=e[0].dataType===9?4:1,f=Math.ceil(ae.size(u)/p),m=[{type:12,data:f},{type:6,data:d},{type:12,data:o},...Oe(e[0].dims,e[1].dims,u)],_=b=>{let E=ue("data",e[0].dataType,e[0].dims.length,p),x=ue("inputIndices",e[1].dataType,e[1].dims.length),I=Ce("output",e[0].dataType,u.length,p),N=$=>{let O=a.length,k=`var indicesIndices${$}  = ${x.type.indices}(0);`;for(let P=0;P<O;P++)k+=`${O>1?`indicesIndices${$}[${P}]`:`indicesIndices${$}`} = ${u.length>1?`outputIndices${$}[uniforms.axis + ${P}]`:`outputIndices${$}`};`;k+=`
          var idx${$} = ${x.getByIndices(`indicesIndices${$}`)};
          if (idx${$} < 0) {
            idx${$} = idx${$} + uniforms.axisDimLimit;
          }
          var dataIndices${$} : ${E.type.indices};
        `;for(let P=0,G=0;P<s;P++)P===o?(k+=`${s>1?`dataIndices${$}[${P}]`:`dataIndices${$}`} = u32(idx${$});`,G+=O):(k+=`${s>1?`dataIndices${$}[${P}]`:`dataIndices${$}`} = ${u.length>1?`outputIndices${$}[${G}]`:`outputIndices${$}`};`,G++);return k},R;if(e[0].dataType===9){let $=(O,k,P="")=>`
          let outputIndices${k} = ${I.offsetToIndices(`outputOffset + ${k}u`)};
          ${N(k)};
          let offset${k} = ${E.indicesToOffset(`dataIndices${k}`)};
          let index${k} = offset${k} / 4u;
          let component${k} = offset${k} % 4u;
          ${O}[${k}] = ${P}(${E.getByOffset(`index${k}`)}[component${k}]);
        `;R=`
        let outputOffset = global_idx * ${p};
        var value = vec4<u32>(0);
        ${$("value",0,"u32")}
        ${$("value",1,"u32")}
        ${$("value",2,"u32")}
        ${$("value",3,"u32")}
        ${I.setByOffset("global_idx","value")}
      `}else R=`
      let outputIndices = ${I.offsetToIndices("global_idx")};
      ${N("")};
      let value = ${E.getByIndices("dataIndices")};
      ${I.setByOffset("global_idx","value")};
      `;return`
      ${b.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(E,x,I)}
      ${b.mainStart()}
        ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${R}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},Cx=e=>pt({axis:e.axis}),Ax=(e,t)=>{let n=e.inputs;NT(n),e.compute($T(e.inputs,t))}}),MT,Ix,Rx,zD=be(()=>{Ve(),Je(),Xe(),MT=(e,t,n,a,s,o,u,d,p)=>{let f=[{type:12,data:o},{type:12,data:a},{type:12,data:s},{type:12,data:n},{type:12,data:u},{type:12,data:d},{type:12,data:p}],m=[o];f.push(...Oe(t.dims,m));let _=b=>{let E=ue("indices_data",t.dataType,t.dims.length),x=Ce("input_slice_offsets_data",12,1,1),I=[E,x],N=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:s.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${b.registerUniforms(N).declareVariables(...I)}
  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${s.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${n.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${s.length}_${n.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:f}),getShaderSource:_},{inputs:[t],outputs:[-1]})[0]},Ix=(e,t)=>{let n=e.inputs,a=n[0].dims,s=n[0].dataType,o=n[1].dims,u=o[o.length-1],d=ae.sizeToDimension(o,o.length-1),p=ae.sizeFromDimension(a,t.batchDims+u),f=ae.sizeToDimension(a,t.batchDims),m=ae.sizeFromDimension(a,t.batchDims),_=d/f,b=new Array(u),E=p;for(let k=0;k<u;++k)b[u-1-k]=E,E*=a[t.batchDims+u-1-k];let x=MT(e,n[1],b,t.batchDims,a,d,_,m,u),I=t.batchDims+u;if(I>a.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let N=o.slice(0,-1).concat(a.slice(I)),R=ae.size(N),$=[{type:12,data:R},{type:12,data:p},...Oe(n[0].dims,x.dims,N)],O=k=>{let P=ue("data",n[0].dataType,n[0].dims.length),G=ue("slice_offsets",12,x.dims.length),B=Ce("output",n[0].dataType,N.length);return`
          ${k.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(P,G,B)}
            ${k.mainStart()}
            ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:N,dataType:s}],dispatchGroup:{x:Math.ceil(R/64)},programUniforms:$}),getShaderSource:O},{inputs:[n[0],x]})},Rx=e=>({batchDims:e.batch_dims,cacheKey:""})}),OT,DT,Nx,$x,LD=be(()=>{Ve(),Je(),Jt(),Xe(),OT=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=ae.normalizeAxis(t.quantizeAxis,e[0].dims.length),a=t.blockSize,s=e[0],o=e[2],u=e.length===4?e[3]:void 0;if(o.dims.length!==s.dims.length||!s.dims.map((d,p)=>p===n?Math.ceil(d/a)===o.dims[p]:d===o.dims[p]).reduce((d,p)=>d&&p,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(u){if(u.dataType!==s.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(u.dims.length!==o.dims.length||!u.dims.map((d,p)=>d===o.dims[p]).reduce((d,p)=>d&&p,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},DT=(e,t)=>{let n=e[0].dims,a=e[1].dims,s=n.length,o=ae.normalizeAxis(t.gatherAxis,s),u=ae.normalizeAxis(t.quantizeAxis,s),d=n.slice(0);d.splice(o,1,...a);let p=ae.size(d),f=e[2].dataType,m=e[0].dataType===22,_=[{type:12,data:p},{type:12,data:u},{type:12,data:o},{type:12,data:t.blockSize},...Oe(...e.map((E,x)=>E.dims),d)],b=E=>{let x=ue("data",e[0].dataType,e[0].dims.length),I=ue("inputIndices",e[1].dataType,e[1].dims.length),N=ue("scales",e[2].dataType,e[2].dims.length),R=e.length>3?ue("zeroPoint",e[3].dataType,e[3].dims.length):void 0,$=Ce("output",f,d.length),O=[x,I,N];R&&O.push(R);let k=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${E.registerUniforms(k).declareVariables(...O,$)}
        ${E.mainStart()}
        let output_indices = ${$.offsetToIndices("global_idx")};
        var indices_indices = ${I.type.indices}(0);
        ${a.length>1?`
          for (var i: u32 = 0; i < ${a.length}; i++) {
            let index = ${$.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${I.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${$.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${x.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${$.indicesGet("output_indices","i")};
          ${x.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${I.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${n[o]};
        }
        ${x.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${d.length}; i++) {
          let index = ${$.indicesGet("output_indices",`i + ${a.length} - 1`)};
          ${x.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${x.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${x.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${N.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${N.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${N.getByIndices("scale_indices")};
        ${R?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${R.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${R.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${zn(f)}(quantized_data - zero_point) * scale;
        ${$.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((E,x)=>x!==1).map(E=>E.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(E,x)=>"rank")},getRunData:()=>({outputs:[{dims:d,dataType:f}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:_}),getShaderSource:b}},Nx=(e,t)=>{let n=e.inputs;OT(n,t),e.compute(DT(e.inputs,t))},$x=e=>pt({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),kT,zT,Mx,Ox,UD=be(()=>{Ve(),Je(),Jt(),Xe(),kT=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},zT=(e,t)=>{let n=e[0].dims,a=e[0].dataType,s=n.length,o=e[1].dims,u=e[1].dataType,d=ae.normalizeAxis(t.axis,s),p=n[d],f=o.slice(0),m=ae.size(f),_=ue("input",a,s),b=ue("indicesInput",u,o.length),E=Ce("output",a,f.length),x=[{type:12,data:m},{type:6,data:p},{type:12,data:d}];return x.push(...Oe(n,o,f)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:f,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:x}),getShaderSource:I=>`
      ${I.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(_,b,E)}
      ${I.mainStart()}
      ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${E.offsetToIndices("global_idx")};

      var idx = ${b.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${_.type.indices}(outputIndices);
      ${_.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${_.getByIndices("inputIndices")};

      ${E.setByOffset("global_idx","value")};
  }`}},Mx=e=>pt({axis:e.axis}),Ox=(e,t)=>{let n=e.inputs;kT(n),e.compute(zT(e.inputs,t))}}),LT,UT,Dx,kx,PD=be(()=>{Ve(),Je(),Xe(),LT=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},UT=(e,t)=>{let n=e[0].dims.slice(),a=e[1].dims.slice(),[s,o,u]=ME.getShapeOfGemmResult(n,t.transA,a,t.transB,e.length===3?e[2].dims:void 0),d=[s,o];if(!d)throw new Error("Can't use gemm on the given tensors");let p=16,f=Math.ceil(o/p),m=Math.ceil(s/p),_=!0,b=ae.size(d),E=[{type:12,data:_?f:b},{type:12,data:s},{type:12,data:o},{type:12,data:u},{type:1,data:t.alpha},{type:1,data:t.beta}],x=["type","type"];e.length===3&&(E.push(...Oe(e[2].dims)),x.push("rank")),E.push(...Oe(d));let I=R=>{let $="";t.transA&&t.transB?$="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?$="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?$="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&($="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let O=t.alpha===1?"":"value *= uniforms.alpha;",k=ue("a",e[0].dataType,e[0].dims),P=ue("b",e[1].dataType,e[1].dims),G=k.type.value,B=null,K=[k,P];e.length===3&&(B=ue("c",e[2].dataType,e[2].dims.length),K.push(B));let Y=Ce("output",e[0].dataType,d.length);K.push(Y);let se=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${R.registerUniforms(se).declareVariables(...K)}

  ${R.mainStart()}
    ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${G}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${$}
    }

    ${O}
    ${B!=null?`let cOffset = ${B.broadcastedIndicesToOffset("vec2(m, n)",Y)}; value += ${G}(uniforms.beta) * ${B.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},N=R=>{let $=ue("a",e[0].dataType,e[0].dims),O=ue("b",e[1].dataType,e[1].dims),k=null,P=[$,O];e.length===3&&(k=ue("c",e[2].dataType,e[2].dims.length),P.push(k));let G=Ce("output",e[0].dataType,d.length);P.push(G);let B=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],K="",Y="";t.transA&&t.transB?(Y=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${O.type.value}(0);
      }
      `,K="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(Y=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${O.type.value}(0);
      }
      `,K="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(Y=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${O.type.value}(0);
      }
      `,K="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(Y=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${$.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${O.type.value}(0);
      }
      `,K="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let se=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${R.registerUniforms(B).declareVariables(...P)}
  var<workgroup> tile_a: array<array<${$.type.storage}, ${p}>, ${p}>;
  var<workgroup> tile_b: array<array<${O.type.storage}, ${p}>, ${p}>;
  ${R.mainStart([p,p,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${p};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${p};
    let num_tiles = (uniforms.K - 1) / ${p} + 1;
    var k_start = 0u;
    var value = ${G.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${Y}
      k_start = k_start + ${p};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${p}; k++) {
        ${K}
      }
      workgroupBarrier();
    }

    ${se}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${k!=null?`let cOffset = ${k.broadcastedIndicesToOffset("vec2(m, n)",G)}; value += ${G.type.value}(uniforms.beta) * ${k.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return _?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:d,dataType:e[0].dataType}],dispatchGroup:{x:f*m},programUniforms:E}),getShaderSource:N}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:d,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:E}),getShaderSource:I}},Dx=e=>{let t=e.transA,n=e.transB,a=e.alpha,s=e.beta;return{transA:t,transB:n,alpha:a,beta:s,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},kx=(e,t)=>{LT(e.inputs),e.compute(UT(e.inputs,t))}}),oa,Ra,Xr,Zr,PT,BT,GT,VT,qT,HT,FT,YT,zx,Lx,BD=be(()=>{Ve(),Je(),Jt(),Xe(),[oa,Ra,Xr,Zr]=[0,1,2,3],PT=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},BT=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,GT=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,VT=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,qT=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,HT=(e,t,n)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${oa}] = batch;
     indices[${Ra}] = channel;`+(()=>{switch(n.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Xr}] = u32(r);
            indices[${Zr}] = u32(c);
          } else {
            return ${t}(0);
          }
        `;case"border":return`
          indices[${Xr}] = u32(clamp(r, 0, H - 1));
          indices[${Zr}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Xr}] = gs_reflect(r, border[1], border[3]);
          indices[${Zr}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${n.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,FT=(e,t,n)=>(()=>{switch(n.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${oa}], indices[${Ra}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${oa}], indices[${Ra}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${oa}], indices[${Ra}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${oa}], indices[${Ra}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${oa}], indices[${Ra}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${oa}], indices[${Ra}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${n.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,YT=(e,t)=>{let n=ue("x",e[0].dataType,e[0].dims.length),a=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],s=ue("grid",e[1].dataType,a.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[oa,Ra,Xr,Zr]=[0,3,1,2]);let u=Ce("output",e[0].dataType,o.length),d=n.type.value,p=ae.size(o),f=[{type:12,data:p},...Oe(e[0].dims,a,o)],m=_=>`
  ${_.registerUniform("output_size","u32").declareVariables(n,s,u)}
  ${BT}
  ${GT(d)}
  ${VT(t)}
  ${qT(t)}
  ${HT(n,d,t)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Xr}]);
      let W_in = i32(uniforms.x_shape[${Zr}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${u.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${oa}], indices[${Xr}], indices[${Zr}]);
      let nxy = ${s.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${FT(u,d,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:_=>{let b=ae.size(o);return{outputs:[{dims:o,dataType:_[0].dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:f}},getShaderSource:m}},zx=(e,t)=>{PT(e.inputs),e.compute(YT(e.inputs,t))},Lx=e=>pt({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),Gn,WT,Ux,eh,KT,Ul,Px,Bx=be(()=>{Ve(),Je(),Jt(),vm(),Tm(),Xe(),Er(),Gn=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,WT=(e,t)=>{let n=e[0],a=Gn(e,1),s=Gn(e,2),o=Gn(e,3),u=Gn(e,4),d=Gn(e,5),p=Gn(e,6),f=Gn(e,7);if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let m=n.dims[0],_=n.dims[1],b=n.dims.length===3?n.dims[2]:t.numHeads*n.dims[4],E=_,x=0,I=0,N=Math.floor(b/t.numHeads);if(p&&f&&ae.size(p.dims)&&ae.size(f.dims)){if(p.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(p.dims[0]!==m||p.dims[1]!==t.numHeads||p.dims[3]!==N)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[0]!==m||f.dims[1]!==t.numHeads||f.dims[3]!==N)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(p.dims[2]!==f.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(f.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');x=p.dims[2],I=p.dims[2]}else if(p&&ae.size(p.dims)||f&&ae.size(f.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let R;if(a&&ae.size(a.dims)>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(a.dims.length<3||a.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==a.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(a.dims.length===3){if(a.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');R=2,E=a.dims[1]}else if(a.dims.length===5){if(a.dims[2]!==t.numHeads||a.dims[3]!==2||a.dims[4]!==N)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');R=5,E=a.dims[1]}else{if(a.dims[1]!==t.numHeads||a.dims[3]!==N)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');R=0,E=a.dims[2]}}else{if(n.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==t.numHeads||n.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');R=3}if(o&&ae.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(a&&a.dims.length===5&&a.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let $=x+E,O=0;if(u&&ae.size(u.dims)>0){O=8;let B=u.dims;throw B.length===1?B[0]===m?O=1:B[0]===3*m+2&&(O=3):B.length===2&&B[0]===m&&B[1]===$&&(O=5),O===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let k=!1,P=b;if(s&&ae.size(s.dims)>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(E!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');P=s.dims[2]}else{if(E!==s.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');P=s.dims[1]*s.dims[3],k=!0}}let G=!1;if(u&&ae.size(u.dims)>0)throw new Error("Key padding mask is not supported");if(d&&ae.size(d.dims)>0){if(d.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(d.dims[0]!==m||d.dims[1]!==t.numHeads||d.dims[2]!==_||d.dims[3]!==$)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:m,sequenceLength:_,pastSequenceLength:x,kvSequenceLength:E,totalSequenceLength:$,maxSequenceLength:I,inputHiddenSize:0,hiddenSize:b,vHiddenSize:P,headSize:N,vHeadSize:Math.floor(P/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:O,scale:t.scale,broadcastResPosBias:G,passPastInKv:k,qkvFormat:R}},Ux=e=>pt({...e}),eh=pt({perm:[0,2,1,3]}),KT=(e,t,n,a,s,o,u)=>{let d=[a,s,o],p=ae.size(d),f=[{type:12,data:p},{type:12,data:u},{type:12,data:o}],m=_=>{let b=Ce("qkv_with_bias",t.dataType,d),E=ue("qkv",t.dataType,d),x=ue("bias",n.dataType,d),I=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${_.registerUniforms(I).declareVariables(E,x,b)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:d,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:f}),getShaderSource:m},{inputs:[t,n],outputs:[-1]})[0]},Ul=(e,t,n,a,s,o,u,d)=>{let p=o;if(u&&ae.size(u.dims)>0){if(a===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return p=KT(e,o,u,t,a,n*s,d),p=p.reshape([t,a,n,s]),n===1||a===1?p:e.compute(fi(p,eh.perm),{inputs:[p],outputs:[-1]})[0]}else return o.dims.length===3&&(p=o.reshape([t,a,n,s])),n===1||a===1?p:e.compute(fi(p,eh.perm),{inputs:[p],outputs:[-1]})[0]},Px=(e,t)=>{let n=WT(e.inputs,t),a=e.inputs[0],s=Gn(e.inputs,1),o=Gn(e.inputs,2),u=Gn(e.inputs,3),d=Gn(e.inputs,4),p=Gn(e.inputs,5),f=Gn(e.inputs,6),m=Gn(e.inputs,7);if(a.dims.length===5)throw new Error("Packed QKV is not implemented");if((s==null?void 0:s.dims.length)===5)throw new Error("Packed KV is not implemented");let _=s&&o&&s.dims.length===4&&o.dims.length===4,b=Ul(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,a,u,0);if(_)return Gl(e,b,s,o,d,void 0,f,m,p,n);if(!s||!o)throw new Error("key and value must be provided");let E=Ul(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,s,u,n.hiddenSize),x=Ul(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,o,u,2*n.hiddenSize);Gl(e,b,E,x,d,void 0,f,m,p,n)}}),JT,XT,ZT,QT,Wh,Gx,Vx,qx=be(()=>{Ve(),Je(),Jt(),Xe(),JT=e=>{if(!e||e.length<1)throw new Error("too few inputs")},XT=(e,t)=>{let n=[],a=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(s=>n.push(Number(s))),a=n.length),pt({numOutputs:a,axis:t.axis,splitSizes:n})},ZT=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${Ne("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,QT=e=>{let t=e.length,n=[];for(let a=0;a<t;++a){let s=e[a].setByIndices("indices","input[global_idx]");t===1?n.push(s):a===0?n.push(`if (output_number == ${a}u) { ${s} }`):a===t-1?n.push(`else { ${s} }`):n.push(`else if (output_number == ${a}) { ${s} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${n.join(`
`)}
      }`},Wh=(e,t)=>{let n=e[0].dims,a=ae.size(n),s=e[0].dataType,o=ae.normalizeAxis(t.axis,n.length),u=new Array(t.numOutputs),d=ue("input",s,n.length),p=new Array(t.numOutputs),f=[],m=[],_=0,b=[{type:12,data:a}];for(let x=0;x<t.numOutputs;x++){_+=t.splitSizes[x],p[x]=_;let I=n.slice();I[o]=t.splitSizes[x],m.push(I),u[x]=Ce(`output${x}`,s,I.length),f.push({dims:m[x],dataType:e[0].dataType})}b.push({type:12,data:p},...Oe(n,...m));let E=x=>`
  ${x.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",p.length).declareVariables(d,...u)}
  ${ZT(p.length)}
  ${QT(u)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${d.offsetToIndices("global_idx")};
    var index = ${d.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Ne("uniforms.size_in_split_axis","output_number - 1u",p.length)};
      ${d.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:E,getRunData:()=>({outputs:f,dispatchGroup:{x:Math.ceil(a/64)},programUniforms:b})}},Gx=(e,t)=>{JT(e.inputs);let n=e.inputs.length===1?t:XT(e.inputs,t);e.compute(Wh(e.inputs,n),{inputs:[0]})},Vx=e=>{let t=e.axis,n=e.splitSizes,a=e.numOutputs<0?n.length:e.numOutputs;if(a!==n.length)throw new Error("numOutputs and splitSizes length must be equal");return pt({axis:t,numOutputs:a,splitSizes:n})}}),jT,Yc,Hx,Fx=be(()=>{Ve(),Je(),Jt(),Xe(),jT=(e,t)=>{let[n,a,s,o]=e,{numHeads:u,rotaryEmbeddingDim:d}=t;if(n.dims.length!==3&&n.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!ae.areEqual(a.dims,[])&&!ae.areEqual(a.dims,[1])&&a.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${a.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!ae.areEqual(s.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(d>0&&u===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let p=n.dims[0],f=n.dims[n.dims.length-2],m=s.dims[0],_=ae.sizeFromDimension(n.dims,1)/f,b=d===0?s.dims[1]*2:_/u;if(d>b)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(a.dims.length===2){if(p!==a.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${a.dims[0]}`);if(f!==a.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${a.dims[1]}`)}if(b/2!==s.dims[1]&&d/2!==s.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${s.dims[1]}`);if(f>m)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Yc=(e,t)=>{let{interleaved:n,numHeads:a,rotaryEmbeddingDim:s,scale:o}=t,u=e[0].dims[0],d=ae.sizeFromDimension(e[0].dims,1),p=e[0].dims[e[0].dims.length-2],f=d/p,m=e[2].dims[1],_=s===0?m*2:f/a,b=new Array(u,p,f/_,_-m),E=ae.computeStrides(b),x=[{type:1,data:o},{type:12,data:b},{type:12,data:E},...e[0].dims.length===3?new Array({type:12,data:[d,f,_,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[d,_,p*_,1]}):[],...Oe(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],I=N=>{let R=ue("input",e[0].dataType,e[0].dims.length),$=ue("position_ids",e[1].dataType,e[1].dims.length),O=ue("cos_cache",e[2].dataType,e[2].dims.length),k=ue("sin_cache",e[3].dataType,e[3].dims.length),P=Ce("output",e[0].dataType,e[0].dims.length);return N.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:b.length},{name:"global_strides",type:"u32",length:E.length},{name:"input_output_strides",type:"u32",length:E.length}]),`
        ${N.declareVariables(R,$,O,k,P)}

        ${N.mainStart(ls)}
          let half_rotary_emb_dim = uniforms.${O.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${N.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${$.broadcastedIndicesToOffset("bsnh.xy",Ce("",$.type.tensor,2))};
            let position_id =
                u32(${$.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});
            let j = i + select(half_rotary_emb_dim, 1, ${n});
            let re = ${R.getByOffset("i")} * ${O.get("position_id","bsnh[3]")} -
                ${R.getByOffset("j")} * ${k.get("position_id","bsnh[3]")};
            ${P.setByOffset("i","re")}
            let im = ${R.getByOffset("i")} * ${k.get("position_id","bsnh[3]")} +
                ${R.getByOffset("j")} * ${O.get("position_id","bsnh[3]")};
            ${P.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${P.setByOffset("k",R.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:pt({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:I,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(ae.size(b)/ls)},programUniforms:x})}},Hx=(e,t)=>{jT(e.inputs,t),e.compute(Yc(e.inputs,t))}}),e1,t1,th,n1,Yx,GD=be(()=>{Jt(),Ve(),Tm(),Bx(),qx(),Er(),Fx(),Xe(),e1=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=e[0],a=e[1],s=e[2],o=e[3],u=e[4];if(t.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let d=!1,p=n.dims[0],f=n.dims[1],m=n.dims.length===3?d?n.dims[2]/3:n.dims[2]:t.numHeads*n.dims[4],_=f,b=0,E=!a||a.dims.length===0,x=Math.floor(E?m/(t.numHeads+2*t.kvNumHeads):m/t.numHeads);E&&(m=x*t.numHeads);let I=o&&o.dims.length!==0,N=u&&u.dims.length!==0;if(I&&o.dims.length===4&&o.dims[0]===p&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===x)throw new Error("BSNH pastKey/pastValue is not supported");if(I&&N){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');b=o.dims[2]}else if(I||N)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let R=1;if(a&&a.dims.length>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(a.dims.length<3||a.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==a.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(a.dims.length===3){if(n.dims[2]%a.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');_=a.dims[1]}else if(a.dims.length===5){if(a.dims[2]!==t.numHeads||a.dims[3]!==2||a.dims[4]!==x)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw new Error('Expect "value" be none when "key" has packed kv format.');_=a.dims[1]}else{if(a.dims[1]!==t.numHeads||a.dims[3]!==x)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');_=a.dims[2]}}else{if(n.dims.length!==3&&n.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(n.dims.length===5&&(n.dims[2]!==t.numHeads||n.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');R=3}let $=0,O=!1,k=t.kvNumHeads?x*t.kvNumHeads:m;if(s&&s.dims.length>0){if(s.dims.length!==3&&s.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==s.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(s.dims.length===3){if(_!==s.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');k=s.dims[2]}else{if(_!==s.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');k=s.dims[1]*s.dims[3],O=!0}}let P=e.length>4?e[5]:void 0;if(P&&P.dims.length!==1&&P.dims[0]!==p)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:p,sequenceLength:f,pastSequenceLength:b,kvSequenceLength:_,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:m,vHiddenSize:k,headSize:x,vHeadSize:Math.floor(k/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:$,scale:t.scale,broadcastResPosBias:!1,passPastInKv:O,qkvFormat:R}},t1=pt({perm:[0,2,1,3]}),th=(e,t,n)=>{let a=t,s=n.kvNumHeads;return t.dims.length===3&&n.kvSequenceLength!==0&&(a=t.reshape([n.batchSize,n.kvSequenceLength,s,n.headSize]),a=e.compute(fi(a,t1.perm),{inputs:[a],outputs:[-1]})[0]),a},n1=(e,t,n,a)=>{let s=7,o=["type","type"],u=[e*t],d=e*t,p=[{type:12,data:d},{type:12,data:t},{type:12,data:e}],f=m=>{let _=ue("seq_lens",n.dataType,n.dims),b=ue("total_seq_lens",a.dataType,a.dims),E=Ce("pos_ids",s,u),x=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${m.registerUniforms(x).declareVariables(_,b,E)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${b.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${_.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${E.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${E.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${E.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${t}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:u,dataType:s}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:p}),getShaderSource:f}},Yx=(e,t)=>{var k;let n=e1(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((k=e.inputs[1])==null?void 0:k.dims.length)===5)throw new Error("Packed KV is not implemented");let a=e.inputs[0],s=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,o=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,u=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,d=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,p=e.inputs.length>4?e.inputs[5]:void 0,f=e.inputs.length>5?e.inputs[6]:void 0,m=n.kvNumHeads?n.kvNumHeads:n.numHeads,_=pt({axis:2,numOutputs:3,splitSizes:[n.numHeads*n.headSize,m*n.headSize,m*n.headSize]}),[b,E,x]=!s&&!o?e.compute(Wh([a],_),{inputs:[a],outputs:[-1,-1,-1]}):[a,s,o],I,N;if(t.doRotary){let P=e.compute(n1(n.batchSize,n.sequenceLength,p,f),{inputs:[p,f],outputs:[-1]})[0],G=e.inputs[7],B=e.inputs[8],K=pt({interleaved:t.rotaryInterleaved!==0,numHeads:n.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),Y=[b,P,G,B],se=[-1];I=e.compute(Yc(Y,K),{inputs:Y,outputs:se})[0],Y.splice(0,1,E);let ve=pt({interleaved:t.rotaryInterleaved!==0,numHeads:n.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});N=e.compute(Yc(Y,ve),{inputs:Y,outputs:se})[0]}let R=Ul(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,t.doRotary?I:b,void 0,0),$=th(e,t.doRotary?N:E,n),O=th(e,x,n);Gl(e,R,$,O,void 0,void 0,u,d,void 0,n,p,f)}}),nh,i1,a1,Wx,VD=be(()=>{Ve(),Je(),Er(),Xe(),nh=(e,t,n,a,s,o,u,d)=>{let p=Ht(o),f=p===1?"f32":`vec${p}f`,m=p===1?"vec2f":`mat2x${p}f`,_=s*u,b=64;_===1&&(b=256);let E=[s,u,o/p],x=[s,u,2],I=["rank","type","type"],N=[];N.push(...Oe(E,x));let R=$=>{let O=ue("x",t.dataType,3,p),k=ue("scale",n.dataType,n.dims),P=ue("bias",a.dataType,a.dims),G=Ce("output",1,3,2),B=[O,k,P,G];return`
  var<workgroup> workgroup_shared : array<${m}, ${b}>;
  const workgroup_size = ${b}u;
  ${$.declareVariables(...B)}
  ${$.mainStart(b)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${f}(0);
    var squared_sum = ${f}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${f}(${O.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${m}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Tr("workgroup_shared[0][0]",p)} / f32(hight * ${p});
      let squared_sum_final = ${Tr("workgroup_shared[0][1]",p)} / f32(hight * ${p});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${d}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${p};${d};${b}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:x,dataType:1}],dispatchGroup:{x:_},programUniforms:N}),getShaderSource:R},{inputs:[t,n,a],outputs:[-1]})[0]},i1=(e,t,n)=>{let a=t[0].dims,s=a,o=2,u=a[0],d=a[1],p=ae.sizeFromDimension(a,o),f=Ht(p),m=ae.size(s)/f,_=nh(e,t[0],t[1],t[2],u,p,d,n.epsilon),b=[u,d,p/f],E=[u,d],x=["type","none"],I=N=>{let R=ue("x",t[0].dataType,b.length,f),$=ue("scale_shift",1,E.length,2),O=Ce("output",t[0].dataType,b.length,f),k=[R,$,O];return`
  ${N.registerUniform("output_size","u32").declareVariables(...k)}
  ${N.mainStart()}
  ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${O.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${$.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${R.getByOffset("global_idx")} * ${O.type.value}(scale_shift.x) + ${O.type.value}(scale_shift.y);
      ${O.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${f}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...Oe(b,E,b)]}),getShaderSource:I},{inputs:[t[0],_]})},a1=(e,t,n)=>{let a=t[0].dims,s=a,o=a[0],u=a[a.length-1],d=ae.sizeFromDimension(a,1)/u,p=Ht(u),f=ae.size(s)/p,m=[{type:12,data:d},{type:12,data:Math.floor(u/p)}],_=["type","type"],b=!1,E=[0,a.length-1];for(let R=0;R<a.length-2;R++)b=b||a[R+1]!==1,E.push(R+1);b=b&&a[a.length-1]!==1;let x=b?e.compute(fi(e.inputs[0],E),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:a.length},(R,$)=>a[E[$]])),I=nh(e,x,t[1],t[2],o,d,u,n.epsilon),N=R=>{let $=mn(t[0].dataType),O=p===1?"vec2f":`mat${p}x2f`,k=B=>{let K=B===0?"x":"y",Y=p===1?"f32":`vec${p}f`;switch(p){case 1:return`${$}(${Y}(scale.${K}))`;case 2:return`vec2<${$}>(${Y}(scale[0].${K}, scale[1].${K}))`;case 4:return`vec4<${$}>(${Y}(scale[0].${K}, scale[1].${K}, scale[2].${K}, scale[3].${K}))`;default:throw new Error(`Not supported compoents ${p}`)}},P=ue("input",t[0].dataType,t[0].dims,p),G=Ce("output",t[0].dataType,s,p);return`
  @group(0) @binding(0) var<storage, read> input : array<${P.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${O}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${G.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${R.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${k(0)}, ${k(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${p}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:N},{inputs:[t[0],I]})},Wx=(e,t)=>{t.format==="NHWC"?a1(e,e.inputs,t):i1(e,e.inputs,t)}}),r1,o1,Kx,qD=be(()=>{Ve(),Je(),Xe(),r1=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},o1=(e,t,n)=>{let a=t.simplified,s=e[0].dims,o=e[1],u=!a&&e[2],d=s,p=ae.normalizeAxis(t.axis,s.length),f=ae.sizeToDimension(s,p),m=ae.sizeFromDimension(s,p),_=ae.size(o.dims),b=u?ae.size(u.dims):0;if(_!==m||u&&b!==m)throw new Error(`Size of X.shape()[axis:] == ${m}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${_} and bias size of ${b}`);let E=[];for(let P=0;P<s.length;++P)P<p?E.push(s[P]):E.push(1);let x=Ht(m),I=["type","type"],N=[{type:12,data:f},{type:1,data:m},{type:12,data:Math.floor(m/x)},{type:1,data:t.epsilon}];u&&I.push("type");let R=n>1,$=n>2,O=P=>{let G=mn(e[0].dataType),B=[ue("x",e[0].dataType,e[0].dims,x),ue("scale",o.dataType,o.dims,x)];u&&B.push(ue("bias",u.dataType,u.dims,x)),B.push(Ce("output",e[0].dataType,d,x)),R&&B.push(Ce("mean_data_output",1,E)),$&&B.push(Ce("inv_std_output",1,E));let K=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${P.registerUniforms(K).declareVariables(...B)}
  ${P.mainStart()}
    ${P.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Uh("f32",x)};
    var mean_square_vector = ${Uh("f32",x)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${is(G,x,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Tr("mean_vector",x)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Tr("mean_square_vector",x)} / uniforms.norm_size ${a?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${is(G,x,"x[j + offset]")};
      let f32scale = ${is(G,x,"scale[j]")};
      output[j + offset] = ${B[0].type.value}((f32input ${a?"":"- mean"}) * inv_std_dev * f32scale
        ${u?`+ ${is(G,x,"bias[j]")}`:""}
      );
    }

    ${R?"mean_data_output[global_idx] = mean":""};
    ${$?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},k=[{dims:d,dataType:e[0].dataType}];return R&&k.push({dims:E,dataType:1}),$&&k.push({dims:E,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${x};${n};${a}`,inputDependencies:I},getRunData:()=>({outputs:k,dispatchGroup:{x:Math.ceil(f/64)},programUniforms:N}),getShaderSource:O}},Kx=(e,t)=>{r1(e.inputs),e.compute(o1(e.inputs,t,e.outputCount))}}),s1,Jx,HD=be(()=>{Je(),Cm(),Am(),s1=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},Jx=e=>{s1(e.inputs);let t=ss.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let n=t[t.length-1],a=e.inputs[0].dims[e.inputs[0].dims.length-1];if(n<8&&a<8)e.compute(xm(e.inputs,{activation:""},t));else{let s=t[t.length-2],o=ae.size(e.inputs[0].dims.slice(0,-2)),u=ae.size(e.inputs[1].dims.slice(0,-2));if(o!==1&&s===1&&u===1){let d=e.inputs[0].reshape([1,o,a]),p=e.inputs[1].reshape([1,a,n]),f=[1,o,n],m=[d,p];e.compute(Fc(m,{activation:""},t,f),{inputs:m})}else e.compute(Fc(e.inputs,{activation:""},t))}}}),l1,u1,c1,Xx,Zx,FD=be(()=>{Ve(),Je(),Jt(),Xe(),l1=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=e[0],a=n.dims.length;if(n.dims[a-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let s=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,u=e[1];if(!ae.areEqual(u.dims,[t.n,s,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let d=e[2].dims;if(ae.size(d)!==t.n*s)throw new Error("scales input size error.");if(e.length===4){let p=e[3].dims,f=t.n*(t.bits===8?s:Math.floor((s*t.bits+7)/8));if(ae.size(p)!==f)throw new Error("zeroPoints input size error.")}},u1=(e,t)=>{let n=e[0].dims,a=n.length,s=n[a-2],o=t.k,u=t.n,d=n.slice(0,a-2),p=ae.size(d),f=e[1].dims[2]/4,m=e[0].dataType,_=Ht(t.k),b=Ht(f),E=Ht(u),x=d.concat([s,u]),I=s>1&&u/E%2===0?2:1,N=ae.size(x)/E/I,R=64,$=[],O=[p,s,o/_],k=ae.convertShape(e[1].dims).slice();k.splice(-1,1,f/b),$.push(...Oe(O)),$.push(...Oe(k)),$.push(...Oe(e[2].dims)),e.length===4&&$.push(...Oe(ae.convertShape(e[3].dims)));let P=[p,s,u/E];$.push(...Oe(P));let G=B=>{let K=O.length,Y=ue("a",e[0].dataType,K,_),se=ue("b",12,k.length,b),ve=ue("scales",e[2].dataType,e[2].dims.length),_e=[Y,se,ve],ge=e.length===4?ue("zero_points",12,e[3].dims.length):void 0;ge&&_e.push(ge);let $e=P.length,Ae=Ce("output",e[0].dataType,$e,E),H=mn(e[0].dataType),j=(()=>{switch(_){case 1:return`array<${H}, 8>`;case 2:return`mat4x2<${H}>`;case 4:return`mat2x4<${H}>`;default:throw new Error(`${_}-component is not supported.`)}})(),fe=()=>{let z=`
          // reuse a data
            var input_offset = ${Y.indicesToOffset(`${Y.type.indices}(batch, row, word_offset)`)};
            var a_data: ${j};
            for (var j: u32 = 0; j < ${8/_}; j++) {
              a_data[j] = ${Y.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let q=0;q<E*I;q++)z+=`
            b_value = ${b===1?`b${q}_data`:`b${q}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${j}(${Array.from({length:4},(te,de)=>`${H}(b_value_lower[${de}]), ${H}(b_value_upper[${de}])`).join(", ")});
            b_dequantized_values = ${_===1?`${j}(${Array.from({length:8},(te,de)=>`(b_quantized_values[${de}] - ${ge?`zero_point${q}`:"zero_point"}) * scale${q}`).join(", ")});`:`(b_quantized_values - ${j}(${Array(8).fill(`${ge?`zero_point${q}`:"zero_point"}`).join(",")})) * scale${q};`};
            workgroup_shared[local_id.x * ${I} + ${Math.floor(q/E)}]${E>1?`[${q%E}]`:""} += ${Array.from({length:8/_},(te,de)=>`${_===1?`a_data[${de}] * b_dequantized_values[${de}]`:`dot(a_data[${de}], b_dequantized_values[${de}])`}`).join(" + ")};
          `;return z},Ee=()=>{let z=`
            var col_index = col * ${E};
            ${ge?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${H}(8);`}
            `;for(let q=0;q<E*I;q++)z+=`
            let scale${q} = ${ve.getByOffset("col_index * nBlocksPerCol + block")};
            ${ge?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${ge.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${q} = ${H}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return z},Ie=()=>{let z=`col_index = col * ${E};`;for(let q=0;q<E*I;q++)z+=`
            let b${q}_data = ${se.getByIndices(`${se.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return z+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${j};
            var b_dequantized_values: ${j};`,z};return`
        var<workgroup> workgroup_shared: array<${Ae.type.value}, ${I*R}>;
        ${B.declareVariables(..._e,Ae)}
        ${B.mainStart([R,1,1])}
          let output_indices = ${Ae.offsetToIndices(`(global_idx / ${R}) * ${I}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${R}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/_};
            ${Ee()}
            for (var word: u32 = 0; word < ${f}; word += ${b}) {
              ${Ie()}
              for (var i: u32 = 0; i < ${b}; i++) {
                ${fe()}
                word_offset += ${8/_};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${I}) {
            var output_value: ${Ae.type.value} = ${Ae.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${R}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${I};
            }
            ${Ae.setByIndices(`${Ae.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${_};${b};${E};${I};${R}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:x,dataType:m}],dispatchGroup:{x:N},programUniforms:$}),getShaderSource:G}},c1=(e,t)=>{let n=e[0].dims,a=n.length,s=n[a-2],o=t.k,u=t.n,d=n.slice(0,a-2),p=ae.size(d),f=e[1].dims[2]/4,m=e[0].dataType,_=Ht(t.k),b=Ht(f),E=d.concat([s,u]),x=128,I=u%8===0?8:u%4===0?4:1,N=x/I,R=N*b*8,$=R/_,O=R/t.blockSize,k=ae.size(E)/I,P=[],G=[p,s,o/_],B=ae.convertShape(e[1].dims).slice();B.splice(-1,1,f/b),P.push(...Oe(G)),P.push(...Oe(B)),P.push(...Oe(e[2].dims)),e.length===4&&P.push(...Oe(ae.convertShape(e[3].dims)));let K=[p,s,u];P.push(...Oe(K));let Y=se=>{let ve=G.length,_e=ue("a",e[0].dataType,ve,_),ge=ue("b",12,B.length,b),$e=ue("scales",e[2].dataType,e[2].dims.length),Ae=[_e,ge,$e],H=e.length===4?ue("zero_points",12,e[3].dims.length):void 0;H&&Ae.push(H);let j=K.length,fe=Ce("output",e[0].dataType,j),Ee=mn(e[0].dataType),Ie=()=>{switch(_){case 1:return`
          let a_data0 = vec4<${Ee}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${Ee}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${Ee}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${Ee}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${_}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${_e.type.value}, ${$}>;
        var<workgroup> inter_results: array<array<${fe.type.value}, ${N}>, ${I}>;
        ${se.declareVariables(...Ae,fe)}
        ${se.mainStart([N,I,1])}
          let output_indices = ${fe.offsetToIndices(`workgroup_index * ${I}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${O} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${$};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${$}; a_offset += ${x})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${_e.getByIndices(`${_e.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${_e.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${O} + local_id.x;
            ${H?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${H.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${Ee}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Ee}(8);`}
            let scale = ${$e.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${ge.getByIndices(`${ge.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/_};
            for (var i: u32 = 0; i < ${b}; i++) {
              ${Ie()}
              let b_value = ${b===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${Ee}>(${Array.from({length:4},(z,q)=>`${Ee}(b_value_lower[${q}]), ${Ee}(b_value_upper[${q}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${Ee}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(z,q)=>`${`dot(a_data${q}, b_dequantized_values[${q}])`}`).join(" + ")};
              word_offset += ${8/_};
            }
            workgroupBarrier();
          }

          if (local_idx < ${I}) {
            var output_value: ${fe.type.value} = ${fe.type.value}(0);
            for (var b = 0u; b < ${N}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${fe.setByIndices(`${fe.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${_};${b};${N};${I}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:E,dataType:m}],dispatchGroup:{x:k},programUniforms:P}),getShaderSource:Y}},Xx=(e,t)=>{l1(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(c1(e.inputs,t)):e.compute(u1(e.inputs,t))},Zx=e=>pt(e)}),d1,f1,p1,h1,m1,g1,y1,v1,Qx,YD=be(()=>{Ve(),Je(),Xe(),d1=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},f1=(e,t,n)=>{let a="";for(let s=t-1;s>=0;--s)a+=`
            k = i32(${e.indicesGet("indices",s)}) - ${Ne("uniforms.pads",s,n)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Ne("uniforms.x_shape",s,t)})) {
              break;
            }
            offset += k * i32(${Ne("uniforms.x_strides",s,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${a}
            value = x[offset];
          }
      `},p1=(e,t,n)=>{let a="";for(let s=t-1;s>=0;--s)a+=`
                k = i32(${e.indicesGet("indices",s)}) - ${Ne("uniforms.pads",s,n)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Ne("uniforms.x_shape",s,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Ne("uniforms.x_shape",s,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Ne("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},h1=(e,t,n)=>{let a="";for(let s=t-1;s>=0;--s)a+=`
                k = i32(${e.indicesGet("indices",s)}) - ${Ne("uniforms.pads",s,n)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Ne("uniforms.x_shape",s,t)})) {
                  k = i32(${Ne("uniforms.x_shape",s,t)}) - 1;
                }
                offset += k * i32(${Ne("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},m1=(e,t,n)=>{let a="";for(let s=t-1;s>=0;--s)a+=`
                k = i32(${e.indicesGet("indices",s)}) - ${Ne("uniforms.pads",s,n)};
                if (k < 0)  {
                  k += i32(${Ne("uniforms.x_shape",s,t)}]);
                }
                if (k >= i32(${Ne("uniforms.x_shape",s,t)})) {
                  k -= i32(${Ne("uniforms.x_shape",s,t)});
                }
                offset += k * i32(${Ne("uniforms.x_strides",s,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${a}
              value = x[offset];
          `},g1=(e,t,n)=>{switch(n.mode){case 0:return f1(e,t,n.pads.length);case 1:return p1(e,t,n.pads.length);case 2:return h1(e,t,n.pads.length);case 3:return m1(e,t,n.pads.length);default:throw new Error("Invalid mode")}},y1=(e,t)=>{let n=ae.padShape(e[0].dims.slice(),t.pads),a=e[0].dims,s=ae.size(n),o=[{type:12,data:s},{type:6,data:t.pads}],u=e.length>=3&&e[2].data;t.mode===0&&o.push({type:u?e[2].dataType:1,data:t.value}),o.push(...Oe(e[0].dims,n));let d=["rank"],p=f=>{let m=Ce("output",e[0].dataType,n.length),_=ue("x",e[0].dataType,a.length),b=_.type.value,E=g1(m,a.length,t),x=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&x.push({name:"constant_value",type:u?b:"f32"}),`
            ${f.registerUniforms(x).declareVariables(_,m)}
            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${m.offsetToIndices("global_idx")};

            var value = ${b}(0);
            ${E}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${u}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(ae.size(n)/64)},programUniforms:o}),getShaderSource:p}},v1=(e,t)=>{if(e.length>1){let n=e[1].getBigInt64Array(),a=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,s=e[0].dims.length,o=new Int32Array(2*s).fill(0);if(e.length>=4){let d=e[3].getBigInt64Array();for(let p=0;p<d.length;p++)o[Number(d[p])]=Number(n[p]),o[Number(d[p])+s]=Number(n[p+d.length])}else n.forEach((d,p)=>o[Number(p)]=Number(d));let u=[];return o.forEach(d=>u.push(d)),{mode:t.mode,value:a,pads:u}}else return t},Qx=(e,t)=>{d1(e.inputs);let n=v1(e.inputs,t);e.compute(y1(e.inputs,n),{inputs:[0]})}}),Nl,ih,ah,rh,oh,_1,b1,sh,lh,jx,e2,uh,t2,n2,ch,i2,a2,r2,o2,WD=be(()=>{Ai(),Ve(),Je(),Xe(),Nl=e=>{if(Mt.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},ih=(e,t,n)=>{let a=t.format==="NHWC",s=e.dims.slice();a&&s.splice(1,0,s.pop());let o=Object.hasOwnProperty.call(t,"dilations"),u=t.kernelShape.slice(),d=t.strides.slice(),p=o?t.dilations.slice():[],f=t.pads.slice();qc.adjustPoolAttributes(n,s,u,d,p,f);let m=qc.computePoolOutputShape(n,s,d,p,u,f,t.autoPad),_=Object.assign({},t);o?Object.assign(_,{kernelShape:u,strides:d,pads:f,dilations:p,cacheKey:t.cacheKey}):Object.assign(_,{kernelShape:u,strides:d,pads:f,cacheKey:t.cacheKey});let b=m.slice();return b.push(b.splice(1,1)[0]),[_,a?b:m]},ah=(e,t)=>{let n=t.format==="NHWC",a=ae.size(e),s=ae.size(t.kernelShape),o=[{type:12,data:a},{type:12,data:s}],u=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let d=t.kernelShape[t.kernelShape.length-1],p=t.strides[t.strides.length-1],f=t.pads[t.pads.length/2-1],m=t.pads[t.pads.length-1],_=!!(f+m);o.push({type:12,data:d},{type:12,data:p},{type:12,data:f},{type:12,data:m}),u.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let b=!1;if(t.kernelShape.length===2){let E=t.kernelShape[t.kernelShape.length-2],x=t.strides[t.strides.length-2],I=t.pads[t.pads.length/2-2],N=t.pads[t.pads.length-2];b=!!(I+N),o.push({type:12,data:E},{type:12,data:x},{type:12,data:I},{type:12,data:N}),u.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,u,!0,_,b]}else{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let d=ae.computeStrides(t.kernelShape);o.push({type:12,data:d},{type:12,data:t.pads},{type:12,data:t.strides}),u.push({name:"kernelStrides",type:"u32",length:d.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let p=t.pads.reduce((f,m)=>f+m);return[o,u,!!p,!1,!1]}},rh=(e,t,n,a,s,o,u,d,p,f,m,_)=>{let b=s.format==="NHWC",E=t.type.value,x=Ce("output",t.type.tensor,a);if(s.kernelShape.length<=2){let I="",N="",R="",$=n-(b?2:1);if(m?I=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${$}] < 0 || xIndices[${$}]
                      >= uniforms.x_shape[${$}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`:I=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`,s.kernelShape.length===2){let O=n-(b?3:2);_?N=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${O}] = indices[${O}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${O}] < 0 || xIndices[${O}] >= uniforms.x_shape[${O}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:N=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${O}] = indices[${O}] * uniforms.sh - uniforms.phStart + j;
                `,R=`
              }
            `}return`
            ${e.registerUniforms(p).declareVariables(t,x)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${x.offsetToIndices("global_idx")};
              var xIndices = ${x.offsetToIndices("global_idx")};

              var value = ${E}(${d});
              var pad = 0;
              ${N}
              ${I}
              ${R}
              ${u}

              output[global_idx] = value;
            }`}else{if(b)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let I=s.kernelShape.length,N=s.pads.length,R="";return f?R=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${o}
              }`:R=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${e.registerUniforms(p).declareVariables(t,x)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${x.offsetToIndices("global_idx")};
              var xIndices = ${x.offsetToIndices("global_idx")};

              var offsets: array<u32, ${I}>;

              var value = ${E}(${d});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${I-1}u; j++) {
                  offsets[j] = offset / ${Ne("uniforms.kernelStrides","j",I)};
                  offset -= offsets[j] * ${Ne("uniforms.kernelStrides","j",I)};
                }
                offsets[${I-1}] = offset;

                isPad = false;
                for (var j = ${n-I}u; j < ${n}u; j++) {
                  xIndices[j] = indices[j] * ${Ne("uniforms.strides",`j - ${n-I}u`,I)}
                    + offsets[j - ${n-I}u] - ${Ne("uniforms.pads","j - 2u",N)};
                  ${R}
              }
              ${u}

              output[global_idx] = value;
            }`}},oh=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,_1=e=>`${oh(e)};${e.countIncludePad}`,b1=e=>`${oh(e)};${e.storageOrder};${e.dilations}`,sh=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),lh=(e,t,n,a)=>{let[s,o]=ih(t,a,n),u=ue("x",t.dataType,t.dims.length),d=u.type.value,p="value += x_val;",f="";s.countIncludePad?f+=`value /= ${d}(uniforms.kernelSize);`:f+=`value /= ${d}(i32(uniforms.kernelSize) - pad);`;let[m,_,b,E,x]=ah(o,s);m.push(...Oe(t.dims,o));let I=["rank"];return{name:e,shaderCache:{hint:`${a.cacheKey};${b};${E};${x}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(ae.size(o)/64)},programUniforms:m}),getShaderSource:N=>rh(N,u,t.dims.length,o.length,s,p,f,0,_,b,E,x)}},jx=e=>{let t=e.count_include_pad!==0,n=sh(e);if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let a={countIncludePad:t,...n,cacheKey:""};return{...a,cacheKey:_1(a)}},e2=(e,t)=>{Nl(e.inputs),e.compute(lh("AveragePool",e.inputs[0],!1,t))},uh={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},t2=e=>{let t=e.format;return{format:t,...uh,cacheKey:t}},n2=(e,t)=>{Nl(e.inputs),e.compute(lh("GlobalAveragePool",e.inputs[0],!0,t))},ch=(e,t,n,a)=>{let[s,o]=ih(t,a,n),u=`
      value = max(x_val, value);
    `,d="",p=ue("x",t.dataType,t.dims.length),f=["rank"],[m,_,b,E,x]=ah(o,s);return m.push(...Oe(t.dims,o)),{name:e,shaderCache:{hint:`${a.cacheKey};${b};${E};${x}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(ae.size(o)/64)},programUniforms:m}),getShaderSource:I=>rh(I,p,t.dims.length,o.length,s,u,d,t.dataType===10?-65504:-1e5,_,b,E,x)}},i2=(e,t)=>{Nl(e.inputs),e.compute(ch("MaxPool",e.inputs[0],!1,t))},a2=e=>{let t=e.storage_order,n=e.dilations,a=sh(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(a.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let s={storageOrder:t,dilations:n,...a,cacheKey:""};return{...s,cacheKey:b1(s)}},r2=e=>{let t=e.format;return{format:t,...uh,cacheKey:t}},o2=(e,t)=>{Nl(e.inputs),e.compute(ch("GlobalMaxPool",e.inputs[0],!0,t))}}),T1,w1,s2,l2,KD=be(()=>{Ve(),Je(),Jt(),Xe(),T1=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((n,a)=>n===e[2].dims[a]).reduce((n,a)=>n&&a,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((s,o)=>o===t.axis||s===e[0].dims[o]).reduce((s,o)=>s&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=e[0].dims[t.axis],a=e[1].dims[t.axis];if(t.blockSize<Math.ceil(n/a)||t.blockSize>Math.ceil(n/(a-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},w1=(e,t)=>{let n=ae.normalizeAxis(t.axis,e[0].dims.length),a=e[0].dataType,s=a===3,o=e[0].dims,u=e[1].dataType,d=ae.size(o),p=a===3||a===2,f=p?[Math.ceil(ae.size(e[0].dims)/4)]:e[0].dims,m=e[1].dims,_=e.length>2?e[2]:void 0,b=_?p?[Math.ceil(ae.size(_.dims)/4)]:_.dims:void 0,E=m.length===0||m.length===1&&m[0]===1,x=E===!1&&m.length===1,I=Ht(d),N=E&&(!p||I===4),R=N?I:1,$=N&&!p?I:1,O=ue("input",p?12:a,f.length,$),k=ue("scale",u,m.length),P=_?ue("zero_point",p?12:a,b.length):void 0,G=Ce("output",u,o.length,R),B=[O,k];P&&B.push(P);let K=[f,m];_&&K.push(b);let Y=[{type:12,data:d/R},{type:12,data:n},{type:12,data:t.blockSize},...Oe(...K,o)],se=ve=>{let _e=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${ve.registerUniforms(_e).declareVariables(...B,G)}
      ${ve.mainStart()}
          ${ve.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${G.offsetToIndices("global_idx")};

          // Set input x
          ${p?`
            let input = ${O.getByOffset("global_idx / 4")};
            let x_vec = ${s?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${R===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${O.getByOffset("global_idx")};`};

          // Set scale input
          ${E?`let scale_value= ${k.getByOffset("0")}`:x?`
            let scale_index = ${G.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${k.getByOffset("scale_index")};`:`
            var scale_indices: ${k.type.indices} = output_indices;
            let index = ${k.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${k.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${k.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${P?E?p?`
                let zero_point_input = ${P.getByOffset("0")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${P.getByOffset("0")}`:x?p?`
                let zero_point_index = ${G.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${P.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${G.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${P.getByOffset("zero_point_index")};`:p?`
                let zero_point_offset = ${k.indicesToOffset("scale_indices")};
                let zero_point_input = ${P.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${s?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${P.getByIndices("scale_indices")};`:`let zero_point_value = ${p?s?"i32":"u32":O.type.value}(0);`};
      // Compute and write output
      ${G.setByOffset("global_idx",`${G.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:P?["rank","rank","rank"]:["rank","rank"]},getShaderSource:se,getRunData:()=>({outputs:[{dims:o,dataType:u}],dispatchGroup:{x:Math.ceil(d/R/64),y:1,z:1},programUniforms:Y})}},s2=(e,t)=>{T1(e.inputs,t),e.compute(w1(e.inputs,t))},l2=e=>pt({axis:e.axis,blockSize:e.blockSize})}),E1,S1,u2,JD=be(()=>{Ai(),Ve(),Xe(),E1=(e,t,n)=>{let a=e===t,s=e<t&&n<0,o=e>t&&n>0;if(a||s||o)throw new Error("Range these inputs' contents are invalid.")},S1=(e,t,n,a)=>{let s=Math.abs(Math.ceil((t-e)/n)),o=[s],u=s,d=[{type:12,data:u},{type:a,data:e},{type:a,data:n},...Oe(o)],p=f=>{let m=Ce("output",a,o.length),_=m.type.value,b=[{name:"outputSize",type:"u32"},{name:"start",type:_},{name:"delta",type:_}];return`
        ${f.registerUniforms(b).declareVariables(m)}
        ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${_}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${a}`},getShaderSource:p,getRunData:()=>({outputs:[{dims:o,dataType:a}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:d})}},u2=e=>{let t=0,n=0,a=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],n=e.inputs[1].getInt32Array()[0],a=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],n=e.inputs[1].getFloat32Array()[0],a=e.inputs[2].getFloat32Array()[0]),Mt.webgpu.validateInputContent&&E1(t,n,a),e.compute(S1(t,n,a,e.inputs[0].dataType),{inputs:[]})}}),x1,C1,c2,d2,XD=be(()=>{Ve(),Je(),Jt(),Xe(),x1=(e,t,n,a)=>{if(e!=="none"&&a!=="i32"&&a!=="u32"&&a!=="f32")throw new Error(`Input ${a} is not supported with reduction ${e}.`);let s=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${n};`;case"add":return a==="i32"||a==="u32"?`atomicAdd(&${t}, bitcast<${a}>(${n}));`:`
              ${s}bitcast<${a}>(oldValue) + (${n})${o}`;case"max":return a==="i32"||a==="u32"?`atomicMax(&${t}, bitcast<${a}>(${n}));`:`
                ${s}max(bitcast<f32>(oldValue), (${n}))${o}`;case"min":return a==="i32"||a==="u32"?`atomicMin(&${t}, bitcast<${a}>(${n}));`:`${s}min(bitcast<${a}>(oldValue), (${n}))${o}`;case"mul":return`${s}(bitcast<${a}>(oldValue) * (${n}))${o}`;default:throw new Error(`Reduction ${e} is not supported.`)}},C1=(e,t)=>{let n=e[0].dims,a=e[1].dims,s=n,o=1,u=Math.ceil(ae.sizeToDimension(a,a.length-1)/o),d=a[a.length-1],p=ae.sizeFromDimension(n,d),f=[{type:12,data:u},{type:12,data:d},{type:12,data:p},...Oe(e[1].dims,e[2].dims,s)],m=_=>{let b=ue("indices",e[1].dataType,e[1].dims.length),E=ue("updates",e[2].dataType,e[2].dims.length,o),x=t.reduction!=="none"&&t.reduction!==""?PE("output",e[0].dataType,s.length):Ce("output",e[0].dataType,s.length,o);return`
      ${_.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(b,E,x)}
      ${_.mainStart()}
        ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${e[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${x1(t.reduction,"output[data_offset + i]","value",x.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:f}),getShaderSource:m}},c2=e=>pt({reduction:e.reduction}),d2=(e,t)=>{e.compute(C1(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),A1,I1,R1,dh,N1,$1,M1,O1,D1,k1,z1,L1,fh,U1,P1,B1,G1,V1,f2,p2,ZD=be(()=>{Ve(),Je(),Jt(),Xe(),A1=(e,t)=>{if(e.every(n=>n>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},I1=(e,t,n)=>{t.every(s=>s>=0&&s<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let a=new Array(n).fill(1);return t.forEach((s,o)=>a[s]=e[o]),a},R1=(e,t,n,a,s,o)=>{let[u,d,p]=n>10?[1,2,3]:[-1,e.length>1?1:-1,-1],f=e[0].dims.length;if(u>0&&e.length>u&&e[u].dims.length>0)e[u].getFloat32Array().forEach(m=>o.push(m));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(d>0&&e.length>d&&e[d].dims.length===1&&e[d].dims[0]>0){if(e[d].getFloat32Array().forEach(m=>a.push(m)),a.length!==0&&a.length!==f&&n>=18&&a.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");A1(a,t),t.axes.length>0&&I1(a,t.axes,f).forEach((m,_)=>a[_]=m)}if(p>0&&e.length>p&&e[p].dims.length===1&&e[p].dims[0]>0&&(e[p].getBigInt64Array().forEach(m=>s.push(Number(m))),s.length!==0&&s.length!==f&&n>=18&&s.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(a.length!==0&&a.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(s.length!==0&&s.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof a<"u"&&typeof s<"u"&&a.length>0&&s.length>f)throw new Error("Resize requires only of scales or sizes to be specified")},dh=(e,t,n,a)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${a}(big / (${n}));
  let fract = ${a}(big % (${n})) / ${a}(${n});
  return whole + fract;
`,N1=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${dh("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${dh("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",$1=(e,t,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",M1=(e,t,n)=>{let a=new Array(n).fill(0).concat(new Array(n).fill(1)),s=e.length===0?a:e.slice();return t.length>0?(t.forEach((o,u)=>{a[o]=s[u],a[u+n]=s[t.length+u]}),a):s},O1=(e,t,n,a)=>{let s=[];if(n.length>0)if(a.length>0){if(e.forEach(o=>s.push(o)),Math.max(...a)>e.length)throw new Error("axes is out of bound");a.forEach((o,u)=>s[o]=n[u])}else n.forEach(o=>s.push(o));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");s=e.map((o,u)=>Math.round(o*t[u]))}return s},D1=(e,t,n)=>{let a=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(o=>t[o]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(o=>t[o]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let s=e.slice();return n.axes.length>0?(n.axes.forEach(o=>t[o]=a),n.axes.forEach(o=>s[o]=Math.round(e[o]*t[o]))):(t.fill(a,0,t.length),s.forEach((o,u)=>s[u]=Math.round(o*t[u]))),s},k1=(e,t,n,a,s)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${n.length}> {
      var original_indices: array<${e.type.value}, ${n.length}>;
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${Ne("uniforms.scales","i",a)};
        var roi_low = ${Ne("uniforms.roi","i",s)};
        var roi_hi = ${Ne("uniforms.roi",`i + ${t.length}`,s)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${Ne("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${Ne("uniforms.output_shape","i",n.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,z1=(e,t,n,a,s,o,u)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${a.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Ne("uniforms.scales","i",s)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Ne("uniforms.roi","i",o)};
          var roi_hi = ${Ne("uniforms.roi",`i + ${n.length}`,o)};
          var input_shape_i = ${Ne("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${Ne("uniforms.output_shape","i",a.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${u} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,L1=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Ne("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,fh=(e,t,n,a)=>e.rank>a?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",n,"batch")};
`:"",U1=(e,t,n,a,s)=>{let[o,u,d,p]=n.length===2?[-1,0,1,-1]:[0,2,3,1],f=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${f} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",u,`max(0, min(row, ${n[u]} - 1))`)};
      ${e.indicesSet("input_indices",d,`max(0, min(col, ${n[d]} - 1))`)};
      ${fh(e,p,o,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${f} = originalIndices[${u}];
      var col:${f} = originalIndices[${d}];
      ${a?`if (row < 0 || row > (${n[u]} - 1) || col < 0 || col > (${n[d]} - 1)) {
        return ${s};
      }`:""};
      row = max(0, min(row, ${n[u]} - 1));
      col = max(0, min(col, ${n[d]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${n.length>2?`u32(originalIndices[${p}])`:"0"};
      var batch: u32 =  ${n.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${f} = getInputValue(batch, channel, row1, col1);
      var x12: ${f} = getInputValue(batch, channel, row1, col2);
      var x21: ${f} = getInputValue(batch, channel, row2, col1);
      var x22: ${f} = getInputValue(batch, channel, row2, col2);
      var dx1: ${f} = abs(row - ${f}(row1));
      var dx2: ${f} = abs(${f}(row2) - row);
      var dy1: ${f} = abs(col - ${f}(col1));
      var dy2: ${f} = abs(${f}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},P1=(e,t,n,a,s,o,u,d,p,f)=>{let m=n.length===2,[_,b]=m?[0,1]:[2,3],E=e.type.value,x=I=>{let N=I===_?"row":"col";return`
      fn ${N}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${E} {
        var output_index = ${t.indicesGet("output_indices",I)};
        var originalIdx: ${E} = getOriginalCoordinateFromResizedCoordinate(output_index, ${s[I]},
        ${a[I]}, ${n[I]}, ${o[I]}, ${o[I]} + ${n.length});
        var fractOriginalIdx: ${E} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${d} && (originalIdx < 0 || originalIdx > (${n[I]} - 1))) {
          return ${p};
        }
        var data: array<${E}, 4> = array<${E}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${N}: ${E} = originalIdx + ${E}(i);
          if (${N} < 0 || ${N} >= ${n[I]}) {
            ${f?`coefs[i + 1] = 0.0;
                        continue;`:d?`return ${p};`:`${N} = max(0, min(${N}, ${n[I]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",I,`u32(${N})`)};
          data[i + 1] = ${I===_?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${x(_)};
    ${x(b)};
  fn getCubicInterpolationCoefs(s: ${E}) -> array<${E}, 4> {
    var absS = abs(s);
    var coeffs: array<${E}, 4> = array<${E}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${E} = 1.0 - absS;
    var twoMinusAbsS: ${E} = 2.0 - absS;
    var onePlusAbsS: ${E} = 1.0 + absS;
    coeffs[0] = ((${u} * onePlusAbsS - 5 * ${u}) * onePlusAbsS + 8 * ${u}) * onePlusAbsS - 4 * ${u};
    coeffs[1] = ((${u} + 2) * absS - (${u} + 3)) * absS * absS + 1;
    coeffs[2] = ((${u} + 2) * oneMinusAbsS - (${u} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${u} * twoMinusAbsS - 5 * ${u}) * twoMinusAbsS + 8 * ${u}) * twoMinusAbsS - 4 * ${u};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${E}, 4>, coefs: array<${E}, 4>) -> ${E} {
    var coefsSum: ${E} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${E} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},B1=(e,t,n,a,s)=>{let[o,u,d,p,f]=n.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],m=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${m} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",u,`max(0, min(depth, ${n[u]} - 1))`)};
      ${e.indicesSet("input_indices",d,`max(0, min(height, ${n[d]} - 1))`)};
      ${e.indicesSet("input_indices",p,`max(0, min(width, ${n[p]} - 1))`)};
      ${fh(e,f,o,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${m} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${m} = originalIndices[${u}];
      var height:${m} = originalIndices[${d}];
      var width:${m} = originalIndices[${p}];
      ${a?`if (depth < 0 || depth > (${n[u]} - 1) || height < 0 || height > (${n[d]} - 1) || width < 0 || (width > ${n[p]} - 1)) {
      return ${s};
        }`:""};

    depth = max(0, min(depth, ${n[u]} - 1));
      height = max(0, min(height, ${n[d]} - 1));
      width = max(0, min(width, ${n[p]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${n.length>3?`u32(originalIndices[${f}])`:"0"};
      var batch: u32 =  ${n.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${m} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${m} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${m} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${m} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${m} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${m} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${m} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${m} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${m} = abs(depth - ${m}(depth1));
      var dx2: ${m} = abs(${m}(depth2) - depth);
      var dy1: ${m} = abs(height - ${m}(height1));
      var dy2: ${m} = abs(${m}(height2) - height);
      var dz1: ${m} = abs(width - ${m}(width1));
      var dz2: ${m} = abs(${m}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},G1=(e,t,n,a,s,o)=>{let u=e.dims,d=M1(o,t.axes,u.length),p=O1(u,a,s,t.axes),f=a.slice();a.length===0&&(f=u.map(($,O)=>$===0?1:p[O]/$),t.keepAspectRatioPolicy!=="stretch"&&(p=D1(u,f,t)));let m=Ce("output",e.dataType,p.length),_=ue("input",e.dataType,u.length),b=ae.size(p),E=u.length===p.length&&u.every(($,O)=>$===p[O]),x=t.coordinateTransformMode==="tf_crop_and_resize",I=t.extrapolationValue,N=_.type.value,R=$=>`
      ${E?"":`
      ${N1(t.coordinateTransformMode,N)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${L1(_,u)};
              ${$1(t.nearestMode,n,N)};
              ${z1(_,m,u,p,f.length,d.length,x)};
              `;case"linear":return`
              ${k1(m,u,p,f.length,d.length)};
              ${(()=>{if(u.length===2||u.length===4)return`${U1(_,m,u,x,I)}`;if(u.length===3||u.length===5)return`${B1(_,m,u,x,I)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(u.length===2||u.length===4)return`${P1(_,m,u,p,f,d,t.cubicCoeffA,x,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${$.registerUniform("output_size","u32").registerUniform("scales","f32",f.length).registerUniform("roi","f32",d.length).declareVariables(_,m)}
      ${$.mainStart()}
        ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${E?"output[global_idx] = input[global_idx];":`
        let output_indices = ${m.offsetToIndices("global_idx")};
        var input_indices: ${_.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${_.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${u.length===2||u.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${n}|${f.length>0?t.mode==="cubic"?f:f.length:""}|${s.length>0?s:""}|${d.length>0?d:""}|${E}|${t.mode==="nearest"?u.length:u}`,inputDependencies:["rank"]},getShaderSource:R,getRunData:()=>({outputs:[{dims:p,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:[{type:12,data:b},{type:1,data:f},{type:1,data:d},...Oe(u,p)]})}},V1=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},f2=(e,t)=>{let n=[],a=[],s=[],o=V1(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");R1(e.inputs,t,o,n,a,s),e.compute(G1(e.inputs[0],t,o,n,a,s),{inputs:[0]})},p2=e=>{let t=e.antialias,n=e.axes,a=e.coordinateTransformMode,s=e.cubicCoeffA,o=e.excludeOutside!==0,u=e.extrapolationValue,d=e.keepAspectRatioPolicy,p=e.mode,f=e.nearestMode===""?"simple":e.nearestMode;return pt({antialias:t,axes:n,coordinateTransformMode:a,cubicCoeffA:s,excludeOutside:o,extrapolationValue:u,keepAspectRatioPolicy:d,mode:p,nearestMode:f})}}),q1,H1,h2,QD=be(()=>{Ve(),Je(),Xe(),q1=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],n=e[1],a=e[2];if(t.dataType!==n.dataType||t.dataType!==a.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Skip must be 2D or 3D");let s=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(n.dims[n.dims.length-1]!==s)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(a.dims.length!==1)throw new Error("Gamma must be 1D");if(a.dims[a.dims.length-1]!==s)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let u=e[3];if(u.dims.length!==1)throw new Error("Beta must be 1D");if(u.dims[u.dims.length-1]!==s)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let u=e[4];if(u.dims.length!==1)throw new Error("Bias must be 1D");if(u.dims[u.dims.length-1]!==s)throw new Error("Bias must have the same hidden size as input")}},H1=(e,t,n,a)=>{let s=t.simplified,o=e[0].dims,u=ae.size(o),d=o,p=u,f=o.slice(-1)[0],m=a?o.slice(0,-1).concat(1):[],_=!s&&e.length>3,b=e.length>4,E=a&&n>1,x=a&&n>2,I=n>3,N=64,R=Ht(f),$=[{type:12,data:p},{type:12,data:R},{type:12,data:f},{type:1,data:t.epsilon}],O=P=>{let G=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],B=[ue("x",e[0].dataType,e[0].dims,R),ue("skip",e[1].dataType,e[1].dims,R),ue("gamma",e[2].dataType,e[2].dims,R)];_&&B.push(ue("beta",e[3].dataType,e[3].dims,R)),b&&B.push(ue("bias",e[4].dataType,e[4].dims,R)),B.push(Ce("output",e[0].dataType,d,R)),E&&B.push(Ce("mean_output",1,m)),x&&B.push(Ce("inv_std_output",1,m)),I&&B.push(Ce("input_skip_bias_sum",e[0].dataType,d,R));let K=mn(e[0].dataType),Y=mn(1,R);return`

      ${P.registerUniforms(G).declareVariables(...B)}
      var<workgroup> sum_shared : array<${Y}, ${N}>;
      var<workgroup> sum_squared_shared : array<${Y}, ${N}>;

      ${P.mainStart([N,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${N};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${N};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${N-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${b?"bias[offset1d + i]":K+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${I?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${is(K,R,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${N};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Tr("sum",R)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Tr("square_sum",R)} / f32(uniforms.hidden_size) ${s?"":"- mean * mean"} + uniforms.epsilon);
        ${E?"mean_output[global_idx] = mean;":""}
        ${x?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${s?"":`- ${K}(mean)`}) *
            ${K}(inv_std_dev) * gamma[offset1d + i]
            ${_?"+ beta[offset1d + i]":""};
        }
      }`},k=[{dims:d,dataType:e[0].dataType}];return n>1&&k.push({dims:m,dataType:1}),n>2&&k.push({dims:m,dataType:1}),n>3&&k.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${R};${E};${x};${I}`,inputDependencies:e.map((P,G)=>"type")},getShaderSource:O,getRunData:()=>({outputs:k,dispatchGroup:{x:Math.ceil(p/f)},programUniforms:$})}},h2=(e,t)=>{q1(e.inputs);let n=[0];e.outputCount>1&&n.push(-3),e.outputCount>2&&n.push(-3),e.outputCount>3&&n.push(3),e.compute(H1(e.inputs,t,e.outputCount,!1),{outputs:n})}}),F1,$l,Y1,ph,W1,K1,m2,g2,jD=be(()=>{Ve(),Je(),Jt(),Xe(),F1=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((n,a)=>{if(e[a+1].dataType!==6&&e[a+1].dataType!==7)throw new Error(`Input ${a} must be an array of int32 or int64`)})},$l=(e,t)=>{let n=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(a=>n.push(Number(a)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(a=>n.push(Number(a)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return n},Y1=(e,t)=>{if(e.length>1){let n=$l(e,1),a=$l(e,2),s=$l(e,3);return s.length===0&&(s=[...Array(e[0].dims.length).keys()]),pt({starts:n,ends:a,axes:s})}else return t},ph=(e,t,n,a,s)=>{let o=e;return e<0&&(o+=n[a[t]]),s[t]<0?Math.max(0,Math.min(o,n[a[t]]-1)):Math.max(0,Math.min(o,n[a[t]]))},W1=(e,t,n)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${n.length-1}; i >= 0; i--) {
            let input_shape_i = ${Ne("uniforms.input_shape","i",n.length)};
            let steps_i = ${Ne("uniforms.steps","i",n.length)};
            let signs_i = ${Ne("uniforms.signs","i",n.length)};
            let starts_i = ${Ne("uniforms.starts","i",n.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,K1=(e,t)=>{let n=e[0].dims,a=ae.size(n),s=t.axes.length>0?ae.normalizeAxes(t.axes,n.length):[...Array(n.length).keys()],o=$l(e,4);o.forEach(R=>R!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(s.length).fill(1));let u=t.starts.map((R,$)=>ph(R,$,n,s,o)),d=t.ends.map((R,$)=>ph(R,$,n,s,o));if(s.length!==u.length||s.length!==d.length)throw new Error("start, ends and axes should have the same number of elements");if(s.length!==n.length)for(let R=0;R<n.length;++R)s.includes(R)||(u.splice(R,0,0),d.splice(R,0,n[R]),o.splice(R,0,1));let p=o.map(R=>Math.sign(R));o.forEach((R,$,O)=>{if(R<0){let k=(d[$]-u[$])/R,P=u[$],G=P+k*o[$];u[$]=G,d[$]=P,O[$]=-R}});let f=n.slice(0);s.forEach((R,$)=>{f[R]=Math.ceil((d[R]-u[R])/o[R])});let m={dims:f,dataType:e[0].dataType},_=Ce("output",e[0].dataType,f.length),b=ue("input",e[0].dataType,e[0].dims.length),E=ae.size(f),x=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:u.length},{name:"signs",type:"i32",length:p.length},{name:"steps",type:"u32",length:o.length}],I=[{type:12,data:E},{type:12,data:u},{type:6,data:p},{type:12,data:o},...Oe(e[0].dims,f)],N=R=>`
      ${R.registerUniforms(x).declareVariables(b,_)}
        ${W1(b,_,n)}
        ${R.mainStart()}
          ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${_.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${_.setByOffset("global_idx",b.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${p.length}_${u.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:N,getRunData:()=>({outputs:[m],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:I})}},m2=(e,t)=>{F1(e.inputs,t);let n=Y1(e.inputs,t);e.compute(K1(e.inputs,n),{inputs:[0]})},g2=e=>{let t=e.starts,n=e.ends,a=e.axes;return pt({starts:t,ends:n,axes:a})}}),J1,X1,y2,v2,ek=be(()=>{Ve(),Je(),Jt(),Er(),Xe(),J1=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},X1=(e,t)=>{let n=e.inputs[0],a=n.dims,s=ae.size(a),o=a.length,u=ae.normalizeAxis(t.axis,o),d=u<a.length-1,p,f=[];d?(f=Array.from({length:o},(B,K)=>K),f[u]=o-1,f[o-1]=u,p=e.compute(fi(n,f),{inputs:[n],outputs:[-1]})[0]):p=n;let m=p.dims,_=m[o-1],b=s/_,E=Ht(_),x=_/E,I=64;b===1&&(I=256);let N=(B,K)=>K===4?`max(max(${B}.x, ${B}.y), max(${B}.z, ${B}.w))`:K===2?`max(${B}.x, ${B}.y)`:K===3?`max(max(${B}.x, ${B}.y), ${B}.z)`:B,R=ue("x",p.dataType,p.dims,E),$=Ce("result",p.dataType,p.dims,E),O=R.type.value,k=mn(p.dataType)==="f32"?`var threadMax = ${O}(-3.402823e+38f);`:`var threadMax = ${O}(-65504.0h);`,P=B=>`
      var<workgroup> rowMaxShared : ${O};
      var<workgroup> rowSumShared : ${O};
      var<workgroup> threadShared : array<${O}, ${I}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${O} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${O}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${B.registerUniform("packedCols","i32").declareVariables(R,$)}
      ${B.mainStart(I)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${I};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${k}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${O}(${N("threadShared[0]",E)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${O}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${O}(${Tr("threadShared[0]",E)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${O}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,G=e.compute({name:"Softmax",shaderCache:{hint:`${E};${I}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:m,dataType:p.dataType}],dispatchGroup:{x:b},programUniforms:[{type:6,data:x}]}),getShaderSource:P},{inputs:[p],outputs:[d?-1:0]})[0];d&&e.compute(fi(G,f),{inputs:[G]})},y2=(e,t)=>{J1(e.inputs),X1(e,t)},v2=e=>pt({axis:e.axis})}),hh,Z1,Q1,j1,_2,tk=be(()=>{Ve(),Je(),Xe(),hh=e=>Array.from(e.getBigInt64Array(),Number),Z1=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(hh(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},Q1=(e,t)=>{let n=[];for(let a=0;a<e.length;++a)n.push(e[a]*t[a]);return n},j1=(e,t)=>{let n=e[0].dims,a=t??hh(e[1]),s=Q1(n,a),o=ae.size(s),u=e[0].dataType,d=ue("input",u,n.length),p=Ce("output",u,s.length),f=m=>`
      const inputShape = ${d.indices(...n)};
      ${m.registerUniform("output_size","u32").declareVariables(d,p)}
      ${m.mainStart()}
      ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${p.offsetToIndices("global_idx")};
      var input_indices: ${d.type.indices};
      for (var i = 0; i < ${n.length}; i++) {
        let input_dim_i = ${d.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${p.indicesGet("output_indices","i")}  % input_dim_i;

        ${d.indicesSet("input_indices","i","input_dim_value")}
      }
      ${p.setByOffset("global_idx",d.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${a}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...Oe(e[0].dims,s)]}),getShaderSource:f}},_2=e=>{Z1(e.inputs),e.compute(j1(e.inputs),{inputs:[0]})}}),ew,tw,b2,nk=be(()=>{Ve(),Je(),Xe(),ew=(e,t,n,a,s)=>{let o=Ce("output_data",s,n.length,4),u=ue("a_data",t[1].dataType,t[1].dims.length,4),d=ue("b_data",t[2].dataType,t[2].dims.length,4),p=ue("c_data",t[0].dataType,t[0].dims.length,4),f,m=(_,b,E)=>`select(${b}, ${_}, ${E})`;if(!a)f=o.setByOffset("global_idx",m(u.getByOffset("global_idx"),d.getByOffset("global_idx"),p.getByOffset("global_idx")));else{let _=(b,E,x="")=>{let I=`a_data[index_a${E}][component_a${E}]`,N=`b_data[index_b${E}][component_b${E}]`,R=`bool(c_data[index_c${E}] & (0xffu << (component_c${E} * 8)))`;return`
            let output_indices${E} = ${o.offsetToIndices(`global_idx * 4u + ${E}u`)};
            let offset_a${E} = ${u.broadcastedIndicesToOffset(`output_indices${E}`,o)};
            let offset_b${E} = ${d.broadcastedIndicesToOffset(`output_indices${E}`,o)};
            let offset_c${E} = ${p.broadcastedIndicesToOffset(`output_indices${E}`,o)};
            let index_a${E} = offset_a${E} / 4u;
            let index_b${E} = offset_b${E} / 4u;
            let index_c${E} = offset_c${E} / 4u;
            let component_a${E} = offset_a${E} % 4u;
            let component_b${E} = offset_b${E} % 4u;
            let component_c${E} = offset_c${E} % 4u;
            ${b}[${E}] = ${x}(${m(I,N,R)});
          `};s===9?f=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:f=`
            ${_("output_data[global_idx]",0)}
            ${_("output_data[global_idx]",1)}
            ${_("output_data[global_idx]",2)}
            ${_("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(p,u,d,o)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${f}
      }`},tw=e=>{let t=e[1].dims,n=e[2].dims,a=e[0].dims,s=e[1].dataType,o=!(ae.areEqual(t,n)&&ae.areEqual(n,a)),u=t,d=ae.size(t);if(o){let f=ss.calcShape(ss.calcShape(t,n,!1),a,!1);if(!f)throw new Error("Can't perform where op on the given tensors");u=f,d=ae.size(u)}let p=Math.ceil(d/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:f=>ew(f,e,u,o,s),getRunData:()=>({outputs:[{dims:u,dataType:s}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:p},...Oe(a,t,n,u)]})}},b2=e=>{e.compute(tw(e.inputs))}}),T2,ik=be(()=>{yD(),Tm(),vD(),_D(),bD(),TD(),wD(),AD(),RD(),ND(),$D(),MD(),OD(),DD(),kD(),zD(),LD(),UD(),PD(),BD(),GD(),VD(),qD(),HD(),FD(),Bx(),YD(),WD(),KD(),JD(),XD(),bm(),ZD(),Fx(),QD(),jD(),ek(),qx(),tk(),Er(),wm(),nk(),T2=new Map([["Abs",[hS]],["Acos",[mS]],["Acosh",[gS]],["Add",[XS]],["ArgMax",[cS,Bh]],["ArgMin",[uS,Bh]],["Asin",[yS]],["Asinh",[vS]],["Atan",[_S]],["Atanh",[bS]],["Attention",[dS]],["AveragePool",[e2,jx]],["BatchNormalization",[fS]],["BiasAdd",[pS]],["BiasSplitGelu",[JS]],["Cast",[wS,TS]],["Ceil",[SS]],["Clip",[ES]],["Concat",[ox,sx]],["Conv",[Yh,Fh]],["ConvTranspose",[yx,gx]],["Cos",[xS]],["Cosh",[CS]],["CumSum",[vx,_x]],["DepthToSpace",[bx,Tx]],["DequantizeLinear",[s2,l2]],["Div",[ZS]],["Einsum",[wx,Ex]],["Elu",[AS,Ll]],["Equal",[QS]],["Erf",[IS]],["Exp",[RS]],["Expand",[Sx]],["FastGelu",[xx]],["Floor",[NS]],["FusedConv",[Yh,Fh]],["Gather",[Ax,Cx]],["GatherElements",[Ox,Mx]],["GatherBlockQuantized",[Nx,$x]],["GatherND",[Ix,Rx]],["Gelu",[$S]],["Gemm",[kx,Dx]],["GlobalAveragePool",[n2,t2]],["GlobalMaxPool",[o2,r2]],["Greater",[nx]],["GreaterOrEqual",[ax]],["GridSample",[zx,Lx]],["GroupQueryAttention",[Yx]],["HardSigmoid",[PS,US]],["InstanceNormalization",[Wx]],["LayerNormalization",[Kx]],["LeakyRelu",[MS,Ll]],["Less",[ix]],["LessOrEqual",[rx]],["Log",[WS]],["MatMul",[Jx]],["MatMulNBits",[Xx,Zx]],["MaxPool",[i2,a2]],["Mul",[jS]],["MultiHeadAttention",[Px,Ux]],["Neg",[DS]],["Not",[OS]],["Pad",[Qx]],["Pow",[ex]],["QuickGelu",[KS,Ll]],["Range",[u2]],["Reciprocal",[kS]],["ReduceMin",[aS]],["ReduceMean",[jE]],["ReduceMax",[iS]],["ReduceSum",[oS]],["ReduceProd",[rS]],["ReduceL1",[eS]],["ReduceL2",[tS]],["ReduceLogSum",[lS]],["ReduceLogSumExp",[nS]],["ReduceSumSquare",[sS]],["Relu",[zS]],["Resize",[f2,p2]],["RotaryEmbedding",[Hx]],["ScatterND",[d2,c2]],["Sigmoid",[LS]],["Sin",[BS]],["Sinh",[GS]],["Slice",[m2,g2]],["SkipLayerNormalization",[h2]],["Split",[Gx,Vx]],["Sqrt",[VS]],["Softmax",[y2,v2]],["Sub",[tx]],["Tan",[qS]],["Tanh",[HS]],["ThresholdedRelu",[YS,Ll]],["Tile",[_2]],["Transpose",[GE,VE]],["Where",[b2]]])}),w2,ak=be(()=>{Ai(),Da(),Xe(),w2=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,n,a,s){sa(e.programInfo.name);let o=this.backend.device,u=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let d=[];for(let f of t)d.push({binding:d.length,resource:{buffer:f.buffer}});for(let f of n)d.push({binding:d.length,resource:{buffer:f.buffer}});s&&d.push({binding:d.length,resource:s});let p=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:d,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let f={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:p,dispatchGroup:a};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(f)}u.setPipeline(e.computePipeline),u.setBindGroup(0,p),u.dispatchWorkgroups(...a),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Ki(e.programInfo.name)}dispose(){}build(e,t){sa(e.name);let n=this.backend.device,a=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(f=>{n.features.has(f.feature)&&a.push(`enable ${f.extension};`)});let s=BE(t,this.backend.device.limits),o=e.getShaderSource(s),u=`${a.join(`
`)}
${s.additionalImplementations}
${o}`,d=n.createShaderModule({code:u,label:e.name});lt("verbose",()=>`[WebGPU] ${e.name} shader code: ${u}`);let p=n.createComputePipeline({compute:{module:d,entryPoint:"main"},layout:"auto",label:e.name});return Ki(e.name),{programInfo:e,computePipeline:p,uniformVariablesInfo:s.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,n=typeof e=="number"?1:e.y||1,a=typeof e=="number"?1:e.z||1,s=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=s&&n<=s&&a<=s)return[t,n,a];let o=t*n*a,u=Math.ceil(Math.sqrt(o));if(u>s){if(u=Math.ceil(Math.cbrt(o)),u>s)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[u,u,u]}else return[u,u,1]}}}),E2={};fs(E2,{WebGpuBackend:()=>S2});var nw,iw,aw,S2,rk=be(()=>{Ai(),Ve(),Da(),kE(),mD(),ik(),ak(),nw=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let n=[];for(let a=0;a<e.length;++a){let s=e[a].dataType;switch(t[a]){case"none":{n.push("");break}case"type":{n.push(`${s}`);break}case"rank":{let o=e[a].dims.length;n.push(`${s};${o}`);break}case"dims":{let o=e[a].dims.join(",");n.push(`${s};${o}`);break}default:throw new Error(`unsupported input dependency: ${t[a]}`)}}return n.join("|")},iw=(e,t,n)=>{var s,o;let a=e.name;return(s=e.shaderCache)!=null&&s.hint&&(a+="["+e.shaderCache.hint+"]"),a+=":"+n+`:${nw(t,((o=e.shaderCache)==null?void 0:o.inputDependencies)??new Array(t.length).fill("dims"))}`,a},aw=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},S2=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let n=[],a={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},s=o=>t.features.has(o)&&n.push(o)&&!0;s("chromium-experimental-timestamp-query-inside-passes")||s("timestamp-query"),s("shader-f16"),s("subgroups"),this.device=await t.requestDevice(a),this.adapterInfo=new aw(t.info||await t.requestAdapterInfo()),this.gpuDataManager=UE(this),this.programManager=new w2(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,gm(e.logLevel,!!e.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;sa(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{var a;let t=new BigUint64Array(e.getMappedRange()),n=this.pendingQueries.get(e);for(let s=0;s<t.length/2;s++){let o=n[s],u=o.kernelId,d=this.kernels.get(u),p=d.kernelType,f=d.kernelName,m=o.programName,_=o.inputTensorViews,b=o.outputTensorViews,E=t[s*2],x=t[s*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=E);let I=Number(E-this.queryTimeBase),N=Number(x-this.queryTimeBase);if(!Number.isSafeInteger(I)||!Number.isSafeInteger(N))throw new RangeError("incorrect timestamp range");if((a=this.env.webgpu.profiling)!=null&&a.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:_.map(R=>({dims:R.dims,dataType:Na(R.dataType)})),outputsMetadata:b.map(R=>({dims:R.dims,dataType:Na(R.dataType)})),kernelId:u,kernelType:p,kernelName:f,programName:m,startTime:I,endTime:N});else{let R="";_.forEach((O,k)=>{R+=`input[${k}]: [${O.dims}] | ${Na(O.dataType)}, `});let $="";b.forEach((O,k)=>{$+=`output[${k}]: [${O.dims}] | ${Na(O.dataType)}, `}),console.log(`[profiling] kernel "${u}|${p}|${f}|${m}" ${R}${$}start time: ${I} ns, execution time: ${N-I} ns`)}Pc("GPU",`${m}::${E}::${x}`)}e.unmap(),this.pendingQueries.delete(e)}),Ki()}run(e,t,n,a,s,o){sa(e.name);let u=[];for(let $=0;$<t.length;++$){let O=t[$].data;if(O===0)continue;let k=this.gpuDataManager.get(O);if(!k)throw new Error(`no GPU data for input: ${O}`);u.push(k)}let{outputs:d,dispatchGroup:p,programUniforms:f}=e.getRunData(t),m=n.length===0?d.map(($,O)=>O):n;if(m.length!==d.length)throw new Error(`Output size ${m.length} must be equal to ${d.length}.`);let _=[],b=[];for(let $=0;$<d.length;++$){if(!Number.isInteger(m[$])||m[$]<-3||m[$]>=o)throw new Error(`Invalid output index: ${m[$]}`);if(m[$]===-3)continue;let O=m[$]===-1,k=m[$]===-2,P=O||k?s(d[$].dataType,d[$].dims):a(m[$],d[$].dataType,d[$].dims);if(_.push(P),P.data===0)continue;let G=this.gpuDataManager.get(P.data);if(!G)throw new Error(`no GPU data for output: ${P.data}`);if(O&&this.temporaryData.push(G),k){let B=this.kernelPersistentData.get(this.currentKernelId);B||(B=[],this.kernelPersistentData.set(this.currentKernelId,B)),B.push(G)}b.push(G)}if(u.length!==t.length||b.length!==_.length){if(b.length===0)return Ki(e.name),_;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let E;if(f){let $=0,O=[];f.forEach(B=>{let K=typeof B.data=="number"?[B.data]:B.data;if(K.length===0)return;let Y=B.type===10?2:4,se,ve;B.type===10?(ve=K.length>4?16:K.length>2?8:K.length*Y,se=K.length>4?16:Y*K.length):(ve=K.length<=2?K.length*Y:16,se=16),$=Math.ceil($/ve)*ve,O.push($);let _e=B.type===10?8:4;$+=K.length>4?Math.ceil(K.length/_e)*se:K.length*Y});let k=16;$=Math.ceil($/k)*k;let P=new ArrayBuffer($);f.forEach((B,K)=>{let Y=O[K],se=typeof B.data=="number"?[B.data]:B.data;if(B.type===6)new Int32Array(P,Y,se.length).set(se);else if(B.type===12)new Uint32Array(P,Y,se.length).set(se);else if(B.type===10)new Uint16Array(P,Y,se.length).set(se);else if(B.type===1)new Float32Array(P,Y,se.length).set(se);else throw new Error(`Unsupported uniform type: ${Na(B.type)}`)});let G=this.gpuDataManager.create($,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(G.buffer,0,P,0,$),this.gpuDataManager.release(G.id),E={offset:0,size:$,buffer:G.buffer}}let x=this.programManager.normalizeDispatchGroupSize(p),I=x[1]===1&&x[2]===1,N=iw(e,t,I),R=this.programManager.getArtifact(N);if(R||(R=this.programManager.build(e,x),this.programManager.setArtifact(N,R),lt("info",()=>`[artifact] key: ${N}, programName: ${e.name}`)),f&&R.uniformVariablesInfo){if(f.length!==R.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${R.uniformVariablesInfo.length}, got ${f.length} in program "${R.programInfo.name}".`);for(let $=0;$<f.length;$++){let O=f[$],k=O.type,P=typeof O.data=="number"?1:O.data.length,[G,B]=R.uniformVariablesInfo[$];if(k!==G||P!==B)throw new Error(`Uniform variable ${$} mismatch: expect type ${G} with size ${B}, got type ${k} with size ${P} in program "${R.programInfo.name}".`)}}if(lt("info",()=>`[ProgramManager] run "${e.name}" (key=${N}) with ${x[0]}x${x[1]}x${x[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let $={kernelId:this.currentKernelId,programName:R.programInfo.name,inputTensorViews:t,outputTensorViews:_};this.pendingKernels.push($),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push($)}return this.programManager.run(R,u,b,x,E),Ki(e.name),_}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,n,a){let s=T2.get(e);if(!s)throw new Error(`kernel not implemented: ${e}`);let o={kernelType:e,kernelName:a,kernelEntry:s[0],attributes:[s[1],n]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let n of t)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,n){let a=this.kernels.get(e);if(!a)throw new Error(`kernel not created: ${e}`);let s=a.kernelType,o=a.kernelName,u=a.kernelEntry,d=a.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${s}] ${o}" is not allowed to be called recursively`);this.currentKernelId=e,d[0]&&(d[1]=d[0](d[1]),d[0]=void 0),lt("info",()=>`[WebGPU] Start to run kernel "[${s}] ${o}"...`);let p=this.env.debug;this.temporaryData=[];try{return p&&this.device.pushErrorScope("validation"),u(t,d[1]),0}catch(f){return n.push(Promise.resolve(`[WebGPU] Kernel "[${s}] ${o}" failed. ${f}`)),1}finally{p&&n.push(this.device.popErrorScope().then(f=>f?`GPU validation error for kernel "[${s}] ${o}": ${f.message}`:null));for(let f of this.temporaryData)this.gpuDataManager.release(f.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,n,a){let s=this.sessionExternalDataMapping.get(e);s||(s=new Map,this.sessionExternalDataMapping.set(e,s));let o=s.get(t),u=this.gpuDataManager.registerExternalBuffer(n,a,o);return s.set(t,[u,n]),u}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(n=>this.gpuDataManager.unregisterExternalBuffer(n[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,n){return async()=>{let a=await Lh(this,e,t);return ym(a.buffer,n)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",(((e=this.env.webgpu.profiling)==null?void 0:e.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){lt("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){lt("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){lt("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),n=e.length;this.pendingKernels=[];for(let a=0;a<n;a++){let s=this.getComputePassEncoder(),o=e[a];this.writeTimestamp(this.pendingDispatchNumber*2),s.setPipeline(o.computePipeline),s.setBindGroup(0,o.bindGroup),s.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[a]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),x2={};fs(x2,{init:()=>C2});var Cc,rw,C2,ok=be(()=>{Ve(),Da(),Je(),hD(),Cc=class A2{constructor(t,n,a,s){this.module=t,this.dataType=n,this.data=a,this.dims=s}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=ae.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=ae.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=ae.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=ae.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(ae.size(t)!==ae.size(this.dims))throw new Error("Invalid new shape");return new A2(this.module,this.dataType,this.data,t)}},rw=class{constructor(e,t,n){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let a=e.PTR_SIZE,s=n/e.PTR_SIZE,o=a===4?"i32":"i64";this.opKernelContext=Number(e.getValue(a*s++,o));let u=Number(e.getValue(a*s++,o));this.outputCount=Number(e.getValue(a*s++,o)),this.customDataOffset=Number(e.getValue(a*s++,"*")),this.customDataSize=Number(e.getValue(a*s++,o));let d=[];for(let p=0;p<u;p++){let f=Number(e.getValue(a*s++,o)),m=Number(e.getValue(a*s++,"*")),_=Number(e.getValue(a*s++,o)),b=[];for(let E=0;E<_;E++)b.push(Number(e.getValue(a*s++,o)));d.push(new Cc(e,f,m,b))}this.inputs=d}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var u;let n=((u=t==null?void 0:t.inputs)==null?void 0:u.map(d=>typeof d=="number"?this.inputs[d]:d))??this.inputs,a=(t==null?void 0:t.outputs)??[],s=(d,p,f)=>new Cc(this.module,p,this.output(d,f),f),o=(d,p)=>{let f=io(d,p);if(!f)throw new Error(`Unsupported data type: ${d}`);let m=f>0?this.backend.gpuDataManager.create(f).id:0;return new Cc(this.module,d,m,p)};return this.backend.run(e,n,a,s,o,this.outputCount)}output(e,t){let n=this.module.stackSave();try{let a=this.module.PTR_SIZE,s=a===4?"i32":"i64",o=this.module.stackAlloc((1+t.length)*a);this.module.setValue(o,t.length,s);for(let u=0;u<t.length;u++)this.module.setValue(o+a*(u+1),t[u],s);return this.module._JsepOutput(this.opKernelContext,e,o)}catch(a){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${a}`)}finally{this.module.stackRestore(n)}}},C2=async(e,t,n,a)=>{let s=t.jsepInit;if(!s)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let o=(rk(),Bl(E2)).WebGpuBackend,u=new o;await u.initialize(n,a),s("webgpu",[u,d=>u.alloc(Number(d)),d=>u.free(d),(d,p,f,m=!1)=>{if(m)lt("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(d)}, dst=${Number(p)}, size=${Number(f)}`),u.memcpy(Number(d),Number(p));else{lt("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(d)}, gpuDataId=${Number(p)}, size=${Number(f)}`);let _=t.HEAPU8.subarray(Number(d>>>0),Number(d>>>0)+Number(f));u.upload(Number(p),_)}},async(d,p,f)=>{lt("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${d}, dataOffset=${p}, size=${f}`),await u.download(Number(d),()=>t.HEAPU8.subarray(Number(p)>>>0,Number(p+f)>>>0))},(d,p,f)=>u.createKernel(d,Number(p),f,t.UTF8ToString(t._JsepGetNodeName(Number(p)))),d=>u.releaseKernel(d),(d,p,f,m)=>{lt("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${f}, kernel=${d}, contextDataOffset=${p}`);let _=new rw(t,u,Number(p));return u.computeKernel(Number(d),_,m)},()=>u.captureBegin(),()=>u.captureEnd(),()=>u.replay()])}else{let o=new LE(n);s("webnn",[o,()=>o.reserveTensorId(),u=>o.releaseTensorId(u),async(u,d,p,f,m)=>o.ensureTensor(u,d,p,f,m),(u,d)=>{o.uploadTensor(u,d)},async(u,d)=>o.downloadTensor(u,d),(u,d)=>o.registerMLContext(u,d),!!n.trace])}}}),ow,Im,Rm,vr,sw,mh,Wc,Nm,$m,gh,Mm,Om,Dm,I2=be(()=>{Ai(),dD(),fD(),Ve(),co(),fm(),$E(),ow=(e,t)=>{It()._OrtInit(e,t)!==0&&bt("Can't initialize onnxruntime.")},Im=async e=>{ow(e.wasm.numThreads,Vc(e.logLevel))},Rm=async(e,t)=>{var a,s;(s=(a=It()).asyncInit)==null||s.call(a);let n=e.webgpu.adapter;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let o=e.webgpu.powerPreference;if(o!==void 0&&o!=="low-power"&&o!=="high-performance")throw new Error(`Invalid powerPreference setting: "${o}"`);let u=e.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(n=await navigator.gpu.requestAdapter({powerPreference:o,forceFallbackAdapter:u}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(t==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let o=(ok(),Bl(x2)).init;t==="webgpu"&&await o("webgpu",It(),e,n),t==="webnn"&&await o("webnn",It(),e)}},vr=new Map,sw=e=>{let t=It(),n=t.stackSave();try{let a=t.PTR_SIZE,s=t.stackAlloc(2*a);t._OrtGetInputOutputCount(e,s,s+a)!==0&&bt("Can't get session input/output count.");let o=a===4?"i32":"i64";return[Number(t.getValue(s,o)),Number(t.getValue(s+a,o))]}finally{t.stackRestore(n)}},mh=(e,t)=>{let n=It(),a=n.stackSave(),s=0;try{let o=n.PTR_SIZE,u=n.stackAlloc(2*o);n._OrtGetInputOutputMetadata(e,t,u,u+o)!==0&&bt("Can't get session input/output metadata.");let d=Number(n.getValue(u,"*"));s=Number(n.getValue(u+o,"*"));let p=n.HEAP32[s/4];if(p===0)return[d,0];let f=n.HEAPU32[s/4+1],m=[];for(let _=0;_<f;_++){let b=Number(n.getValue(s+8+_*o,"*"));m.push(b!==0?n.UTF8ToString(b):Number(n.getValue(s+8+(_+f)*o,"*")))}return[d,p,m]}finally{n.stackRestore(a),s!==0&&n._OrtFree(s)}},Wc=e=>{let t=It(),n=t._malloc(e.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,n),[n,e.byteLength]},Nm=async(e,t)=>{var _,b,E,x;let n,a,s=It();Array.isArray(e)?[n,a]=e:e.buffer===s.HEAPU8.buffer?[n,a]=[e.byteOffset,e.byteLength]:[n,a]=Wc(e);let o=0,u=0,d=0,p=[],f=[],m=[];try{if([u,p]=await NE(t),(t==null?void 0:t.externalData)&&s.mountExternalData){let K=[];for(let Y of t.externalData){let se=typeof Y=="string"?Y:Y.path;K.push(mm(typeof Y=="string"?Y:Y.data).then(ve=>{s.mountExternalData(se,ve)}))}await Promise.all(K)}for(let K of(t==null?void 0:t.executionProviders)??[])if((typeof K=="string"?K:K.name)==="webnn"){if(s.shouldTransferToMLTensor=!1,typeof K!="string"){let Y=K,se=Y==null?void 0:Y.context,ve=Y==null?void 0:Y.gpuDevice,_e=Y==null?void 0:Y.deviceType,ge=Y==null?void 0:Y.powerPreference;se?s.currentContext=se:ve?s.currentContext=await s.webnnCreateMLContext(ve):s.currentContext=await s.webnnCreateMLContext({deviceType:_e,powerPreference:ge})}else s.currentContext=await s.webnnCreateMLContext();break}o=await s._OrtCreateSession(n,a,u),(_=s.webgpuOnCreateSession)==null||_.call(s,o),o===0&&bt("Can't create a session."),(b=s.jsepOnCreateSession)==null||b.call(s),s.currentContext&&(s.webnnRegisterMLContext(o,s.currentContext),s.currentContext=void 0,s.shouldTransferToMLTensor=!0);let[I,N]=sw(o),R=!!(t!=null&&t.enableGraphCapture),$=[],O=[],k=[],P=[],G=[];for(let K=0;K<I;K++){let[Y,se,ve]=mh(o,K);Y===0&&bt("Can't get an input name."),f.push(Y);let _e=s.UTF8ToString(Y);$.push(_e),k.push(se===0?{name:_e,isTensor:!1}:{name:_e,isTensor:!0,type:Na(se),shape:ve})}for(let K=0;K<N;K++){let[Y,se,ve]=mh(o,K+I);Y===0&&bt("Can't get an output name."),m.push(Y);let _e=s.UTF8ToString(Y);O.push(_e),P.push(se===0?{name:_e,isTensor:!1}:{name:_e,isTensor:!0,type:Na(se),shape:ve});{if(R&&(t==null?void 0:t.preferredOutputLocation)===void 0){G.push("gpu-buffer");continue}let ge=typeof(t==null?void 0:t.preferredOutputLocation)=="string"?t.preferredOutputLocation:((E=t==null?void 0:t.preferredOutputLocation)==null?void 0:E[_e])??"cpu",$e=s.webnnIsGraphOutput;if(ge==="cpu"&&$e&&$e(o,_e)){G.push("ml-tensor-cpu-output");continue}if(ge!=="cpu"&&ge!=="cpu-pinned"&&ge!=="gpu-buffer"&&ge!=="ml-tensor")throw new Error(`Not supported preferred output location: ${ge}.`);if(R&&ge!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${ge}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);G.push(ge)}}let B=null;return G.some(K=>K==="gpu-buffer"||K==="ml-tensor"||K==="ml-tensor-cpu-output")&&(d=s._OrtCreateBinding(o),d===0&&bt("Can't create IO binding."),B={handle:d,outputPreferredLocations:G,outputPreferredLocationsEncoded:G.map(K=>K==="ml-tensor-cpu-output"?"ml-tensor":K).map(K=>kh(K))}),vr.set(o,[o,f,m,B,R,!1]),[o,$,O,k,P]}catch(I){throw f.forEach(N=>s._OrtFree(N)),m.forEach(N=>s._OrtFree(N)),d!==0&&s._OrtReleaseBinding(d)!==0&&bt("Can't release IO binding."),o!==0&&s._OrtReleaseSession(o)!==0&&bt("Can't release session."),I}finally{s._free(n),u!==0&&s._OrtReleaseSessionOptions(u)!==0&&bt("Can't release session options."),p.forEach(I=>s._free(I)),(x=s.unmountExternalData)==null||x.call(s)}},$m=e=>{var p,f,m;let t=It(),n=vr.get(e);if(!n)throw new Error(`cannot release session. invalid session id: ${e}`);let[a,s,o,u,d]=n;u&&(d&&t._OrtClearBoundOutputs(u.handle)!==0&&bt("Can't clear bound outputs."),t._OrtReleaseBinding(u.handle)!==0&&bt("Can't release IO binding.")),(p=t.jsepOnReleaseSession)==null||p.call(t,e),(f=t.webnnOnReleaseSession)==null||f.call(t,e),(m=t.webgpuOnReleaseSession)==null||m.call(t,e),s.forEach(_=>t._OrtFree(_)),o.forEach(_=>t._OrtFree(_)),t._OrtReleaseSession(a)!==0&&bt("Can't release session."),vr.delete(e)},gh=async(e,t,n,a,s,o,u=!1)=>{if(!e){t.push(0);return}let d=It(),p=d.PTR_SIZE,f=e[0],m=e[1],_=e[3],b=_,E,x;if(f==="string"&&(_==="gpu-buffer"||_==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(u&&_!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(_==="gpu-buffer"){let R=e[2].gpuBuffer;x=io(no(f),m);{let $=d.jsepRegisterBuffer;if(!$)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');E=$(a,o,R,x)}}else if(_==="ml-tensor"){let R=e[2].mlTensor;x=io(no(f),m);let $=d.webnnRegisterMLTensor;if(!$)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');E=$(a,R,no(f),m)}else{let R=e[2];if(Array.isArray(R)){x=p*R.length,E=d._malloc(x),n.push(E);for(let $=0;$<R.length;$++){if(typeof R[$]!="string")throw new TypeError(`tensor data at index ${$} is not a string`);d.setValue(E+$*p,Fi(R[$],n),"*")}}else{let $=d.webnnIsGraphInput,O=d.webnnIsGraphOutput;if(f!=="string"&&$&&O){let k=d.UTF8ToString(s);if($(a,k)||O(a,k)){let P=no(f);x=io(P,m),b="ml-tensor";let G=d.webnnCreateTemporaryTensor,B=d.webnnUploadTensor;if(!G||!B)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let K=await G(a,P,m);B(K,new Uint8Array(R.buffer,R.byteOffset,R.byteLength)),E=K}else x=R.byteLength,E=d._malloc(x),n.push(E),d.HEAPU8.set(new Uint8Array(R.buffer,R.byteOffset,x),E)}else x=R.byteLength,E=d._malloc(x),n.push(E),d.HEAPU8.set(new Uint8Array(R.buffer,R.byteOffset,x),E)}}let I=d.stackSave(),N=d.stackAlloc(4*m.length);try{m.forEach(($,O)=>d.setValue(N+O*p,$,p===4?"i32":"i64"));let R=d._OrtCreateTensor(no(f),E,x,N,m.length,kh(b));R===0&&bt(`Can't create tensor for input/output. session=${a}, index=${o}.`),t.push(R)}finally{d.stackRestore(I)}},Mm=async(e,t,n,a,s,o)=>{var ve,_e,ge,$e;let u=It(),d=u.PTR_SIZE,p=vr.get(e);if(!p)throw new Error(`cannot run inference. invalid session id: ${e}`);let f=p[0],m=p[1],_=p[2],b=p[3],E=p[4],x=p[5],I=t.length,N=a.length,R=0,$=[],O=[],k=[],P=[],G=u.stackSave(),B=u.stackAlloc(I*d),K=u.stackAlloc(I*d),Y=u.stackAlloc(N*d),se=u.stackAlloc(N*d);try{[R,$]=RE(o),ao("wasm prepareInputOutputTensor");for(let fe=0;fe<I;fe++)await gh(n[fe],O,P,e,m[t[fe]],t[fe],E);for(let fe=0;fe<N;fe++)await gh(s[fe],k,P,e,_[a[fe]],I+a[fe],E);ro("wasm prepareInputOutputTensor");for(let fe=0;fe<I;fe++)u.setValue(B+fe*d,O[fe],"*"),u.setValue(K+fe*d,m[t[fe]],"*");for(let fe=0;fe<N;fe++)u.setValue(Y+fe*d,k[fe],"*"),u.setValue(se+fe*d,_[a[fe]],"*");if(b&&!x){let{handle:fe,outputPreferredLocations:Ee,outputPreferredLocationsEncoded:Ie}=b;if(m.length!==I)throw new Error(`input count from feeds (${I}) is expected to be always equal to model's input count (${m.length}).`);ao("wasm bindInputsOutputs");for(let z=0;z<I;z++){let q=t[z];await u._OrtBindInput(fe,m[q],O[z])!==0&&bt(`Can't bind input[${z}] for session=${e}.`)}for(let z=0;z<N;z++){let q=a[z];(ve=s[z])!=null&&ve[3]?u._OrtBindOutput(fe,_[q],k[z],0)!==0&&bt(`Can't bind pre-allocated output[${z}] for session=${e}.`):u._OrtBindOutput(fe,_[q],0,Ie[q])!==0&&bt(`Can't bind output[${z}] to ${Ee[z]} for session=${e}.`)}ro("wasm bindInputsOutputs"),vr.set(e,[f,m,_,b,E,!0])}(_e=u.jsepOnRunStart)==null||_e.call(u,f),(ge=u.webnnOnRunStart)==null||ge.call(u,f);let Ae;b?Ae=await u._OrtRunWithBinding(f,b.handle,N,Y,R):Ae=await u._OrtRun(f,K,B,I,se,N,Y,R),Ae!==0&&bt("failed to call OrtRun().");let H=[],j=[];ao("wasm ProcessOutputTensor");for(let fe=0;fe<N;fe++){let Ee=Number(u.getValue(Y+fe*d,"*"));if(Ee===k[fe]){H.push(s[fe]);continue}let Ie=u.stackSave(),z=u.stackAlloc(4*d),q=!1,te,de=0;try{u._OrtGetTensorData(Ee,z,z+d,z+2*d,z+3*d)!==0&&bt(`Can't access output tensor data on index ${fe}.`);let Me=d===4?"i32":"i64",Fe=Number(u.getValue(z,Me));de=u.getValue(z+d,"*");let oe=u.getValue(z+d*2,"*"),Be=Number(u.getValue(z+d*3,Me)),je=[];for(let nt=0;nt<Be;nt++)je.push(Number(u.getValue(oe+nt*d,Me)));u._OrtFree(oe)!==0&&bt("Can't free memory for tensor dims.");let Pt=je.reduce((nt,yt)=>nt*yt,1);te=Na(Fe);let cn=b==null?void 0:b.outputPreferredLocations[a[fe]];if(te==="string"){if(cn==="gpu-buffer"||cn==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let nt=[];for(let yt=0;yt<Pt;yt++){let Bt=u.getValue(de+yt*d,"*"),ei=u.getValue(de+(yt+1)*d,"*"),Ot=yt===Pt-1?void 0:ei-Bt;nt.push(u.UTF8ToString(Bt,Ot))}H.push([te,je,nt,"cpu"])}else if(cn==="gpu-buffer"&&Pt>0){let nt=u.jsepGetBuffer;if(!nt)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let yt=nt(de),Bt=io(Fe,Pt);if(Bt===void 0||!pm(te))throw new Error(`Unsupported data type: ${te}`);q=!0,H.push([te,je,{gpuBuffer:yt,download:u.jsepCreateDownloader(yt,Bt,te),dispose:()=>{u._OrtReleaseTensor(Ee)!==0&&bt("Can't release tensor.")}},"gpu-buffer"])}else if(cn==="ml-tensor"&&Pt>0){let nt=u.webnnEnsureTensor,yt=u.webnnIsGraphInputOutputTypeSupported;if(!nt||!yt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(io(Fe,Pt)===void 0||!hm(te))throw new Error(`Unsupported data type: ${te}`);if(!yt(e,te,!1))throw new Error(`preferredLocation "ml-tensor" for ${te} output is not supported by current WebNN Context.`);let Bt=await nt(e,de,Fe,je,!1);q=!0,H.push([te,je,{mlTensor:Bt,download:u.webnnCreateMLTensorDownloader(de,te),dispose:()=>{u.webnnReleaseTensorId(de),u._OrtReleaseTensor(Ee)}},"ml-tensor"])}else if(cn==="ml-tensor-cpu-output"&&Pt>0){let nt=u.webnnCreateMLTensorDownloader(de,te)(),yt=H.length;q=!0,j.push((async()=>{let Bt=[yt,await nt];return u.webnnReleaseTensorId(de),u._OrtReleaseTensor(Ee),Bt})()),H.push([te,je,[],"cpu"])}else{let nt=id(te),yt=new nt(Pt);new Uint8Array(yt.buffer,yt.byteOffset,yt.byteLength).set(u.HEAPU8.subarray(de,de+yt.byteLength)),H.push([te,je,yt,"cpu"])}}finally{u.stackRestore(Ie),te==="string"&&de&&u._free(de),q||u._OrtReleaseTensor(Ee)}}b&&!E&&(u._OrtClearBoundOutputs(b.handle)!==0&&bt("Can't clear bound outputs."),vr.set(e,[f,m,_,b,E,!1]));for(let[fe,Ee]of await Promise.all(j))H[fe][2]=Ee;return ro("wasm ProcessOutputTensor"),H}finally{($e=u.webnnOnRunEnd)==null||$e.call(u,f),u.stackRestore(G),O.forEach(Ae=>u._OrtReleaseTensor(Ae)),k.forEach(Ae=>u._OrtReleaseTensor(Ae)),P.forEach(Ae=>u._free(Ae)),R!==0&&u._OrtReleaseRunOptions(R),$.forEach(Ae=>u._free(Ae))}},Om=e=>{let t=It(),n=vr.get(e);if(!n)throw new Error("invalid session id");let a=n[0],s=t._OrtEndProfiling(a);s===0&&bt("Can't get an profile file name."),t._OrtFree(s)},Dm=e=>{let t=[];for(let n of e){let a=n[2];!Array.isArray(a)&&"buffer"in a&&t.push(a.buffer)}return t}}),_r,jn,Qo,Ml,Ol,Ac,yh,Ic,Qr,jr,lw,R2,N2,$2,M2,O2,D2,k2,z2=be(()=>{Ai(),I2(),co(),cm(),_r=()=>!!Mt.wasm.proxy&&typeof document<"u",Qo=!1,Ml=!1,Ol=!1,Ic=new Map,Qr=(e,t)=>{let n=Ic.get(e);n?n.push(t):Ic.set(e,[t])},jr=()=>{if(Qo||!Ml||Ol||!jn)throw new Error("worker not ready")},lw=e=>{switch(e.data.type){case"init-wasm":Qo=!1,e.data.err?(Ol=!0,yh[1](e.data.err)):(Ml=!0,yh[0]()),Ac&&(URL.revokeObjectURL(Ac),Ac=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Ic.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},R2=async()=>{if(!Ml){if(Qo)throw new Error("multiple calls to 'initWasm()' detected.");if(Ol)throw new Error("previous call to 'initWasm()' failed.");if(Qo=!0,_r())return new Promise((e,t)=>{jn==null||jn.terminate(),AE().then(([n,a])=>{try{jn=a,jn.onerror=o=>t(o),jn.onmessage=lw,yh=[e,t];let s={type:"init-wasm",in:Mt};!s.in.wasm.wasmPaths&&(n||Dh)&&(s.in.wasm.wasmPaths={wasm:new URL("/SENTINELV15/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href}),jn.postMessage(s),Ac=n}catch(s){t(s)}},t)});try{await dm(Mt.wasm),await Im(Mt),Ml=!0}catch(e){throw Ol=!0,e}finally{Qo=!1}}},N2=async e=>{if(_r())return jr(),new Promise((t,n)=>{Qr("init-ep",[t,n]);let a={type:"init-ep",in:{epName:e,env:Mt}};jn.postMessage(a)});await Rm(Mt,e)},$2=async e=>_r()?(jr(),new Promise((t,n)=>{Qr("copy-from",[t,n]);let a={type:"copy-from",in:{buffer:e}};jn.postMessage(a,[e.buffer])})):Wc(e),M2=async(e,t)=>{if(_r()){if(t!=null&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return jr(),new Promise((n,a)=>{Qr("create",[n,a]);let s={type:"create",in:{model:e,options:{...t}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),jn.postMessage(s,o)})}else return Nm(e,t)},O2=async e=>{if(_r())return jr(),new Promise((t,n)=>{Qr("release",[t,n]);let a={type:"release",in:e};jn.postMessage(a)});$m(e)},D2=async(e,t,n,a,s,o)=>{if(_r()){if(n.some(u=>u[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(s.some(u=>u))throw new Error("pre-allocated output tensor is not supported for proxy.");return jr(),new Promise((u,d)=>{Qr("run",[u,d]);let p=n,f={type:"run",in:{sessionId:e,inputIndices:t,inputs:p,outputIndices:a,options:o}};jn.postMessage(f,Dm(p))})}else return Mm(e,t,n,a,s,o)},k2=async e=>{if(_r())return jr(),new Promise((t,n)=>{Qr("end-profiling",[t,n]);let a={type:"end-profiling",in:e};jn.postMessage(a)});Om(e)}}),vh,uw,L2,sk=be(()=>{Ai(),z2(),Ve(),um(),$E(),vh=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},uw=e=>{switch(e[3]){case"cpu":return new Si(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!pm(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:n,download:a,dispose:s}=e[2];return Si.fromGpuBuffer(n,{dataType:t,dims:e[1],download:a,dispose:s})}case"ml-tensor":{let t=e[0];if(!hm(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:n,download:a,dispose:s}=e[2];return Si.fromMLTensor(n,{dataType:t,dims:e[1],download:a,dispose:s})}default:throw new Error(`invalid data location: ${e[3]}`)}},L2=class{async fetchModelAndCopyToWasmMemory(e){return $2(await mm(e))}async loadModel(e,t){sa();let n;typeof e=="string"?n=await this.fetchModelAndCopyToWasmMemory(e):n=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await M2(n,t),Ki()}async dispose(){return O2(this.sessionId)}async run(e,t,n){sa();let a=[],s=[];Object.entries(e).forEach(_=>{let b=_[0],E=_[1],x=this.inputNames.indexOf(b);if(x===-1)throw new Error(`invalid input '${b}'`);a.push(E),s.push(x)});let o=[],u=[];Object.entries(t).forEach(_=>{let b=_[0],E=_[1],x=this.outputNames.indexOf(b);if(x===-1)throw new Error(`invalid output '${b}'`);o.push(E),u.push(x)});let d=a.map((_,b)=>vh(_,()=>`input "${this.inputNames[s[b]]}"`)),p=o.map((_,b)=>_?vh(_,()=>`output "${this.outputNames[u[b]]}"`):null),f=await D2(this.sessionId,s,d,u,p,n),m={};for(let _=0;_<f.length;_++)m[this.outputNames[u[_]]]=o[_]??uw(f[_]);return Ki(),m}startProfiling(){}endProfiling(){k2(this.sessionId)}}}),U2={};fs(U2,{OnnxruntimeWebAssemblyBackend:()=>Jh,initializeFlags:()=>Kh,wasmBackend:()=>P2});var Kh,Jh,P2,lk=be(()=>{Ai(),z2(),sk(),Kh=()=>{(typeof Mt.wasm.initTimeout!="number"||Mt.wasm.initTimeout<0)&&(Mt.wasm.initTimeout=0);let e=Mt.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),Mt.wasm.simd=!1),typeof Mt.wasm.proxy!="boolean"&&(Mt.wasm.proxy=!1),typeof Mt.wasm.trace!="boolean"&&(Mt.wasm.trace=!1),typeof Mt.wasm.numThreads!="number"||!Number.isInteger(Mt.wasm.numThreads)||Mt.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Mt.wasm.numThreads=1;else{let t=typeof navigator>"u"?WO("node:os").cpus().length:navigator.hardwareConcurrency;Mt.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},Jh=class{async init(e){Kh(),await R2(),await N2(e)}async createInferenceSessionHandler(e,t){let n=new L2;return await n.loadModel(e,t),n}},P2=new Jh});Ai();Ai();Ai();var uk="1.23.2";{let e=(lk(),Bl(U2)).wasmBackend;ns("webgpu",e,5),ns("webnn",e,5),ns("cpu",e,10),ns("wasm",e,10)}Object.defineProperty(Mt.versions,"web",{value:uk,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"],as=class as{constructor(t,n){this.age=0,this.hits=0,this.timeSinceUpdate=0,this.trackId=as.count++;const a=t[0]+t[2]/2,s=t[1]+t[3]/2,o=t[2]*t[3],u=t[3];this.state=[a,s,o,u,0,0,0,0],this.appearance=n,this.P=this.createIdentity(8,10)}predict(){const t=this.createIdentity(8,1);for(let a=0;a<4;a++)t[a][a+4]=1;const n=new Array(8).fill(0);for(let a=0;a<8;a++)for(let s=0;s<8;s++)n[a]+=t[a][s]*this.state[s];return this.state=n,this.age++,this.timeSinceUpdate>0&&(this.hits=0),this.timeSinceUpdate++,this.getBBox()}update(t,n){this.timeSinceUpdate=0,this.hits++;const a=t[0]+t[2]/2,s=t[1]+t[3]/2,o=t[2]*t[3],u=t[3],d=.6;this.state[0]=this.state[0]*(1-d)+a*d,this.state[1]=this.state[1]*(1-d)+s*d,this.state[2]=this.state[2]*(1-d)+o*d,this.state[3]=this.state[3]*(1-d)+u*d,n&&this.appearance?this.appearance=this.appearance.map((f,m)=>f*.9+n[m]*(1-.9)):n&&(this.appearance=n)}getBBox(){const t=this.state[0],n=this.state[1],a=this.state[2],s=this.state[3],o=a/s;return[t-o/2,n-s/2,o,s]}createIdentity(t,n){const a=[];for(let s=0;s<t;s++){const o=new Array(t).fill(0);o[s]=n,a.push(o)}return a}};as.count=0,as.R_STD=[10,10,10,10],as.Q_STD=[.01,.01,.01,.01,.01,.01,.01,.01];let Kc=as;function Jc(e,t){const n=Math.max(e[0],t[0]),a=Math.max(e[1],t[1]),s=Math.min(e[0]+e[2],t[0]+t[2]),o=Math.min(e[1]+e[3],t[1]+t[3]),u=Math.max(0,s-n)*Math.max(0,o-a),d=e[2]*e[3],p=t[2]*t[3];return u/(d+p-u)}function dk(e,t){if(!e||!t||e.length!==t.length)return 0;let n=0,a=0,s=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o],a+=e[o]*e[o],s+=t[o]*t[o];return n/(Math.sqrt(a)*Math.sqrt(s)+1e-8)}class fk{constructor(){this.tracks=[],this.frameId=0,this.highThresh=.5,this.matchThresh=.25,this.trackBufferFrames=30}update(t){this.frameId++;const n=t.filter(b=>b.score>=this.highThresh),a=t.filter(b=>b.score<this.highThresh&&b.score>.1);this.tracks.forEach(b=>b.predict());const s=Array.from(this.tracks.keys()),o=Array.from(n.keys()),{matches:u,unmatchedTracks:d,unmatchedDets:p}=this.match(this.tracks,n,s,o,this.matchThresh);u.forEach(b=>{this.tracks[b[0]].update(n[b[1]].bbox)});const{matches:f,unmatchedTracks:m,unmatchedDets:_}=this.match(this.tracks,a,d,Array.from(a.keys()),this.matchThresh);return f.forEach(b=>{this.tracks[b[0]].update(a[b[1]].bbox)}),p.forEach(b=>{const E=n[b];this.tracks.push(new Kc(E.bbox))}),this.tracks=this.tracks.filter(b=>b.timeSinceUpdate<this.trackBufferFrames),this.tracks.map(b=>{const[E,x,I,N]=b.getBBox();return{trackId:b.trackId,bbox:[E,x,I,N],score:1,classId:0,className:"vehicle",state:b.state,covariance:b.P,age:b.age,hits:b.hits,timeSinceUpdate:b.timeSinceUpdate}})}match(t,n,a,s,o){const u=[],d=new Set(a),p=new Set(s),f=[];return a.forEach(m=>{s.forEach(_=>{const b=Jc(t[m].getBBox(),n[_].bbox);b>=o&&f.push({tIdx:m,dIdx:_,iou:b})})}),f.sort((m,_)=>_.iou-m.iou),f.forEach(m=>{d.has(m.tIdx)&&p.has(m.dIdx)&&(u.push([m.tIdx,m.dIdx]),d.delete(m.tIdx),p.delete(m.dIdx))}),{matches:u,unmatchedTracks:Array.from(d),unmatchedDets:Array.from(p)}}}class _h{constructor(){this.tracks=[],this.frameId=0,this.highThresh=.6,this.matchThresh=.25,this.trackBufferFrames=40,this.appearanceWeight=.5}extractAppearance(t,n){const[a,s,o,u]=n.map(f=>Math.floor(f)),d=new Array(16).fill(0);let p=0;for(let f=Math.max(0,s);f<Math.min(t.height,s+u);f++)for(let m=Math.max(0,a);m<Math.min(t.width,a+o);m++){const _=(f*t.width+m)*4,b=Math.floor(t.data[_]/64),E=Math.floor(t.data[_+1]/64);Math.floor(t.data[_+2]/64);const x=b*4+E;d[x]++,p++}return d.map(f=>f/(p+1e-8))}update(t,n){this.frameId++;let a=[];if(n){const N=document.createElement("canvas");N.width=n.videoWidth,N.height=n.videoHeight;const R=N.getContext("2d");if(R){R.drawImage(n,0,0);const $=R.getImageData(0,0,N.width,N.height);a=t.map(O=>this.extractAppearance($,O.bbox))}}const s=t.filter(N=>N.score>=this.highThresh),o=t.filter(N=>N.score<this.highThresh&&N.score>.1),u=a.slice(0,s.length),d=a.slice(s.length);this.tracks.forEach(N=>N.predict());const p=Array.from(this.tracks.keys()),f=Array.from(s.keys()),{matches:m,unmatchedTracks:_,unmatchedDets:b}=this.matchWithAppearance(this.tracks,s,p,f,this.matchThresh,u);m.forEach(N=>{this.tracks[N[0]].update(s[N[1]].bbox,u[N[1]])});const{matches:E,unmatchedTracks:x,unmatchedDets:I}=this.matchWithAppearance(this.tracks,o,_,Array.from(o.keys()),this.matchThresh*.7,d);return E.forEach(N=>{this.tracks[N[0]].update(o[N[1]].bbox,d[N[1]])}),b.forEach(N=>{const R=s[N];this.tracks.push(new Kc(R.bbox,u[N]))}),this.tracks=this.tracks.filter(N=>N.timeSinceUpdate<this.trackBufferFrames),this.tracks.map(N=>{const[R,$,O,k]=N.getBBox();return{trackId:N.trackId,bbox:[R,$,O,k],score:1,classId:0,className:"vehicle",state:N.state,covariance:N.P,age:N.age,hits:N.hits,timeSinceUpdate:N.timeSinceUpdate,appearance:N.appearance}})}matchWithAppearance(t,n,a,s,o,u){const d=[],p=new Set(a),f=new Set(s),m=[];return a.forEach(_=>{s.forEach(b=>{const E=Jc(t[_].getBBox(),n[b].bbox);let x=E;if(t[_].appearance&&u[b]){const I=dk(t[_].appearance,u[b]);x=(1-this.appearanceWeight)*E+this.appearanceWeight*I}x>=o&&m.push({tIdx:_,dIdx:b,score:x})})}),m.sort((_,b)=>b.score-_.score),m.forEach(_=>{p.has(_.tIdx)&&f.has(_.dIdx)&&(d.push([_.tIdx,_.dIdx]),p.delete(_.tIdx),f.delete(_.dIdx))}),{matches:d,unmatchedTracks:Array.from(p),unmatchedDets:Array.from(f)}}}class pk{constructor(){this.session=null,this.poseSession=null}async load(t,n){try{if(Mt.wasm.wasmPaths="/SENTINELV15/",this.session=await Bc.create(t,{executionProviders:["wasm"]}),console.log("YOLOv11 Loaded",this.session.outputNames,this.session.inputNames),n)try{this.poseSession=await Bc.create(n,{executionProviders:["wasm"]}),console.log("YOLOv11-Pose Loaded",this.poseSession.outputNames,this.poseSession.inputNames)}catch(a){console.warn("Failed to load Pose model (continuing without pose features):",a)}}catch(a){throw console.error("Failed to load YOLO ONNX detection model",a),a}}async detectPose(t,n=.5){if(!this.poseSession)return[];const a=document.createElement("canvas");a.width=640,a.height=640;const s=a.getContext("2d");if(!s)return[];s.drawImage(t,0,0,640,640);const o=s.getImageData(0,0,640,640),u=new Float32Array(3*640*640);for(let R=0;R<640*640;R++){const $=o.data[R*4]/255,O=o.data[R*4+1]/255,k=o.data[R*4+2]/255;u[R]=$,u[640*640+R]=O,u[2*640*640+R]=k}const p={images:new Si("float32",u,[1,3,640,640])},f=await this.poseSession.run(p),m=f[Object.keys(f)[0]].data,_=f[Object.keys(f)[0]].dims;let b=8400,E=!1;_&&_.length===3&&(_[1]>_[2]?(E=!0,b=_[1]):b=_[2]);const x=[],I=t.videoWidth/640,N=t.videoHeight/640;for(let R=0;R<b;R++){let $,O,k,P,G;if(E){const B=R*56;$=m[B+0],O=m[B+1],k=m[B+2],P=m[B+3],G=m[B+4]}else $=m[0*b+R],O=m[1*b+R],k=m[2*b+R],P=m[3*b+R],G=m[4*b+R];if(G>n){const B=[];for(let K=0;K<17;K++){let Y,se,ve;if(E){const _e=R*56;Y=m[_e+5+K*3],se=m[_e+5+K*3+1],ve=m[_e+5+K*3+2]}else Y=m[(5+K*3)*b+R],se=m[(5+K*3+1)*b+R],ve=m[(5+K*3+2)*b+R];B.push({x:Y*I,y:se*N,confidence:ve})}x.push({bbox:[($-k/2)*I,(O-P/2)*N,k*I,P*N],score:G,classId:0,className:"person",keypoints:B})}}return this.nmsPose(x)}nmsPose(t,n=.45){t.sort((s,o)=>o.score-s.score);const a=[];for(;t.length>0;){const s=t.shift();a.push(s),t=t.filter(o=>Jc(s.bbox,o.bbox)<n)}return a}async detect(t,n=.4){if(!this.session)return[];const a=document.createElement("canvas");a.width=640,a.height=640;const s=a.getContext("2d");if(!s)return[];s.drawImage(t,0,0,640,640);const o=s.getImageData(0,0,640,640),u=new Float32Array(3*640*640);for(let N=0;N<640*640;N++){const R=o.data[N*4]/255,$=o.data[N*4+1]/255,O=o.data[N*4+2]/255;u[N]=R,u[640*640+N]=$,u[2*640*640+N]=O}const p={images:new Si("float32",u,[1,3,640,640])},f=await this.session.run(p),m=f[Object.keys(f)[0]].data,_=f[Object.keys(f)[0]].dims;let b=8400,E=80,x=!1;_&&_.length===3&&(_[1]>_[2]?(x=!0,b=_[1],E=_[2]-4):(x=!1,b=_[2],E=_[1]-4));const I=[];for(let N=0;N<b;N++){let R=0,$=0;for(let O=0;O<E;O++){let k=0;x?k=m[N*(E+4)+(4+O)]:k=m[(4+O)*b+N],k>R&&(R=k,$=O)}if(R>n){let O,k,P,G;if(x){const Y=N*(E+4);O=m[Y+0],k=m[Y+1],P=m[Y+2],G=m[Y+3]}else O=m[0*b+N],k=m[1*b+N],P=m[2*b+N],G=m[3*b+N];const B=t.videoWidth/640,K=t.videoHeight/640;I.push({bbox:[(O-P/2)*B,(k-G/2)*K,P*B,G*K],score:R,classId:$,className:ck[$]||"unknown"})}}return this.nms(I)}nms(t,n=.45){t.sort((s,o)=>o.score-s.score);const a=[];for(;t.length>0;){const s=t.shift();a.push(s),t=t.filter(o=>Jc(s.bbox,o.bbox)<n)}return a}}const hk=3,mk=320,gk=mk/hk,cw=({className:e})=>L.jsx("svg",{viewBox:"0 0 200 240",className:e,fill:"none",xmlns:"http://www.w3.org/2000/svg"}),yk={car:"#06b6d4",truck:"#f59e0b",motorcycle:"#8b5cf6",bus:"#10b981",person:"#ec4899",bicycle:"#84cc16"},vk=`PROTOCOLO DAGANZO_V15_AUDIT:
1. DETECCIN CELULAR: Vigilar posicin de manos y brillo facial compatible con terminal mvil.
2. CINTURN SEGURIDAD: Analizar contraste diagonal en hombro del conductor.
3. SEALTICA HORIZONTAL: Vigilar pisado de lnea continua y detencin total en STOP (velocidad < 1km/h).
4. PRIORIDAD PEATONAL: Detectar presencia de peatones en cebra y reduccin de velocidad preventiva.
5. OCUPACIN VA: Deteccin de vehculos en doble fila o zonas de carga/descarga sin operario.
6. COMPORTAMIENTO: Virajes bruscos, aceleraciones sbitas o invasin de carril contrario.
7. CALIBRACIN: Usar referencia de 3 metros por carril para estimar velocidades crticas.`,_k=()=>{var xr,hi,Ni,dn,Hn,fn;const[e,t]=We.useState("none"),[n,a]=We.useState(null),[s,o]=We.useState(!1),[u,d]=We.useState(!1),[p,f]=We.useState(null),[m,_]=We.useState(0),[b,E]=We.useState(vk),[x,I]=We.useState(null),[N,R]=We.useState([]),[$,O]=We.useState(null),[k,P]=We.useState(0),G=We.useRef(new Set),[B,K]=We.useState(0),[Y,se]=We.useState({cpu:24,mem:1.2,temp:42,net:85,gps:"40.6483 N, 3.4582 W"}),[ve,_e]=We.useState(!0),ge={"highway-fast-bytetrack":{confThreshold:.4,nmsIouThreshold:.45,detectionSkip:2,trackerType:"ByteTrack",highDetThreshold:.6,lowDetThreshold:.2,matchIouThreshold:.3,trackBufferFrames:20,minHitsToConfirm:3,appearanceWeight:0},"urban-balanced-bytetrack":{confThreshold:.4,nmsIouThreshold:.35,detectionSkip:2,trackerType:"ByteTrack",highDetThreshold:.6,lowDetThreshold:.1,matchIouThreshold:.2,trackBufferFrames:60,minHitsToConfirm:5,appearanceWeight:0},"precision-slow-botsort":{confThreshold:.3,nmsIouThreshold:.55,detectionSkip:1,trackerType:"BoT-SORT",highDetThreshold:.6,lowDetThreshold:.1,matchIouThreshold:.2,trackBufferFrames:45,minHitsToConfirm:1,appearanceWeight:.5},"forensic-reID-botsort":{confThreshold:.25,nmsIouThreshold:.6,detectionSkip:1,trackerType:"BoT-SORT",highDetThreshold:.55,lowDetThreshold:.05,matchIouThreshold:.15,trackBufferFrames:60,minHitsToConfirm:1,appearanceWeight:.7}},[$e,Ae]=We.useState("urban-balanced-bytetrack"),H=We.useRef([]),[j,fe]=We.useState(ge["urban-balanced-bytetrack"]),Ee=We.useRef(0),[Ie,z]=We.useState({enabled:!1,gridType:"cross",spacing:200,angleAdaptive:!0,perspectiveVanishingY:300}),[q,te]=We.useState(["2-lanes-bidirectional"]),[de,Me]=We.useState(!1),[Fe,oe]=We.useState("solid"),[Be,je]=We.useState([{y:500,type:"solid",direction:"bidirectional",label:"LNEA CONTINUA CENTRAL",infractionType:"LINE_CROSSING"}]),Pt=We.useCallback(ie=>{if(!ie.enabled)return[];const we=[],J=1e3,Ye=1e3;switch(ie.gridType){case"horizontal":for(let De=ie.spacing;De<Ye;De+=ie.spacing)we.push({y:De,type:"divider",direction:"bidirectional",label:`GRID_H_${De}`,infractionType:void 0});break;case"vertical":for(let De=ie.spacing;De<J;De+=ie.spacing)we.push({y:0,x1:De,y2:Ye,x2:De,type:"divider",direction:"bidirectional",label:`GRID_V_${De}`,infractionType:void 0});break;case"cross":for(let De=ie.spacing;De<Ye;De+=ie.spacing)we.push({y:De,type:"divider",direction:"bidirectional",label:`GRID_H_${De}`,infractionType:void 0});for(let De=ie.spacing;De<J;De+=ie.spacing)we.push({y:0,x1:De,y2:Ye,x2:De,type:"divider",direction:"bidirectional",label:`GRID_V_${De}`,infractionType:void 0});break;case"perspective":const kt=ie.perspectiveVanishingY,Ft=J/2;for(let De=ie.spacing;De<Ye;De+=ie.spacing)if(!ie.angleAdaptive)we.push({y:De,type:"divider",direction:"bidirectional",label:`PERSP_H_${De}`,infractionType:void 0});else{const Le=(De-kt)/10;we.push({y:De,x1:0,y2:De,x2:J,angle:Math.atan2(Le,J)*(180/Math.PI),type:"divider",direction:"bidirectional",label:`PERSP_H_${De}`,infractionType:void 0})}const Et=Math.floor(J/ie.spacing);for(let De=0;De<Et;De++){const Le=De/Et*J;we.push({y:kt,x1:Ft,y2:Ye,x2:Le,angle:Math.atan2(Ye-kt,Le-Ft)*(180/Math.PI),type:"divider",direction:"bidirectional",label:`PERSP_R_${De}`,infractionType:void 0})}break}return we},[]);We.useEffect(()=>{if(Ie.enabled){const ie=Pt(Ie);je(we=>[...we.filter(Ye=>!Ye.label.startsWith("GRID_")&&!Ye.label.startsWith("PERSP_")),...ie])}else je(ie=>ie.filter(we=>!we.label.startsWith("GRID_")&&!we.label.startsWith("PERSP_")))},[Ie,Pt]);const cn={"daganzo-m100-enlace":{lines:[{y:350,type:"divider",direction:"bidirectional",label:"NUDO M-100 / M-113",infractionType:null},{y:650,type:"speed-zone",direction:"bidirectional",label:"RADAR ENLACE LOGSTICO",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO NUDO LOGSTICO M-100:
1. Auditora de flujos pesados desde A-2.
2. Control de velocidad en ramal de incorporacin.
3. Vigilancia de trazada en curvas de radio reducido.`},"daganzo-m113-ajalvir":{lines:[{y:400,type:"solid",direction:"bidirectional",label:"EJE ACCESO AJALVIR",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ACCESO AJALVIR (M-113 OESTE):
1. Control de pisotn de lnea en tramo interurbano.
2. Vigilancia de uso de arcenes por ciclistas/peatones.
3. [LINE: Y=800, TYPE=speed-zone, LABEL=CONTROL ENTRADA MUNICIPIO, INFRACTION=SPEEDING]`},"daganzo-m113-fresno":{lines:[{y:350,type:"divider",direction:"bidirectional",label:"ENTORNO FRESNO/SERRACINES",infractionType:null}],directivesTemplate:`PROTOCOLO ACCESO FRESNO (M-113 NORTE):
1. Vigilancia de trnsito agrcola/maquinaria.
2. Control de adelantamientos en rasantes.
3. Auditora de seales de stop en caminos rurales.`},"daganzo-av-madrid":{lines:[{y:300,type:"bus-lane",direction:"northbound",label:"CARRIL BUS AV. MADRID",infractionType:"BUS_LANE_VIOLATION"},{y:600,type:"pedestrian",direction:"bidirectional",label:"CRUCE AV. MADRID",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO AVENIDA DE MADRID (ACCESO SUR):
1. Prioridad: Carril BUS - Sancionar invasin turismos.
2. Control de velocidad urbana 30km/h.
3. Vigilancia de giros a derecha hacia polgonos.`},"daganzo-calle-mayor":{lines:[{y:400,type:"pedestrian",direction:"bidirectional",label:"EJE CALLE MAYOR",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO CALLE MAYOR (NCLEO):
1. Control de prioridad peatonal extrema.
2. Sancionar carga/descarga fuera de horario.
3. [LINE: Y=200, TYPE=speed-zone, LABEL=RADAR NCLEO, INFRACTION=SPEEDING]`},"daganzo-poligono-gitesa":{lines:[{y:350,type:"loading-zone",direction:"bidirectional",label:"POLGONO GITESA",infractionType:"LOADING_ZONE_VIOLATION"}],directivesTemplate:`PROTOCOLO POLGONO GITESA:
1. Vigilancia de camiones en espera en calzada.
2. Control de ocupacin de vados industriales.
3. Auditora de flujos pesados nocturnos.`},"daganzo-camino-gancha":{lines:[{y:500,type:"solid",direction:"bidirectional",label:"CAMINO DE LA GANCHA",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ENTORNO RURAL / DEPORTIVO:
1. Control de trnsito no autorizado en caminos.
2. Vigilancia de acceso a instalaciones deportivas.
3. Sancionar vertido de escombros (Auditora visual).`},"daganzo-m113-norte":{lines:[{y:350,type:"speed-zone",direction:"southbound",label:"ACCESO M-113 NORTE (ENTRADA)",infractionType:"SPEEDING"},{y:600,type:"solid",direction:"bidirectional",label:"EJE M-113",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO M-113 ACCESO NORTE:
1. Control velocidad entrada municipio (50km/h).
2. Vigilancia pisotn lnea continua en curva de acceso.
3. [LINE: Y=850, TYPE=stop, LABEL=PUNTO AUDITORA, INFRACTION=null]`},"daganzo-m113-sur":{lines:[{y:300,type:"speed-zone",direction:"northbound",label:"ACCESO M-113 SUR (A-2/R-2)",infractionType:"SPEEDING"},{y:550,type:"divider",direction:"bidirectional",label:"BIFURCACIN POLGONO",infractionType:null}],directivesTemplate:`PROTOCOLO M-113 ACCESO SUR:
1. Auditora de flujo desde A-2/Torrejn.
2. Control de velocidad en tramo interurbano.
3. Vigilancia de incorporaciones desde caminos vecinales.`},"daganzo-m118-alcala":{lines:[{y:400,type:"solid",direction:"bidirectional",label:"EJE M-118 ALCAL",infractionType:"LINE_CROSSING"},{y:700,type:"speed-zone",direction:"bidirectional",label:"RADAR M-118",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO M-118 (CONEXIN ALCAL):
1. Control de velocidad en tramo curvo.
2. Sancionar adelantamientos prohibidos en lnea continua.
3. [LINE: Y=200, TYPE=stop, LABEL=STOP CONEXIN M-113, INFRACTION=STOP_VIOLATION]`},"daganzo-m119-camarma":{lines:[{y:450,type:"solid",direction:"bidirectional",label:"EJE M-119 CAMARMA",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO M-119 (ACCESO CAMARMA):
1. Vigilancia de transporte pesado.
2. Control de velocidad 90km/h (Tramo interurbano).
3. Auditora de arcenes.`},"daganzo-constitucion":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"PASO C/ CONSTITUCIN",infractionType:"PEDESTRIAN_PRIORITY"},{id:"radar-urbano",y:500,type:"speed-zone",direction:"bidirectional",label:"CONTROL 30/40",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO ARTERIA URBANA (C/ CONSTITUCIN):
1. Lmite 30km/h tramo central.
2. Prioridad peatonal en cruces sealizados.
3. Sancionar estacionamiento en doble fila obstruyendo bus.`},"daganzo-residencial":{lines:[{y:400,type:"pedestrian",direction:"bidirectional",label:"ZONA RESIDENCIAL 20",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO ZONA RESIDENCIAL / COEXISTENCIA:
1. Velocidad mxima 20km/h.
2. Vigilancia de juego en calle y trnsito peatonal fluido.
3. Prohibicin de trnsito de paso (solo residentes).`},"daganzo-colegios-magno":{lines:[{y:350,type:"pedestrian",direction:"bidirectional",label:"ENTORNO COLEGIO MAGNO",infractionType:"PEDESTRIAN_PRIORITY"},{y:650,type:"stop",direction:"bidirectional",label:"DETENCIN BUS ESCOLAR",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO SEGURIDAD ESCOLAR (MAGNO/BERZAL):
1. Control horario entrada/salida (08:30-10:00 / 16:00-17:30).
2. Sancin inmediata doble fila.
3. Vigilancia de cruce seguro de menores.`},"daganzo-poligono-frailes":{lines:[{y:350,type:"loading-zone",direction:"bidirectional",label:"LOS FRAILES LOGSTICA",infractionType:"LOADING_ZONE_VIOLATION"},{y:650,type:"divider",direction:"bidirectional",label:"FLUJO PESADO",infractionType:null}],directivesTemplate:`PROTOCOLO POLGONO LOS FRAILES:
1. Auditora de vehculos de gran tonelaje.
2. Control de carga/descarga fuera de zonas habilitadas.
3. Vigilancia de estacionamiento en esquinas de naves.`},"daganzo-rotonda-entrada":{lines:[{y:250,type:"solid",direction:"southbound",label:"ENTRADA ROTONDA M-113",infractionType:"STOP_VIOLATION"},{y:500,type:"dashed",direction:"bidirectional",label:"ANILLO ROTONDA",infractionType:null},{y:750,type:"solid",direction:"bidirectional",label:"SALIDA CENTRO",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ROTONDA PRINCIPAL DAGANZO:
1. Prioridad de paso en anillo.
2. Sancionar salida desde carril interior.
3. Auditora de trazadas peligrosas.`},"daganzo-centro":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"PLAZA DE LA VILLA (20)",infractionType:"PEDESTRIAN_PRIORITY"},{y:600,type:"speed-zone",direction:"bidirectional",label:"ZONA RESIDENCIAL",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO DAGANZO CENTRO:
1. Lmite 20km/h en casco histrico.
2. Prioridad absoluta al peatn.
3. Vigilancia de paradas en Plaza de la Villa.`},"daganzo-m113":{lines:[{y:400,type:"solid",direction:"bidirectional",label:"TRAVESA M-113",infractionType:"LINE_CROSSING"},{y:700,type:"stop",direction:"bidirectional",label:"SEMFORO ARTERIAL",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO DAGANZO M-113:
1. Control de travesa principal.
2. Vigilancia de giro a la izquierda en polgono.
3. Sancionar rebasamiento de foto-rojo.`},"daganzo-poligono":{lines:[{y:350,type:"loading-zone",direction:"bidirectional",label:"ACCESO POLGONO",infractionType:"LOADING_ZONE_VIOLATION"},{y:650,type:"divider",direction:"bidirectional",label:"EJE INDUSTRIAL",infractionType:null}],directivesTemplate:`PROTOCOLO DAGANZO INDUSTRIAL:
1. Control de paso de vehculos pesados.
2. Vigilancia de carga/descarga en calzada.
3. [LINE: Y=800, TYPE=solid, LABEL=LNEA CONTINUA ACCESO, INFRACTION=LINE_CROSSING]`},"2-lanes-bidirectional":{lines:[{y:500,type:"solid",direction:"bidirectional",label:"DIVISORIA CENTRAL (L1)",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO BIDIRECCIONAL:
1. Vigilar pisotn de lnea continua central.
2. Analizar invasin de carril contrario en adelantamientos prohibidos.
3. Verificar uso de intermitentes en cambios de trayectoria.`},"4-lanes-highway":{lines:[{y:300,type:"speed-zone",direction:"northbound",label:"ZONA CALIBRACIN (Z1)",infractionType:"SPEEDING"},{y:400,type:"divider",direction:"northbound",label:"DIVISOR CARRIL L/R",infractionType:null},{y:500,type:"solid",direction:"bidirectional",label:"MEDIANA DIVISORIA",infractionType:"LINE_CROSSING"},{y:600,type:"divider",direction:"southbound",label:"DIVISOR CARRIL L/R",infractionType:null},{y:700,type:"speed-zone",direction:"southbound",label:"ZONA CALIBRACIN (Z2)",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO AUTOPISTA:
1. Control riguroso de velocidad (Umbral 120km/h).
2. Vigilar ocupacin indebida del carril izquierdo.
3. Detectar conduccin temeraria (zigzag entre carriles).
4. Verificar distancia de seguridad (Regla de los 2 segundos).`},"3-lanes-oneway":{lines:[{y:300,type:"bus-lane",direction:"southbound",label:"CARRIL RESERVADO (R1)",infractionType:"BUS_LANE_VIOLATION"},{y:450,type:"dashed",direction:"southbound",label:"DIVISORIA TRAMO 1-2",infractionType:null},{y:650,type:"dashed",direction:"southbound",label:"DIVISORIA TRAMO 2-3",infractionType:null}],directivesTemplate:`PROTOCOLO VA URBANA (3C):
1. Prioridad: Sancionar invasin de Carril BUS por vehculos no autorizados.
2. Vigilar cambios de carril bruscos sin sealizacin.
3. Detectar paradas indebidas en carriles de circulacin.`},"cross-junction-4way":{lines:[{y:200,type:"stop",direction:"bidirectional",label:"DETENCIN NORTE (P1)",infractionType:"STOP_VIOLATION"},{y:300,type:"pedestrian",direction:"bidirectional",label:"REA DE PASO (A1)",infractionType:"PEDESTRIAN_PRIORITY"},{y:500,type:"divider",direction:"bidirectional",label:"EJE INTERSECCIN",infractionType:null},{y:700,type:"pedestrian",direction:"bidirectional",label:"REA DE PASO (A2)",infractionType:"PEDESTRIAN_PRIORITY"},{y:800,type:"stop",direction:"bidirectional",label:"DETENCIN SUR (P2)",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO INTERSECCIN 4 VAS:
1. Control de giro prohibido en el centro de la interseccin.
2. Vigilancia cruzada de prioridades de paso.
3. Sancin por bloqueo de interseccin (quedarse en medio).`},"t-junction-urban":{lines:[{y:350,type:"stop",direction:"bidirectional",label:"PARADA OBLIGATORIA",infractionType:"STOP_VIOLATION"},{y:500,type:"pedestrian",direction:"bidirectional",label:"PASO PEATONAL INTEGRADOR",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO INTERSECCIN EN T URBANA:
1. Control estricto de Stop/Ceda el Paso.
2. Prioridad peatonal en el radio de giro.
3. Vigilancia de invasin de carril contrario al realizar el giro.`},"t-junction-rural":{lines:[{y:400,type:"divider",direction:"bidirectional",label:"CARRIL CENTRAL DE GIRO",infractionType:null},{y:700,type:"solid",direction:"bidirectional",label:"LNEA DE INCORPORACIN",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO INTERSECCIN EN T RURAL (M-113/M-119):
1. Control de velocidad en va principal.
2. Vigilancia de uso del carril de espera/giro.
3. Deteccin de incorporaciones peligrosas (faltas de ceda el paso).`},"t-junction-multi":{lines:[{y:300,type:"stop",direction:"southbound",label:"DETENCIN ACCESO (P1)",infractionType:"STOP_VIOLATION"},{y:450,type:"solid",direction:"bidirectional",label:"DIVISORIA DE FLUJO",infractionType:"LINE_CROSSING"},{y:650,type:"dashed",direction:"bidirectional",label:"VECTOR DE TRANSICIN",infractionType:null}],directivesTemplate:`PROTOCOLO INTERSECCIN EN T MULTICARRIL:
1. Analizar detencin en va secundaria.
2. Vigilar pisotn de lnea continua al girar.
3. Prioridad absoluta a va principal.`},"roundabout-2lanes":{lines:[{y:250,type:"solid",direction:"southbound",label:"PUNTO INCORPORACIN (I1)",infractionType:"STOP_VIOLATION"},{y:450,type:"dashed",direction:"bidirectional",label:"DELIMITADOR EXTERIOR",infractionType:null},{y:650,type:"solid",direction:"bidirectional",label:"DELIMITADOR INTERIOR",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ROTONDA MULTICARRIL:
1. Sancionar salida directa desde carril interior.
2. Vigilancia de prioridad de entrada.
3. Control de trazada (uso correcto de carriles).`},"y-junction-split":{lines:[{y:400,type:"divider",direction:"northbound",label:"VRTICE SEPARACIN",infractionType:null},{y:550,type:"solid",direction:"northbound",label:"DIVISORA DE ISLETA",infractionType:"LINE_CROSSING"},{y:750,type:"speed-zone",direction:"northbound",label:"ZONA TRANSICIN (Z1)",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO BIFURCACIN EN Y:
1. Sancionar cruce tardo de isleta (lnea continua).
2. Control de velocidad en ramal de salida.
3. Deteccin de dudas peligrosas en el vrtice.`},"staggered-junction":{lines:[{y:250,type:"stop",direction:"southbound",label:"DETENCIN N-1 (P1)",infractionType:"STOP_VIOLATION"},{y:500,type:"divider",direction:"bidirectional",label:"REA CENTRAL",infractionType:null},{y:750,type:"stop",direction:"northbound",label:"DETENCIN N-2 (P2)",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO CRUCE DESPLAZADO:
1. Vigilancia de trfico cruzado en dos niveles.
2. Anlisis de ocupacin de zona central.
3. Control de giros indirectos.`},"urban-complete":{lines:[{y:200,type:"stop",direction:"bidirectional",label:"LNEA DE DETENCIN (P1)",infractionType:"STOP_VIOLATION"},{y:350,type:"pedestrian",direction:"bidirectional",label:"ZONA DE TRNSITO (A1)",infractionType:"PEDESTRIAN_PRIORITY"},{y:500,type:"solid",direction:"bidirectional",label:"DELIMITADOR SLIDO (D1)",infractionType:"LINE_CROSSING"},{y:650,type:"loading-zone",direction:"bidirectional",label:"REA CARGA/DESCARGA",infractionType:"LOADING_ZONE_VIOLATION"},{y:800,type:"bus-lane",direction:"southbound",label:"CARRIL RESERVADO (R1)",infractionType:"BUS_LANE_VIOLATION"}],directivesTemplate:`PROTOCOLO INTEGRAL URBANO:
1. Auditora multiespectral de todas las infracciones simultneas.
2. Especial nfasis en distraccin por mvil al aproximarse a zonas crticas.
3. Vigilancia de comportamiento errtico en reas congestionadas.`},"school-safety":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"ENTORNO ESCOLAR (A1)",infractionType:"PEDESTRIAN_PRIORITY"},{y:500,type:"speed-zone",direction:"bidirectional",label:"CONTROL VELOCIDAD (Z1)",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO SEGURIDAD ESCOLAR:
1. Velocidad limitada a 20km/h (tolerancia cero).
2. Vigilancia extrema de peatones infantiles.
3. Sancionar paradas en doble fila en horarios de entrada/salida.`},"roundabout-access":{lines:[{y:400,type:"stop",direction:"southbound",label:"PUNTO ACCESO (I1)",infractionType:"STOP_VIOLATION"},{y:600,type:"solid",direction:"bidirectional",label:"DIVISORIA INTERIOR (D1)",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ACCESO ROTONDA:
1. Analizar cesin de paso en entrada (prioridad del que est dentro).
2. Sancionar cruce de lneas continuas en el interior de la rotonda.`},"interurban-cloverleaf":{lines:[{y:300,type:"divider",direction:"northbound",label:"BIFURCACIN LAZO (L1)",infractionType:null},{y:450,type:"solid",direction:"bidirectional",label:"MEDIANA SEPARACIN",infractionType:"LINE_CROSSING"},{y:600,type:"divider",direction:"southbound",label:"INCORPORACIN LAZO (L2)",infractionType:null}],directivesTemplate:`PROTOCOLO INTERCAMBIADOR TRBOL:
1. Analizar trayectorias en bucles de enlace.
2. [LINE: Y=750, TYPE=speed-zone, LABEL=CONTROL VELOCIDAD ENLACE, INFRACTION=SPEEDING]
3. Sancionar cambios de carril bruscos en zonas de trenzado.`},"interurban-diamond":{lines:[{y:350,type:"divider",direction:"northbound",label:"SALIDA DIAMANTE (S1)",infractionType:null},{y:650,type:"divider",direction:"northbound",label:"ENTRADA DIAMANTE (E1)",infractionType:null}],directivesTemplate:`PROTOCOLO ENLACE DIAMANTE:
1. Vigilar cruce de lnea continua en divergencia.
2. [LINE: Y=200, TYPE=stop, LABEL=DETENCIN RAMAL, INFRACTION=STOP_VIOLATION]
3. Auditora de ceda el paso en incorporacin.`},"interurban-trumpet":{lines:[{y:400,type:"solid",direction:"bidirectional",label:"CURVA TROMPETA (C1)",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO ENLACE TROMPETA:
1. Control de trazada en curva de gran radio.
2. [LINE: Y=800, TYPE=speed-zone, LABEL=RADAR SALIDA AUTOPISTA, INFRACTION=SPEEDING]
3. Vigilancia de invasin de arcn.`},"accel-decel-lane":{lines:[{y:450,type:"dashed",direction:"northbound",label:"CARRIL ACELERACIN",infractionType:null},{y:550,type:"solid",direction:"northbound",label:"FIN DE RAMAL",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO RAMALES DE FLUJO:
1. Verificar incorporacin segura (velocidad adecuada).
2. [LINE: Y=650, TYPE=divider, LABEL=ZONA TRENZADO, INFRACTION=null]
3. Sancionar detencin en carril de aceleracin.`},"tunnel-security":{lines:[{y:300,type:"speed-zone",direction:"bidirectional",label:"RADAR TNEL (T1)",infractionType:"SPEEDING"},{y:500,type:"solid",direction:"bidirectional",label:"DELIMITADOR TNEL",infractionType:"LINE_CROSSING"},{y:700,type:"divider",direction:"bidirectional",label:"ZONA DE SEGURIDAD",infractionType:null}],directivesTemplate:`PROTOCOLO SEGURIDAD EN TNEL:
1. Control estricto de distancia de seguridad.
2. Sancionar uso de luces antiniebla o posicin incorrecta.
3. Vigilancia de detencin injustificada en el interior.`},"construction-zone":{lines:[{y:300,type:"speed-zone",direction:"bidirectional",label:"RADAR OBRAS 40 (O1)",infractionType:"SPEEDING"},{y:600,type:"divider",direction:"bidirectional",label:"BALIZAMIENTO TRANSVERSAL",infractionType:null}],directivesTemplate:`PROTOCOLO ZONA DE OBRAS:
1. Velocidad limitada a 40km/h (tolerancia mnima).
2. Sancionar desplazamiento de conos o balizas.
3. Prioridad absoluta a personal de va.`},"toll-plaza":{lines:[{y:400,type:"stop",direction:"northbound",label:"BARRERA PEAJE (B1)",infractionType:"STOP_VIOLATION"},{y:650,type:"divider",direction:"northbound",label:"CARRIL TELEPEAJE",infractionType:null}],directivesTemplate:`PROTOCOLO PEAJE / CONTROL:
1. Verificar detencin total ante barrera.
2. Sancionar cambio de carril en zona de embudo.
3. [LINE: Y=800, TYPE=speed-zone, LABEL=SALIDA CONTROL, INFRACTION=SPEEDING]`},"level-crossing":{lines:[{y:350,type:"stop",direction:"bidirectional",label:"PASO A NIVEL (N1)",infractionType:"STOP_VIOLATION"},{y:600,type:"pedestrian",direction:"bidirectional",label:"ZONA DE RIESGO",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO PASO A NIVEL:
1. Auditora de paso con seales acsticas/pticas activas.
2. Sancionar detencin sobre la va frrea.
3. Verificar visibilidad y comportamiento preventivo.`},"mountain-pass":{lines:[{y:450,type:"solid",direction:"bidirectional",label:"EJE CURVA PELIGROSA",infractionType:"LINE_CROSSING"},{y:700,type:"speed-zone",direction:"bidirectional",label:"RADAR BAJADA (Z1)",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO PUERTO DE MONTAA:
1. Sancionar invasin de carril contrario en curvas sin visibilidad.
2. Control del uso de freno motor (velocidad en descenso).
3. Vigilancia de adelantamientos en zonas de baja adherencia.`},"pedestrian-priority-zone":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"ZONA RESIDENCIAL (A1)",infractionType:"PEDESTRIAN_PRIORITY"},{y:550,type:"loading-zone",direction:"bidirectional",label:"REA CARGA CASCO (C1)",infractionType:"LOADING_ZONE_VIOLATION"}],directivesTemplate:`PROTOCOLO CASCO HISTRICO:
1. Prioridad absoluta al peatn sobre cualquier vehculo.
2. Control de tiempo en zonas de carga/descarga.
3. Sancionar acceso de vehculos no autorizados (R.E.S.).`},"es-autovia-nacional":{lines:[{y:300,type:"speed-zone",direction:"northbound",label:"RADAR A-X (120)",infractionType:"SPEEDING"},{y:500,type:"divider",direction:"bidirectional",label:"MEDIANA BARRERA",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO RED DE CARRETERAS DEL ESTADO (RCE):
1. Control estricto 120km/h.
2. Vigilar uso carril izquierdo/central (Sndrome del carril izquierdo).
3. [LINE: Y=800, TYPE=solid, LABEL=LNEA ARCN, INFRACTION=LINE_CROSSING]`},"es-convencional-ancha":{lines:[{y:450,type:"solid",direction:"bidirectional",label:"EJE CONVENCIONAL I",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO CARRETERA CONVENCIONAL ANCHA (Arcn > 1.5m):
1. Lmite general 90km/h.
2. Vigilancia extrema en cruces al mismo nivel.
3. Control de adelantamientos en tramos de visibilidad reducida.`},"es-convencional-estrecha":{lines:[{y:500,type:"solid",direction:"bidirectional",label:"EJE CONVENCIONAL II",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO CARRETERA CONVENCIONAL ESTRECHA (Sin Arcn):
1. Lmite 90km/h con precaucin especial.
2. Vigilar invasin de carril en curvas sin arcn.
3. [LINE: Y=700, TYPE=speed-zone, LABEL=CONTROL VELOCIDAD REDUCIDA, INFRACTION=SPEEDING]`},"es-via-automoviles":{lines:[{y:350,type:"divider",direction:"northbound",label:"INICIO VA AUTOMVILES",infractionType:null},{y:600,type:"solid",direction:"bidirectional",label:"MEDIANA FLEXIBLE",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO VA PARA AUTOMVILES:
1. Prohibicin vehculos traccin animal/ciclos.
2. Control de velocidad y sentido de circulacin.
3. Vigilancia de paradas en calzada.`},"es-calle-30":{lines:[{y:400,type:"speed-zone",direction:"bidirectional",label:"RADAR URBANO (30)",infractionType:"SPEEDING"},{y:600,type:"divider",direction:"bidirectional",label:"DIVISOR CARRIL NICO",infractionType:null}],directivesTemplate:`PROTOCOLO CALLE 30 (Ley 2021):
1. Lmite estricto 30km/h en va de carril nico.
2. Prioridad absoluta a peatones en toda la plataforma.
3. Vigilar uso de mviles por el conductor.`},"es-ciclocarril":{lines:[{y:450,type:"dashed",direction:"bidirectional",label:"LIMITADOR CICLOCARRIL",infractionType:null},{y:700,type:"speed-zone",direction:"bidirectional",label:"RADAR COEXISTENCIA",infractionType:"SPEEDING"}],directivesTemplate:`PROTOCOLO CICLOCARRIL / CICLOVA:
1. Seguridad Ciclista: Distancia 1.5m.
2. Velocidad mxima 30km/h.
3. Sancionar acoso a ciclistas (distancia seguridad).`},"es-supermanzana":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"ACCESO SUPERILLA",infractionType:"PEDESTRIAN_PRIORITY"},{y:600,type:"loading-zone",direction:"bidirectional",label:"CARGA VECINDAD",infractionType:"LOADING_ZONE_VIOLATION"}],directivesTemplate:`PROTOCOLO SUPERMANZANA / SMART ZONE:
1. Acceso restringido solo autorizados.
2. Velocidad residencial (10km/h).
3. Auditora de ruido y ocupacin de espacio.`},"es-rotonda-partida":{lines:[{y:300,type:"stop",direction:"bidirectional",label:"SEMFORO ROTONDA",infractionType:"STOP_VIOLATION"},{y:600,type:"divider",direction:"bidirectional",label:"FLUJO DIRECTO",infractionType:null}],directivesTemplate:`PROTOCOLO GLORIETA PARTIDA:
1. Control de giro a la izquierda condicionado.
2. Vigilancia de semforos en fase de cruce.
3. Anlisis de trayectorias en fase de Bypass.`},"es-travesia-nacional":{lines:[{y:350,type:"speed-zone",direction:"bidirectional",label:"RADAR TRAVESA (50)",infractionType:"SPEEDING"},{y:650,type:"pedestrian",direction:"bidirectional",label:"CRUCE PRINCIPAL",infractionType:"PEDESTRIAN_PRIORITY"}],directivesTemplate:`PROTOCOLO TRAVESA NACIONAL:
1. Transicin de velocidad Carretera-Urbano.
2. Sancionar estacionamientos impropios que obstruyan visibilidad.
3. [LINE: Y=800, TYPE=stop, LABEL=SEMFORO TRAVESA, INFRACTION=STOP_VIOLATION]`},"madrid-regional-highway":{lines:[{y:350,type:"speed-zone",direction:"northbound",label:"RADAR REGIONAL (M-607)",infractionType:"SPEEDING"},{y:550,type:"divider",direction:"bidirectional",label:"MEDIANA NEW JERSEY",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO RED AUTONMICA MADRID (M-607/M-506):
1. Control de velocidad variable segn densidad.
2. Vigilar uso de arcenes en retenciones.
3. Sancionar circulacin de vehculos no autorizados en bus-vao si aplica.`},"madrid-convencional-cm":{lines:[{y:400,type:"solid",direction:"bidirectional",label:"EJE M-501 / M-100",infractionType:"LINE_CROSSING"},{y:650,type:"dashed",direction:"bidirectional",label:"ZONA ADELANTAMIENTO",infractionType:null}],directivesTemplate:`PROTOCOLO CARRETERA CONVENCIONAL CM:
1. Vigilancia extrema de adelantamientos en lnea continua.
2. Control de velocidad en intersecciones al mismo nivel.
3. [LINE: Y=800, TYPE=stop, LABEL=STOP INCORPORACIN, INFRACTION=STOP_VIOLATION]`},"madrid-calle30-tunnel":{lines:[{y:300,type:"speed-zone",direction:"bidirectional",label:"RADAR CALLE 30 (70KM/H)",infractionType:"SPEEDING"},{y:500,type:"solid",direction:"bidirectional",label:"CARRIL CONFINADO",infractionType:"LINE_CROSSING"},{y:700,type:"divider",direction:"bidirectional",label:"DIVERGENCIA SALIDA",infractionType:null}],directivesTemplate:`PROTOCOLO CALLE 30 / TNEL URBANO:
1. Lmite estricto 70km/h.
2. Sancionar cambios de carril en tramos de lnea continua (tnel).
3. Deteccin de paradas por avera o emergencia (Protocolo Tnel).`},"madrid-zbe-enforcement":{lines:[{y:300,type:"pedestrian",direction:"bidirectional",label:"ACCESO ZBE MADRID",infractionType:"PEDESTRIAN_PRIORITY"},{y:600,type:"loading-zone",direction:"bidirectional",label:"CONTROL ETIQUETA",infractionType:"FORENSIC_PRIORITY"}],directivesTemplate:`PROTOCOLO ZBE MADRID CENTRAL:
1. Auditora forense de etiquetas ambientales.
2. Control de acceso de vehculos no autorizados.
3. Vigilancia de uso de carriles exclusivos residentes.`},"madrid-travesia-local":{lines:[{y:250,type:"speed-zone",direction:"bidirectional",label:"RADAR TRAVESA 30/50",infractionType:"SPEEDING"},{y:500,type:"pedestrian",direction:"bidirectional",label:"PASO URBANO (P1)",infractionType:"PEDESTRIAN_PRIORITY"},{y:750,type:"stop",direction:"bidirectional",label:"SEMFORO FOTO-ROJO",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO TRAVESA CM:
1. Control de velocidad en zona urbana de carretera provincial.
2. Prioridad peatonal en arterias principales del municipio.
3. Sancionar rebasamiento de semforo en fase roja.`},"intersection-ddi":{lines:[{y:300,type:"solid",direction:"bidirectional",label:"CRUCE DDI (SENTIDO INVERSO)",infractionType:"DIRECTION_VIOLATION"},{y:600,type:"divider",direction:"bidirectional",label:"CANALIZADOR DDI",infractionType:null}],directivesTemplate:`PROTOCOLO DDI (Diverging Diamond Interchange):
1. Vigilancia de flujo en sentido inverso (caracterstico DDI).
2. Control de semforos en puntos de cruce X.
3. Sancionar invasin de canalizadores de giro.`},"intersection-spui":{lines:[{y:500,type:"stop",direction:"bidirectional",label:"PUNTO NICO DE CONTROL",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO SPUI (Single-Point Urban Interchange):
1. Auditora de giros a la izquierda simultneos.
2. Control de despeje de interseccin en fase nica.
3. [LINE: Y=800, TYPE=divider, LABEL=ZONA TRENZADO SPUI, INFRACTION=null]`},"intersection-turbo-roundabout":{lines:[{y:350,type:"solid",direction:"bidirectional",label:"DELIMITADOR ESPIRAL",infractionType:"LINE_CROSSING"},{y:650,type:"solid",direction:"bidirectional",label:"CARRIL CONFINADO TURBO",infractionType:"LINE_CROSSING"}],directivesTemplate:`PROTOCOLO TURBO-ROTONDA:
1. Sancionar cambio de carril entre espirales (Lnea Continua Obligatoria).
2. Control de entrada segn eleccin de carril previa.
3. Vigilancia de trazada espiral descendente.`},"intersection-cfi":{lines:[{y:200,type:"stop",direction:"bidirectional",label:"PRE-CRUCE CFI",infractionType:"STOP_VIOLATION"},{y:400,type:"solid",direction:"bidirectional",label:"CARRIL DESPLAZADO",infractionType:"DIRECTION_VIOLATION"}],directivesTemplate:`PROTOCOLO CFI (Continuous Flow Interchange):
1. Vigilancia de carriles de giro desplazados.
2. Control de coordinacin de fases en stop intermedio.
3. Sancionar incorporacin tarda al carril CFI.`},"intersection-box-junction":{lines:[{y:300,type:"divider",direction:"bidirectional",label:"YELLOW BOX NORTE",infractionType:"FORENSIC_PRIORITY"},{y:700,type:"divider",direction:"bidirectional",label:"YELLOW BOX SUR",infractionType:"FORENSIC_PRIORITY"}],directivesTemplate:`PROTOCOLO BOX JUNCTION (Anti-Bloqueo):
1. Sancionar entrada en rea amarilla sin salida libre.
2. Auditora de tiempo de permanencia en interseccin.
3. Deteccin de colapso por bloqueo transversal.`},"intersection-stack":{lines:[{y:400,type:"divider",direction:"northbound",label:"RAMAL NIVEL +1",infractionType:null},{y:600,type:"divider",direction:"northbound",label:"RAMAL NIVEL +2",infractionType:null}],directivesTemplate:`PROTOCOLO STACK INTERCHANGE (Multinivel):
1. Control de velocidad en ramales de gran altura.
2. Vigilancia de cambios de carril en zonas de convergencia de niveles.
3. Auditora de flujo masivo direccional.`},"intersection-magic-roundabout":{lines:[{y:300,type:"roundabout-access",direction:"bidirectional",label:"MICRO-ROTATOR 1",infractionType:"STOP_VIOLATION"},{y:600,type:"roundabout-access",direction:"bidirectional",label:"MICRO-ROTATOR 2",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO MAGIC ROUNDABOUT (Multi-Rotonda):
1. Complejidad Mxima: Vigilancia en micro-rotondas perifricas.
2. Control de giro inverso en el anillo central.
3. Anlisis de prioridades en mltiples puntos de decisin.`},"intersection-dumbbell":{lines:[{y:300,type:"stop",direction:"bidirectional",label:"ROTONDA A",infractionType:"STOP_VIOLATION"},{y:700,type:"stop",direction:"bidirectional",label:"ROTONDA B",infractionType:"STOP_VIOLATION"}],directivesTemplate:`PROTOCOLO DUMBBELL INTERCHANGE:
1. Control de sincronizacin entre rotondas gemelas.
2. Vigilancia de congestin en el puente de enlace.
3. Sancionar giros prohibidos en ramales de conexin.`},custom:{lines:[],directivesTemplate:`PROTOCOLO PERSONALIZADO:
Defina sus propias directivas. Use el formato [LINE: Y=500, TYPE=solid, LABEL=LNEA N...] para crear zonas dinmicas.`}},nt=We.useCallback((ie,we)=>{const J=[...we],Ye=/\[LINE:\s*Y=(\d+),\s*TYPE=([^,\]\s]+),\s*LABEL=([^,\]]+)(?:,\s*INFRACTION=([^,\]\s]+))?\]/gi;let kt;for(;(kt=Ye.exec(ie))!==null;){const[,Le,Yt,Rt,Wt]=kt;J.push({y:parseInt(Le),type:Yt.trim(),direction:"bidirectional",label:Rt.trim(),infractionType:(Wt==null?void 0:Wt.trim())||null})}const Ft=ie.toLowerCase();[{keywords:["continua","lnea continua","cruce de lnea","line crossing"],line:{y:500,type:"solid",label:"AUTO: LNEA CONTINUA",infraction:"LINE_CROSSING"}},{keywords:["stop","detencin","alto","parada obligatoria"],line:{y:400,type:"stop",label:"AUTO: STOP",infraction:"STOP_VIOLATION"}},{keywords:["peatones","paso de peatones","cebra","pedestrian"],line:{y:600,type:"pedestrian",label:"AUTO: PASO PEATONES",infraction:"PEDESTRIAN_ZONE"}},{keywords:["bus","carril bus","bus lane"],line:{y:450,type:"bus-lane",label:"AUTO: CARRIL BUS",infraction:"BUS_LANE_VIOLATION"}},{keywords:["carga","descarga","loading","zona de carga"],line:{y:550,type:"loading-zone",label:"AUTO: ZONA CARGA",infraction:"LOADING_ZONE"}},{keywords:["velocidad","radar","speed","exceso"],line:{y:350,type:"speed-zone",label:"AUTO: CONTROL VELOCIDAD",infraction:"SPEEDING"}},{keywords:["divisoria","carril","lane","divider"],line:{y:500,type:"divider",label:"AUTO: DIVISORIA CARRIL",infraction:null}},{keywords:["incorporacin","entrada","access","ramal"],line:{y:300,type:"dashed",label:"AUTO: INCORPORACIN",infraction:null}}].forEach((Le,Yt)=>{if(Le.keywords.some(Wt=>Ft.includes(Wt))){const Wt=Yt*50,gn={y:Le.line.y+Wt,type:Le.line.type,direction:"bidirectional",label:Le.line.label,infractionType:Le.line.infraction};J.some(mi=>mi.label===gn.label||Math.abs(mi.y-gn.y)<30&&mi.type===gn.type)||J.push(gn)}});const De=ie.match(/(\d+)\s*(carriles|lanes|vas)/gi);if(De&&De.length>0){const Le=parseInt(De[0]);if(Le>=2&&Le<=4){const Yt=1e3/(Le+1);for(let Rt=1;Rt<=Le;Rt++){const Wt=Math.floor(Yt*Rt);J.some(la=>Math.abs(la.y-Wt)<50)||J.push({y:Wt,type:"divider",direction:"bidirectional",label:`AUTO: CARRIL ${Rt}`,infractionType:null})}}}return J.filter((Le,Yt,Rt)=>Rt.findIndex(Wt=>Wt.y===Le.y&&Wt.label===Le.label)===Yt)},[]),yt=We.useCallback(ie=>{let we=[];return ie.forEach(J=>{cn[J]&&(we=[...we,...cn[J].lines])}),we},[]),Bt=We.useCallback((ie,we)=>{let J=[],Ye="";ie.forEach(Ft=>{const Et=cn[Ft];Et&&(J=[...J,...Et.lines],Ye+=(Ye?`

`:"")+Et.directivesTemplate)});const kt=nt(Ye,J);je(kt),E(Ye),I(`SINCRONIZACIN MULTI-PROTOCOLO: ${ie.length} ACTIVOS`),setTimeout(()=>I(null),3e3)},[nt]),ei=ie=>{te(we=>{let J;if(we.includes(ie)){if(we.length===1)return we;J=we.filter(Ye=>Ye!==ie)}else J=[...we,ie];return Bt(J,b),J})};We.useEffect(()=>{if(!de&&b){const ie=yt(q),we=nt(b,ie);je(we),console.log(` AUTO-SYNTHESIS: Generated ${we.filter(J=>J.label.startsWith("AUTO:")).length} smart lines`)}},[b,q,de,nt,yt]);const Ot=We.useRef(null),pi=We.useRef(null),Dt=We.useRef([]),Nn=We.useRef(null),tn=We.useRef(null),Ii=We.useRef(!1),ka=We.useRef(Date.now()),za=We.useRef(30),Gt=ie=>{const we=ie.target.value;if(E(we),cn[q[0]]){const Ye=nt(we,yt(q));je(Ye)}I("ACTUALIZANDO CRITERIOS DE ANLISIS... SINCRONIZANDO CON RED NEURONAL"),setTimeout(()=>I(null),3e3)};We.useEffect(()=>{const ie=setInterval(()=>{se(we=>({...we,cpu:Math.floor(20+Math.random()*15),mem:Number((1.1+Math.random()*.3).toFixed(1)),temp:Math.floor(40+Math.random()*5),net:Math.floor(80+Math.random()*10)}))},2e3);return()=>clearInterval(ie)},[]);const vt=async()=>{if(Ot.current)try{await Ot.current.play(),o(!0)}catch(ie){ie.name!=="AbortError"&&console.error("Playback error:",ie)}},La=()=>{Ot.current&&(Ot.current.pause(),o(!1))};We.useEffect(()=>{(async()=>{try{const we=new pk;await we.load("/SENTINELV15/upload/yolo11n_640.onnx","/SENTINELV15/upload/yolo11n_pose.onnx"),Nn.current=we,j.trackerType==="BoT-SORT"?tn.current=new _h:tn.current=new fk,console.log(`YOLOv11 + ${j.trackerType} system initialized`)}catch(we){console.error("YOLO Load Error",we)}})()},[j.trackerType]),We.useEffect(()=>{n&&e==="upload"&&Ot.current&&(Ot.current.src=n,Ot.current.load(),Ot.current.onloadeddata=()=>vt())},[n,e]);const Sr=async(ie=5e3)=>new Promise(we=>{if(!pi.current)return we("");const J=pi.current.captureStream(30),Ye=new MediaRecorder(J,{mimeType:"video/webm"}),kt=[];Ye.ondataavailable=Ft=>kt.push(Ft.data),Ye.onstop=()=>{const Ft=new Blob(kt,{type:"video/webm"});we(URL.createObjectURL(Ft))},Ye.start(),setTimeout(()=>Ye.stop(),ie)}),Ri=async ie=>{var we;if(!Ii.current){Ii.current=!0,d(!0),f("FORENSIC ANALYSIS: DAGANZO_POLICE_ALGO ACTIVE...");try{const J=new xO({apiKey:"AIzaSyAIYIVAWrFRY1-m4owryfuQ025VKVJ-QqQ"}),Ye=`Eres el AUDITOR FORENSE SUPREMO asignado a la Polica Local de Daganzo de Arriba.
      
      ESPECIFICACIONES TCNICAS DEL SISTEMA (SENTINEL V15 - ARQUITECTURA HBRIDA EDGE+CLOUD):
      1. Capa Local (Edge Computing): YOLOv11n (ONNX) + ByteTrack para seguimiento de alta precisin en tiempo real.
         - Modelo de Deteccin: YOLO11-Nano (640640px) corriendo en WebAssembly SIMD
         - Tracker: ByteTrack con Filtro de Kalman de 8 estados [cx, cy, rea, altura, vx, vy, va, vh]
         - Coincidencia: Algoritmo Hngaro con IoU threshold = ${j.matchIouThreshold}
         - Configuracin Activa: ${$e} 
           * Umbral Conf. YOLO: ${j.confThreshold}
           * Skip de Frames: ${j.detectionSkip}
           * Buffer de Track: ${j.trackBufferFrames} frames
           * High Det. Threshold: ${j.highDetThreshold}
         - Suavizado: Filtro de Kalman con constante de velocidad y correccin por medicin
      2. Capa Remota (Cloud Judiciary - TU ROL): Juicio legal definitivo de la escena basado en evidencia visual multiplexada y las directivas municipales de Daganzo.
      3. Geometra Espacial: Sistema de coordenadas normalizado (0-1000) con lneas de deteccin en eje Y.
      
      DATOS DEL VEHCULO ANALIZADO:
      - Track ID: ${ie.id}
      - Edad del Track: ${ie.age} frames
      - Confianza Media: ${ie.confidence.toFixed(3)}
      - Velocidad Estimada: ${Math.floor(ie.velocity*3.6)} km/h (basado en desplazamiento entre frames)
      - Clase Detectada: ${ie.label}
      - Estado Infractor: ${ie.isInfractor?"CONFIRMADO (cruce de lnea detectado)":"En evaluacin"}
      
      INSTRUCCIONES DE ANLISIS:
      Analiza la rfaga de imgenes forenses para determinar si existe infraccin de trfico siguiendo ESTRICTAMENTE estas directivas municipales de Daganzo:
      "${b}"
      
      SALIDA JSON OBLIGATORIA (NO OTROS FORMATOS):
      {
        "infraction": boolean,
        "plate": "MATRCULA",
        "ocrConfidence": 0.95,
        "description": "Relato tcnico detallado de la infraccin segn directivas, incluyendo evidencia visual especfica observada",
        "severity": "leve|grave|muy-grave",
        "legalArticle": "Artculo especfico del cdigo de circulacin espaol",
        "reasoning": ["Evidencia visual 1", "Evidencia visual 2", "Inferencia tcnica"],
        "vehicleType": "Descripcin visual del vehculo (marca, modelo, color)",
        "subType": "turismo|furgoneta|camin|moto|bus",
        "confidence": 0.98,
        "telemetry": { 
          "speedEstimated": "${Math.floor(ie.velocity*3.6)} km/h", 
          "trackAge": "${ie.age} frames",
          "yoloConfidence": "${ie.confidence.toFixed(3)}",
          "maneuverType": "Giro/Cruce/Adelantamiento/Recto",
          "poseAlert": boolean
        }
      }`,kt=Sr(1e4),Ft=ie.snapshots.map(Rt=>({inlineData:{mimeType:"image/jpeg",data:Rt}})),Et=await J.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[...Ft,{text:"Ejecutar auditora forense inmediata basada en directivas de Daganzo."}]},config:{systemInstruction:Ye,responseMimeType:"application/json",temperature:.1}}),De=JSON.parse(((we=Et.text.trim().match(/\{[\s\S]*\}/))==null?void 0:we[0])||"{}"),Le=await kt,Yt=Dt.current.findIndex(Rt=>Rt.id===ie.id);Yt!==-1&&(Dt.current[Yt].plate=De.plate,Dt.current[Yt].isInfractor=De.infraction,Dt.current[Yt].analyzed=!0),De.infraction&&(K(Rt=>Rt+1),R(Rt=>[{...De,id:Date.now(),image:`data:image/jpeg;base64,${ie.snapshots[ie.snapshots.length-1]}`,snapshots:ie.snapshots,videoUrl:Le,time:new Date().toLocaleTimeString(),date:new Date().toLocaleDateString(),violatedDirective:b,telemetry:{...De.telemetry,framesAnalyzed:ie.points.length}},...Rt]))}catch(J){console.error("Forensic Hub Error:",J)}finally{d(!1),f(null),Ii.current=!1}}},ti=We.useCallback(async()=>{var mi,Ua;if(!Ot.current||!pi.current||!Nn.current||!tn.current)return;const ie=Ot.current,we=pi.current,J=we.getContext("2d");if(!J||ie.readyState<2)return;const Ye=Date.now(),kt=Ye-ka.current;if(kt>0){const ye=Math.round(1e3/kt);_(ye),za.current=ye}ka.current=Ye,we.width=((mi=we.parentElement)==null?void 0:mi.clientWidth)||0,we.height=((Ua=we.parentElement)==null?void 0:Ua.clientHeight)||0;const Ft=Math.min(we.width/ie.videoWidth,we.height/ie.videoHeight),Et=ie.videoWidth*Ft,De=ie.videoHeight*Ft,Le=(we.width-Et)/2,Yt=(we.height-De)/2;if(J.clearRect(0,0,we.width,we.height),!s)return;de&&pi.current&&(J.strokeStyle="rgba(34, 211, 238, 0.5)",J.setLineDash([5,5]),J.beginPath(),J.moveTo(Le,0),J.lineTo(Le+Et,0),J.setLineDash([])),Ee.current++;let Rt=[];const Wt=Ee.current%j.detectionSkip===0;Wt&&(Rt=await Nn.current.detect(ie,j.confThreshold),ve&&Nn.current.poseSession?H.current=await Nn.current.detectPose(ie,.5):H.current=[]),tn.current&&(tn.current.highThresh=j.highDetThreshold,tn.current.matchThresh=j.matchIouThreshold,tn.current.trackBufferFrames=j.trackBufferFrames,tn.current instanceof _h&&(tn.current.appearanceWeight=j.appearanceWeight));let gn=[];if(Wt&&Nn.current){tn.current instanceof _h?gn=tn.current.update(Rt,ie):gn=tn.current.update(Rt);const ye=[],zt=new Set;gn.forEach(at=>{zt.add(at.trackId);let Ue=Dt.current.find(On=>On.id===at.trackId);const $n=ie.videoWidth||1280,Nt=ie.videoHeight||720,qe=(at.bbox[0]+at.bbox[2]/2)/$n*1e3,Ke=(at.bbox[1]+at.bbox[3]/2)/Nt*1e3,et=at.bbox[2]/$n*1e3,Xt=at.bbox[3]/Nt*1e3;Ue||(Ue={id:at.trackId,label:at.className,points:[],lastSeen:Ye,lastSnapshotTime:0,color:yk[at.className]||"#fff",snapshots:[],velocity:0,age:at.age,analyzed:!1,vx:0,vy:0,predictedX:qe,predictedY:Ke,confidence:at.score,missedFrames:0,w:et,h:Xt,renderX:qe,renderY:Ke,renderW:et,renderH:Xt,isInfractor:!1});const Mn=.6;if(Ue.renderX=Ue.renderX*Mn+qe*(1-Mn),Ue.renderY=Ue.renderY*Mn+Ke*(1-Mn),Ue.renderW=Ue.renderW*Mn+et*(1-Mn),Ue.renderH=Ue.renderH*Mn+Xt*(1-Mn),Ue.lastSeen=Ye,Ue.points.push({x:qe,y:Ke,time:Ye}),Ue.w=et,Ue.h=Xt,Ue.confidence=at.score,Ue.age=at.age,Ue.points.length>1){const On=Ue.points[Ue.points.length-1],pn=Ue.points[Ue.points.length-2];Ue.vx=On.x-pn.x,Ue.vy=On.y-pn.y,Ue.velocity=Math.sqrt(Ue.vx*Ue.vx+Ue.vy*Ue.vy)}Ue.points.length>50&&Ue.points.shift(),ye.push(Ue)}),Dt.current=ye}else Dt.current.forEach(ye=>{if(ye.points.length>0){const zt=ye.points[ye.points.length-1];ye.renderX+=ye.vx,ye.renderY+=ye.vy,ye.points.push({x:zt.x+ye.vx,y:zt.y+ye.vy,time:Ye}),ye.points.length>50&&ye.points.shift()}if(ye.points.length>2){const zt=ye.points[ye.points.length-1],at=ye.points[ye.points.length-3],$n=40+Math.max(0,Math.min(1,(ye.renderY-300)/700))*110,Nt=zt.x-at.x,qe=zt.y-at.y,et=Math.sqrt(Nt*Nt+qe*qe)/$n*(za.current/2)*3.6;ye.velocity=(ye.velocity||et)*.8+et*.2,ye.vx=(zt.x-at.x)/2,ye.vy=(zt.y-at.y)/2}!G.current.has(ye.id)&&ye.age>10&&ye.confidence>.4&&(G.current.add(ye.id),P(zt=>zt+1))});const la=new Set(Dt.current.map(ye=>ye.id));if(Dt.current.forEach(ye=>{var Pa;if(ye.points.length===0||ye.age<4||ye.confidence<.25)return;const zt=ye.points[ye.points.length-1],at=ye.renderW,Ue=ye.renderH,$n=ye.renderX-at/2,Nt=ye.renderY-Ue/2,qe=Le+$n/1e3*Et,Ke=Yt+Nt/1e3*De,et=at/1e3*Et,Xt=Ue/1e3*De,Mn=ye.velocity/gk,On=Math.floor(Mn*za.current*3.6);let pn=ye.confidence;ye.age>5?pn=Math.max(.95,ye.confidence):pn=Math.max(.7,ye.confidence);const Zi=ye.isInfractor;if(J.globalAlpha=pn,Zi){const St=Math.sin(Date.now()/100)*2;J.shadowColor="#ef4444",J.shadowBlur=30,J.shadowOffsetX=0,J.shadowOffsetY=0,J.strokeStyle="#ef4444",J.lineWidth=5,J.strokeRect(qe+St,Ke+St,et,Xt),J.strokeStyle="#dc2626",J.lineWidth=2,J.strokeRect(qe-3+St,Ke-3+St,et+6,Xt+6),J.shadowBlur=0;const Zt=15;J.strokeStyle="#fca5a5",J.lineWidth=3,J.beginPath(),J.moveTo(qe,Ke+Zt),J.lineTo(qe,Ke),J.lineTo(qe+Zt,Ke),J.stroke(),J.beginPath(),J.moveTo(qe+et-Zt,Ke),J.lineTo(qe+et,Ke),J.lineTo(qe+et,Ke+Zt),J.stroke(),J.beginPath(),J.moveTo(qe+et,Ke+Xt-Zt),J.lineTo(qe+et,Ke+Xt),J.lineTo(qe+et-Zt,Ke+Xt),J.stroke(),J.beginPath(),J.moveTo(qe+Zt,Ke+Xt),J.lineTo(qe,Ke+Xt),J.lineTo(qe,Ke+Xt-Zt),J.stroke(),J.fillStyle="#dc2626",J.fillRect(qe,Ke-24,et,22),J.fillStyle="#ffffff",J.font="bold 11px monospace",J.fillText(` INFRACCIN | ${ye.plate||"ANALYZING"} | ${On} KM/H`,qe+5,Ke-7)}else J.strokeStyle=ye.color,J.lineWidth=2,J.strokeRect(qe,Ke,et,Xt),J.fillStyle=ye.color,J.fillRect(qe,Ke-20,et,18),J.fillStyle="#000",J.font="bold 10px monospace",J.fillText(`${(ye.subType||ye.label).toUpperCase()} | ${On} KM/H`,qe+5,Ke-7);if(J.globalAlpha=1,ye.points.length>=2){const St=ye.points[ye.points.length-2],Zt=ye.points[ye.points.length-1];Be.forEach(yn=>{if((St.y<yn.y&&Zt.y>=yn.y||St.y>yn.y&&Zt.y<=yn.y)&&!ye.isInfractor){const rn={solid:"CRUCE_LINEA_CONTINUA",stop:"NO_DETENCION_STOP",pedestrian:"INVASION_PASO_PEATONES","bus-lane":"CIRCULACION_CARRIL_BUS","loading-zone":"ESTACIONAMIENTO_ZONA_CARGA","speed-zone":"EXCESO_VELOCIDAD"}[yn.type]||"INFRACCION_GENERICA";console.log(` INFRACCIN DETECTADA: Track ${ye.id} cruz lnea "${yn.label}" (${rn})`),ye.snapshots.length>=5&&ye.age>15&&!ye.analyzed&&(ye.isInfractor=!0,setTimeout(()=>Ri(ye),100))}})}if(la.has(ye.id)&&Ye-ye.lastSnapshotTime>150&&ye.snapshots.length<25&&ye.confidence>.65){const St=document.createElement("canvas");St.width=400,St.height=300;const Zt=zt.x/1e3*ie.videoWidth-40,yn=zt.y/1e3*ie.videoHeight-40;(Pa=St.getContext("2d"))==null||Pa.drawImage(ie,Zt,yn,80,80,0,0,400,300),ye.snapshots.push(St.toDataURL("image/jpeg",.65).split(",")[1]),ye.lastSnapshotTime=Ye}ye.age===50&&!ye.analyzed&&!Ii.current&&ye.confidence>.8&&!ye.isInfractor&&Ri(ye)}),J.save(),Be.forEach((ye,zt)=>{const at=Yt+ye.y/1e3*De;switch(ye.type){case"solid":J.strokeStyle="#ef4444",J.lineWidth=4,J.setLineDash([]);break;case"stop":J.strokeStyle="#dc2626",J.lineWidth=6,J.setLineDash([]);break;case"pedestrian":J.strokeStyle="#22d3ee",J.lineWidth=8,J.setLineDash([30,20]);break;case"bus-lane":J.strokeStyle="#f59e0b",J.lineWidth=5,J.setLineDash([]);break;case"loading-zone":J.strokeStyle="#a855f7",J.lineWidth=3,J.setLineDash([10,10]);break;case"speed-zone":J.strokeStyle="#22c55e",J.lineWidth=2,J.setLineDash([2,5]);break;case"dashed":J.strokeStyle="#f59e0b",J.lineWidth=2,J.setLineDash([15,10]);break;default:J.strokeStyle="#06b6d4",J.lineWidth=2,J.setLineDash([10,5]);break}if(J.globalAlpha=ye.type==="solid"||ye.type==="stop"?.8:ye.label.startsWith("GRID_")||ye.label.startsWith("PERSP_")?.15:.5,ye.x1!==void 0&&ye.y2!==void 0&&ye.x2!==void 0){const Ue=Le+ye.x1/1e3*Et,$n=Yt+ye.y/1e3*De,Nt=Le+ye.x2/1e3*Et,qe=Yt+ye.y2/1e3*De;J.beginPath(),J.moveTo(Ue,$n),J.lineTo(Nt,qe),J.stroke()}else if(J.beginPath(),J.moveTo(0,at),J.lineTo(we.width,at),J.stroke(),!ye.label.startsWith("GRID_")&&!ye.label.startsWith("PERSP_")){J.setLineDash([]),J.lineWidth=2;for(let Ue=0;Ue<we.width;Ue+=120)J.beginPath(),J.moveTo(Ue,at-6),J.lineTo(Ue,at+6),J.stroke()}!ye.label.startsWith("GRID_")&&!ye.label.startsWith("PERSP_")&&(J.fillStyle=J.strokeStyle,J.font="bold 10px monospace",J.globalAlpha=.9,J.fillText(ye.label,15,at-12))}),ve&&H.current.length>0){const ye=H.current,zt=Ue=>Le+Ue/ie.videoWidth*Et,at=Ue=>Yt+Ue/ie.videoHeight*De;J.lineWidth=2,J.strokeStyle="#c084fc",ye.forEach(Ue=>{const $n=[[15,13],[13,11],[16,14],[14,12],[11,12],[5,11],[6,12],[5,6],[5,7],[6,8],[7,9],[8,10],[1,2],[0,1],[0,2],[1,3],[2,4],[3,5],[4,6]];J.beginPath(),$n.forEach(([Nt,qe])=>{const Ke=Ue.keypoints[Nt],et=Ue.keypoints[qe];Ke&&et&&Ke.score>.5&&et.score>.5&&(J.moveTo(zt(Ke.x),at(Ke.y)),J.lineTo(zt(et.x),at(et.y)))}),J.stroke(),J.fillStyle="#f0abfc",Ue.keypoints.forEach(Nt=>{Nt.score>.5&&(J.beginPath(),J.arc(zt(Nt.x),at(Nt.y),3,0,2*Math.PI),J.fill())})})}J.restore(),Dt.current=Dt.current.filter(ye=>ye.missedFrames<Math.max(30,j.trackBufferFrames)&&ye.confidence>.01)},[s,Be,j]);We.useEffect(()=>{let ie;const we=()=>{ti(),ie=requestAnimationFrame(we)};return we(),()=>cancelAnimationFrame(ie)},[ti]);const Xi=async()=>{try{const ie=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:1280,height:720}});Ot.current&&(Ot.current.srcObject=ie,Ot.current.onloadedmetadata=()=>{vt(),t("live")})}catch{alert("Error de cmara.")}};return L.jsxs("div",{className:"h-screen w-screen bg-[#020617] text-slate-100 flex flex-col lg:flex-row overflow-hidden font-sans select-none",children:[L.jsxs("aside",{className:"hidden lg:flex w-96 border-r border-white/5 flex-col z-50 bg-[#020617]/98 backdrop-blur-2xl overflow-y-auto custom-scrollbar",children:[L.jsxs("div",{className:"p-8 border-b border-white/5 flex items-center gap-4",children:[L.jsx("div",{className:"w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center border border-cyan-500/30 shadow-neon",children:L.jsx(UO,{className:"text-cyan-500 w-6 h-6 animate-pulse"})}),L.jsxs("div",{className:"flex flex-col",children:[L.jsx("span",{className:"text-xl font-black italic tracking-tighter text-white uppercase leading-none",children:"SENTINEL"}),L.jsx("span",{className:"text-[10px] font-black tracking-[0.5em] text-cyan-500/80 uppercase whitespace-nowrap",children:"POLICA LOCAL DAGANZO"})]})]}),L.jsxs("div",{className:"flex-1 p-6 space-y-8",children:[L.jsxs("div",{className:"space-y-4",children:[L.jsxs("h3",{className:"text-[11px] font-black uppercase text-slate-500 tracking-widest flex items-center gap-2 px-2",children:[L.jsx($O,{size:12,className:"text-cyan-500"})," NEURAL TRACKING CORE"]}),L.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(ge).map(ie=>{const we=ge[ie],J={"highway-fast-bytetrack":{icon:"",name:"Autopista",color:"amber"},"urban-balanced-bytetrack":{icon:"",name:"Urbano",color:"cyan"},"precision-slow-botsort":{icon:"",name:"Precisin",color:"purple"},"forensic-reID-botsort":{icon:"",name:"Forense",color:"pink"}}[ie]||{icon:"",name:"Custom",color:"gray"},Ye=$e===ie;return L.jsxs("button",{onClick:()=>{Ae(ie),fe(ge[ie])},className:`p-2 rounded-xl border transition-all flex flex-col items-center justify-center gap-1 relative ${Ye?`bg-${J.color}-500/20 border-${J.color}-500/50 text-${J.color}-400 shadow-[0_0_15px_rgba(var(--${J.color}-500-rgb),0.2)]`:"bg-slate-900/40 border-white/5 text-slate-500 hover:border-white/20 hover:bg-slate-900/80"}`,children:[L.jsx("span",{className:"text-lg filter drop-shadow-md",children:J.icon}),L.jsx("span",{className:"text-[10px] font-black uppercase tracking-tight",children:J.name}),L.jsx("span",{className:`text-[7px] font-mono px-1.5 rounded-full ${we.trackerType==="BoT-SORT"?"bg-purple-950/50 text-purple-300":"bg-cyan-950/50 text-cyan-300"}`,children:we.trackerType==="BoT-SORT"?"BoT-SORT":"ByteTrack"}),Ye&&L.jsx(A_,{size:10,className:`absolute top-2 right-2 text-${J.color}-400`})]},ie)})})]}),L.jsxs("div",{className:"bg-slate-900/40 rounded-2xl p-4 space-y-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-300 uppercase tracking-wide",children:[L.jsx("span",{children:" YOLO Confidence"}),L.jsx("span",{className:"text-cyan-400 font-mono",children:j.confThreshold.toFixed(2)})]}),L.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:j.confThreshold,onChange:ie=>fe(we=>({...we,confThreshold:parseFloat(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),L.jsxs("div",{className:"space-y-1",children:[L.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-300 uppercase tracking-wide",children:[L.jsx("span",{children:" Frame Skip"}),L.jsxs("span",{className:"text-amber-400 font-mono",children:[j.detectionSkip," F"]})]}),L.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:j.detectionSkip,onChange:ie=>fe(we=>({...we,detectionSkip:parseInt(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),L.jsxs("div",{className:"space-y-1",children:[L.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-300 uppercase tracking-wide",children:[L.jsx("span",{children:" High Det. Thr"}),L.jsx("span",{className:"text-purple-400 font-mono",children:j.highDetThreshold.toFixed(2)})]}),L.jsx("input",{type:"range",min:"0.3",max:"0.9",step:"0.05",value:j.highDetThreshold,onChange:ie=>fe(we=>({...we,highDetThreshold:parseFloat(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),L.jsxs("div",{className:"space-y-1",children:[L.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-300 uppercase tracking-wide",children:[L.jsx("span",{children:" Track Buffer"}),L.jsxs("span",{className:"text-green-400 font-mono",children:[j.trackBufferFrames," F"]})]}),L.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:j.trackBufferFrames,onChange:ie=>fe(we=>({...we,trackBufferFrames:parseInt(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-green-500"})]}),L.jsxs("div",{className:"space-y-1",children:[L.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-300 uppercase tracking-wide",children:[L.jsx("span",{children:" Match IoU"}),L.jsx("span",{className:"text-pink-400 font-mono",children:j.matchIouThreshold.toFixed(2)})]}),L.jsx("input",{type:"range",min:"0.1",max:"0.7",step:"0.05",value:j.matchIouThreshold,onChange:ie=>fe(we=>({...we,matchIouThreshold:parseFloat(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-pink-500"})]}),j.trackerType==="BoT-SORT"&&L.jsxs("div",{className:"space-y-1 pt-2 border-t border-purple-500/20",children:[L.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-purple-400 uppercase",children:[L.jsx("span",{children:" Appearance Weight"}),L.jsx("span",{className:"text-purple-300",children:j.appearanceWeight.toFixed(2)})]}),L.jsx("input",{type:"range",min:"0.0",max:"1.0",step:"0.1",value:j.appearanceWeight,onChange:ie=>fe(we=>({...we,appearanceWeight:parseFloat(ie.target.value)})),className:"w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"}),L.jsx("p",{className:"text-[7px] text-purple-400/60 mt-1",children:"Visual similarity weight"})]}),L.jsxs("div",{className:"mt-4 p-3 bg-slate-950/50 border border-white/5 rounded-xl space-y-2",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${Nn.current?"bg-green-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:"text-[8px] font-mono text-green-400 uppercase tracking-wider",children:"RADAR_ACTIVE"})]}),L.jsx(PO,{size:10,className:"text-green-400"})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${tn.current?"bg-cyan-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:"text-[8px] font-mono text-cyan-400 uppercase tracking-wider",children:"AI_CORE_SYNC"})]}),L.jsx(x_,{size:10,className:"text-cyan-400"})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${ve&&((xr=Nn.current)!=null&&xr.poseSession)?"bg-purple-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:`text-[8px] font-mono uppercase tracking-wider ${ve&&((hi=Nn.current)!=null&&hi.poseSession)?"text-purple-400":"text-slate-600"}`,children:"POSE_DETECTOR"})]}),L.jsx("button",{onClick:()=>_e(!ve),className:`px-2 py-0.5 rounded text-[7px] font-bold transition-all ${ve?"bg-purple-500/30 text-purple-300":"bg-slate-800 text-slate-500"}`,children:ve?"ON":"OFF"})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${Ie.enabled?"bg-pink-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:`text-[8px] font-mono uppercase tracking-wider ${Ie.enabled?"text-pink-400":"text-slate-600"}`,children:"MESH_GRID"})]}),L.jsx("span",{className:"text-[7px] text-slate-500 font-mono",children:Ie.gridType.toUpperCase()})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${Be.length>0?"bg-amber-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:`text-[8px] font-mono uppercase tracking-wider ${Be.length>0?"text-amber-400":"text-slate-600"}`,children:"LINE_SENSORS"})]}),L.jsx("span",{className:"text-[7px] text-amber-400 font-mono",children:Be.filter(ie=>!ie.label.startsWith("GRID_")&&!ie.label.startsWith("PERSP_")).length})]}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("div",{className:`w-2 h-2 rounded-full ${Dt.current.some(ie=>ie.snapshots&&ie.snapshots.length>0)?"bg-orange-400 animate-pulse":"bg-slate-700"}`}),L.jsx("span",{className:`text-[8px] font-mono uppercase tracking-wider ${Dt.current.some(ie=>ie.snapshots&&ie.snapshots.length>0)?"text-orange-400":"text-slate-600"}`,children:"FORENSIC_BUF"})]}),L.jsx("span",{className:"text-[7px] text-orange-400 font-mono",children:Dt.current.reduce((ie,we)=>{var J;return ie+(((J=we.snapshots)==null?void 0:J.length)||0)},0)})]})]}),L.jsxs("div",{className:"text-[8px] font-mono text-slate-500 space-y-1 pt-2 border-t border-white/5",children:[L.jsxs("div",{children:["Model: ",L.jsx("span",{className:"text-cyan-400",children:"YOLOv11-Nano (ONNX/WASM)"})]}),L.jsxs("div",{children:["Tracker: ",L.jsx("span",{className:j.trackerType==="BoT-SORT"?"text-purple-400":"text-cyan-400",children:j.trackerType})]}),L.jsxs("div",{children:["Backend: ",L.jsx("span",{className:"text-green-400",children:"WebAssembly SIMD"})]})]})]})]})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("h3",{className:"text-[12px] font-black uppercase text-slate-500 tracking-widest flex items-center gap-2",children:[L.jsx(RO,{size:14,className:"text-cyan-500"})," ANLISIS EXHAUSTIVO"]}),x&&L.jsx("span",{className:"text-[10px] font-black text-amber-500 animate-pulse uppercase tracking-tighter",children:"AI_KNOWLEDGE_SYNC"})]}),L.jsxs("div",{className:"relative",children:[L.jsx("textarea",{value:b,onChange:Gt,className:"w-full h-[400px] bg-slate-950 border border-white/10 rounded-2xl p-4 text-[12px] font-mono text-cyan-500 focus:border-cyan-500 outline-none resize-none leading-relaxed transition-all scrollbar-hide"}),L.jsx("div",{className:"absolute bottom-4 right-4 text-[11px] font-black text-cyan-500/30 font-mono tracking-widest",children:"GEMINI_OS_v3"})]}),x&&L.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl text-[9px] font-black text-amber-400 uppercase tracking-widest animate-in fade-in slide-in-from-top-2",children:x})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("h3",{className:"text-[12px] font-black uppercase text-slate-500 tracking-widest flex items-center gap-2 px-2",children:[L.jsx(OO,{size:14,className:"text-purple-500"})," STACK DE PROTOCOLO (",q.length,")"]}),L.jsx("div",{className:"bg-slate-900/50 border border-white/5 rounded-[32px] overflow-hidden",children:L.jsx("div",{className:"max-h-[350px] overflow-y-auto p-4 space-y-6 custom-scrollbar",children:[{label:"INTERSECCIONES TCNICAS",items:[{id:"intersection-ddi",label:"Diamante Divergente (DDI)",icon:"",desc:"Intercambia carriles antes del puente para eliminar giros cruzados"},{id:"intersection-spui",label:"Punto nico (SPUI)",icon:"",desc:"Un solo semforo central gestiona todos los giros"},{id:"intersection-turbo-roundabout",label:"Turbo-Rotonda",icon:"",desc:"Carriles en espiral que evitan cambios de carril dentro de la rotonda"},{id:"intersection-cfi",label:"Flujo Continuo (CFI)",icon:"",desc:"Giros a la izquierda antes de la interseccin para flujo sin paradas"},{id:"intersection-box-junction",label:"Caja Amarilla (Box)",icon:"",desc:"Zona restrictiva donde no se puede detener el vehculo"},{id:"es-rotonda-partida",label:"Glorieta Partida",icon:"",desc:"Rotonda dividida por un paso elevado o deprimido"},{id:"intersection-stack",label:"Enlace Multinivel (Stack)",icon:"",desc:"Mltiples niveles de puentes para separar totalmente los flujos"},{id:"intersection-magic-roundabout",label:"Magic Roundabout",icon:"",desc:"Varias mini-rotondas alrededor de una central en sentido contrario"},{id:"intersection-dumbbell",label:"Dumbbell (Pesa)",icon:"",desc:"Dos rotondas conectadas por un tramo recto"},{id:"t-junction-urban",label:"Interseccin en T (Urbana)",icon:"",desc:"Cruce en T con semforo y paso de peatones"},{id:"t-junction-rural",label:"Interseccin en T (Rural)",icon:"",desc:"Cruce en T sin semforo con sealizacin de prioridad"},{id:"t-junction-multi",label:"Interseccin en T (Multi)",icon:"",desc:"Cruce en T con mltiples carriles y carriles de giro dedicados"},{id:"roundabout-2lanes",label:"Rotonda Estndar",icon:"",desc:"Rotonda convencional de 2 carriles con ceda el paso"},{id:"interurban-cloverleaf",label:"Enlace Trbol",icon:"",desc:"Cuatro lazos en forma de hoja para conectar autopistas"},{id:"cross-junction-4way",label:"Interseccin en Cruz",icon:"",desc:"Cruce de 4 vas con semforos y control total"}]},{label:"RED PROVINCIAL DE CARRETERAS",items:[{id:"es-convencional-ancha",label:"Convencional (Arcn >1.5m)",icon:""},{id:"es-convencional-estrecha",label:"Convencional Estrecha",icon:""},{id:"es-autovia-nacional",label:"Autova / Autopista",icon:""},{id:"madrid-regional-highway",label:"Regional (M-607 / M-506)",icon:""},{id:"es-via-automoviles",label:"Va Automviles",icon:""},{id:"mountain-pass",label:"Puerto de Montaa",icon:""},{id:"es-travesia-nacional",label:"Travesa Nacional",icon:""}]},{label:"ENTORNO URBANO (ESPAA)",items:[{id:"es-calle-30",label:"Calle 30 (Lmite 30)",icon:""},{id:"es-ciclocarril",label:"Ciclocarril / Va Bici",icon:""},{id:"es-supermanzana",label:"Supermanzana / Residencial",icon:""},{id:"school-safety",label:"Zona Escolar Segura",icon:""},{id:"madrid-zbe-enforcement",label:"ZBE (Bajas Emisiones)",icon:""},{id:"parking-enforcement",label:"Carga/Descarga / ORA",icon:""}]},{label:"ACCESOS A DAGANZO (PERMETRO)",items:[{id:"daganzo-m100-enlace",label:"Enlace M-100 (A-2)",icon:""},{id:"daganzo-m113-ajalvir",label:"Acceso Ajalvir",icon:""},{id:"daganzo-m113-norte",label:"Acceso Paracuellos",icon:""},{id:"daganzo-m113-fresno",label:"Acceso Fresno/Serracines",icon:""},{id:"daganzo-m113-sur",label:"Acceso Sur (Torrejn R-2)",icon:""},{id:"daganzo-m118-alcala",label:"M-118 (Alcal)",icon:""},{id:"daganzo-m119-camarma",label:"M-119 (Camarma)",icon:""}]},{label:"NCLEO URBANO Y POLGONOS",items:[{id:"daganzo-constitucion",label:"C/ Constitucin",icon:""},{id:"daganzo-av-madrid",label:"Avenida de Madrid",icon:""},{id:"daganzo-calle-mayor",label:"Calle Mayor",icon:""},{id:"daganzo-rotonda-entrada",label:"Rotonda Principal",icon:""},{id:"daganzo-centro",label:"Centro / Plaza Villa",icon:""},{id:"daganzo-residencial",label:"Zonas SORE",icon:""},{id:"daganzo-colegios-magno",label:"Escuelas (Magno/Berzal)",icon:""},{id:"daganzo-poligono-frailes",label:"P.I. Los Frailes",icon:""},{id:"daganzo-poligono-gitesa",label:"P.I. Gitesa",icon:""},{id:"daganzo-camino-gancha",label:"Camino de la Gancha",icon:""}]}].map((ie,we)=>L.jsxs("div",{className:"space-y-2",children:[L.jsx("div",{className:"text-[11px] font-black text-slate-600 uppercase tracking-widest px-2",children:ie.label}),L.jsx("div",{className:"grid grid-cols-1 gap-1",children:ie.items.map(J=>L.jsxs("button",{onClick:()=>ei(J.id),className:`flex items-center justify-between p-3 rounded-xl border transition-all group ${q.includes(J.id)?"bg-cyan-950/30 border-cyan-500/40 shadow-[0_0_15px_rgba(6,182,212,0.1)]":"bg-black/40 border-white/5 hover:bg-white/5 hover:border-white/10"}`,children:[L.jsxs("div",{className:"flex items-center gap-3 flex-1 text-left",children:[L.jsx("span",{className:`text-xs filter ${q.includes(J.id)?"grayscale-0":"grayscale opacity-50"}`,children:J.icon}),L.jsxs("div",{className:"flex flex-col gap-0.5",children:[L.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${q.includes(J.id)?"text-cyan-400":"text-slate-400 group-hover:text-slate-300"}`,children:J.label}),J.desc&&L.jsx("span",{className:`text-[8px] font-mono leading-tight ${q.includes(J.id)?"text-cyan-500/60":"text-slate-600"}`,children:J.desc})]})]}),q.includes(J.id)&&L.jsx(A_,{size:10,className:"text-cyan-400 shrink-0"})]},J.id))})]},we))})}),L.jsx("div",{className:"px-2 space-y-3 pt-2",children:L.jsxs("button",{onClick:()=>Bt(q,b),className:"w-full py-4 rounded-2xl bg-cyan-500 text-black flex items-center justify-center gap-3 transition-all hover:bg-cyan-400 shadow-[0_0_30px_rgba(6,182,212,0.3)] animate-pulse",children:[L.jsx(C_,{size:18}),L.jsx("span",{className:"text-[12px] font-black uppercase tracking-[0.2em]",children:"SNTESIS AUTOMTICA DE MALLA"})]})}),L.jsxs("div",{className:"px-2 space-y-4 pt-4 border-t border-white/5",children:[L.jsxs("span",{className:"text-[11px] font-black text-slate-500 uppercase block",children:["Malla de Deteccin: ",Be.length," Nodos"]}),L.jsx("div",{className:"flex flex-wrap gap-2 max-h-[100px] overflow-y-auto custom-scrollbar",children:Be.map((ie,we)=>L.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-slate-900 border border-white/5 rounded-full group",children:[L.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:ie.type==="solid"||ie.type==="stop"?"#ef4444":ie.type==="pedestrian"?"#22d3ee":"#f59e0b"}}),L.jsx("span",{className:"text-[10px] font-mono text-slate-400 capitalize",children:ie.label.toLowerCase()}),L.jsx("button",{onClick:()=>je(J=>J.filter((Ye,kt)=>kt!==we)),className:"opacity-0 group-hover:opacity-100 text-red-500 transition-opacity",children:L.jsx($_,{size:8})})]},we))})]})]}),L.jsx("div",{className:"p-6 border-t border-white/5 mt-auto",children:L.jsxs("button",{onClick:Xi,className:`w-full py-4 rounded-2xl flex items-center justify-center gap-3 transition-all ${e==="live"?"bg-cyan-500 text-black":"bg-white/5 text-slate-400"}`,children:[L.jsx(qO,{size:16})," ",L.jsx("span",{className:"text-[12px] font-black uppercase tracking-widest text-inherit",children:"Sync Radar Daganzo"})]})})]}),L.jsxs("main",{className:"flex-1 relative flex flex-col bg-black overflow-hidden group/viewport",children:[L.jsx("canvas",{ref:pi,className:"w-full h-full object-contain"}),L.jsx("div",{className:"absolute top-6 left-6 right-6 z-40 flex justify-between pointer-events-none items-start",children:L.jsxs("div",{className:"flex items-center gap-3 bg-black/60 backdrop-blur-xl px-4 py-2 rounded-2xl border border-cyan-500/20",children:[L.jsx("div",{className:"w-2 h-2 bg-cyan-500 rounded-full animate-pulse shadow-[0_0_10px_#22d3ee]"}),L.jsxs("span",{className:"text-[9px] font-mono text-cyan-400/80 uppercase tracking-wider",children:["LIVE :: ",m," FPS"]})]})}),L.jsx("div",{className:"absolute inset-0 z-10",children:e==="none"?L.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-8 lg:gap-12 animate-in zoom-in-95 duration-1000",children:[L.jsx(cw,{className:"w-64 h-80 lg:w-96 lg:h-[480px] drop-shadow-[0_0_30px_rgba(14,165,233,0.1)]"}),L.jsxs("div",{className:"text-center space-y-4",children:[L.jsx("span",{className:"text-3xl lg:text-4xl font-black uppercase tracking-[0.8em] italic text-white/10 block leading-none",children:"POLICA LOCAL"}),L.jsx("p",{className:"text-[12px] font-mono text-cyan-500/30 uppercase tracking-[0.4em]",children:"Standby :: Esperando Feed Forense"})]})]}):L.jsxs("div",{className:"relative w-full h-full bg-black",children:[L.jsx("video",{ref:Ot,autoPlay:!0,playsInline:!0,muted:!0,loop:!0,className:"absolute inset-0 w-full h-full object-contain brightness-[0.9] contrast-[1.3]"}),L.jsx("canvas",{ref:pi,className:"absolute inset-0 w-full h-full pointer-events-none"}),L.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none hud-grid"}),u&&L.jsxs("div",{className:"absolute bottom-8 right-8 z-50 bg-black/95 border-2 border-red-600/40 p-6 rounded-[30px] flex items-center gap-5 shadow-[0_0_40px_rgba(220,38,38,0.4)] animate-in slide-in-from-bottom-10",children:[L.jsx("div",{className:"w-12 h-12 border-t-3 border-red-600 rounded-full animate-spin flex items-center justify-center",children:L.jsx(C_,{size:24,className:"text-cyan-400 animate-pulse"})}),L.jsxs("div",{className:"flex flex-col",children:[L.jsx("span",{className:"text-[11px] font-black text-red-500 uppercase tracking-widest",children:p}),L.jsx("span",{className:"text-[11px] font-mono text-cyan-500/60 uppercase",children:"Anlisis Forense Neural"})]})]})]})}),L.jsxs("div",{className:"h-32 bg-[#020617]/98 border-t border-white/5 flex items-center justify-between px-12 z-50",children:[L.jsxs("div",{className:"flex items-center gap-8 w-1/3",children:[L.jsx("button",{onClick:()=>s?La():vt(),className:`w-14 h-14 rounded-2xl flex items-center justify-center transition-all ${s?"bg-red-800 shadow-neon":"bg-cyan-600 text-black shadow-neon"}`,children:s?L.jsx(DO,{size:28}):L.jsx(I_,{size:28,className:"ml-1"})}),L.jsxs("div",{className:"flex flex-col",children:[L.jsx("span",{className:"text-[11px] font-black text-slate-600 uppercase tracking-widest mb-1",children:"Status de Feed"}),L.jsx("span",{className:"text-xl font-black italic text-white/95 tracking-tighter uppercase whitespace-nowrap",children:e==="live"?"Neural_Live_Feed":e==="upload"?"Forensic_Buffer":"System_Standby"})]})]}),L.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 w-1/3",children:[L.jsxs("div",{className:"flex items-center gap-3 bg-white/5 px-4 py-1.5 rounded-full border border-white/10 mb-1",children:[L.jsx(R_,{size:12,className:"text-purple-400"}),L.jsx("span",{className:"text-[9px] font-black text-white/80 uppercase tracking-widest",children:"SENTINEL_V15_NODE"})]}),L.jsxs("div",{className:"flex gap-8 border-t border-white/5 pt-2",children:[L.jsxs("div",{className:"text-center",children:[L.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] block",children:"Detecciones"}),L.jsx("span",{className:"text-2xl font-mono font-black text-cyan-500 leading-none",children:k})]}),L.jsxs("div",{className:"text-center",children:[L.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] block",children:"Expedientes"}),L.jsx("span",{className:"text-2xl font-mono font-black text-red-600 leading-none",children:B})]})]})]}),L.jsxs("div",{className:"flex items-center justify-end gap-6 w-1/3",children:[L.jsxs("div",{className:"hidden lg:flex flex-col text-right",children:[L.jsx("span",{className:"text-[11px] font-black text-slate-600 uppercase tracking-widest mb-1",children:"Processor_Unit"}),L.jsx("span",{className:"text-[12px] font-mono text-cyan-400/60 uppercase",children:"Daganzo_Node_01"})]}),L.jsxs("button",{onClick:()=>{var ie;return(ie=document.getElementById("f-up-main"))==null?void 0:ie.click()},className:"w-14 h-14 bg-white/5 rounded-2xl hover:bg-white/10 text-slate-500 transition-all border border-white/10 flex items-center justify-center shadow-neon group",children:[L.jsx(GO,{size:24,className:"group-hover:text-cyan-400 transition-colors"}),L.jsx("input",{id:"f-up-main",type:"file",className:"hidden",accept:"video/*",onChange:ie=>{var J;const we=(J=ie.target.files)==null?void 0:J[0];we&&(a(URL.createObjectURL(we)),t("upload"))}})]})]})]})]}),L.jsxs("aside",{className:"w-full lg:w-96 border-l border-white/5 flex flex-col z-50 bg-[#020617]/98 h-1/2 lg:h-full backdrop-blur-2xl",children:[L.jsxs("div",{className:"p-8 border-b border-white/5 flex items-center justify-between bg-red-950/10",children:[L.jsxs("div",{className:"flex flex-col",children:[L.jsx("span",{className:"text-xl font-black italic tracking-tighter text-red-500 uppercase leading-none",children:"EVIDENCE"}),L.jsx("span",{className:"text-[10px] font-black tracking-[0.5em] text-red-500/80 uppercase whitespace-nowrap",children:"STORAGE & LOGS"})]}),L.jsx(zO,{size:20,className:"text-red-500/50"})]}),L.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar",children:N.map(ie=>L.jsxs("div",{onClick:()=>O(ie),className:"p-4 bg-slate-900/40 border border-white/5 border-l-4 border-l-red-600 rounded-2xl cursor-pointer hover:bg-slate-900 transition-all shadow-lg group hover:border-red-500/30",children:[L.jsxs("div",{className:"relative aspect-video rounded-xl overflow-hidden mb-3 border border-white/10 shadow-lg",children:[L.jsx("img",{src:ie.image,className:"w-full h-full object-cover grayscale brightness-110 contrast-125 group-hover:grayscale-0 transition-all duration-500"}),L.jsx("div",{className:"absolute top-2 right-2 bg-red-700/90 backdrop-blur px-2 py-0.5 rounded text-[10px] font-mono font-black text-white shadow-lg",children:ie.plate})]}),L.jsxs("div",{className:"flex items-center justify-between mb-2",children:[L.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wider",children:ie.subType}),L.jsx("span",{className:`text-[8px] font-black px-2 py-0.5 rounded-full uppercase ${ie.severity==="muy-grave"?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-orange-500/20 text-orange-400 border border-orange-500/30"}`,children:ie.severity})]}),L.jsxs("p",{className:"text-[9px] text-slate-500 font-mono line-clamp-2 leading-relaxed uppercase group-hover:text-slate-400",children:['"',ie.description,'"']})]},ie.id))})]}),$&&L.jsx("div",{className:"fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-6 backdrop-blur-3xl animate-in fade-in duration-500",children:L.jsxs("div",{className:"bg-[#050914] w-full max-w-7xl h-[90vh] rounded-[60px] border border-white/5 overflow-hidden flex flex-col shadow-2xl relative animate-in zoom-in-95",children:[L.jsx("button",{onClick:()=>O(null),className:"absolute top-6 right-6 z-[210] p-3 bg-slate-900/90 rounded-full hover:bg-red-700 text-white transition-all shadow-neon border border-white/10",children:L.jsx($_,{size:24})}),L.jsxs("div",{className:"flex-1 p-6 lg:p-8 flex flex-col lg:flex-row gap-6 overflow-hidden",children:[L.jsxs("div",{className:"flex-1 flex flex-col gap-4 overflow-y-auto custom-scrollbar",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("h3",{className:"text-cyan-500 font-black uppercase text-sm tracking-[0.2em] flex items-center gap-4 italic",children:[L.jsx(VO,{size:20,className:"animate-pulse"})," EVIDENCE CLIP (HD_10S)"]}),L.jsxs("div",{className:"flex gap-4",children:[L.jsxs("span",{className:"bg-slate-900 border border-white/10 px-4 py-1.5 rounded-xl text-[12px] font-mono text-slate-400 flex items-center gap-2",children:[L.jsx(NO,{size:12})," ",$.time]}),L.jsxs("span",{className:"bg-slate-900 border border-white/10 px-4 py-1.5 rounded-xl text-[12px] font-mono text-purple-400 flex items-center gap-2",children:[L.jsx(kO,{size:12})," 3M_LANE_CALIB"]})]})]}),L.jsxs("div",{className:"relative bg-[#0a0a0a] rounded-[60px] overflow-hidden border border-white/10 shadow-[0_0_80px_rgba(34,211,238,0.1)] group",children:[L.jsx("div",{className:"absolute top-0 left-0 right-0 p-8 flex justify-center pointer-events-none z-20",children:L.jsx("div",{className:"bg-red-700 text-white px-10 py-4 rounded-b-[40px] font-black text-lg uppercase tracking-tighter shadow-2xl text-center leading-tight max-w-[80%]",children:$.legalArticle||"ART. 151 DEL REGLAMENTO GENERAL DE CIRCULACIN"})}),L.jsx("div",{className:"aspect-video relative",children:$.videoUrl?L.jsxs(L.Fragment,{children:[L.jsx("video",{ref:ie=>{ie&&(ie.onloadedmetadata=()=>{},ie.ontimeupdate=()=>{})},src:$.videoUrl,autoPlay:!0,loop:!0,muted:!0,className:"w-full h-full object-contain brightness-110 contrast-125"}),L.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-opacity",children:L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors",children:L.jsx(I_,{size:14,className:"text-white"})}),L.jsx("div",{className:"flex-1 h-1 bg-white/20 rounded-full overflow-hidden cursor-pointer group/timeline",children:L.jsx("div",{className:"h-full bg-cyan-500 w-1/2"})}),L.jsx("span",{className:"text-xs font-mono text-white/60",children:"00:00 / 00:10"})]})})]}):L.jsx("img",{src:$.image,className:"w-full h-full object-contain"})}),L.jsx("div",{className:"absolute inset-0 bg-red-600/5 pointer-events-none"})]}),L.jsxs("div",{className:"bg-[#0a0a0a]/50 p-10 rounded-[50px] border border-white/5 space-y-4",children:[L.jsxs("div",{className:"text-cyan-500 font-black uppercase text-sm tracking-[0.4em] italic flex items-center gap-2",children:[L.jsx(R_,{size:16})," ",$.vehicleType," / FORENSIC_CALIB"]}),L.jsx("h2",{className:"text-5xl lg:text-6xl font-black italic text-white tracking-tighter uppercase font-mono",children:$.plate})]}),L.jsxs("div",{className:"grid grid-cols-4 gap-6 px-2",children:[L.jsxs("div",{className:"bg-[#0a0a0a] aspect-[3/4.5] rounded-[60px] border border-white/5 flex flex-col items-center justify-between py-10 text-center group transition-transform hover:scale-105",children:[L.jsx("span",{className:"text-[9px] font-black text-slate-600 uppercase tracking-widest font-mono",children:"Calibracin"}),L.jsxs("div",{className:"flex flex-col items-center",children:[L.jsx("span",{className:"text-[16px] font-black text-purple-500 uppercase leading-none",children:"CARRIL"}),L.jsx("span",{className:"text-[18px] font-black text-purple-500 font-mono",children:"3.0M"})]}),L.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500/30 border border-purple-500 animate-pulse"})]}),L.jsxs("div",{className:"bg-[#0a0a0a] aspect-[3/4.5] rounded-[60px] border border-white/5 flex flex-col items-center justify-between py-10 text-center transition-transform hover:scale-105",children:[L.jsx("span",{className:"text-[9px] font-black text-slate-600 uppercase tracking-widest font-mono",children:"Velocidad_Est."}),L.jsxs("div",{className:"flex flex-col items-center",children:[L.jsx("span",{className:"text-4xl font-mono font-black text-amber-500 leading-none",children:(Ni=$.telemetry)==null?void 0:Ni.speedEstimated.replace(" km/h","")}),L.jsx("span",{className:"text-[14px] font-black text-amber-500/50 uppercase font-mono",children:"km/h"})]}),L.jsx(MO,{size:18,className:"text-amber-500/40"})]}),L.jsxs("div",{className:"bg-[#0a0a0a] aspect-[3/4.5] rounded-[60px] border border-white/5 flex flex-col items-center justify-between py-10 text-center transition-transform hover:scale-105",children:[L.jsx("span",{className:"text-[9px] font-black text-slate-600 uppercase tracking-widest font-mono",children:"Confianza_AI"}),L.jsxs("span",{className:"text-4xl font-mono font-black text-cyan-400 leading-none",children:[($.confidence*100).toFixed(0),"%"]}),L.jsx("div",{className:"w-12 h-1 bg-cyan-500/20 rounded-full overflow-hidden",children:L.jsx("div",{className:"h-full bg-cyan-500",style:{width:`${$.confidence*100}%`}})})]}),L.jsxs("div",{className:"bg-[#0a0a0a] aspect-[3/4.5] rounded-[60px] border border-white/5 flex flex-col items-center justify-between py-10 text-center transition-transform hover:scale-105",children:[L.jsx("span",{className:"text-[9px] font-black text-slate-600 uppercase tracking-widest font-mono",children:"Severidad"}),L.jsx("span",{className:"text-[16px] font-black text-red-600 uppercase font-mono leading-none tracking-tighter whitespace-nowrap",children:$.severity}),L.jsx(N_,{size:20,className:"text-red-600 animate-bounce"})]})]}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center justify-between px-4",children:[L.jsxs("h3",{className:"text-cyan-500 font-black uppercase text-[12px] tracking-[0.3em] flex items-center gap-3 italic",children:[L.jsx(x_,{size:16,className:"text-cyan-500"})," NEURAL_FORENSIC_BUFFER [BIF]"]}),L.jsxs("span",{className:"text-[11px] font-mono text-slate-500 uppercase",children:[((dn=$.snapshots)==null?void 0:dn.length)||0," SECUENTIAL_FRAMES_CAPTURED"]})]}),L.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-4 custom-scrollbar snap-x",children:[(Hn=$.snapshots)==null?void 0:Hn.map((ie,we)=>L.jsxs("div",{className:"min-w-[120px] aspect-[4/3] bg-slate-900 rounded-2xl border border-white/10 overflow-hidden snap-center group relative cursor-pointer hover:border-cyan-500/50 transition-all shrink-0",children:[L.jsx("img",{src:`data:image/jpeg;base64,${ie}`,className:"w-full h-full object-cover grayscale brightness-110 contrast-125 group-hover:grayscale-0 transition-all"}),L.jsxs("div",{className:"absolute bottom-1 right-2 text-[10px] font-mono text-white/40",children:["F_",we.toString().padStart(2,"0")]})]},we)),(!$.snapshots||$.snapshots.length===0)&&L.jsxs("div",{className:"w-full py-12 flex flex-col items-center justify-center border border-dashed border-white/5 rounded-3xl text-slate-600",children:[L.jsx(LO,{size:32,className:"mb-2 opacity-20"}),L.jsx("span",{className:"text-[12px] font-black uppercase tracking-widest",children:"No BIF Data Available"})]})]})]})]}),L.jsxs("div",{className:"w-full lg:w-[480px] flex flex-col gap-10 lg:pt-2",children:[L.jsxs("div",{className:"space-y-6",children:[L.jsxs("h3",{className:"text-red-500 font-black uppercase text-sm tracking-[0.2em] italic flex items-center gap-4",children:[L.jsx(N_,{size:20,className:"text-red-600 animate-pulse"})," FORENSIC EVIDENCE REPORT"]}),L.jsx("div",{className:"bg-[#0c0c0c] p-10 lg:p-14 rounded-[50px] border border-red-900/10 shadow-inner relative",children:L.jsxs("p",{className:"text-slate-100 italic text-2xl lg:text-3xl leading-relaxed font-serif",children:['"',$.description,'"']})})]}),L.jsxs("div",{className:"flex-1 p-8 bg-[#0a0a0a] rounded-[50px] border border-white/5 flex flex-col overflow-hidden",children:[L.jsxs("h3",{className:"text-[12px] font-black uppercase text-slate-500 flex items-center gap-4 italic tracking-widest mb-6 border-b border-white/5 pb-4",children:[L.jsx(BO,{size:18,className:"text-cyan-500"})," ORDERED_EVIDENCE_LOG"]}),L.jsx("div",{className:"space-y-4 overflow-y-auto custom-scrollbar pr-2",children:(fn=$.reasoning)==null?void 0:fn.map((ie,we)=>L.jsxs("div",{className:"flex gap-4 text-[13px] font-mono leading-relaxed py-3 border-b border-white/5 last:border-0 text-slate-400",children:[L.jsx("span",{className:"text-red-600 font-black h-fit shrink-0",children:"_>"}),L.jsx("span",{children:ie})]},we))})]}),L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center gap-6 p-8 bg-slate-950/40 rounded-[40px] border border-white/5",children:[L.jsx(cw,{className:"w-12 h-14 opacity-50"}),L.jsxs("div",{className:"flex flex-col",children:[L.jsx("span",{className:"text-[12px] font-black text-white/30 uppercase tracking-[0.2em]",children:"CERTIFICADO POR"}),L.jsx("span",{className:"text-[11px] font-black text-cyan-500 uppercase",children:"P.L. DAGANZO DE ARRIBA"})]})]}),L.jsx("button",{onClick:()=>O(null),className:"w-full py-10 bg-[#b91c1c] text-white rounded-[45px] font-black uppercase tracking-[0.5em] text-3xl shadow-[0_20px_60px_rgba(185,28,28,0.3)] hover:bg-red-600 hover:scale-[1.01] transition-all transform active:scale-95 leading-none",children:"VALIDAR EXPEDIENTE"})]})]})]})]})}),L.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100;300;400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
          font-family: 'Outfit', sans-serif;
        }

        .hud-grid { 
          background-image: linear-gradient(to right, rgba(34, 211, 238, 0.02) 1px, transparent 1px), 
                            linear-gradient(to bottom, rgba(34, 211, 238, 0.02) 1px, transparent 1px); 
          background-size: 100px 100px; 
        }
        .shadow-neon { box-shadow: 0 0 50px rgba(34, 211, 238, 0.15); }
        
        /* Infractor Glow Animation */
        @keyframes redGlow {
          0%, 100% { filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.8)); }
          50% { filter: drop-shadow(0 0 25px rgba(239, 68, 68, 1)); }
        }
        
        /* Border Vibration */
        @keyframes vibrate {
          0%, 100% { transform: translate(0, 0); }
          25% { transform: translate(-1px, 1px); }
          50% { transform: translate(1px, -1px); }
          75% { transform: translate(-1px, -1px); }
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 15px; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Range Slider Styling */
        input[type="range"].slider-thumb::-webkit-slider-thumb {
          appearance: none;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #f59e0b;
          cursor: pointer;
          border: 2px solid #0c4a6e;
          box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
          transition: all 0.2s;
        }
        input[type="range"].slider-thumb::-webkit-slider-thumb:hover {
          background: #fbbf24;
          box-shadow: 0 0 15px rgba(245, 158, 11, 0.8);
          transform: scale(1.1);
        }
        input[type="range"].slider-thumb::-moz-range-thumb {
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #f59e0b;
          cursor: pointer;
          border: 2px solid #0c4a6e;
          box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        }
      `})]})},bk=hA.createRoot(document.getElementById("root"));bk.render(L.jsx(_k,{}));
